--- a/grsecurity-2.1.12-2.6.26.6-200810131006.patch
+++ b/grsecurity-2.1.12-2.6.26.6-200810131006.patch
@@ -1,102 +1,4 @@
-diff --git a/Documentation/dontdiff b/Documentation/dontdiff
-index 881e6dd03aea411bb9a1b0b11aa3b4fb3a90761e..5165eb5a1c433bde9f8399c76e29f3f75eb7f304 100644
---- a/Documentation/dontdiff
-+++ b/Documentation/dontdiff
-@@ -3,6 +3,7 @@
- *.bin
- *.cpio
- *.css
-+*.dbg
- *.dvi
- *.eps
- *.gif
-@@ -51,9 +52,14 @@ COPYING
- CREDITS
- CVS
- ChangeSet
-+GPATH
-+GRTAGS
-+GSYMS
-+GTAGS
- Image
- Kerntypes
- MODS.txt
-+Module.markers
- Module.symvers
- PENDING
- SCCS
-@@ -72,6 +78,7 @@ bbootsect
- bin2c
- binkernel.spec
- bootsect
-+bounds.h
- bsetup
- btfixupprep
- build
-@@ -88,6 +95,7 @@ config_data.gz*
- conmakehash
- consolemap_deftbl.c*
- crc32table.h*
-+cpustr.h
- cscope.*
- defkeymap.c*
- devlist.h*
-@@ -136,6 +144,7 @@ miboot*
- mk_elfconfig
- mkboot
- mkbugboot
-+mkcpustr
- mkdep
- mkprep
- mktables
-@@ -177,16 +186,20 @@ times.h*
- tkparse
- trix_boot.h
- utsrelease.h*
--vdso.lds
-+vdso*.lds
- version.h*
- vmlinux
- vmlinux-*
- vmlinux.aout
--vmlinux*.lds*
-+vmlinux.bin.all
-+vmlinux*.lds
-+vmlinux.relocs
- vmlinux*.scr
--vsyscall.lds
-+vsyscall*.lds
-+wakeup.lds
- wanxlfw.inc
- uImage
- unifdef
-+utsrelease.h
- zImage*
- zconf.hash.c
-diff --git a/Makefile b/Makefile
-index 0250a3761f35db5970ac270981164ffe3c27e815..03e0b8c895b22d317e822a05766b32b50f89ce95 100644
---- a/Makefile
-+++ b/Makefile
-@@ -214,7 +214,7 @@ CONFIG_SHELL := $(shell if [ -x "$$BASH" ]; then echo $$BASH; \
- 
- HOSTCC       = gcc
- HOSTCXX      = g++
--HOSTCFLAGS   = -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer
-+HOSTCFLAGS   = -Wall -W -Wno-unused -Wno-sign-compare -Wstrict-prototypes -O2 -fomit-frame-pointer
- HOSTCXXFLAGS = -O2
- 
- # Decide whether to build built-in, modular, or both.
-@@ -607,7 +607,7 @@ export mod_strip_cmd
- 
- 
- ifeq ($(KBUILD_EXTMOD),)
--core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
-+core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
- 
- vmlinux-dirs	:= $(patsubst %/,%,$(filter %/, $(init-y) $(init-m) \
- 		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \
-diff --git a/arch/alpha/kernel/module.c b/arch/alpha/kernel/module.c
-index ebc3c894b5a2cc0d5a871e0e30ac99249d599bd7..20cfa6366fe0fe79b43b6b453c6bae364ece7deb 100644
---- a/arch/alpha/kernel/module.c
-+++ b/arch/alpha/kernel/module.c
-@@ -182,7 +182,7 @@ apply_relocate_add(Elf64_Shdr *sechdrs, const char *strtab,
+diff -urNp linux-2.6.26.6/arch/alpha/kernel/module.c linux-2.6.26.6/arch/alpha/kernel/module.c
+--- linux-2.6.26.6/arch/alpha/kernel/module.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/alpha/kernel/module.c	2008-10-11 21:54:18.000000000 -0400
+@@ -182,7 +182,7 @@ apply_relocate_add(Elf64_Shdr *sechdrs, 
@@ -111,5 +13,4 @@
-diff --git a/arch/alpha/kernel/osf_sys.c b/arch/alpha/kernel/osf_sys.c
-index 32ca1b9273078d7025466075e677a59e34938b33..36408c7a415b6924a307e7d01fd4e9890196e7d5 100644
---- a/arch/alpha/kernel/osf_sys.c
-+++ b/arch/alpha/kernel/osf_sys.c
-@@ -1227,6 +1227,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.6/arch/alpha/kernel/osf_sys.c linux-2.6.26.6/arch/alpha/kernel/osf_sys.c
+--- linux-2.6.26.6/arch/alpha/kernel/osf_sys.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/alpha/kernel/osf_sys.c	2008-10-11 21:54:18.000000000 -0400
+@@ -1227,6 +1227,10 @@ arch_get_unmapped_area(struct file *filp
@@ -126 +27 @@
-@@ -1234,8 +1238,8 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -1234,8 +1238,8 @@ arch_get_unmapped_area(struct file *filp
@@ -137,4 +38,3 @@
-diff --git a/arch/alpha/kernel/ptrace.c b/arch/alpha/kernel/ptrace.c
-index 1e9ad52c460ec293aa70f9cbc5bb3094adc08d74..a2323ed1317248952f8831b2b3043a3b6a79a3cc 100644
---- a/arch/alpha/kernel/ptrace.c
-+++ b/arch/alpha/kernel/ptrace.c
+diff -urNp linux-2.6.26.6/arch/alpha/kernel/ptrace.c linux-2.6.26.6/arch/alpha/kernel/ptrace.c
+--- linux-2.6.26.6/arch/alpha/kernel/ptrace.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/alpha/kernel/ptrace.c	2008-10-11 21:54:18.000000000 -0400
@@ -149 +49 @@
-@@ -266,6 +267,9 @@ long arch_ptrace(struct task_struct *child, long request, long addr, long data)
+@@ -266,6 +267,9 @@ long arch_ptrace(struct task_struct *chi
@@ -159,5 +59,4 @@
-diff --git a/arch/alpha/mm/fault.c b/arch/alpha/mm/fault.c
-index 4829f96585b15a1fd59f0409750df4ed59d99d35..d5887030bae361b5559aa22fcfd3329a875204d2 100644
---- a/arch/alpha/mm/fault.c
-+++ b/arch/alpha/mm/fault.c
-@@ -54,6 +54,124 @@ __load_new_mm_context(struct mm_struct *next_mm)
+diff -urNp linux-2.6.26.6/arch/alpha/mm/fault.c linux-2.6.26.6/arch/alpha/mm/fault.c
+--- linux-2.6.26.6/arch/alpha/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/alpha/mm/fault.c	2008-10-11 21:54:18.000000000 -0400
+@@ -54,6 +54,124 @@ __load_new_mm_context(struct mm_struct *
@@ -288 +187 @@
-@@ -131,8 +249,29 @@ do_page_fault(unsigned long address, unsigned long mmcsr,
+@@ -131,8 +249,29 @@ do_page_fault(unsigned long address, uns
@@ -319,5 +218,4 @@
-diff --git a/arch/arm/mm/mmap.c b/arch/arm/mm/mmap.c
-index 3f6dc40b835321fd469a23ce8ffa49089377e74b..994c15d2e153eb25003a4efa40588661443b9a97 100644
---- a/arch/arm/mm/mmap.c
-+++ b/arch/arm/mm/mmap.c
-@@ -60,6 +60,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.6/arch/arm/mm/mmap.c linux-2.6.26.6/arch/arm/mm/mmap.c
+--- linux-2.6.26.6/arch/arm/mm/mmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/arm/mm/mmap.c	2008-10-11 21:54:19.000000000 -0400
+@@ -60,6 +60,10 @@ arch_get_unmapped_area(struct file *filp
@@ -334 +232 @@
-@@ -72,10 +76,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -72,10 +76,10 @@ arch_get_unmapped_area(struct file *filp
@@ -359,5 +257,4 @@
-diff --git a/arch/avr32/mm/fault.c b/arch/avr32/mm/fault.c
-index ce4e4296b95467f3e0b715a9ec953398917be8f7..ef6aa1cff4d308699b64596cefc86d0119a3eed1 100644
---- a/arch/avr32/mm/fault.c
-+++ b/arch/avr32/mm/fault.c
-@@ -41,6 +41,23 @@ static inline int notify_page_fault(struct pt_regs *regs, int trap)
+diff -urNp linux-2.6.26.6/arch/avr32/mm/fault.c linux-2.6.26.6/arch/avr32/mm/fault.c
+--- linux-2.6.26.6/arch/avr32/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/avr32/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
+@@ -41,6 +41,23 @@ static inline int notify_page_fault(stru
@@ -404,5 +301,4 @@
-diff --git a/arch/ia64/ia32/binfmt_elf32.c b/arch/ia64/ia32/binfmt_elf32.c
-index 4f0c30c38e994c1ea188f811232ecc27f7b81be1..04175b44ceec080f0ad942dd270c53335426685b 100644
---- a/arch/ia64/ia32/binfmt_elf32.c
-+++ b/arch/ia64/ia32/binfmt_elf32.c
-@@ -45,6 +45,13 @@ randomize_stack_top(unsigned long stack_top);
+diff -urNp linux-2.6.26.6/arch/ia64/ia32/binfmt_elf32.c linux-2.6.26.6/arch/ia64/ia32/binfmt_elf32.c
+--- linux-2.6.26.6/arch/ia64/ia32/binfmt_elf32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ia64/ia32/binfmt_elf32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -45,6 +45,13 @@ randomize_stack_top(unsigned long stack_
@@ -422,4 +318,3 @@
-diff --git a/arch/ia64/ia32/ia32priv.h b/arch/ia64/ia32/ia32priv.h
-index c5c872b250da5e420a661fb25223115fe2c7b424..04d89df37768ea6dadd07d59fef5bf1f7528abe1 100644
---- a/arch/ia64/ia32/ia32priv.h
-+++ b/arch/ia64/ia32/ia32priv.h
+diff -urNp linux-2.6.26.6/arch/ia64/ia32/ia32priv.h linux-2.6.26.6/arch/ia64/ia32/ia32priv.h
+--- linux-2.6.26.6/arch/ia64/ia32/ia32priv.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ia64/ia32/ia32priv.h	2008-10-11 21:54:19.000000000 -0400
@@ -442,4 +337,3 @@
-diff --git a/arch/ia64/kernel/module.c b/arch/ia64/kernel/module.c
-index e83e2ea3b3e0787ea673ae7451ae2855196f1c38..30baec96ed72ee6c4225eec5e310836097e9fbbe 100644
---- a/arch/ia64/kernel/module.c
-+++ b/arch/ia64/kernel/module.c
+diff -urNp linux-2.6.26.6/arch/ia64/kernel/module.c linux-2.6.26.6/arch/ia64/kernel/module.c
+--- linux-2.6.26.6/arch/ia64/kernel/module.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ia64/kernel/module.c	2008-10-11 21:54:19.000000000 -0400
@@ -455 +349 @@
-@@ -499,15 +499,39 @@ module_frob_arch_sections (Elf_Ehdr *ehdr, Elf_Shdr *sechdrs, char *secstrings,
+@@ -499,15 +499,39 @@ module_frob_arch_sections (Elf_Ehdr *ehd
@@ -497 +391 @@
-@@ -691,7 +715,14 @@ do_reloc (struct module *mod, uint8_t r_type, Elf64_Sym *sym, uint64_t addend,
+@@ -691,7 +715,14 @@ do_reloc (struct module *mod, uint8_t r_
@@ -513 +407 @@
-@@ -825,15 +856,15 @@ apply_relocate_add (Elf64_Shdr *sechdrs, const char *strtab, unsigned int symind
+@@ -825,15 +856,15 @@ apply_relocate_add (Elf64_Shdr *sechdrs,
@@ -533,5 +427,4 @@
-diff --git a/arch/ia64/kernel/sys_ia64.c b/arch/ia64/kernel/sys_ia64.c
-index 1eda194b95595110497adb009e457f8fe5c9d116..234545fae698b039477a6cba397c7f80101afada 100644
---- a/arch/ia64/kernel/sys_ia64.c
-+++ b/arch/ia64/kernel/sys_ia64.c
-@@ -43,6 +43,13 @@ arch_get_unmapped_area (struct file *filp, unsigned long addr, unsigned long len
+diff -urNp linux-2.6.26.6/arch/ia64/kernel/sys_ia64.c linux-2.6.26.6/arch/ia64/kernel/sys_ia64.c
+--- linux-2.6.26.6/arch/ia64/kernel/sys_ia64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ia64/kernel/sys_ia64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -43,6 +43,13 @@ arch_get_unmapped_area (struct file *fil
@@ -551 +444 @@
-@@ -61,9 +68,9 @@ arch_get_unmapped_area (struct file *filp, unsigned long addr, unsigned long len
+@@ -61,9 +68,9 @@ arch_get_unmapped_area (struct file *fil
@@ -563,5 +456,4 @@
-diff --git a/arch/ia64/mm/fault.c b/arch/ia64/mm/fault.c
-index 23088bed111ec229c4df3b1315da0e0fce7411a3..63326c8e5d45a09d58a30ebc594e98b2cfb1111d 100644
---- a/arch/ia64/mm/fault.c
-+++ b/arch/ia64/mm/fault.c
-@@ -72,6 +72,23 @@ mapped_kernel_page_is_present (unsigned long address)
+diff -urNp linux-2.6.26.6/arch/ia64/mm/fault.c linux-2.6.26.6/arch/ia64/mm/fault.c
+--- linux-2.6.26.6/arch/ia64/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ia64/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
+@@ -72,6 +72,23 @@ mapped_kernel_page_is_present (unsigned 
@@ -591 +483 @@
-@@ -145,9 +162,23 @@ ia64_do_page_fault (unsigned long address, unsigned long isr, struct pt_regs *re
+@@ -145,9 +162,23 @@ ia64_do_page_fault (unsigned long addres
@@ -616,4 +508,3 @@
-diff --git a/arch/ia64/mm/init.c b/arch/ia64/mm/init.c
-index 200100ea7610883ae8fc90768a64ba185aa68d3c..c046c61b22106b3174e71d34ffb74c8e89b66aac 100644
---- a/arch/ia64/mm/init.c
-+++ b/arch/ia64/mm/init.c
+diff -urNp linux-2.6.26.6/arch/ia64/mm/init.c linux-2.6.26.6/arch/ia64/mm/init.c
+--- linux-2.6.26.6/arch/ia64/mm/init.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ia64/mm/init.c	2008-10-11 21:54:19.000000000 -0400
@@ -640,5 +531,4 @@
-diff --git a/arch/mips/kernel/binfmt_elfn32.c b/arch/mips/kernel/binfmt_elfn32.c
-index 9fdd8bcdd21ef1785c90cc40b0579b6acb4dc1a0..ddb854ac30b55aad356d8fd2940ef83eb0d42623 100644
---- a/arch/mips/kernel/binfmt_elfn32.c
-+++ b/arch/mips/kernel/binfmt_elfn32.c
-@@ -50,6 +50,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_NFPREG];
+diff -urNp linux-2.6.26.6/arch/mips/kernel/binfmt_elfn32.c linux-2.6.26.6/arch/mips/kernel/binfmt_elfn32.c
+--- linux-2.6.26.6/arch/mips/kernel/binfmt_elfn32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/mips/kernel/binfmt_elfn32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -50,6 +50,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_N
@@ -658,5 +548,4 @@
-diff --git a/arch/mips/kernel/binfmt_elfo32.c b/arch/mips/kernel/binfmt_elfo32.c
-index e1333d7319e275a065546490baa8401b87c9bf47..563c82cd5e79e69ca3b7d5eaace767c01f74ed79 100644
---- a/arch/mips/kernel/binfmt_elfo32.c
-+++ b/arch/mips/kernel/binfmt_elfo32.c
-@@ -52,6 +52,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_NFPREG];
+diff -urNp linux-2.6.26.6/arch/mips/kernel/binfmt_elfo32.c linux-2.6.26.6/arch/mips/kernel/binfmt_elfo32.c
+--- linux-2.6.26.6/arch/mips/kernel/binfmt_elfo32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/mips/kernel/binfmt_elfo32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -52,6 +52,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_N
@@ -676,5 +565,4 @@
-diff --git a/arch/mips/kernel/syscall.c b/arch/mips/kernel/syscall.c
-index af1bdc897488acf4d71f65bc69579f58b03183ce..fd128c068c183ee5dc0e4e8cc92bac96fa3b5abf 100644
---- a/arch/mips/kernel/syscall.c
-+++ b/arch/mips/kernel/syscall.c
-@@ -93,6 +93,11 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.6/arch/mips/kernel/syscall.c linux-2.6.26.6/arch/mips/kernel/syscall.c
+--- linux-2.6.26.6/arch/mips/kernel/syscall.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/mips/kernel/syscall.c	2008-10-11 21:54:19.000000000 -0400
+@@ -93,6 +93,11 @@ unsigned long arch_get_unmapped_area(str
@@ -692 +580 @@
-@@ -103,7 +108,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -103,7 +108,7 @@ unsigned long arch_get_unmapped_area(str
@@ -701,4 +589,3 @@
-diff --git a/arch/mips/mm/fault.c b/arch/mips/mm/fault.c
-index fa636fc6b7b90403a2a8771ef3c5f023a1a82cd4..d0f020b4e4c3c3fcfefdb7cb61ac95d3b1566471 100644
---- a/arch/mips/mm/fault.c
-+++ b/arch/mips/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/mips/mm/fault.c linux-2.6.26.6/arch/mips/mm/fault.c
+--- linux-2.6.26.6/arch/mips/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/mips/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
@@ -729,4 +616,3 @@
-diff --git a/arch/parisc/kernel/module.c b/arch/parisc/kernel/module.c
-index fdacdd4341c9f3ccf3189afe683b7179ead823d4..35faae68a32fb421743a6fda2041dba957761bf5 100644
---- a/arch/parisc/kernel/module.c
-+++ b/arch/parisc/kernel/module.c
+diff -urNp linux-2.6.26.6/arch/parisc/kernel/module.c linux-2.6.26.6/arch/parisc/kernel/module.c
+--- linux-2.6.26.6/arch/parisc/kernel/module.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/parisc/kernel/module.c	2008-10-11 21:54:19.000000000 -0400
@@ -776 +662 @@
-@@ -296,21 +318,21 @@ int module_frob_arch_sections(CONST Elf_Ehdr *hdr,
+@@ -296,21 +318,21 @@ int module_frob_arch_sections(CONST Elf_
@@ -783,4 +669 @@
-+	me->core_size_rw = ALIGN(me->core_size_rw, 16);
-+	me->arch.got_offset = me->core_size_rw;
-+	me->core_size_rw += gots * sizeof(struct got_entry);
- 
+-
@@ -790,4 +673 @@
-+	me->core_size_rw = ALIGN(me->core_size_rw, 16);
-+	me->arch.fdesc_offset = me->core_size_rw;
-+	me->core_size_rw += fdescs * sizeof(Elf_Fdesc);
- 
+-
@@ -797,4 +677 @@
-+	me->core_size_rx = ALIGN(me->core_size_rx, 16);
-+	me->arch.stub_offset = me->core_size_rx;
-+	me->core_size_rx += stubs * sizeof(struct stub_entry);
- 
+-
@@ -803,0 +681,12 @@
++	me->core_size_rw = ALIGN(me->core_size_rw, 16);
++	me->arch.got_offset = me->core_size_rw;
++	me->core_size_rw += gots * sizeof(struct got_entry);
++
++	me->core_size_rw = ALIGN(me->core_size_rw, 16);
++	me->arch.fdesc_offset = me->core_size_rw;
++	me->core_size_rw += fdescs * sizeof(Elf_Fdesc);
++
++	me->core_size_rx = ALIGN(me->core_size_rx, 16);
++	me->arch.stub_offset = me->core_size_rx;
++	me->core_size_rx += stubs * sizeof(struct stub_entry);
++
@@ -810 +699 @@
-@@ -330,7 +352,7 @@ static Elf64_Word get_got(struct module *me, unsigned long value, long addend)
+@@ -330,7 +352,7 @@ static Elf64_Word get_got(struct module 
@@ -819 +708 @@
-@@ -348,7 +370,7 @@ static Elf64_Word get_got(struct module *me, unsigned long value, long addend)
+@@ -348,7 +370,7 @@ static Elf64_Word get_got(struct module 
@@ -828 +717 @@
-@@ -366,7 +388,7 @@ static Elf_Addr get_fdesc(struct module *me, unsigned long value)
+@@ -366,7 +388,7 @@ static Elf_Addr get_fdesc(struct module 
@@ -837 +726 @@
-@@ -386,12 +408,12 @@ static Elf_Addr get_stub(struct module *me, unsigned long value, long addend,
+@@ -386,12 +408,12 @@ static Elf_Addr get_stub(struct module *
@@ -861,5 +750,4 @@
-diff --git a/arch/parisc/kernel/sys_parisc.c b/arch/parisc/kernel/sys_parisc.c
-index 71b31957c8f13805c5a8da1c93c6061bf562f2a7..e15efcf0431812a6b10ca6bb47227f3d4e0e5661 100644
---- a/arch/parisc/kernel/sys_parisc.c
-+++ b/arch/parisc/kernel/sys_parisc.c
-@@ -98,7 +98,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.6/arch/parisc/kernel/sys_parisc.c linux-2.6.26.6/arch/parisc/kernel/sys_parisc.c
+--- linux-2.6.26.6/arch/parisc/kernel/sys_parisc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/parisc/kernel/sys_parisc.c	2008-10-11 21:54:19.000000000 -0400
+@@ -98,7 +98,7 @@ unsigned long arch_get_unmapped_area(str
@@ -874,5 +762,4 @@
-diff --git a/arch/parisc/kernel/traps.c b/arch/parisc/kernel/traps.c
-index 675f1d098f05d2f6ec29ab8c5be3d55005627a03..2d603e5c4596480042d2b5d12ece1038b9a6a851 100644
---- a/arch/parisc/kernel/traps.c
-+++ b/arch/parisc/kernel/traps.c
-@@ -732,9 +732,7 @@ void handle_interruption(int code, struct pt_regs *regs)
+diff -urNp linux-2.6.26.6/arch/parisc/kernel/traps.c linux-2.6.26.6/arch/parisc/kernel/traps.c
+--- linux-2.6.26.6/arch/parisc/kernel/traps.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/parisc/kernel/traps.c	2008-10-11 21:54:19.000000000 -0400
+@@ -732,9 +732,7 @@ void handle_interruption(int code, struc
@@ -889,4 +776,3 @@
-diff --git a/arch/parisc/mm/fault.c b/arch/parisc/mm/fault.c
-index b2e3e9a8cecefce049d43ef1a5d36d61403cc9b9..3352cc553863cb5b8dd976ae3a98613b03f37608 100644
---- a/arch/parisc/mm/fault.c
-+++ b/arch/parisc/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/parisc/mm/fault.c linux-2.6.26.6/arch/parisc/mm/fault.c
+--- linux-2.6.26.6/arch/parisc/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/parisc/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
@@ -901 +787 @@
-@@ -53,7 +54,7 @@ DEFINE_PER_CPU(struct exception_data, exception_data);
+@@ -53,7 +54,7 @@ DEFINE_PER_CPU(struct exception_data, ex
@@ -910 +796 @@
-@@ -139,6 +140,116 @@ parisc_acctyp(unsigned long code, unsigned int inst)
+@@ -139,6 +140,116 @@ parisc_acctyp(unsigned long code, unsign
@@ -1062,5 +948,4 @@
-diff --git a/arch/powerpc/kernel/module_32.c b/arch/powerpc/kernel/module_32.c
-index eab313858315ef991b5efc0d6886433105e1ac89..a0d0e7ec6beea5df9b164fcf2d321462670b0733 100644
---- a/arch/powerpc/kernel/module_32.c
-+++ b/arch/powerpc/kernel/module_32.c
-@@ -175,7 +175,7 @@ int module_frob_arch_sections(Elf32_Ehdr *hdr,
+diff -urNp linux-2.6.26.6/arch/powerpc/kernel/module_32.c linux-2.6.26.6/arch/powerpc/kernel/module_32.c
+--- linux-2.6.26.6/arch/powerpc/kernel/module_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/powerpc/kernel/module_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -175,7 +175,7 @@ int module_frob_arch_sections(Elf32_Ehdr
@@ -1075 +960 @@
-@@ -216,11 +216,16 @@ static uint32_t do_plt_call(void *location,
+@@ -216,11 +216,16 @@ static uint32_t do_plt_call(void *locati
@@ -1095,5 +980,4 @@
-diff --git a/arch/powerpc/kernel/signal_32.c b/arch/powerpc/kernel/signal_32.c
-index ad6943468ee9f25aee853a3ded8f99271f1c3d72..1e44d2e644c80e1ba0e1005d43f8dd3f10b1996d 100644
---- a/arch/powerpc/kernel/signal_32.c
-+++ b/arch/powerpc/kernel/signal_32.c
-@@ -743,7 +743,7 @@ int handle_rt_signal32(unsigned long sig, struct k_sigaction *ka,
+diff -urNp linux-2.6.26.6/arch/powerpc/kernel/signal_32.c linux-2.6.26.6/arch/powerpc/kernel/signal_32.c
+--- linux-2.6.26.6/arch/powerpc/kernel/signal_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/powerpc/kernel/signal_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -743,7 +743,7 @@ int handle_rt_signal32(unsigned long sig
@@ -1108,5 +992,4 @@
-diff --git a/arch/powerpc/kernel/signal_64.c b/arch/powerpc/kernel/signal_64.c
-index da7c058e3731ffc712367f7f2f4e01e572d0055d..a79f4f061f0baa6bdfc8a72eed465cc8ac01b8a5 100644
---- a/arch/powerpc/kernel/signal_64.c
-+++ b/arch/powerpc/kernel/signal_64.c
-@@ -371,7 +371,7 @@ int handle_rt_signal64(int signr, struct k_sigaction *ka, siginfo_t *info,
+diff -urNp linux-2.6.26.6/arch/powerpc/kernel/signal_64.c linux-2.6.26.6/arch/powerpc/kernel/signal_64.c
+--- linux-2.6.26.6/arch/powerpc/kernel/signal_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/powerpc/kernel/signal_64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -371,7 +371,7 @@ int handle_rt_signal64(int signr, struct
@@ -1121,5 +1004,4 @@
-diff --git a/arch/powerpc/kernel/vdso.c b/arch/powerpc/kernel/vdso.c
-index ce245a850db2b8d90d0d35dcd98a2e1fa39d97b7..6ace7ccb94963a387625e2a319b4f0c13b2e4231 100644
---- a/arch/powerpc/kernel/vdso.c
-+++ b/arch/powerpc/kernel/vdso.c
-@@ -212,7 +212,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm,
+diff -urNp linux-2.6.26.6/arch/powerpc/kernel/vdso.c linux-2.6.26.6/arch/powerpc/kernel/vdso.c
+--- linux-2.6.26.6/arch/powerpc/kernel/vdso.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/powerpc/kernel/vdso.c	2008-10-11 21:54:19.000000000 -0400
+@@ -212,7 +212,7 @@ int arch_setup_additional_pages(struct l
@@ -1134 +1016 @@
-@@ -229,7 +229,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm,
+@@ -229,7 +229,7 @@ int arch_setup_additional_pages(struct l
@@ -1143,4 +1025,3 @@
-diff --git a/arch/powerpc/mm/fault.c b/arch/powerpc/mm/fault.c
-index 7b2510799266654e4fb8ec1283adfbbbfb159158..fcf840ea958afc5a5c7b9ed2da5e2776755c40de 100644
---- a/arch/powerpc/mm/fault.c
-+++ b/arch/powerpc/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/powerpc/mm/fault.c linux-2.6.26.6/arch/powerpc/mm/fault.c
+--- linux-2.6.26.6/arch/powerpc/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/powerpc/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
@@ -1158 +1039 @@
-@@ -62,6 +66,363 @@ static inline int notify_page_fault(struct pt_regs *regs)
+@@ -62,6 +66,363 @@ static inline int notify_page_fault(stru
@@ -1522 +1403 @@
-@@ -157,7 +518,7 @@ int __kprobes do_page_fault(struct pt_regs *regs, unsigned long address,
+@@ -157,7 +518,7 @@ int __kprobes do_page_fault(struct pt_re
@@ -1569,5 +1450,4 @@
-diff --git a/arch/powerpc/mm/mmap.c b/arch/powerpc/mm/mmap.c
-index 86010fc7d3b17accc427c12f00606a0d1f4bbc70..782ac3f8efb476573c115f1aeea8c8848c098cde 100644
---- a/arch/powerpc/mm/mmap.c
-+++ b/arch/powerpc/mm/mmap.c
-@@ -75,10 +75,22 @@ void arch_pick_mmap_layout(struct mm_struct *mm)
+diff -urNp linux-2.6.26.6/arch/powerpc/mm/mmap.c linux-2.6.26.6/arch/powerpc/mm/mmap.c
+--- linux-2.6.26.6/arch/powerpc/mm/mmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/powerpc/mm/mmap.c	2008-10-11 21:54:19.000000000 -0400
+@@ -75,10 +75,22 @@ void arch_pick_mmap_layout(struct mm_str
@@ -1596,4 +1476,3 @@
-diff --git a/arch/ppc/mm/fault.c b/arch/ppc/mm/fault.c
-index 36c0e7529edbc89f1e7c7dc8d3c000024a2f433d..7d604edf73b65fe7b970891c680085f76bda509d 100644
---- a/arch/ppc/mm/fault.c
-+++ b/arch/ppc/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/ppc/mm/fault.c linux-2.6.26.6/arch/ppc/mm/fault.c
+--- linux-2.6.26.6/arch/ppc/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/ppc/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
@@ -1611 +1490 @@
-@@ -48,6 +52,363 @@ unsigned long pte_misses;	/* updated by do_page_fault() */
+@@ -48,6 +52,363 @@ unsigned long pte_misses;	/* updated by 
@@ -1975 +1854 @@
-@@ -109,7 +470,7 @@ int do_page_fault(struct pt_regs *regs, unsigned long address,
+@@ -109,7 +470,7 @@ int do_page_fault(struct pt_regs *regs, 
@@ -2044,5 +1923,4 @@
-diff --git a/arch/s390/kernel/module.c b/arch/s390/kernel/module.c
-index 59b4e796680af3e3f376285b7fbaa5500092d602..958196a03ac624a203f6b8c24e55cf23b8b8b3fb 100644
---- a/arch/s390/kernel/module.c
-+++ b/arch/s390/kernel/module.c
-@@ -166,11 +166,11 @@ module_frob_arch_sections(Elf_Ehdr *hdr, Elf_Shdr *sechdrs,
+diff -urNp linux-2.6.26.6/arch/s390/kernel/module.c linux-2.6.26.6/arch/s390/kernel/module.c
+--- linux-2.6.26.6/arch/s390/kernel/module.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/s390/kernel/module.c	2008-10-11 21:54:19.000000000 -0400
+@@ -166,11 +166,11 @@ module_frob_arch_sections(Elf_Ehdr *hdr,
@@ -2065 +1943 @@
-@@ -256,7 +256,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -256,7 +256,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2074 +1952 @@
-@@ -280,7 +280,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -280,7 +280,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2083 +1961 @@
-@@ -294,7 +294,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -294,7 +294,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2092 +1970 @@
-@@ -316,7 +316,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -316,7 +316,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2101 +1979 @@
-@@ -336,7 +336,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -336,7 +336,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2110 +1988 @@
-@@ -346,7 +346,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -346,7 +346,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2119,18 +1997,4 @@
-diff --git a/arch/sparc/Makefile b/arch/sparc/Makefile
-index fef28e267a52fc1e2943d85c7bf3daea8603170e..002f9f05260e5a24f910d27d506d4ec46ebd48c3 100644
---- a/arch/sparc/Makefile
-+++ b/arch/sparc/Makefile
-@@ -36,7 +36,7 @@ drivers-$(CONFIG_OPROFILE)	+= arch/sparc/oprofile/
- # Renaming is done to avoid confusing pattern matching rules in 2.5.45 (multy-)
- INIT_Y		:= $(patsubst %/, %/built-in.o, $(init-y))
- CORE_Y		:= $(core-y)
--CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
-+CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
- CORE_Y		:= $(patsubst %/, %/built-in.o, $(CORE_Y))
- DRIVERS_Y	:= $(patsubst %/, %/built-in.o, $(drivers-y))
- NET_Y		:= $(patsubst %/, %/built-in.o, $(net-y))
-diff --git a/arch/sparc/kernel/sys_sparc.c b/arch/sparc/kernel/sys_sparc.c
-index 3c6b49a53ae82f8e7a77dc67b4445eb753591f6f..fe00ee38a21753dfa566a7afa8f8269461902b81 100644
---- a/arch/sparc/kernel/sys_sparc.c
-+++ b/arch/sparc/kernel/sys_sparc.c
-@@ -56,7 +56,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+diff -urNp linux-2.6.26.6/arch/sparc/kernel/sys_sparc.c linux-2.6.26.6/arch/sparc/kernel/sys_sparc.c
+--- linux-2.6.26.6/arch/sparc/kernel/sys_sparc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc/kernel/sys_sparc.c	2008-10-11 21:54:19.000000000 -0400
+@@ -56,7 +56,7 @@ unsigned long arch_get_unmapped_area(str
@@ -2145,4 +2009,15 @@
-diff --git a/arch/sparc/mm/fault.c b/arch/sparc/mm/fault.c
-index 0a3cd8f6cfe4690d43817152ce8e4f67b1ea2e82..149c18e5e444fc558a9cc34a1f8d82ee892430de 100644
---- a/arch/sparc/mm/fault.c
-+++ b/arch/sparc/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/sparc/Makefile linux-2.6.26.6/arch/sparc/Makefile
+--- linux-2.6.26.6/arch/sparc/Makefile	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc/Makefile	2008-10-11 21:54:19.000000000 -0400
+@@ -36,7 +36,7 @@ drivers-$(CONFIG_OPROFILE)	+= arch/sparc
+ # Renaming is done to avoid confusing pattern matching rules in 2.5.45 (multy-)
+ INIT_Y		:= $(patsubst %/, %/built-in.o, $(init-y))
+ CORE_Y		:= $(core-y)
+-CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
++CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
+ CORE_Y		:= $(patsubst %/, %/built-in.o, $(CORE_Y))
+ DRIVERS_Y	:= $(patsubst %/, %/built-in.o, $(drivers-y))
+ NET_Y		:= $(patsubst %/, %/built-in.o, $(net-y))
+diff -urNp linux-2.6.26.6/arch/sparc/mm/fault.c linux-2.6.26.6/arch/sparc/mm/fault.c
+--- linux-2.6.26.6/arch/sparc/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
@@ -2159 +2034 @@
-@@ -167,6 +170,249 @@ static unsigned long compute_si_addr(struct pt_regs *regs, int text_fault)
+@@ -167,6 +170,249 @@ static unsigned long compute_si_addr(str
@@ -2434,4 +2309,3 @@
-diff --git a/arch/sparc/mm/init.c b/arch/sparc/mm/init.c
-index 7794ecb896e32284c8c1d3225faa285e87d088fd..66c33a3a7354e1e5d5af9139185e20ca6f2cbb5d 100644
---- a/arch/sparc/mm/init.c
-+++ b/arch/sparc/mm/init.c
+diff -urNp linux-2.6.26.6/arch/sparc/mm/init.c linux-2.6.26.6/arch/sparc/mm/init.c
+--- linux-2.6.26.6/arch/sparc/mm/init.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc/mm/init.c	2008-10-11 21:54:19.000000000 -0400
@@ -2472,4 +2346,3 @@
-diff --git a/arch/sparc/mm/srmmu.c b/arch/sparc/mm/srmmu.c
-index 23d3291a3e81e65736c862e03e3b24e3047ffa22..4186ca900e43ea193b04cea65ff5bf294464d3e1 100644
---- a/arch/sparc/mm/srmmu.c
-+++ b/arch/sparc/mm/srmmu.c
+diff -urNp linux-2.6.26.6/arch/sparc/mm/srmmu.c linux-2.6.26.6/arch/sparc/mm/srmmu.c
+--- linux-2.6.26.6/arch/sparc/mm/srmmu.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc/mm/srmmu.c	2008-10-11 21:54:19.000000000 -0400
@@ -2490,4 +2363,3 @@
-diff --git a/arch/sparc64/kernel/Makefile b/arch/sparc64/kernel/Makefile
-index ec4f5ebb1ca669e72048317fe623c12d30b281d2..fe83258e434a37acfcfc72702430e7ff7caec601 100644
---- a/arch/sparc64/kernel/Makefile
-+++ b/arch/sparc64/kernel/Makefile
+diff -urNp linux-2.6.26.6/arch/sparc64/kernel/Makefile linux-2.6.26.6/arch/sparc64/kernel/Makefile
+--- linux-2.6.26.6/arch/sparc64/kernel/Makefile	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc64/kernel/Makefile	2008-10-11 21:54:19.000000000 -0400
@@ -2503,5 +2375,4 @@
-diff --git a/arch/sparc64/kernel/sys_sparc.c b/arch/sparc64/kernel/sys_sparc.c
-index ac1bff58c1ac8319eb0178e0980eeda35dfb1a32..9ba14a4f1500d2896052f45cc864cbb3dfec2530 100644
---- a/arch/sparc64/kernel/sys_sparc.c
-+++ b/arch/sparc64/kernel/sys_sparc.c
-@@ -124,7 +124,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+diff -urNp linux-2.6.26.6/arch/sparc64/kernel/sys_sparc.c linux-2.6.26.6/arch/sparc64/kernel/sys_sparc.c
+--- linux-2.6.26.6/arch/sparc64/kernel/sys_sparc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc64/kernel/sys_sparc.c	2008-10-11 21:54:19.000000000 -0400
+@@ -124,7 +124,7 @@ unsigned long arch_get_unmapped_area(str
@@ -2516 +2387 @@
-@@ -139,6 +139,10 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+@@ -139,6 +139,10 @@ unsigned long arch_get_unmapped_area(str
@@ -2527 +2398 @@
-@@ -152,9 +156,9 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+@@ -152,9 +156,9 @@ unsigned long arch_get_unmapped_area(str
@@ -2550 +2421 @@
-@@ -215,7 +219,7 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -215,7 +219,7 @@ arch_get_unmapped_area_topdown(struct fi
@@ -2559 +2430 @@
-@@ -378,6 +382,12 @@ void arch_pick_mmap_layout(struct mm_struct *mm)
+@@ -378,6 +382,12 @@ void arch_pick_mmap_layout(struct mm_str
@@ -2572 +2443 @@
-@@ -392,6 +402,12 @@ void arch_pick_mmap_layout(struct mm_struct *mm)
+@@ -392,6 +402,12 @@ void arch_pick_mmap_layout(struct mm_str
@@ -2585,17 +2456,3 @@
-diff --git a/arch/sparc64/mm/Makefile b/arch/sparc64/mm/Makefile
-index 68d04c0370f420cb152ace47834f7c7cd61d98d4..386018430b53a72f04967032d300382cd5f34784 100644
---- a/arch/sparc64/mm/Makefile
-+++ b/arch/sparc64/mm/Makefile
-@@ -2,7 +2,7 @@
- #
- 
- EXTRA_AFLAGS := -ansi
--EXTRA_CFLAGS := -Werror
-+#EXTRA_CFLAGS := -Werror
- 
- obj-y    := ultra.o tlb.o tsb.o fault.o init.o generic.o
- 
-diff --git a/arch/sparc64/mm/fault.c b/arch/sparc64/mm/fault.c
-index 236f4d228d2bc962908af77a37b012ce9d1e8bc5..abe22a4bfafb268ac18a4648c4a2a5be25e884bf 100644
---- a/arch/sparc64/mm/fault.c
-+++ b/arch/sparc64/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/sparc64/mm/fault.c linux-2.6.26.6/arch/sparc64/mm/fault.c
+--- linux-2.6.26.6/arch/sparc64/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc64/mm/fault.c	2008-10-11 21:54:19.000000000 -0400
@@ -2980 +2837 @@
-@@ -303,8 +667,10 @@ asmlinkage void __kprobes do_sparc64_fault(struct pt_regs *regs)
+@@ -303,8 +667,10 @@ asmlinkage void __kprobes do_sparc64_fau
@@ -2992 +2849 @@
-@@ -321,6 +687,29 @@ asmlinkage void __kprobes do_sparc64_fault(struct pt_regs *regs)
+@@ -321,6 +687,29 @@ asmlinkage void __kprobes do_sparc64_fau
@@ -3022,4 +2879,15 @@
-diff --git a/arch/um/sys-i386/syscalls.c b/arch/um/sys-i386/syscalls.c
-index e2d14268441201d87f09c1adfb27f9a14233f24e..d6b923141e642a6b042309a9134ba2bf0f08c9fc 100644
---- a/arch/um/sys-i386/syscalls.c
-+++ b/arch/um/sys-i386/syscalls.c
+diff -urNp linux-2.6.26.6/arch/sparc64/mm/Makefile linux-2.6.26.6/arch/sparc64/mm/Makefile
+--- linux-2.6.26.6/arch/sparc64/mm/Makefile	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/sparc64/mm/Makefile	2008-10-11 21:54:19.000000000 -0400
+@@ -2,7 +2,7 @@
+ #
+ 
+ EXTRA_AFLAGS := -ansi
+-EXTRA_CFLAGS := -Werror
++#EXTRA_CFLAGS := -Werror
+ 
+ obj-y    := ultra.o tlb.o tsb.o fault.o init.o generic.o
+ 
+diff -urNp linux-2.6.26.6/arch/um/sys-i386/syscalls.c linux-2.6.26.6/arch/um/sys-i386/syscalls.c
+--- linux-2.6.26.6/arch/um/sys-i386/syscalls.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/um/sys-i386/syscalls.c	2008-10-11 21:55:07.000000000 -0400
@@ -3048,5 +2916,4 @@
-diff --git a/arch/v850/kernel/module.c b/arch/v850/kernel/module.c
-index 64aeb3e37c52716c1687eecbd46a509c2db27309..50cf7f13a56023b8bd364f20fdd729fe6f1d90fa 100644
---- a/arch/v850/kernel/module.c
-+++ b/arch/v850/kernel/module.c
-@@ -150,8 +150,8 @@ static uint32_t do_plt_call (void *location, Elf32_Addr val,
+diff -urNp linux-2.6.26.6/arch/v850/kernel/module.c linux-2.6.26.6/arch/v850/kernel/module.c
+--- linux-2.6.26.6/arch/v850/kernel/module.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/v850/kernel/module.c	2008-10-11 21:54:19.000000000 -0400
+@@ -150,8 +150,8 @@ static uint32_t do_plt_call (void *locat
@@ -3063,110 +2930,4 @@
-diff --git a/arch/x86/Kconfig b/arch/x86/Kconfig
-index bf07b6f50fa178268f9d81388a615a7a8abff32b..de786f7fd230077a2aeec365492cbef0806845ef 100644
---- a/arch/x86/Kconfig
-+++ b/arch/x86/Kconfig
-@@ -887,7 +887,7 @@ config PAGE_OFFSET
- 	hex
- 	default 0xB0000000 if VMSPLIT_3G_OPT
- 	default 0x80000000 if VMSPLIT_2G
--	default 0x78000000 if VMSPLIT_2G_OPT
-+	default 0x70000000 if VMSPLIT_2G_OPT
- 	default 0x40000000 if VMSPLIT_1G
- 	default 0xC0000000
- 	depends on X86_32
-@@ -1206,8 +1206,7 @@ config CRASH_DUMP
- config PHYSICAL_START
- 	hex "Physical address where the kernel is loaded" if (EMBEDDED || CRASH_DUMP)
- 	default "0x1000000" if X86_NUMAQ
--	default "0x200000" if X86_64
--	default "0x100000"
-+	default "0x200000"
- 	help
- 	  This gives the physical address where the kernel is loaded.
- 
-@@ -1299,9 +1298,9 @@ config HOTPLUG_CPU
- 	  suspend.
- 
- config COMPAT_VDSO
--	def_bool y
-+	def_bool n
- 	prompt "Compat VDSO support"
--	depends on X86_32 || IA32_EMULATION
-+	depends on (X86_32 || IA32_EMULATION) && !PAX_NOEXEC
- 	help
- 	  Map the 32-bit VDSO to the predictable old-style address too.
- 	---help---
-@@ -1488,7 +1487,7 @@ config PCI
- choice
- 	prompt "PCI access mode"
- 	depends on X86_32 && PCI && !X86_VISWS
--	default PCI_GOANY
-+	default PCI_GODIRECT
- 	---help---
- 	  On PCI systems, the BIOS can be used to detect the PCI devices and
- 	  determine their configuration. However, some old PCI motherboards
-diff --git a/arch/x86/Kconfig.cpu b/arch/x86/Kconfig.cpu
-index dd138a29d8db3658302ceefd838e19889b5b5d18..5502942d576709c68020aa0b21b04087cabf8f79 100644
---- a/arch/x86/Kconfig.cpu
-+++ b/arch/x86/Kconfig.cpu
-@@ -340,7 +340,7 @@ config X86_PPRO_FENCE
- 
- config X86_F00F_BUG
- 	def_bool y
--	depends on M586MMX || M586TSC || M586 || M486 || M386
-+	depends on (M586MMX || M586TSC || M586 || M486 || M386) && !PAX_KERNEXEC
- 
- config X86_WP_WORKS_OK
- 	def_bool y
-@@ -360,7 +360,7 @@ config X86_POPAD_OK
- 
- config X86_ALIGNMENT_16
- 	def_bool y
--	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK6 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
-+	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK8 || MK7 || MK6 || MCORE2 || MPENTIUM4 || MPENTIUMIII || MPENTIUMII || M686 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
- 
- config X86_GOOD_APIC
- 	def_bool y
-@@ -403,7 +403,7 @@ config X86_TSC
- # generates cmov.
- config X86_CMOV
- 	def_bool y
--	depends on (MK7 || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
-+	depends on (MK8 || MK7 || MCORE2 || MPSC || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
- 
- config X86_MINIMUM_CPU_FAMILY
- 	int
-diff --git a/arch/x86/Kconfig.debug b/arch/x86/Kconfig.debug
-index 18363374d51a9a57b39b6fb8d3f87a054b4b4aa5..4b3854ba52c4e65949a33fd2d5548e8567f4ce92 100644
---- a/arch/x86/Kconfig.debug
-+++ b/arch/x86/Kconfig.debug
-@@ -84,7 +84,7 @@ config X86_PTDUMP
- config DEBUG_RODATA
- 	bool "Write protect kernel read-only data structures"
- 	default y
--	depends on DEBUG_KERNEL
-+	depends on DEBUG_KERNEL && BROKEN
- 	help
- 	  Mark the kernel read-only data as write-protected in the pagetables,
- 	  in order to catch accidental (and incorrect) writes to such const
-diff --git a/arch/x86/Makefile b/arch/x86/Makefile
-index 3cff3c894cf3c0cd80161d1f61a959cbb80f7106..17470c9e385098300611f381d9b3f2405286eef7 100644
---- a/arch/x86/Makefile
-+++ b/arch/x86/Makefile
-@@ -258,3 +258,12 @@ endef
- CLEAN_FILES += arch/x86/boot/fdimage \
- 	       arch/x86/boot/image.iso \
- 	       arch/x86/boot/mtools.conf
-+
-+define OLD_LD
-+
-+*** ${VERSION}.${PATCHLEVEL} PaX kernels no longer build correctly with old versions of binutils.
-+*** Please upgrade your binutils to 2.18 or newer
-+endef
-+
-+archprepare:
-+	$(if $(LDFLAGS_BUILD_ID),,$(error $(OLD_LD)))
-diff --git a/arch/x86/boot/bitops.h b/arch/x86/boot/bitops.h
-index 878e4b9940d9212ce581c5bea0ac518ae6bbf85f..20537abb34141442d8e3cdf755c0bbcb716adc35 100644
---- a/arch/x86/boot/bitops.h
-+++ b/arch/x86/boot/bitops.h
-@@ -26,7 +26,7 @@ static inline int variable_test_bit(int nr, const void *addr)
+diff -urNp linux-2.6.26.6/arch/x86/boot/bitops.h linux-2.6.26.6/arch/x86/boot/bitops.h
+--- linux-2.6.26.6/arch/x86/boot/bitops.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/bitops.h	2008-10-11 21:54:19.000000000 -0400
+@@ -26,7 +26,7 @@ static inline int variable_test_bit(int 
@@ -3181 +2942 @@
-@@ -37,7 +37,7 @@ static inline int variable_test_bit(int nr, const void *addr)
+@@ -37,7 +37,7 @@ static inline int variable_test_bit(int 
@@ -3190,4 +2951,3 @@
-diff --git a/arch/x86/boot/boot.h b/arch/x86/boot/boot.h
-index 9d4b4b43d97af59f6ed45d8680b8d58a04469c5c..a3c07c0734a00c5d190ac5ff210c62d70a6eb2fd 100644
---- a/arch/x86/boot/boot.h
-+++ b/arch/x86/boot/boot.h
+diff -urNp linux-2.6.26.6/arch/x86/boot/boot.h linux-2.6.26.6/arch/x86/boot/boot.h
+--- linux-2.6.26.6/arch/x86/boot/boot.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/boot.h	2008-10-11 21:54:19.000000000 -0400
@@ -3203 +2963 @@
-@@ -174,7 +174,7 @@ static inline void wrgs32(u32 v, addr_t addr)
+@@ -174,7 +174,7 @@ static inline void wrgs32(u32 v, addr_t 
@@ -3212,4 +2972,3 @@
-diff --git a/arch/x86/boot/compressed/head_32.S b/arch/x86/boot/compressed/head_32.S
-index ba7736cf2ec73e8977e447a8ab852d083f079c42..18ddfb231551497f327b631866053f1f8c0f75aa 100644
---- a/arch/x86/boot/compressed/head_32.S
-+++ b/arch/x86/boot/compressed/head_32.S
+diff -urNp linux-2.6.26.6/arch/x86/boot/compressed/head_32.S linux-2.6.26.6/arch/x86/boot/compressed/head_32.S
+--- linux-2.6.26.6/arch/x86/boot/compressed/head_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/compressed/head_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -3254,4 +3013,3 @@
-diff --git a/arch/x86/boot/compressed/misc.c b/arch/x86/boot/compressed/misc.c
-index 90456cee47c337b226a8874582440377c428a91e..7f32263fb4523996a2bac41aa5f2ccb6b7cba57f 100644
---- a/arch/x86/boot/compressed/misc.c
-+++ b/arch/x86/boot/compressed/misc.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/compressed/misc.c linux-2.6.26.6/arch/x86/boot/compressed/misc.c
+--- linux-2.6.26.6/arch/x86/boot/compressed/misc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/compressed/misc.c	2008-10-11 21:54:19.000000000 -0400
@@ -3267 +3025 @@
-@@ -459,7 +459,7 @@ asmlinkage void decompress_kernel(void *rmode, memptr heap,
+@@ -459,7 +459,7 @@ asmlinkage void decompress_kernel(void *
@@ -3276,4 +3034,3 @@
-diff --git a/arch/x86/boot/compressed/relocs.c b/arch/x86/boot/compressed/relocs.c
-index edaadea90aafcf9876256bcac9db5d68823874ea..1406b3d0dd092fa0117d7c096f9e04f290e8eaab 100644
---- a/arch/x86/boot/compressed/relocs.c
-+++ b/arch/x86/boot/compressed/relocs.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/compressed/relocs.c linux-2.6.26.6/arch/x86/boot/compressed/relocs.c
+--- linux-2.6.26.6/arch/x86/boot/compressed/relocs.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/compressed/relocs.c	2008-10-11 21:54:19.000000000 -0400
@@ -3357 +3114 @@
-@@ -482,6 +525,23 @@ static void walk_relocs(void (*visit)(Elf32_Rel *rel, Elf32_Sym *sym))
+@@ -482,6 +525,23 @@ static void walk_relocs(void (*visit)(El
@@ -3389,4 +3146,3 @@
-diff --git a/arch/x86/boot/cpucheck.c b/arch/x86/boot/cpucheck.c
-index c1ce0303d994206faa386226dcba435dbba2aa97..515852e44b9fb4ec80fca33db88fccf6ecd53043 100644
---- a/arch/x86/boot/cpucheck.c
-+++ b/arch/x86/boot/cpucheck.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/cpucheck.c linux-2.6.26.6/arch/x86/boot/cpucheck.c
+--- linux-2.6.26.6/arch/x86/boot/cpucheck.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/cpucheck.c	2008-10-11 21:54:19.000000000 -0400
@@ -3447 +3203 @@
-@@ -205,9 +205,9 @@ int check_cpu(int *cpu_level_ptr, int *req_level_ptr, u32 **err_flags_ptr)
+@@ -205,9 +205,9 @@ int check_cpu(int *cpu_level_ptr, int *r
@@ -3459 +3215 @@
-@@ -220,9 +220,9 @@ int check_cpu(int *cpu_level_ptr, int *req_level_ptr, u32 **err_flags_ptr)
+@@ -220,9 +220,9 @@ int check_cpu(int *cpu_level_ptr, int *r
@@ -3471 +3227 @@
-@@ -233,12 +233,12 @@ int check_cpu(int *cpu_level_ptr, int *req_level_ptr, u32 **err_flags_ptr)
+@@ -233,12 +233,12 @@ int check_cpu(int *cpu_level_ptr, int *r
@@ -3488,5 +3244,4 @@
-diff --git a/arch/x86/boot/edd.c b/arch/x86/boot/edd.c
-index 03399d64013b21459f63942c06bc6c33b803f425..c0762cf318c8c993dd2b6ba24128c0fc3d25b8ea 100644
---- a/arch/x86/boot/edd.c
-+++ b/arch/x86/boot/edd.c
-@@ -76,7 +76,7 @@ static int get_edd_info(u8 devno, struct edd_info *ei)
+diff -urNp linux-2.6.26.6/arch/x86/boot/edd.c linux-2.6.26.6/arch/x86/boot/edd.c
+--- linux-2.6.26.6/arch/x86/boot/edd.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/edd.c	2008-10-11 21:54:19.000000000 -0400
+@@ -76,7 +76,7 @@ static int get_edd_info(u8 devno, struct
@@ -3501 +3256 @@
-@@ -95,7 +95,7 @@ static int get_edd_info(u8 devno, struct edd_info *ei)
+@@ -95,7 +95,7 @@ static int get_edd_info(u8 devno, struct
@@ -3510 +3265 @@
-@@ -106,7 +106,7 @@ static int get_edd_info(u8 devno, struct edd_info *ei)
+@@ -106,7 +106,7 @@ static int get_edd_info(u8 devno, struct
@@ -3519,4 +3274,3 @@
-diff --git a/arch/x86/boot/main.c b/arch/x86/boot/main.c
-index 1b92cb66a90e1a61985cf7cf44aac0b9b1bd2df1..9a3e6e746dd49ed3ab8b80589deee22e91740657 100644
---- a/arch/x86/boot/main.c
-+++ b/arch/x86/boot/main.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/main.c linux-2.6.26.6/arch/x86/boot/main.c
+--- linux-2.6.26.6/arch/x86/boot/main.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/main.c	2008-10-11 21:54:19.000000000 -0400
@@ -3532,4 +3286,3 @@
-diff --git a/arch/x86/boot/mca.c b/arch/x86/boot/mca.c
-index 911eaae5d696427c98fdad7f344a14bdc0340efc..ea2c2b2ef2f4a7ec0a117bbe8a55c872e770a139 100644
---- a/arch/x86/boot/mca.c
-+++ b/arch/x86/boot/mca.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/mca.c linux-2.6.26.6/arch/x86/boot/mca.c
+--- linux-2.6.26.6/arch/x86/boot/mca.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/mca.c	2008-10-11 21:54:19.000000000 -0400
@@ -3545,4 +3298,3 @@
-diff --git a/arch/x86/boot/memory.c b/arch/x86/boot/memory.c
-index acad32eb4290861b1539553c1e8eb49f7ec82e92..1318c870932b1d007bc77700293d39f688587243 100644
---- a/arch/x86/boot/memory.c
-+++ b/arch/x86/boot/memory.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/memory.c linux-2.6.26.6/arch/x86/boot/memory.c
+--- linux-2.6.26.6/arch/x86/boot/memory.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/memory.c	2008-10-11 21:54:19.000000000 -0400
@@ -3576,4 +3328,24 @@
-diff --git a/arch/x86/boot/video-vesa.c b/arch/x86/boot/video-vesa.c
-index 401ad998ad08d7cd63943a5b7a7ae893264b5e3f..56e521e8467742713c198d430658f8a6745c62c2 100644
---- a/arch/x86/boot/video-vesa.c
-+++ b/arch/x86/boot/video-vesa.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/video.c linux-2.6.26.6/arch/x86/boot/video.c
+--- linux-2.6.26.6/arch/x86/boot/video.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/video.c	2008-10-11 21:54:19.000000000 -0400
+@@ -23,7 +23,7 @@ static void store_cursor_position(void)
+ 
+ 	ax = 0x0300;
+ 	bx = 0;
+-	asm(INT10
++	asm volatile(INT10
+ 	    : "=d" (curpos), "+a" (ax), "+b" (bx)
+ 	    : : "ecx", "esi", "edi");
+ 
+@@ -38,7 +38,7 @@ static void store_video_mode(void)
+ 	/* N.B.: the saving of the video page here is a bit silly,
+ 	   since we pretty much assume page 0 everywhere. */
+ 	ax = 0x0f00;
+-	asm(INT10
++	asm volatile(INT10
+ 	    : "+a" (ax), "=b" (page)
+ 	    : : "ecx", "edx", "esi", "edi");
+ 
+diff -urNp linux-2.6.26.6/arch/x86/boot/video-vesa.c linux-2.6.26.6/arch/x86/boot/video-vesa.c
+--- linux-2.6.26.6/arch/x86/boot/video-vesa.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/video-vesa.c	2008-10-11 21:54:19.000000000 -0400
@@ -3598 +3370 @@
-@@ -123,7 +123,7 @@ static int vesa_set_mode(struct mode_info *mode)
+@@ -123,7 +123,7 @@ static int vesa_set_mode(struct mode_inf
@@ -3651,4 +3423,3 @@
-diff --git a/arch/x86/boot/video-vga.c b/arch/x86/boot/video-vga.c
-index 40ecb8d7688c3d5c8a7587aa8fce8bb7ea06d76b..9aedbbe304d3a4d2a708a0c63172f7cc432e7e08 100644
---- a/arch/x86/boot/video-vga.c
-+++ b/arch/x86/boot/video-vga.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/video-vga.c linux-2.6.26.6/arch/x86/boot/video-vga.c
+--- linux-2.6.26.6/arch/x86/boot/video-vga.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/video-vga.c	2008-10-11 21:54:19.000000000 -0400
@@ -3673,26 +3444,3 @@
-diff --git a/arch/x86/boot/video.c b/arch/x86/boot/video.c
-index 83598b23093aa31398db2d1c9a5f89eb30733357..8b7722794e64fdb6df4ca9476cc22cfef3e0a3e5 100644
---- a/arch/x86/boot/video.c
-+++ b/arch/x86/boot/video.c
-@@ -23,7 +23,7 @@ static void store_cursor_position(void)
- 
- 	ax = 0x0300;
- 	bx = 0;
--	asm(INT10
-+	asm volatile(INT10
- 	    : "=d" (curpos), "+a" (ax), "+b" (bx)
- 	    : : "ecx", "esi", "edi");
- 
-@@ -38,7 +38,7 @@ static void store_video_mode(void)
- 	/* N.B.: the saving of the video page here is a bit silly,
- 	   since we pretty much assume page 0 everywhere. */
- 	ax = 0x0f00;
--	asm(INT10
-+	asm volatile(INT10
- 	    : "+a" (ax), "=b" (page)
- 	    : : "ecx", "edx", "esi", "edi");
- 
-diff --git a/arch/x86/boot/voyager.c b/arch/x86/boot/voyager.c
-index 433909d61e5cb2ef7a20f7386c0ad87c362b47c1..edc601df302886f9c6b014f064ebba23306b1eb8 100644
---- a/arch/x86/boot/voyager.c
-+++ b/arch/x86/boot/voyager.c
+diff -urNp linux-2.6.26.6/arch/x86/boot/voyager.c linux-2.6.26.6/arch/x86/boot/voyager.c
+--- linux-2.6.26.6/arch/x86/boot/voyager.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/boot/voyager.c	2008-10-11 21:54:19.000000000 -0400
@@ -3708,5 +3456,4 @@
-diff --git a/arch/x86/ia32/ia32_signal.c b/arch/x86/ia32/ia32_signal.c
-index cb3856a18c8544e1ffe722d33a7713439043829d..e995822bed508d009b558fcd4fc329abe601a710 100644
---- a/arch/x86/ia32/ia32_signal.c
-+++ b/arch/x86/ia32/ia32_signal.c
-@@ -531,6 +531,7 @@ int ia32_setup_rt_frame(int sig, struct k_sigaction *ka, siginfo_t *info,
+diff -urNp linux-2.6.26.6/arch/x86/ia32/ia32_signal.c linux-2.6.26.6/arch/x86/ia32/ia32_signal.c
+--- linux-2.6.26.6/arch/x86/ia32/ia32_signal.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/ia32/ia32_signal.c	2008-10-11 21:54:19.000000000 -0400
+@@ -531,6 +531,7 @@ int ia32_setup_rt_frame(int sig, struct 
@@ -3720,5 +3467,89 @@
-diff --git a/arch/x86/kernel/acpi/boot.c b/arch/x86/kernel/acpi/boot.c
-index 33c5216fd3e1f5137b0b8c52fa8178ac328d630a..c5407343cd3ce24a6b9a69a94bbcf48dc2697dc1 100644
---- a/arch/x86/kernel/acpi/boot.c
-+++ b/arch/x86/kernel/acpi/boot.c
-@@ -1227,7 +1227,7 @@ static struct dmi_system_id __initdata acpi_dmi_table[] = {
+diff -urNp linux-2.6.26.6/arch/x86/Kconfig linux-2.6.26.6/arch/x86/Kconfig
+--- linux-2.6.26.6/arch/x86/Kconfig	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/Kconfig	2008-10-11 21:54:19.000000000 -0400
+@@ -887,7 +887,7 @@ config PAGE_OFFSET
+ 	hex
+ 	default 0xB0000000 if VMSPLIT_3G_OPT
+ 	default 0x80000000 if VMSPLIT_2G
+-	default 0x78000000 if VMSPLIT_2G_OPT
++	default 0x70000000 if VMSPLIT_2G_OPT
+ 	default 0x40000000 if VMSPLIT_1G
+ 	default 0xC0000000
+ 	depends on X86_32
+@@ -1206,8 +1206,7 @@ config CRASH_DUMP
+ config PHYSICAL_START
+ 	hex "Physical address where the kernel is loaded" if (EMBEDDED || CRASH_DUMP)
+ 	default "0x1000000" if X86_NUMAQ
+-	default "0x200000" if X86_64
+-	default "0x100000"
++	default "0x200000"
+ 	help
+ 	  This gives the physical address where the kernel is loaded.
+ 
+@@ -1299,9 +1298,9 @@ config HOTPLUG_CPU
+ 	  suspend.
+ 
+ config COMPAT_VDSO
+-	def_bool y
++	def_bool n
+ 	prompt "Compat VDSO support"
+-	depends on X86_32 || IA32_EMULATION
++	depends on (X86_32 || IA32_EMULATION) && !PAX_NOEXEC
+ 	help
+ 	  Map the 32-bit VDSO to the predictable old-style address too.
+ 	---help---
+@@ -1488,7 +1487,7 @@ config PCI
+ choice
+ 	prompt "PCI access mode"
+ 	depends on X86_32 && PCI && !X86_VISWS
+-	default PCI_GOANY
++	default PCI_GODIRECT
+ 	---help---
+ 	  On PCI systems, the BIOS can be used to detect the PCI devices and
+ 	  determine their configuration. However, some old PCI motherboards
+diff -urNp linux-2.6.26.6/arch/x86/Kconfig.cpu linux-2.6.26.6/arch/x86/Kconfig.cpu
+--- linux-2.6.26.6/arch/x86/Kconfig.cpu	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/Kconfig.cpu	2008-10-11 21:54:19.000000000 -0400
+@@ -340,7 +340,7 @@ config X86_PPRO_FENCE
+ 
+ config X86_F00F_BUG
+ 	def_bool y
+-	depends on M586MMX || M586TSC || M586 || M486 || M386
++	depends on (M586MMX || M586TSC || M586 || M486 || M386) && !PAX_KERNEXEC
+ 
+ config X86_WP_WORKS_OK
+ 	def_bool y
+@@ -360,7 +360,7 @@ config X86_POPAD_OK
+ 
+ config X86_ALIGNMENT_16
+ 	def_bool y
+-	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK6 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
++	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK8 || MK7 || MK6 || MCORE2 || MPENTIUM4 || MPENTIUMIII || MPENTIUMII || M686 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
+ 
+ config X86_GOOD_APIC
+ 	def_bool y
+@@ -403,7 +403,7 @@ config X86_TSC
+ # generates cmov.
+ config X86_CMOV
+ 	def_bool y
+-	depends on (MK7 || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
++	depends on (MK8 || MK7 || MCORE2 || MPSC || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
+ 
+ config X86_MINIMUM_CPU_FAMILY
+ 	int
+diff -urNp linux-2.6.26.6/arch/x86/Kconfig.debug linux-2.6.26.6/arch/x86/Kconfig.debug
+--- linux-2.6.26.6/arch/x86/Kconfig.debug	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/Kconfig.debug	2008-10-11 21:54:19.000000000 -0400
+@@ -84,7 +84,7 @@ config X86_PTDUMP
+ config DEBUG_RODATA
+ 	bool "Write protect kernel read-only data structures"
+ 	default y
+-	depends on DEBUG_KERNEL
++	depends on DEBUG_KERNEL && BROKEN
+ 	help
+ 	  Mark the kernel read-only data as write-protected in the pagetables,
+ 	  in order to catch accidental (and incorrect) writes to such const
+diff -urNp linux-2.6.26.6/arch/x86/kernel/acpi/boot.c linux-2.6.26.6/arch/x86/kernel/acpi/boot.c
+--- linux-2.6.26.6/arch/x86/kernel/acpi/boot.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/acpi/boot.c	2008-10-11 21:54:19.000000000 -0400
+@@ -1227,7 +1227,7 @@ static struct dmi_system_id __initdata a
@@ -3733,4 +3564,3 @@
-diff --git a/arch/x86/kernel/acpi/realmode/wakeup.S b/arch/x86/kernel/acpi/realmode/wakeup.S
-index 3355973b12ac6f8ca11ea0f5486a6643373d8042..7f073d69e35451a41b13400405b6281bb54bad3c 100644
---- a/arch/x86/kernel/acpi/realmode/wakeup.S
-+++ b/arch/x86/kernel/acpi/realmode/wakeup.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/acpi/realmode/wakeup.S linux-2.6.26.6/arch/x86/kernel/acpi/realmode/wakeup.S
+--- linux-2.6.26.6/arch/x86/kernel/acpi/realmode/wakeup.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/acpi/realmode/wakeup.S	2008-10-11 21:54:19.000000000 -0400
@@ -3746,4 +3576,3 @@
-diff --git a/arch/x86/kernel/acpi/wakeup_32.S b/arch/x86/kernel/acpi/wakeup_32.S
-index a12e6a9fb65963f12ad7697b0f830a85cb69ff64..8e41c246b01c2f12c90341bd393260bab87da140 100644
---- a/arch/x86/kernel/acpi/wakeup_32.S
-+++ b/arch/x86/kernel/acpi/wakeup_32.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/acpi/wakeup_32.S linux-2.6.26.6/arch/x86/kernel/acpi/wakeup_32.S
+--- linux-2.6.26.6/arch/x86/kernel/acpi/wakeup_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/acpi/wakeup_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -3766,5 +3595,4 @@
-diff --git a/arch/x86/kernel/alternative.c b/arch/x86/kernel/alternative.c
-index d5ccf42267e47d1edd0876a48d1cc9aafa760e84..2007aadfed128f713f998a12c0f7e08eef25be29 100644
---- a/arch/x86/kernel/alternative.c
-+++ b/arch/x86/kernel/alternative.c
-@@ -403,7 +403,7 @@ void apply_paravirt(struct paravirt_patch_site *start,
+diff -urNp linux-2.6.26.6/arch/x86/kernel/alternative.c linux-2.6.26.6/arch/x86/kernel/alternative.c
+--- linux-2.6.26.6/arch/x86/kernel/alternative.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/alternative.c	2008-10-11 22:15:25.000000000 -0400
+@@ -403,7 +403,7 @@ void apply_paravirt(struct paravirt_patc
@@ -3779 +3607 @@
-@@ -483,11 +483,26 @@ void __init alternative_instructions(void)
+@@ -483,11 +483,26 @@ void __init alternative_instructions(voi
@@ -3808 +3636 @@
-@@ -508,33 +523,27 @@ void *text_poke_early(void *addr, const void *opcode, size_t len)
+@@ -508,33 +523,27 @@ void *text_poke_early(void *addr, const 
@@ -3818,0 +3647,2 @@
++
++	if (!core_kernel_text((unsigned long)addr)
@@ -3823,2 +3652,0 @@
-+	if (!core_kernel_text((unsigned long)addr)
-+
@@ -3857,5 +3685,4 @@
-diff --git a/arch/x86/kernel/apm_32.c b/arch/x86/kernel/apm_32.c
-index bf9290e290136a36d6006d032c1ca4fe392f84bd..12784aa917135ebee6b471d534eb05390ff8a514 100644
---- a/arch/x86/kernel/apm_32.c
-+++ b/arch/x86/kernel/apm_32.c
-@@ -406,7 +406,7 @@ static DECLARE_WAIT_QUEUE_HEAD(apm_waitqueue);
+diff -urNp linux-2.6.26.6/arch/x86/kernel/apm_32.c linux-2.6.26.6/arch/x86/kernel/apm_32.c
+--- linux-2.6.26.6/arch/x86/kernel/apm_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/apm_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -406,7 +406,7 @@ static DECLARE_WAIT_QUEUE_HEAD(apm_waitq
@@ -3870 +3697 @@
-@@ -601,19 +601,42 @@ static u8 apm_bios_call(u32 func, u32 ebx_in, u32 ecx_in,
+@@ -601,19 +601,42 @@ static u8 apm_bios_call(u32 func, u32 eb
@@ -3913 +3740 @@
-@@ -644,19 +667,42 @@ static u8 apm_bios_call_simple(u32 func, u32 ebx_in, u32 ecx_in, u32 *eax)
+@@ -644,19 +667,42 @@ static u8 apm_bios_call_simple(u32 func,
@@ -3965 +3792 @@
-@@ -1868,7 +1914,10 @@ static const struct file_operations apm_bios_fops = {
+@@ -1868,7 +1914,10 @@ static const struct file_operations apm_
@@ -3977 +3804 @@
-@@ -2189,7 +2238,7 @@ static struct dmi_system_id __initdata apm_dmi_table[] = {
+@@ -2189,7 +2238,7 @@ static struct dmi_system_id __initdata a
@@ -4039,4 +3866,3 @@
-diff --git a/arch/x86/kernel/asm-offsets_32.c b/arch/x86/kernel/asm-offsets_32.c
-index 92588083950f8106bd08aafb081ebe46ce3023fd..c67715ccc4579a50dc61258d897254a2791d59b9 100644
---- a/arch/x86/kernel/asm-offsets_32.c
-+++ b/arch/x86/kernel/asm-offsets_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/asm-offsets_32.c linux-2.6.26.6/arch/x86/kernel/asm-offsets_32.c
+--- linux-2.6.26.6/arch/x86/kernel/asm-offsets_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/asm-offsets_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -4059,4 +3885,3 @@
-diff --git a/arch/x86/kernel/asm-offsets_64.c b/arch/x86/kernel/asm-offsets_64.c
-index f126c05d6170a17e8fdd880b5973324eb8ebb7d0..23282b86238c7c4a831c511e2795a8d26d89d988 100644
---- a/arch/x86/kernel/asm-offsets_64.c
-+++ b/arch/x86/kernel/asm-offsets_64.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/asm-offsets_64.c linux-2.6.26.6/arch/x86/kernel/asm-offsets_64.c
+--- linux-2.6.26.6/arch/x86/kernel/asm-offsets_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/asm-offsets_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -4071,4 +3896,3 @@
-diff --git a/arch/x86/kernel/cpu/common.c b/arch/x86/kernel/cpu/common.c
-index d0463a9462477716bd065b5c822cd34e96812282..37ff4cca6e503f87d950571c06823cb49a67b2ad 100644
---- a/arch/x86/kernel/cpu/common.c
-+++ b/arch/x86/kernel/cpu/common.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/cpu/common.c linux-2.6.26.6/arch/x86/kernel/cpu/common.c
+--- linux-2.6.26.6/arch/x86/kernel/cpu/common.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/cpu/common.c	2008-10-11 21:54:19.000000000 -0400
@@ -4126 +3950 @@
-@@ -479,6 +442,10 @@ void __cpuinit identify_cpu(struct cpuinfo_x86 *c)
+@@ -479,6 +442,10 @@ void __cpuinit identify_cpu(struct cpuin
@@ -4137 +3961 @@
-@@ -615,7 +582,7 @@ static __init int setup_disablecpuid(char *arg)
+@@ -615,7 +582,7 @@ static __init int setup_disablecpuid(cha
@@ -4173,5 +3997,4 @@
-diff --git a/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c b/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
-index b0c8208df9fa17363b5a3ed5ce35bdec8c52ad25..242a75d98feee6845146b9c4b2f2d50d22f6d658 100644
---- a/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
-+++ b/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
-@@ -560,7 +560,7 @@ static const struct dmi_system_id sw_any_bug_dmi_table[] = {
+diff -urNp linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
+--- linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c	2008-10-11 21:54:19.000000000 -0400
+@@ -560,7 +560,7 @@ static const struct dmi_system_id sw_any
@@ -4186,4 +4009,3 @@
-diff --git a/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c b/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
-index 908dd347c67ec3dc29aa5ab8b3dcbae9a12e5e37..d2dd06eefc6e0ceece433b114bd0df534342bb9a 100644
---- a/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
-+++ b/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
+--- linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c	2008-10-11 21:54:19.000000000 -0400
@@ -4199,5 +4021,4 @@
-diff --git a/arch/x86/kernel/cpu/intel.c b/arch/x86/kernel/cpu/intel.c
-index fe9224c51d37ee1ca4cd36d6e7265e8124059012..37b7a882e53a8b5c2d4ceebc9266c9cc486fb060 100644
---- a/arch/x86/kernel/cpu/intel.c
-+++ b/arch/x86/kernel/cpu/intel.c
-@@ -107,7 +107,7 @@ static void __cpuinit trap_init_f00f_bug(void)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/cpu/intel.c linux-2.6.26.6/arch/x86/kernel/cpu/intel.c
+--- linux-2.6.26.6/arch/x86/kernel/cpu/intel.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/cpu/intel.c	2008-10-11 21:54:19.000000000 -0400
+@@ -107,7 +107,7 @@ static void __cpuinit trap_init_f00f_bug
@@ -4212,5 +4033,4 @@
-diff --git a/arch/x86/kernel/cpu/mcheck/mce_64.c b/arch/x86/kernel/cpu/mcheck/mce_64.c
-index e07e8c068ae00c464cdbf828cfbc8c67aaf76202..1df6badc4d7e5450b790d46bb2d449a6c703b9af 100644
---- a/arch/x86/kernel/cpu/mcheck/mce_64.c
-+++ b/arch/x86/kernel/cpu/mcheck/mce_64.c
-@@ -672,6 +672,7 @@ static struct miscdevice mce_log_device = {
+diff -urNp linux-2.6.26.6/arch/x86/kernel/cpu/mcheck/mce_64.c linux-2.6.26.6/arch/x86/kernel/cpu/mcheck/mce_64.c
+--- linux-2.6.26.6/arch/x86/kernel/cpu/mcheck/mce_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/cpu/mcheck/mce_64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -672,6 +672,7 @@ static struct miscdevice mce_log_device 
@@ -4224,5 +4044,4 @@
-diff --git a/arch/x86/kernel/cpu/mtrr/generic.c b/arch/x86/kernel/cpu/mtrr/generic.c
-index 745b974d5c958c3c217377c621c949093a01c38d..c3b5c44a5f5a04c7997751e404e570513f614bc7 100644
---- a/arch/x86/kernel/cpu/mtrr/generic.c
-+++ b/arch/x86/kernel/cpu/mtrr/generic.c
-@@ -31,11 +31,11 @@ static struct fixed_range_block fixed_range_blocks[] = {
+diff -urNp linux-2.6.26.6/arch/x86/kernel/cpu/mtrr/generic.c linux-2.6.26.6/arch/x86/kernel/cpu/mtrr/generic.c
+--- linux-2.6.26.6/arch/x86/kernel/cpu/mtrr/generic.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/cpu/mtrr/generic.c	2008-10-11 21:55:52.000000000 -0400
+@@ -31,11 +31,11 @@ static struct fixed_range_block fixed_ra
@@ -4251,5 +4070,4 @@
-diff --git a/arch/x86/kernel/crash.c b/arch/x86/kernel/crash.c
-index 2685538179097a1e8e073ebf07cd49e898ef4f6e..42c856769fcdc420d8a95ef3e33c6d9e782c103e 100644
---- a/arch/x86/kernel/crash.c
-+++ b/arch/x86/kernel/crash.c
-@@ -59,7 +59,7 @@ static int crash_nmi_callback(struct notifier_block *self,
+diff -urNp linux-2.6.26.6/arch/x86/kernel/crash.c linux-2.6.26.6/arch/x86/kernel/crash.c
+--- linux-2.6.26.6/arch/x86/kernel/crash.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/crash.c	2008-10-11 21:54:19.000000000 -0400
+@@ -59,7 +59,7 @@ static int crash_nmi_callback(struct not
@@ -4264,4 +4082,3 @@
-diff --git a/arch/x86/kernel/doublefault_32.c b/arch/x86/kernel/doublefault_32.c
-index a47798b59f07e82205cc6f24d2e4ccc5f0cb6db7..c4bae0eef29d3bbfde57dd872118fb553e70f930 100644
---- a/arch/x86/kernel/doublefault_32.c
-+++ b/arch/x86/kernel/doublefault_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/doublefault_32.c linux-2.6.26.6/arch/x86/kernel/doublefault_32.c
+--- linux-2.6.26.6/arch/x86/kernel/doublefault_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/doublefault_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -4286 +4103 @@
-@@ -60,10 +60,10 @@ struct tss_struct doublefault_tss __cacheline_aligned = {
+@@ -60,10 +60,10 @@ struct tss_struct doublefault_tss __cach
@@ -4299,4 +4116,3 @@
-diff --git a/arch/x86/kernel/efi_32.c b/arch/x86/kernel/efi_32.c
-index 4b63c8e1f13b1b078a42dc113403c1952c52f3cc..553e34fedf5b651452be6d4665dc2c44e7c321e6 100644
---- a/arch/x86/kernel/efi_32.c
-+++ b/arch/x86/kernel/efi_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/efi_32.c linux-2.6.26.6/arch/x86/kernel/efi_32.c
+--- linux-2.6.26.6/arch/x86/kernel/efi_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/efi_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -4383,4 +4199,3 @@
-diff --git a/arch/x86/kernel/efi_stub_32.S b/arch/x86/kernel/efi_stub_32.S
-index ef00bb77d7e480d058ce21e2b66a20be730c7896..c902bdceeb8ed51f7ae4b1dbc205b698642e7eaf 100644
---- a/arch/x86/kernel/efi_stub_32.S
-+++ b/arch/x86/kernel/efi_stub_32.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/efi_stub_32.S linux-2.6.26.6/arch/x86/kernel/efi_stub_32.S
+--- linux-2.6.26.6/arch/x86/kernel/efi_stub_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/efi_stub_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -4484,4 +4299,3 @@
-diff --git a/arch/x86/kernel/entry_32.S b/arch/x86/kernel/entry_32.S
-index c778e4fa55a2eacc79d34954c2fdcef1367d5732..596c39f50b3e2ca3437000b24141c15af4f8d23b 100644
---- a/arch/x86/kernel/entry_32.S
-+++ b/arch/x86/kernel/entry_32.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/entry_32.S linux-2.6.26.6/arch/x86/kernel/entry_32.S
+--- linux-2.6.26.6/arch/x86/kernel/entry_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/entry_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -4769,4 +4583,3 @@
-diff --git a/arch/x86/kernel/entry_64.S b/arch/x86/kernel/entry_64.S
-index 556a8df522a7adcf9583164be4cad60e29b00a97..3f04e6e21ecb673fb55deb76b1faf424d33e08c8 100644
---- a/arch/x86/kernel/entry_64.S
-+++ b/arch/x86/kernel/entry_64.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/entry_64.S linux-2.6.26.6/arch/x86/kernel/entry_64.S
+--- linux-2.6.26.6/arch/x86/kernel/entry_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/entry_64.S	2008-10-11 21:54:19.000000000 -0400
@@ -4795,31 +4608,3 @@
-diff --git a/arch/x86/kernel/head64.c b/arch/x86/kernel/head64.c
-index d946c37aceca5640a028791ea3e028b4d00fe64c..caf320bca413f94837cf10cd1861e631e0785629 100644
---- a/arch/x86/kernel/head64.c
-+++ b/arch/x86/kernel/head64.c
-@@ -143,6 +143,11 @@ void __init x86_64_start_kernel(char * real_mode_data)
- 	/* Make NULL pointers segfault */
- 	zap_identity_mappings();
- 
-+	for (i = 0; i < NR_CPUS; i++)
-+		cpu_pda(i) = &boot_cpu_pda[i];
-+
-+	pda_init(0);
-+
- 	/* Cleanup the over mapped high alias */
- 	cleanup_highmap();
- 
-@@ -157,10 +162,6 @@ void __init x86_64_start_kernel(char * real_mode_data)
- 
- 	early_printk("Kernel alive\n");
- 
-- 	for (i = 0; i < NR_CPUS; i++)
-- 		cpu_pda(i) = &boot_cpu_pda[i];
--
--	pda_init(0);
- 	copy_bootdata(__va(real_mode_data));
- 
- 	reserve_early(__pa_symbol(&_text), __pa_symbol(&_end), "TEXT DATA BSS");
-diff --git a/arch/x86/kernel/head_32.S b/arch/x86/kernel/head_32.S
-index f7357cc0162c2f1c4786b3208e8524b51837fef8..e82fcee79d36f476ee89a000ee89a45d229a0f80 100644
---- a/arch/x86/kernel/head_32.S
-+++ b/arch/x86/kernel/head_32.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/head_32.S linux-2.6.26.6/arch/x86/kernel/head_32.S
+--- linux-2.6.26.6/arch/x86/kernel/head_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/head_32.S	2008-10-11 21:55:07.000000000 -0400
@@ -4862 +4647 @@
-@@ -82,6 +88,12 @@ INIT_MAP_BEYOND_END = BOOTBITMAP_SIZE + (PAGE_TABLE_SIZE + ALLOCATOR_SLOP)*PAGE_
+@@ -82,6 +88,12 @@ INIT_MAP_BEYOND_END = BOOTBITMAP_SIZE + 
@@ -4956 +4741 @@
-@@ -172,7 +232,7 @@ num_subarch_entries = (. - subarch_entries) / 4
+@@ -172,7 +232,7 @@ num_subarch_entries = (. - subarch_entri
@@ -5244,4 +5029,29 @@
-diff --git a/arch/x86/kernel/head_64.S b/arch/x86/kernel/head_64.S
-index b817974ef9420bba5702327a1089156dcb5d72c3..9c902d20769f72b40583181d9495f01ec754d46e 100644
---- a/arch/x86/kernel/head_64.S
-+++ b/arch/x86/kernel/head_64.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/head64.c linux-2.6.26.6/arch/x86/kernel/head64.c
+--- linux-2.6.26.6/arch/x86/kernel/head64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/head64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -143,6 +143,11 @@ void __init x86_64_start_kernel(char * r
+ 	/* Make NULL pointers segfault */
+ 	zap_identity_mappings();
+ 
++	for (i = 0; i < NR_CPUS; i++)
++		cpu_pda(i) = &boot_cpu_pda[i];
++
++	pda_init(0);
++
+ 	/* Cleanup the over mapped high alias */
+ 	cleanup_highmap();
+ 
+@@ -157,10 +162,6 @@ void __init x86_64_start_kernel(char * r
+ 
+ 	early_printk("Kernel alive\n");
+ 
+- 	for (i = 0; i < NR_CPUS; i++)
+- 		cpu_pda(i) = &boot_cpu_pda[i];
+-
+-	pda_init(0);
+ 	copy_bootdata(__va(real_mode_data));
+ 
+ 	reserve_early(__pa_symbol(&_text), __pa_symbol(&_end), "TEXT DATA BSS");
+diff -urNp linux-2.6.26.6/arch/x86/kernel/head_64.S linux-2.6.26.6/arch/x86/kernel/head_64.S
+--- linux-2.6.26.6/arch/x86/kernel/head_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/head_64.S	2008-10-11 22:15:25.000000000 -0400
@@ -5303,3 +5113,3 @@
-+	.previous
- #endif /* CONFIG_EARLY_PRINTK */
--	.previous
+-#endif /* CONFIG_EARLY_PRINTK */
+ 	.previous
++#endif /* CONFIG_EARLY_PRINTK */
@@ -5404,4 +5214,3 @@
-diff --git a/arch/x86/kernel/i386_ksyms_32.c b/arch/x86/kernel/i386_ksyms_32.c
-index deb43785e923d09a8ba7215222e84363ad682742..f9f39f4a5de6ccdc3a961f4a77b1dcf1d596e93c 100644
---- a/arch/x86/kernel/i386_ksyms_32.c
-+++ b/arch/x86/kernel/i386_ksyms_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/i386_ksyms_32.c linux-2.6.26.6/arch/x86/kernel/i386_ksyms_32.c
+--- linux-2.6.26.6/arch/x86/kernel/i386_ksyms_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/i386_ksyms_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -5429,4 +5238,3 @@
-diff --git a/arch/x86/kernel/init_task.c b/arch/x86/kernel/init_task.c
-index a4f93b4120c155c20889947942d7bdb5c286908d..ec3d4c4d707c80c5f6ffc8f6efc2372cb33b0684 100644
---- a/arch/x86/kernel/init_task.c
-+++ b/arch/x86/kernel/init_task.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/init_task.c linux-2.6.26.6/arch/x86/kernel/init_task.c
+--- linux-2.6.26.6/arch/x86/kernel/init_task.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/init_task.c	2008-10-11 21:54:19.000000000 -0400
@@ -5441,4 +5249,3 @@
-diff --git a/arch/x86/kernel/ioport.c b/arch/x86/kernel/ioport.c
-index 50e5e4a31c8500e94b277378b2d3860d673fc225..147ea7bc716d2c1f13c9261d218e98d87cbdd2d4 100644
---- a/arch/x86/kernel/ioport.c
-+++ b/arch/x86/kernel/ioport.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/ioport.c linux-2.6.26.6/arch/x86/kernel/ioport.c
+--- linux-2.6.26.6/arch/x86/kernel/ioport.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/ioport.c	2008-10-11 21:54:19.000000000 -0400
@@ -5453 +5260 @@
-@@ -40,6 +41,12 @@ asmlinkage long sys_ioperm(unsigned long from, unsigned long num, int turn_on)
+@@ -40,6 +41,12 @@ asmlinkage long sys_ioperm(unsigned long
@@ -5466 +5273 @@
-@@ -66,7 +73,7 @@ asmlinkage long sys_ioperm(unsigned long from, unsigned long num, int turn_on)
+@@ -66,7 +73,7 @@ asmlinkage long sys_ioperm(unsigned long
@@ -5475 +5282 @@
-@@ -121,8 +128,13 @@ static int do_iopl(unsigned int level, struct pt_regs *regs)
+@@ -121,8 +128,13 @@ static int do_iopl(unsigned int level, s
@@ -5489,5 +5296,4 @@
-diff --git a/arch/x86/kernel/irq_32.c b/arch/x86/kernel/irq_32.c
-index 147352df28b9c74146a102f6c8b22b17e2b11d6d..6d223d9316479d023c1ab1ecf86c29f4f26e9dd4 100644
---- a/arch/x86/kernel/irq_32.c
-+++ b/arch/x86/kernel/irq_32.c
-@@ -115,7 +115,7 @@ unsigned int do_IRQ(struct pt_regs *regs)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/irq_32.c linux-2.6.26.6/arch/x86/kernel/irq_32.c
+--- linux-2.6.26.6/arch/x86/kernel/irq_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/irq_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -115,7 +115,7 @@ unsigned int do_IRQ(struct pt_regs *regs
@@ -5511,5 +5317,4 @@
-diff --git a/arch/x86/kernel/kprobes.c b/arch/x86/kernel/kprobes.c
-index 43c019f85f0db749425e451957bd2279cee47b80..0b7ec722350dca9047a3c0ddcf3cffc563a662f7 100644
---- a/arch/x86/kernel/kprobes.c
-+++ b/arch/x86/kernel/kprobes.c
-@@ -166,9 +166,24 @@ static void __kprobes set_jmp_op(void *from, void *to)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/kprobes.c linux-2.6.26.6/arch/x86/kernel/kprobes.c
+--- linux-2.6.26.6/arch/x86/kernel/kprobes.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/kprobes.c	2008-10-11 21:54:19.000000000 -0400
+@@ -166,9 +166,24 @@ static void __kprobes set_jmp_op(void *f
@@ -5541 +5346 @@
-@@ -342,16 +357,29 @@ static void __kprobes fix_riprel(struct kprobe *p)
+@@ -342,16 +357,29 @@ static void __kprobes fix_riprel(struct 
@@ -5574 +5379 @@
-@@ -428,7 +456,7 @@ static void __kprobes prepare_singlestep(struct kprobe *p, struct pt_regs *regs)
+@@ -428,7 +456,7 @@ static void __kprobes prepare_singlestep
@@ -5583 +5388 @@
-@@ -450,7 +478,7 @@ static void __kprobes setup_singlestep(struct kprobe *p, struct pt_regs *regs,
+@@ -450,7 +478,7 @@ static void __kprobes setup_singlestep(s
@@ -5592 +5397 @@
-@@ -772,7 +800,7 @@ static void __kprobes resume_execution(struct kprobe *p,
+@@ -772,7 +800,7 @@ static void __kprobes resume_execution(s
@@ -5601 +5406 @@
-@@ -955,7 +983,7 @@ int __kprobes kprobe_exceptions_notify(struct notifier_block *self,
+@@ -955,7 +983,7 @@ int __kprobes kprobe_exceptions_notify(s
@@ -5610,5 +5415,4 @@
-diff --git a/arch/x86/kernel/ldt.c b/arch/x86/kernel/ldt.c
-index 0224c3637c73e68b4566124dd5d825034bc8c07a..449f9d7299316b161c3d8ce162dae73c3ea6dafb 100644
---- a/arch/x86/kernel/ldt.c
-+++ b/arch/x86/kernel/ldt.c
-@@ -65,7 +65,7 @@ static int alloc_ldt(mm_context_t *pc, int mincount, int reload)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/ldt.c linux-2.6.26.6/arch/x86/kernel/ldt.c
+--- linux-2.6.26.6/arch/x86/kernel/ldt.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/ldt.c	2008-10-11 21:54:19.000000000 -0400
+@@ -65,7 +65,7 @@ static int alloc_ldt(mm_context_t *pc, i
@@ -5623 +5427 @@
-@@ -110,6 +110,24 @@ int init_new_context(struct task_struct *tsk, struct mm_struct *mm)
+@@ -110,6 +110,24 @@ int init_new_context(struct task_struct 
@@ -5648 +5452 @@
-@@ -223,6 +241,13 @@ static int write_ldt(void __user *ptr, unsigned long bytecount, int oldmode)
+@@ -223,6 +241,13 @@ static int write_ldt(void __user *ptr, u
@@ -5662,5 +5466,4 @@
-diff --git a/arch/x86/kernel/machine_kexec_32.c b/arch/x86/kernel/machine_kexec_32.c
-index d0b234c9fc318ac0f11a127f9aac87ce7de55dc6..a6639df3cb41dc3a820567f31f5ba4b3585a3f2a 100644
---- a/arch/x86/kernel/machine_kexec_32.c
-+++ b/arch/x86/kernel/machine_kexec_32.c
-@@ -30,7 +30,7 @@ static u32 kexec_pmd1[1024] PAGE_ALIGNED;
+diff -urNp linux-2.6.26.6/arch/x86/kernel/machine_kexec_32.c linux-2.6.26.6/arch/x86/kernel/machine_kexec_32.c
+--- linux-2.6.26.6/arch/x86/kernel/machine_kexec_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/machine_kexec_32.c	2008-10-11 21:55:52.000000000 -0400
+@@ -30,7 +30,7 @@ static u32 kexec_pmd1[1024] PAGE_ALIGNED
@@ -5675 +5478 @@
-@@ -42,7 +42,7 @@ static void set_idt(void *newidt, __u16 limit)
+@@ -42,7 +42,7 @@ static void set_idt(void *newidt, __u16 
@@ -5684 +5487 @@
-@@ -111,10 +111,10 @@ NORET_TYPE void machine_kexec(struct kimage *image)
+@@ -111,10 +111,10 @@ NORET_TYPE void machine_kexec(struct kim
@@ -5697,4 +5500,3 @@
-diff --git a/arch/x86/kernel/module_32.c b/arch/x86/kernel/module_32.c
-index 3db0a5442eb1bab48d9bbdfa93a0a9ccd5b74fa0..9f9c24318f18e272bca800bb88706b065b7bbb04 100644
---- a/arch/x86/kernel/module_32.c
-+++ b/arch/x86/kernel/module_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/module_32.c linux-2.6.26.6/arch/x86/kernel/module_32.c
+--- linux-2.6.26.6/arch/x86/kernel/module_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/module_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -5743 +5545 @@
-@@ -45,6 +70,45 @@ void module_free(struct module *mod, void *module_region)
+@@ -45,6 +70,45 @@ void module_free(struct module *mod, voi
@@ -5848,5 +5650,4 @@
-diff --git a/arch/x86/kernel/module_64.c b/arch/x86/kernel/module_64.c
-index a888e67f5874dad3415220cc9fd0c9f962c4661c..241d7434e9803d486432296e7a98917a68f1c615 100644
---- a/arch/x86/kernel/module_64.c
-+++ b/arch/x86/kernel/module_64.c
-@@ -39,7 +39,7 @@ void module_free(struct module *mod, void *module_region)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/module_64.c linux-2.6.26.6/arch/x86/kernel/module_64.c
+--- linux-2.6.26.6/arch/x86/kernel/module_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/module_64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -39,7 +39,7 @@ void module_free(struct module *mod, voi
@@ -5867 +5668 @@
- }
++}
@@ -5883 +5684 @@
-+}
+ }
@@ -5894 +5695 @@
-@@ -76,7 +99,11 @@ int apply_relocate_add(Elf64_Shdr *sechdrs,
+@@ -76,7 +99,11 @@ int apply_relocate_add(Elf64_Shdr *sechd
@@ -5907 +5708 @@
-@@ -100,21 +127,61 @@ int apply_relocate_add(Elf64_Shdr *sechdrs,
+@@ -100,21 +127,61 @@ int apply_relocate_add(Elf64_Shdr *sechd
@@ -5969,5 +5770,4 @@
-diff --git a/arch/x86/kernel/mpparse.c b/arch/x86/kernel/mpparse.c
-index d5b8691fff4db379cf4ee08328fc3a68765919ce..6acdaa1a59be558def552d021694836f32cd2365 100644
---- a/arch/x86/kernel/mpparse.c
-+++ b/arch/x86/kernel/mpparse.c
-@@ -313,14 +313,14 @@ static int __init smp_read_mpc(struct mp_config_table *mpc, unsigned early)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/mpparse.c linux-2.6.26.6/arch/x86/kernel/mpparse.c
+--- linux-2.6.26.6/arch/x86/kernel/mpparse.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/mpparse.c	2008-10-11 21:54:19.000000000 -0400
+@@ -313,14 +313,14 @@ static int __init smp_read_mpc(struct mp
@@ -5991,4 +5791,3 @@
-diff --git a/arch/x86/kernel/paravirt.c b/arch/x86/kernel/paravirt.c
-index 74f0c5ea2a0388af848faa058804cd9df86f4391..238d37eedf612beadb1d5858588d479840eb02cf 100644
---- a/arch/x86/kernel/paravirt.c
-+++ b/arch/x86/kernel/paravirt.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/paravirt.c linux-2.6.26.6/arch/x86/kernel/paravirt.c
+--- linux-2.6.26.6/arch/x86/kernel/paravirt.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/paravirt.c	2008-10-11 21:54:19.000000000 -0400
@@ -6004 +5803 @@
-@@ -159,7 +159,7 @@ unsigned paravirt_patch_insns(void *insnbuf, unsigned len,
+@@ -159,7 +159,7 @@ unsigned paravirt_patch_insns(void *insn
@@ -6013 +5812 @@
-@@ -261,21 +261,21 @@ enum paravirt_lazy_mode paravirt_get_lazy_mode(void)
+@@ -261,21 +261,21 @@ enum paravirt_lazy_mode paravirt_get_laz
@@ -6074,5 +5873,4 @@
-diff --git a/arch/x86/kernel/process_32.c b/arch/x86/kernel/process_32.c
-index e2db9ac5c61c2b6d6de1f0b13f71b6d834eaeca2..ba2c81b0edda179e85c4bcc8df94aee507192067 100644
---- a/arch/x86/kernel/process_32.c
-+++ b/arch/x86/kernel/process_32.c
-@@ -66,8 +66,10 @@ EXPORT_SYMBOL(boot_option_idle_override);
+diff -urNp linux-2.6.26.6/arch/x86/kernel/process_32.c linux-2.6.26.6/arch/x86/kernel/process_32.c
+--- linux-2.6.26.6/arch/x86/kernel/process_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/process_32.c	2008-10-11 21:55:07.000000000 -0400
+@@ -66,8 +66,10 @@ EXPORT_SYMBOL(boot_option_idle_override)
@@ -6097 +5895 @@
-@@ -201,7 +204,7 @@ void __show_registers(struct pt_regs *regs, int all)
+@@ -201,7 +204,7 @@ void __show_registers(struct pt_regs *re
@@ -6106 +5904 @@
-@@ -278,8 +281,8 @@ int kernel_thread(int (*fn)(void *), void * arg, unsigned long flags)
+@@ -278,8 +281,8 @@ int kernel_thread(int (*fn)(void *), voi
@@ -6134 +5932 @@
-@@ -361,7 +365,7 @@ int copy_thread(int nr, unsigned long clone_flags, unsigned long sp,
+@@ -361,7 +365,7 @@ int copy_thread(int nr, unsigned long cl
@@ -6143 +5941 @@
-@@ -390,6 +394,7 @@ int copy_thread(int nr, unsigned long clone_flags, unsigned long sp,
+@@ -390,6 +394,7 @@ int copy_thread(int nr, unsigned long cl
@@ -6151 +5949 @@
-@@ -589,7 +594,7 @@ struct task_struct * __switch_to(struct task_struct *prev_p, struct task_struct
+@@ -589,7 +594,7 @@ struct task_struct * __switch_to(struct 
@@ -6160 +5958 @@
-@@ -617,6 +622,11 @@ struct task_struct * __switch_to(struct task_struct *prev_p, struct task_struct
+@@ -617,6 +622,11 @@ struct task_struct * __switch_to(struct 
@@ -6172 +5970 @@
-@@ -755,15 +765,27 @@ unsigned long get_wchan(struct task_struct *p)
+@@ -755,15 +765,27 @@ unsigned long get_wchan(struct task_stru
@@ -6209,4 +6007,3 @@
-diff --git a/arch/x86/kernel/process_64.c b/arch/x86/kernel/process_64.c
-index c6eb5c91e5f607f7fb70758ed65eee667c7d1401..a671641e4a4a01fd8b1f31b0b843d62ed8a660b0 100644
---- a/arch/x86/kernel/process_64.c
-+++ b/arch/x86/kernel/process_64.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/process_64.c linux-2.6.26.6/arch/x86/kernel/process_64.c
+--- linux-2.6.26.6/arch/x86/kernel/process_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/process_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -6231 +6028 @@
-@@ -566,7 +568,7 @@ __switch_to(struct task_struct *prev_p, struct task_struct *next_p)
+@@ -566,7 +568,7 @@ __switch_to(struct task_struct *prev_p, 
@@ -6240 +6037 @@
-@@ -641,7 +643,6 @@ __switch_to(struct task_struct *prev_p, struct task_struct *next_p)
+@@ -641,7 +643,6 @@ __switch_to(struct task_struct *prev_p, 
@@ -6248 +6045 @@
-@@ -855,16 +856,3 @@ long sys_arch_prctl(int code, unsigned long addr)
+@@ -855,16 +856,3 @@ long sys_arch_prctl(int code, unsigned l
@@ -6265,5 +6062,4 @@
-diff --git a/arch/x86/kernel/ptrace.c b/arch/x86/kernel/ptrace.c
-index 77040b6070e18c00ce71f788efa0d40d5a156229..4afe11493d48cce8558e974e700ef23313b6b3d1 100644
---- a/arch/x86/kernel/ptrace.c
-+++ b/arch/x86/kernel/ptrace.c
-@@ -1371,7 +1371,7 @@ void send_sigtrap(struct task_struct *tsk, struct pt_regs *regs, int error_code)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/ptrace.c linux-2.6.26.6/arch/x86/kernel/ptrace.c
+--- linux-2.6.26.6/arch/x86/kernel/ptrace.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/ptrace.c	2008-10-11 21:54:19.000000000 -0400
+@@ -1371,7 +1371,7 @@ void send_sigtrap(struct task_struct *ts
@@ -6278,4 +6074,3 @@
-diff --git a/arch/x86/kernel/reboot.c b/arch/x86/kernel/reboot.c
-index d834b36b0ce19cfc9cdc289c8cc72f360770f13a..b11e4141b802f583e785bfdd1cf697f522907c36 100644
---- a/arch/x86/kernel/reboot.c
-+++ b/arch/x86/kernel/reboot.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/reboot.c linux-2.6.26.6/arch/x86/kernel/reboot.c
+--- linux-2.6.26.6/arch/x86/kernel/reboot.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/reboot.c	2008-10-11 21:54:19.000000000 -0400
@@ -6291 +6086 @@
-@@ -193,7 +193,7 @@ static struct dmi_system_id __initdata reboot_dmi_table[] = {
+@@ -193,7 +193,7 @@ static struct dmi_system_id __initdata r
@@ -6331 +6126 @@
-@@ -253,7 +253,7 @@ static unsigned char real_mode_switch [] =
+@@ -253,7 +253,7 @@ static unsigned char real_mode_switch []
@@ -6349 +6144 @@
-@@ -283,8 +283,8 @@ void machine_real_restart(unsigned char *code, int length)
+@@ -283,8 +283,8 @@ void machine_real_restart(unsigned char 
@@ -6360 +6155 @@
-@@ -296,16 +296,15 @@ void machine_real_restart(unsigned char *code, int length)
+@@ -296,16 +296,15 @@ void machine_real_restart(unsigned char 
@@ -6380,84 +6175,3 @@
-diff --git a/arch/x86/kernel/setup64.c b/arch/x86/kernel/setup64.c
-index aee0e8200777057699f8cd580c1add23684d780d..8e8e18c6333aac7227c7448aca91f3136ccee0ef 100644
---- a/arch/x86/kernel/setup64.c
-+++ b/arch/x86/kernel/setup64.c
-@@ -38,15 +38,13 @@ struct x8664_pda *_cpu_pda[NR_CPUS] __read_mostly;
- EXPORT_SYMBOL(_cpu_pda);
- struct x8664_pda boot_cpu_pda[NR_CPUS] __cacheline_aligned;
- 
--struct desc_ptr idt_descr = { 256 * 16 - 1, (unsigned long) idt_table };
-+struct desc_ptr idt_descr __read_only = { 256 * 16 - 1, (unsigned long) idt_table };
- 
- char boot_cpu_stack[IRQSTACKSIZE] __attribute__((section(".bss.page_aligned")));
- 
- unsigned long __supported_pte_mask __read_mostly = ~0UL;
- EXPORT_SYMBOL_GPL(__supported_pte_mask);
- 
--static int do_not_nx __cpuinitdata = 0;
--
- /* noexec=on|off
- Control non executable mappings for 64bit processes.
- 
-@@ -59,16 +57,14 @@ static int __init nonx_setup(char *str)
- 		return -EINVAL;
- 	if (!strncmp(str, "on", 2)) {
-                 __supported_pte_mask |= _PAGE_NX; 
-- 		do_not_nx = 0; 
- 	} else if (!strncmp(str, "off", 3)) {
--		do_not_nx = 1;
- 		__supported_pte_mask &= ~_PAGE_NX;
-         }
- 	return 0;
- } 
- early_param("noexec", nonx_setup);
- 
--int force_personality32 = 0; 
-+int force_personality32;
- 
- /* noexec32=on|off
- Control non executable heap for 32bit processes.
-@@ -151,7 +147,7 @@ void __cpuinit check_efer(void)
- 	unsigned long efer;
- 
- 	rdmsrl(MSR_EFER, efer); 
--        if (!(efer & EFER_NX) || do_not_nx) { 
-+        if (!(efer & EFER_NX)) {
-                 __supported_pte_mask &= ~_PAGE_NX; 
-         }       
- }
-@@ -174,12 +170,13 @@ DEFINE_PER_CPU(struct orig_ist, orig_ist);
- void __cpuinit cpu_init (void)
- {
- 	int cpu = stack_smp_processor_id();
--	struct tss_struct *t = &per_cpu(init_tss, cpu);
-+	struct tss_struct *t = init_tss + cpu;
- 	struct orig_ist *orig_ist = &per_cpu(orig_ist, cpu);
- 	unsigned long v; 
- 	char *estacks = NULL; 
- 	struct task_struct *me;
- 	int i;
-+	struct desc_ptr cpu_gdt_descr = { .size = GDT_SIZE - 1, .address = (unsigned long)get_cpu_gdt_table(cpu)};
- 
- 	/* CPU 0 is initialised in head64.c */
- 	if (cpu != 0) {
-@@ -197,14 +194,9 @@ void __cpuinit cpu_init (void)
- 	clear_in_cr4(X86_CR4_VME|X86_CR4_PVI|X86_CR4_TSD|X86_CR4_DE);
- 
- 	/*
--	 * Initialize the per-CPU GDT with the boot GDT,
--	 * and set up the GDT descriptor:
-+	 * Initialize the per-CPU GDT with the boot GDT:
- 	 */
--	if (cpu)
--		memcpy(get_cpu_gdt_table(cpu), cpu_gdt_table, GDT_SIZE);
--
--	cpu_gdt_descr[cpu].size = GDT_SIZE;
--	load_gdt((const struct desc_ptr *)&cpu_gdt_descr[cpu]);
-+	load_gdt(&cpu_gdt_descr);
- 	load_idt((const struct desc_ptr *)&idt_descr);
- 
- 	memset(me->thread.tls_array, 0, GDT_ENTRY_TLS_ENTRIES * 8);
-diff --git a/arch/x86/kernel/setup_32.c b/arch/x86/kernel/setup_32.c
-index 3bf22f030d7869dbc9dabc4bb2d3077eb3769f47..6f0adaae10cae9db52dcb4f5b901c3ca4ef08568 100644
---- a/arch/x86/kernel/setup_32.c
-+++ b/arch/x86/kernel/setup_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/setup_32.c linux-2.6.26.6/arch/x86/kernel/setup_32.c
+--- linux-2.6.26.6/arch/x86/kernel/setup_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/setup_32.c	2008-10-11 21:55:52.000000000 -0400
@@ -6472 +6186 @@
-@@ -341,10 +342,10 @@ early_param("reservetop", parse_reservetop);
+@@ -341,10 +342,10 @@ early_param("reservetop", parse_reservet
@@ -6486 +6200 @@
-@@ -353,7 +354,7 @@ unsigned long __init find_max_low_pfn(void)
+@@ -353,7 +354,7 @@ unsigned long __init find_max_low_pfn(vo
@@ -6495 +6209 @@
-@@ -381,18 +382,18 @@ unsigned long __init find_max_low_pfn(void)
+@@ -381,18 +382,18 @@ unsigned long __init find_max_low_pfn(vo
@@ -6517 +6231 @@
-@@ -447,7 +448,7 @@ static void __init reserve_ebda_region(void)
+@@ -447,7 +448,7 @@ static void __init reserve_ebda_region(v
@@ -6526 +6240 @@
-@@ -477,8 +478,6 @@ static unsigned long __init setup_memory(void)
+@@ -477,8 +478,6 @@ static unsigned long __init setup_memory
@@ -6544 +6258 @@
-@@ -662,8 +661,8 @@ void __init setup_bootmem_allocator(void)
+@@ -662,8 +661,8 @@ void __init setup_bootmem_allocator(void
@@ -6555 +6269 @@
-@@ -758,8 +757,6 @@ DEFINE_PER_CPU(int, x86_cpu_to_node_map) = NUMA_NO_NODE;
+@@ -758,8 +757,6 @@ DEFINE_PER_CPU(int, x86_cpu_to_node_map)
@@ -6593,6 +6307,6 @@
-diff --git a/arch/x86/kernel/signal_32.c b/arch/x86/kernel/signal_32.c
-index d92373630963f980fb5471a0d96d903b5d4b18bf..a46b1718dd32a3dc51e97f3b22415318424db2e1 100644
---- a/arch/x86/kernel/signal_32.c
-+++ b/arch/x86/kernel/signal_32.c
-@@ -378,9 +378,9 @@ setup_frame(int sig, struct k_sigaction *ka, sigset_t *set,
- 	}
+diff -urNp linux-2.6.26.6/arch/x86/kernel/setup64.c linux-2.6.26.6/arch/x86/kernel/setup64.c
+--- linux-2.6.26.6/arch/x86/kernel/setup64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/setup64.c	2008-10-11 21:55:07.000000000 -0400
+@@ -38,15 +38,13 @@ struct x8664_pda *_cpu_pda[NR_CPUS] __re
+ EXPORT_SYMBOL(_cpu_pda);
+ struct x8664_pda boot_cpu_pda[NR_CPUS] __cacheline_aligned;
@@ -6600,8 +6314,2 @@
- 	if (current->mm->context.vdso)
--		restorer = VDSO32_SYMBOL(current->mm->context.vdso, sigreturn);
-+		restorer = (void __user *)VDSO32_SYMBOL(current->mm->context.vdso, sigreturn);
- 	else
--		restorer = &frame->retcode;
-+		restorer = (void __user *)&frame->retcode;
- 	if (ka->sa.sa_flags & SA_RESTORER)
- 		restorer = ka->sa.sa_restorer;
+-struct desc_ptr idt_descr = { 256 * 16 - 1, (unsigned long) idt_table };
++struct desc_ptr idt_descr __read_only = { 256 * 16 - 1, (unsigned long) idt_table };
@@ -6609,2 +6317 @@
-@@ -460,7 +460,7 @@ static int setup_rt_frame(int sig, struct k_sigaction *ka, siginfo_t *info,
- 		goto give_sigsegv;
+ char boot_cpu_stack[IRQSTACKSIZE] __attribute__((section(".bss.page_aligned")));
@@ -6612,13 +6319,2 @@
- 	/* Set up to return from userspace.  */
--	restorer = VDSO32_SYMBOL(current->mm->context.vdso, rt_sigreturn);
-+	restorer = (void __user *)VDSO32_SYMBOL(current->mm->context.vdso, rt_sigreturn);
- 	if (ka->sa.sa_flags & SA_RESTORER)
- 		restorer = ka->sa.sa_restorer;
- 	err |= __put_user(restorer, &frame->pretcode);
-@@ -590,7 +590,7 @@ static void do_signal(struct pt_regs *regs)
- 	 * X86_32: vm86 regs switched out by assembly code before reaching
- 	 * here, so testing against kernel CS suffices.
- 	 */
--	if (!user_mode(regs))
-+	if (!user_mode_novm(regs))
- 		return;
+ unsigned long __supported_pte_mask __read_mostly = ~0UL;
+ EXPORT_SYMBOL_GPL(__supported_pte_mask);
@@ -6626,12 +6322,107 @@
- 	if (current_thread_info()->status & TS_RESTORE_SIGMASK)
-diff --git a/arch/x86/kernel/signal_64.c b/arch/x86/kernel/signal_64.c
-index c56034de6c779743ee2301856bec2e835d3de7c3..269a3e18f3db69ebc680dbd56967226ae8d4b6ae 100644
---- a/arch/x86/kernel/signal_64.c
-+++ b/arch/x86/kernel/signal_64.c
-@@ -312,8 +312,8 @@ static int setup_rt_frame(int sig, struct k_sigaction *ka, siginfo_t *info,
- 	err |= setup_sigcontext(&frame->uc.uc_mcontext, regs, set->sig[0], me);
- 	err |= __put_user(fp, &frame->uc.uc_mcontext.fpstate);
- 	if (sizeof(*set) == 16) { 
--		__put_user(set->sig[0], &frame->uc.uc_sigmask.sig[0]);
--		__put_user(set->sig[1], &frame->uc.uc_sigmask.sig[1]); 
-+		err |= __put_user(set->sig[0], &frame->uc.uc_sigmask.sig[0]);
+-static int do_not_nx __cpuinitdata = 0;
+-
+ /* noexec=on|off
+ Control non executable mappings for 64bit processes.
+ 
+@@ -59,16 +57,14 @@ static int __init nonx_setup(char *str)
+ 		return -EINVAL;
+ 	if (!strncmp(str, "on", 2)) {
+                 __supported_pte_mask |= _PAGE_NX; 
+- 		do_not_nx = 0; 
+ 	} else if (!strncmp(str, "off", 3)) {
+-		do_not_nx = 1;
+ 		__supported_pte_mask &= ~_PAGE_NX;
+         }
+ 	return 0;
+ } 
+ early_param("noexec", nonx_setup);
+ 
+-int force_personality32 = 0; 
++int force_personality32;
+ 
+ /* noexec32=on|off
+ Control non executable heap for 32bit processes.
+@@ -151,7 +147,7 @@ void __cpuinit check_efer(void)
+ 	unsigned long efer;
+ 
+ 	rdmsrl(MSR_EFER, efer); 
+-        if (!(efer & EFER_NX) || do_not_nx) { 
++        if (!(efer & EFER_NX)) {
+                 __supported_pte_mask &= ~_PAGE_NX; 
+         }       
+ }
+@@ -174,12 +170,13 @@ DEFINE_PER_CPU(struct orig_ist, orig_ist
+ void __cpuinit cpu_init (void)
+ {
+ 	int cpu = stack_smp_processor_id();
+-	struct tss_struct *t = &per_cpu(init_tss, cpu);
++	struct tss_struct *t = init_tss + cpu;
+ 	struct orig_ist *orig_ist = &per_cpu(orig_ist, cpu);
+ 	unsigned long v; 
+ 	char *estacks = NULL; 
+ 	struct task_struct *me;
+ 	int i;
++	struct desc_ptr cpu_gdt_descr = { .size = GDT_SIZE - 1, .address = (unsigned long)get_cpu_gdt_table(cpu)};
+ 
+ 	/* CPU 0 is initialised in head64.c */
+ 	if (cpu != 0) {
+@@ -197,14 +194,9 @@ void __cpuinit cpu_init (void)
+ 	clear_in_cr4(X86_CR4_VME|X86_CR4_PVI|X86_CR4_TSD|X86_CR4_DE);
+ 
+ 	/*
+-	 * Initialize the per-CPU GDT with the boot GDT,
+-	 * and set up the GDT descriptor:
++	 * Initialize the per-CPU GDT with the boot GDT:
+ 	 */
+-	if (cpu)
+-		memcpy(get_cpu_gdt_table(cpu), cpu_gdt_table, GDT_SIZE);
+-
+-	cpu_gdt_descr[cpu].size = GDT_SIZE;
+-	load_gdt((const struct desc_ptr *)&cpu_gdt_descr[cpu]);
++	load_gdt(&cpu_gdt_descr);
+ 	load_idt((const struct desc_ptr *)&idt_descr);
+ 
+ 	memset(me->thread.tls_array, 0, GDT_ENTRY_TLS_ENTRIES * 8);
+diff -urNp linux-2.6.26.6/arch/x86/kernel/signal_32.c linux-2.6.26.6/arch/x86/kernel/signal_32.c
+--- linux-2.6.26.6/arch/x86/kernel/signal_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/signal_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -378,9 +378,9 @@ setup_frame(int sig, struct k_sigaction 
+ 	}
+ 
+ 	if (current->mm->context.vdso)
+-		restorer = VDSO32_SYMBOL(current->mm->context.vdso, sigreturn);
++		restorer = (void __user *)VDSO32_SYMBOL(current->mm->context.vdso, sigreturn);
+ 	else
+-		restorer = &frame->retcode;
++		restorer = (void __user *)&frame->retcode;
+ 	if (ka->sa.sa_flags & SA_RESTORER)
+ 		restorer = ka->sa.sa_restorer;
+ 
+@@ -460,7 +460,7 @@ static int setup_rt_frame(int sig, struc
+ 		goto give_sigsegv;
+ 
+ 	/* Set up to return from userspace.  */
+-	restorer = VDSO32_SYMBOL(current->mm->context.vdso, rt_sigreturn);
++	restorer = (void __user *)VDSO32_SYMBOL(current->mm->context.vdso, rt_sigreturn);
+ 	if (ka->sa.sa_flags & SA_RESTORER)
+ 		restorer = ka->sa.sa_restorer;
+ 	err |= __put_user(restorer, &frame->pretcode);
+@@ -590,7 +590,7 @@ static void do_signal(struct pt_regs *re
+ 	 * X86_32: vm86 regs switched out by assembly code before reaching
+ 	 * here, so testing against kernel CS suffices.
+ 	 */
+-	if (!user_mode(regs))
++	if (!user_mode_novm(regs))
+ 		return;
+ 
+ 	if (current_thread_info()->status & TS_RESTORE_SIGMASK)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/signal_64.c linux-2.6.26.6/arch/x86/kernel/signal_64.c
+--- linux-2.6.26.6/arch/x86/kernel/signal_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/signal_64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -312,8 +312,8 @@ static int setup_rt_frame(int sig, struc
+ 	err |= setup_sigcontext(&frame->uc.uc_mcontext, regs, set->sig[0], me);
+ 	err |= __put_user(fp, &frame->uc.uc_mcontext.fpstate);
+ 	if (sizeof(*set) == 16) { 
+-		__put_user(set->sig[0], &frame->uc.uc_sigmask.sig[0]);
+-		__put_user(set->sig[1], &frame->uc.uc_sigmask.sig[1]); 
++		err |= __put_user(set->sig[0], &frame->uc.uc_sigmask.sig[0]);
@@ -6642,5 +6433,4 @@
-diff --git a/arch/x86/kernel/smpboot.c b/arch/x86/kernel/smpboot.c
-index 3e1cecedde42747261c94053a53191ffa7291107..9b8b8ee35a5edaec3d6e86910202ee62a4d5efba 100644
---- a/arch/x86/kernel/smpboot.c
-+++ b/arch/x86/kernel/smpboot.c
-@@ -847,15 +847,13 @@ static int __cpuinit do_boot_cpu(int apicid, int cpu)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/smpboot.c linux-2.6.26.6/arch/x86/kernel/smpboot.c
+--- linux-2.6.26.6/arch/x86/kernel/smpboot.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/smpboot.c	2008-10-11 21:55:07.000000000 -0400
+@@ -847,15 +847,13 @@ static int __cpuinit do_boot_cpu(int api
@@ -6694,4 +6484,3 @@
-diff --git a/arch/x86/kernel/smpcommon.c b/arch/x86/kernel/smpcommon.c
-index 3449064d141a5010d69ea5702f1b2198a7548e73..8917d4933ae9c519b2e81bfe95aa65d722086bae 100644
---- a/arch/x86/kernel/smpcommon.c
-+++ b/arch/x86/kernel/smpcommon.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/smpcommon.c linux-2.6.26.6/arch/x86/kernel/smpcommon.c
+--- linux-2.6.26.6/arch/x86/kernel/smpcommon.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/smpcommon.c	2008-10-11 21:55:07.000000000 -0400
@@ -6737,5 +6526,4 @@
-diff --git a/arch/x86/kernel/step.c b/arch/x86/kernel/step.c
-index 92c20fee6781b5f5d419335e68eee8361b7f960d..674266a90b421ddef60d0008a4be22a6bb50ebc0 100644
---- a/arch/x86/kernel/step.c
-+++ b/arch/x86/kernel/step.c
-@@ -23,22 +23,20 @@ unsigned long convert_ip_to_linear(struct task_struct *child, struct pt_regs *re
+diff -urNp linux-2.6.26.6/arch/x86/kernel/step.c linux-2.6.26.6/arch/x86/kernel/step.c
+--- linux-2.6.26.6/arch/x86/kernel/step.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/step.c	2008-10-11 21:55:07.000000000 -0400
+@@ -23,22 +23,20 @@ unsigned long convert_ip_to_linear(struc
@@ -6771 +6559 @@
-@@ -54,6 +52,9 @@ static int is_setting_trap_flag(struct task_struct *child, struct pt_regs *regs)
+@@ -54,6 +52,9 @@ static int is_setting_trap_flag(struct t
@@ -6781 +6569 @@
-@@ -75,7 +76,7 @@ static int is_setting_trap_flag(struct task_struct *child, struct pt_regs *regs)
+@@ -75,7 +76,7 @@ static int is_setting_trap_flag(struct t
@@ -6790,4 +6578,11 @@
-diff --git a/arch/x86/kernel/sys_i386_32.c b/arch/x86/kernel/sys_i386_32.c
-index d2ab52cc1d6b17fa5ff72ef4e5b6111acc6903f5..df547dde3c92aea076eda795588d35690c99db5c 100644
---- a/arch/x86/kernel/sys_i386_32.c
-+++ b/arch/x86/kernel/sys_i386_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/syscall_table_32.S linux-2.6.26.6/arch/x86/kernel/syscall_table_32.S
+--- linux-2.6.26.6/arch/x86/kernel/syscall_table_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/syscall_table_32.S	2008-10-11 21:54:19.000000000 -0400
+@@ -1,3 +1,4 @@
++.section .rodata,"a",@progbits
+ ENTRY(sys_call_table)
+ 	.long sys_restart_syscall	/* 0 - old "setup()" system call, used for restarting */
+ 	.long sys_exit
+diff -urNp linux-2.6.26.6/arch/x86/kernel/sys_i386_32.c linux-2.6.26.6/arch/x86/kernel/sys_i386_32.c
+--- linux-2.6.26.6/arch/x86/kernel/sys_i386_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/sys_i386_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -7022,4 +6817,3 @@
-diff --git a/arch/x86/kernel/sys_x86_64.c b/arch/x86/kernel/sys_x86_64.c
-index 3b360ef33817c9b618e661f452e682a43dfe91bc..00b873a83e3f67f64d4dd15d4d844c2ab165d9c7 100644
---- a/arch/x86/kernel/sys_x86_64.c
-+++ b/arch/x86/kernel/sys_x86_64.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/sys_x86_64.c linux-2.6.26.6/arch/x86/kernel/sys_x86_64.c
+--- linux-2.6.26.6/arch/x86/kernel/sys_x86_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/sys_x86_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -7037 +6831 @@
-@@ -65,7 +65,7 @@ static void find_start_end(unsigned long flags, unsigned long *begin,
+@@ -65,7 +65,7 @@ static void find_start_end(unsigned long
@@ -7046 +6840 @@
-@@ -82,11 +82,15 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -82,11 +82,15 @@ arch_get_unmapped_area(struct file *filp
@@ -7063 +6857 @@
-@@ -141,7 +145,7 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -141,7 +145,7 @@ arch_get_unmapped_area_topdown(struct fi
@@ -7072 +6866 @@
-@@ -154,6 +158,10 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -154,6 +158,10 @@ arch_get_unmapped_area_topdown(struct fi
@@ -7107,14 +6901,4 @@
-diff --git a/arch/x86/kernel/syscall_table_32.S b/arch/x86/kernel/syscall_table_32.S
-index adff5562f5fd4bbc40965ba8eb5f33d433f9f776..53bfb6cbf9aec58ddca2697c857f16b7402964ed 100644
---- a/arch/x86/kernel/syscall_table_32.S
-+++ b/arch/x86/kernel/syscall_table_32.S
-@@ -1,3 +1,4 @@
-+.section .rodata,"a",@progbits
- ENTRY(sys_call_table)
- 	.long sys_restart_syscall	/* 0 - old "setup()" system call, used for restarting */
- 	.long sys_exit
-diff --git a/arch/x86/kernel/time_32.c b/arch/x86/kernel/time_32.c
-index 2ff21f398934b049975a427e463b046e9226d079..5bf79853f0a3fcc30fc8a33cf425451466004d40 100644
---- a/arch/x86/kernel/time_32.c
-+++ b/arch/x86/kernel/time_32.c
-@@ -52,20 +52,30 @@ unsigned long profile_pc(struct pt_regs *regs)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/time_32.c linux-2.6.26.6/arch/x86/kernel/time_32.c
+--- linux-2.6.26.6/arch/x86/kernel/time_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/time_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -52,20 +52,30 @@ unsigned long profile_pc(struct pt_regs 
@@ -7152,4 +6936,3 @@
-diff --git a/arch/x86/kernel/tlb_32.c b/arch/x86/kernel/tlb_32.c
-index 9bb2363851af3e37d91045f5970f3d6316d0f9d9..73c8f4f1fc0260885031fae4bd8545a9ba79ddee 100644
---- a/arch/x86/kernel/tlb_32.c
-+++ b/arch/x86/kernel/tlb_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/tlb_32.c linux-2.6.26.6/arch/x86/kernel/tlb_32.c
+--- linux-2.6.26.6/arch/x86/kernel/tlb_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/tlb_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -7165,5 +6948,4 @@
-diff --git a/arch/x86/kernel/tls.c b/arch/x86/kernel/tls.c
-index ab6bf375a3077e0e6052f07bff9c5c6a93742e45..30bc6ba7b7981fb312b2005d27eb4688910386b6 100644
---- a/arch/x86/kernel/tls.c
-+++ b/arch/x86/kernel/tls.c
-@@ -84,6 +84,11 @@ int do_set_thread_area(struct task_struct *p, int idx,
+diff -urNp linux-2.6.26.6/arch/x86/kernel/tls.c linux-2.6.26.6/arch/x86/kernel/tls.c
+--- linux-2.6.26.6/arch/x86/kernel/tls.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/tls.c	2008-10-11 21:54:19.000000000 -0400
+@@ -84,6 +84,11 @@ int do_set_thread_area(struct task_struc
@@ -7181,4 +6963,3 @@
-diff --git a/arch/x86/kernel/traps_32.c b/arch/x86/kernel/traps_32.c
-index 08d752de4eee307779ba20b31c3b1e7c006daa62..7c46bc4f844826af312d56e49e7860984c7f50c4 100644
---- a/arch/x86/kernel/traps_32.c
-+++ b/arch/x86/kernel/traps_32.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/traps_32.c linux-2.6.26.6/arch/x86/kernel/traps_32.c
+--- linux-2.6.26.6/arch/x86/kernel/traps_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/traps_32.c	2008-10-11 21:55:07.000000000 -0400
@@ -7200 +6981 @@
-@@ -339,22 +331,23 @@ void show_registers(struct pt_regs *regs)
+@@ -339,22 +331,23 @@ void show_registers(struct pt_regs *regs
@@ -7227 +7008 @@
-@@ -363,7 +356,7 @@ void show_registers(struct pt_regs *regs)
+@@ -363,7 +356,7 @@ void show_registers(struct pt_regs *regs
@@ -7244 +7025 @@
-@@ -488,7 +482,7 @@ void die(const char *str, struct pt_regs *regs, long err)
+@@ -488,7 +482,7 @@ void die(const char *str, struct pt_regs
@@ -7253 +7034 @@
-@@ -498,7 +492,7 @@ do_trap(int trapnr, int signr, char *str, int vm86, struct pt_regs *regs,
+@@ -498,7 +492,7 @@ do_trap(int trapnr, int signr, char *str
@@ -7275 +7056 @@
-@@ -612,7 +612,7 @@ void __kprobes do_general_protection(struct pt_regs *regs, long error_code)
+@@ -612,7 +612,7 @@ void __kprobes do_general_protection(str
@@ -7284 +7065 @@
-@@ -644,12 +644,28 @@ void __kprobes do_general_protection(struct pt_regs *regs, long error_code)
+@@ -644,12 +644,28 @@ void __kprobes do_general_protection(str
@@ -7329 +7110 @@
-@@ -779,7 +802,7 @@ void notrace __kprobes die_nmi(struct pt_regs *regs, const char *msg)
+@@ -779,7 +802,7 @@ void notrace __kprobes die_nmi(struct pt
@@ -7338 +7119 @@
-@@ -925,7 +948,7 @@ void __kprobes do_debug(struct pt_regs *regs, long error_code)
+@@ -925,7 +948,7 @@ void __kprobes do_debug(struct pt_regs *
@@ -7347 +7128 @@
-@@ -941,7 +964,7 @@ void __kprobes do_debug(struct pt_regs *regs, long error_code)
+@@ -941,7 +964,7 @@ void __kprobes do_debug(struct pt_regs *
@@ -7356 +7137 @@
-@@ -1097,7 +1120,7 @@ void do_simd_coprocessor_error(struct pt_regs *regs, long error_code)
+@@ -1097,7 +1120,7 @@ void do_simd_coprocessor_error(struct pt
@@ -7365 +7146 @@
-@@ -1117,19 +1140,14 @@ void do_spurious_interrupt_bug(struct pt_regs *regs, long error_code)
+@@ -1117,19 +1140,14 @@ void do_spurious_interrupt_bug(struct pt
@@ -7388,5 +7169,4 @@
-diff --git a/arch/x86/kernel/traps_64.c b/arch/x86/kernel/traps_64.c
-index 9e26f39afa5b4e037a4828eb5d8fe2ccab25967b..53aad174da2ae54d10d65390ae9af8de93bb7fda 100644
---- a/arch/x86/kernel/traps_64.c
-+++ b/arch/x86/kernel/traps_64.c
-@@ -669,6 +669,12 @@ static void __kprobes do_trap(int trapnr, int signr, char *str,
+diff -urNp linux-2.6.26.6/arch/x86/kernel/traps_64.c linux-2.6.26.6/arch/x86/kernel/traps_64.c
+--- linux-2.6.26.6/arch/x86/kernel/traps_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/traps_64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -669,6 +669,12 @@ static void __kprobes do_trap(int trapnr
@@ -7405,5 +7185,4 @@
-diff --git a/arch/x86/kernel/tsc_32.c b/arch/x86/kernel/tsc_32.c
-index 65b70637ad9796d8256b9305c4dfd4ed3c378e6d..73caa1d9d21e3cab00c28d8a8f8a40cd77cae7d3 100644
---- a/arch/x86/kernel/tsc_32.c
-+++ b/arch/x86/kernel/tsc_32.c
-@@ -353,7 +353,7 @@ static struct dmi_system_id __initdata bad_tsc_dmi_table[] = {
+diff -urNp linux-2.6.26.6/arch/x86/kernel/tsc_32.c linux-2.6.26.6/arch/x86/kernel/tsc_32.c
+--- linux-2.6.26.6/arch/x86/kernel/tsc_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/tsc_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -353,7 +353,7 @@ static struct dmi_system_id __initdata b
@@ -7418,5 +7197,4 @@
-diff --git a/arch/x86/kernel/vm86_32.c b/arch/x86/kernel/vm86_32.c
-index 38f566fa27d2b35c0e3b95382a38537745cbe53d..cd2a6c5a3e0dc101abe46b4d3d31c7128d1ffc67 100644
---- a/arch/x86/kernel/vm86_32.c
-+++ b/arch/x86/kernel/vm86_32.c
-@@ -147,7 +147,7 @@ struct pt_regs *save_v86_state(struct kernel_vm86_regs *regs)
+diff -urNp linux-2.6.26.6/arch/x86/kernel/vm86_32.c linux-2.6.26.6/arch/x86/kernel/vm86_32.c
+--- linux-2.6.26.6/arch/x86/kernel/vm86_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/vm86_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -147,7 +147,7 @@ struct pt_regs *save_v86_state(struct ke
@@ -7431 +7209 @@
-@@ -324,7 +324,7 @@ static void do_sys_vm86(struct kernel_vm86_struct *info, struct task_struct *tsk
+@@ -324,7 +324,7 @@ static void do_sys_vm86(struct kernel_vm
@@ -7440,5 +7218,4 @@
-diff --git a/arch/x86/kernel/vmi_32.c b/arch/x86/kernel/vmi_32.c
-index 9b3e795a3147c42e86612fbf036c5f0d59385063..356bedd9ea6dce9a15d270ce332939017ff1771e 100644
---- a/arch/x86/kernel/vmi_32.c
-+++ b/arch/x86/kernel/vmi_32.c
-@@ -101,18 +101,43 @@ static unsigned patch_internal(int call, unsigned len, void *insnbuf,
+diff -urNp linux-2.6.26.6/arch/x86/kernel/vmi_32.c linux-2.6.26.6/arch/x86/kernel/vmi_32.c
+--- linux-2.6.26.6/arch/x86/kernel/vmi_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/vmi_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -101,18 +101,43 @@ static unsigned patch_internal(int call,
@@ -7488 +7265 @@
-@@ -515,14 +540,14 @@ static void vmi_set_pud(pud_t *pudp, pud_t pudval)
+@@ -515,14 +540,14 @@ static void vmi_set_pud(pud_t *pudp, pud
@@ -7505 +7282 @@
-@@ -551,8 +576,8 @@ vmi_startup_ipi_hook(int phys_apicid, unsigned long start_eip,
+@@ -551,8 +576,8 @@ vmi_startup_ipi_hook(int phys_apicid, un
@@ -7516 +7293 @@
-@@ -747,12 +772,20 @@ static inline int __init activate_vmi(void)
+@@ -747,12 +772,20 @@ static inline int __init activate_vmi(vo
@@ -7537 +7314 @@
-@@ -943,6 +976,10 @@ static inline int __init activate_vmi(void)
+@@ -943,6 +976,10 @@ static inline int __init activate_vmi(vo
@@ -7548,4 +7325,3 @@
-diff --git a/arch/x86/kernel/vmlinux_32.lds.S b/arch/x86/kernel/vmlinux_32.lds.S
-index ce5ed083a1e905e463486e8f05e9125d2f41d157..6116eb449c1845b54faf1a19bdfcc9b20a457329 100644
---- a/arch/x86/kernel/vmlinux_32.lds.S
-+++ b/arch/x86/kernel/vmlinux_32.lds.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/vmlinux_32.lds.S linux-2.6.26.6/arch/x86/kernel/vmlinux_32.lds.S
+--- linux-2.6.26.6/arch/x86/kernel/vmlinux_32.lds.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/vmlinux_32.lds.S	2008-10-11 21:54:19.000000000 -0400
@@ -7592,2 +7368 @@
-+  . = LOAD_OFFSET + ____LOAD_PHYSICAL_ADDR;
- 
+-
@@ -7629 +7404,2 @@
--
++  . = LOAD_OFFSET + ____LOAD_PHYSICAL_ADDR;
+ 
@@ -7855,4 +7631,3 @@
-diff --git a/arch/x86/kernel/vmlinux_64.lds.S b/arch/x86/kernel/vmlinux_64.lds.S
-index fad3674b06a58f990cabab44bd61910f975a6682..ab6ecee95b296eec64ce211bd8465bc25cff3384 100644
---- a/arch/x86/kernel/vmlinux_64.lds.S
-+++ b/arch/x86/kernel/vmlinux_64.lds.S
+diff -urNp linux-2.6.26.6/arch/x86/kernel/vmlinux_64.lds.S linux-2.6.26.6/arch/x86/kernel/vmlinux_64.lds.S
+--- linux-2.6.26.6/arch/x86/kernel/vmlinux_64.lds.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/vmlinux_64.lds.S	2008-10-11 21:54:19.000000000 -0400
@@ -7976,4 +7751,3 @@
-diff --git a/arch/x86/kernel/vsyscall_64.c b/arch/x86/kernel/vsyscall_64.c
-index 61efa2f7d5645c804bba44bf524661133bc15374..e57fbf0b5700989d856b6b3d08f4413bc889c07d 100644
---- a/arch/x86/kernel/vsyscall_64.c
-+++ b/arch/x86/kernel/vsyscall_64.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/vsyscall_64.c linux-2.6.26.6/arch/x86/kernel/vsyscall_64.c
+--- linux-2.6.26.6/arch/x86/kernel/vsyscall_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/vsyscall_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -7996 +7770 @@
-@@ -251,6 +251,11 @@ static void __cpuinit vsyscall_set_cpu(int cpu)
+@@ -251,6 +251,11 @@ static void __cpuinit vsyscall_set_cpu(i
@@ -8008 +7782 @@
-@@ -261,10 +266,20 @@ static void __cpuinit vsyscall_set_cpu(int cpu)
+@@ -261,10 +266,20 @@ static void __cpuinit vsyscall_set_cpu(i
@@ -8029,4 +7803,3 @@
-diff --git a/arch/x86/kernel/x8664_ksyms_64.c b/arch/x86/kernel/x8664_ksyms_64.c
-index f6c05d0410fb08717fe7f736320225bc476f0533..2f306a8268973bb531402dc7b8aa8cb14ebbd22a 100644
---- a/arch/x86/kernel/x8664_ksyms_64.c
-+++ b/arch/x86/kernel/x8664_ksyms_64.c
+diff -urNp linux-2.6.26.6/arch/x86/kernel/x8664_ksyms_64.c linux-2.6.26.6/arch/x86/kernel/x8664_ksyms_64.c
+--- linux-2.6.26.6/arch/x86/kernel/x8664_ksyms_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kernel/x8664_ksyms_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -8042,5 +7815,4 @@
-diff --git a/arch/x86/kvm/i8254.c b/arch/x86/kvm/i8254.c
-index 3829aa7b663f5690c7fe7efb7df279cd51b9ada7..735ec9a0b360c9a9afaade1f7697d126714ee2d0 100644
---- a/arch/x86/kvm/i8254.c
-+++ b/arch/x86/kvm/i8254.c
-@@ -91,7 +91,7 @@ static void pit_set_gate(struct kvm *kvm, int channel, u32 val)
+diff -urNp linux-2.6.26.6/arch/x86/kvm/i8254.c linux-2.6.26.6/arch/x86/kvm/i8254.c
+--- linux-2.6.26.6/arch/x86/kvm/i8254.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kvm/i8254.c	2008-10-11 21:55:52.000000000 -0400
+@@ -91,7 +91,7 @@ static void pit_set_gate(struct kvm *kvm
@@ -8055 +7827 @@
-@@ -193,7 +193,7 @@ static void pit_latch_status(struct kvm *kvm, int channel)
+@@ -193,7 +193,7 @@ static void pit_latch_status(struct kvm 
@@ -8073,4 +7845,3 @@
-diff --git a/arch/x86/kvm/mmu.c b/arch/x86/kvm/mmu.c
-index 67d00bc7f88bdcdb07ba0717c85bd65da484b16b..6deddc5d7a8f799828cd7ab8ec6d8bf67faeb5a9 100644
---- a/arch/x86/kvm/mmu.c
-+++ b/arch/x86/kvm/mmu.c
+diff -urNp linux-2.6.26.6/arch/x86/kvm/mmu.c linux-2.6.26.6/arch/x86/kvm/mmu.c
+--- linux-2.6.26.6/arch/x86/kvm/mmu.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kvm/mmu.c	2008-10-11 21:55:52.000000000 -0400
@@ -8086,5 +7857,4 @@
-diff --git a/arch/x86/kvm/svm.c b/arch/x86/kvm/svm.c
-index 45e228081a1e5a67a2bd63728939f7c1af04d5ce..779bccc5a359a96424295d54470ac519fb06257f 100644
---- a/arch/x86/kvm/svm.c
-+++ b/arch/x86/kvm/svm.c
-@@ -1478,7 +1478,19 @@ static void reload_tss(struct kvm_vcpu *vcpu)
+diff -urNp linux-2.6.26.6/arch/x86/kvm/svm.c linux-2.6.26.6/arch/x86/kvm/svm.c
+--- linux-2.6.26.6/arch/x86/kvm/svm.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kvm/svm.c	2008-10-11 21:54:19.000000000 -0400
+@@ -1478,7 +1478,19 @@ static void reload_tss(struct kvm_vcpu *
@@ -8110,4 +7880,3 @@
-diff --git a/arch/x86/kvm/vmx.c b/arch/x86/kvm/vmx.c
-index 3ff39c1f9b034453c7330e4fbf2f39a097d3c9d4..dc509c09ac075f2f3cf5e71de97d2378850ca73b 100644
---- a/arch/x86/kvm/vmx.c
-+++ b/arch/x86/kvm/vmx.c
+diff -urNp linux-2.6.26.6/arch/x86/kvm/vmx.c linux-2.6.26.6/arch/x86/kvm/vmx.c
+--- linux-2.6.26.6/arch/x86/kvm/vmx.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kvm/vmx.c	2008-10-11 21:55:52.000000000 -0400
@@ -8147 +7916 @@
-@@ -1824,7 +1838,7 @@ static void allocate_vpid(struct vcpu_vmx *vmx)
+@@ -1824,7 +1838,7 @@ static void allocate_vpid(struct vcpu_vm
@@ -8156 +7925 @@
-@@ -2956,7 +2970,7 @@ static void vmx_vcpu_run(struct kvm_vcpu *vcpu, struct kvm_run *kvm_run)
+@@ -2956,7 +2970,7 @@ static void vmx_vcpu_run(struct kvm_vcpu
@@ -8165,5 +7934,4 @@
-diff --git a/arch/x86/kvm/x86.c b/arch/x86/kvm/x86.c
-index 8ab14ab105f0b0992ad9ac1b9a688489e617fc04..f96c301c4884b652e572ea78586cae6e843b108b 100644
---- a/arch/x86/kvm/x86.c
-+++ b/arch/x86/kvm/x86.c
-@@ -63,34 +63,34 @@ static int kvm_dev_ioctl_get_supported_cpuid(struct kvm_cpuid2 *cpuid,
+diff -urNp linux-2.6.26.6/arch/x86/kvm/x86.c linux-2.6.26.6/arch/x86/kvm/x86.c
+--- linux-2.6.26.6/arch/x86/kvm/x86.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/kvm/x86.c	2008-10-11 21:55:52.000000000 -0400
+@@ -63,34 +63,34 @@ static int kvm_dev_ioctl_get_supported_c
@@ -8232 +8000 @@
-@@ -1254,7 +1254,7 @@ static int kvm_vcpu_ioctl_set_lapic(struct kvm_vcpu *vcpu,
+@@ -1254,7 +1254,7 @@ static int kvm_vcpu_ioctl_set_lapic(stru
@@ -8241 +8009 @@
-@@ -3411,7 +3411,7 @@ static int load_state_from_tss16(struct kvm_vcpu *vcpu,
+@@ -3411,7 +3411,7 @@ static int load_state_from_tss16(struct 
@@ -8259,4 +8027,3 @@
-diff --git a/arch/x86/lib/checksum_32.S b/arch/x86/lib/checksum_32.S
-index adbccd0bbb78a1b4905be30ce7ddea89fad4038f..d9f12e3ce0d09918703cea93ce0703692fca9923 100644
---- a/arch/x86/lib/checksum_32.S
-+++ b/arch/x86/lib/checksum_32.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/checksum_32.S linux-2.6.26.6/arch/x86/lib/checksum_32.S
+--- linux-2.6.26.6/arch/x86/lib/checksum_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/checksum_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -8273 +8040 @@
-@@ -304,9 +305,22 @@ unsigned int csum_partial_copy_generic (const char *src, char *dst,
+@@ -304,9 +305,22 @@ unsigned int csum_partial_copy_generic (
@@ -8508,4 +8275,3 @@
-diff --git a/arch/x86/lib/clear_page_64.S b/arch/x86/lib/clear_page_64.S
-index 9a10a78bb4a414867fa68099996c6cfb66f26d2e..5fd976d7799fd7e1878751fc43e76a327f6d1317 100644
---- a/arch/x86/lib/clear_page_64.S
-+++ b/arch/x86/lib/clear_page_64.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/clear_page_64.S linux-2.6.26.6/arch/x86/lib/clear_page_64.S
+--- linux-2.6.26.6/arch/x86/lib/clear_page_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/clear_page_64.S	2008-10-11 21:54:19.000000000 -0400
@@ -8521,4 +8287,3 @@
-diff --git a/arch/x86/lib/copy_page_64.S b/arch/x86/lib/copy_page_64.S
-index 727a5d46d2fc0cfb6888053a698841fb6e9732f9..fd61ff497d6f315928c61173f48836f268585015 100644
---- a/arch/x86/lib/copy_page_64.S
-+++ b/arch/x86/lib/copy_page_64.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/copy_page_64.S linux-2.6.26.6/arch/x86/lib/copy_page_64.S
+--- linux-2.6.26.6/arch/x86/lib/copy_page_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/copy_page_64.S	2008-10-11 21:54:19.000000000 -0400
@@ -8534,4 +8299,3 @@
-diff --git a/arch/x86/lib/copy_user_64.S b/arch/x86/lib/copy_user_64.S
-index ee1c3f635157b397e4fd70c0060b81e3ff3f34b1..4a7af99e0e67ab5a9a28b9701a1f12de8eb0a631 100644
---- a/arch/x86/lib/copy_user_64.S
-+++ b/arch/x86/lib/copy_user_64.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/copy_user_64.S linux-2.6.26.6/arch/x86/lib/copy_user_64.S
+--- linux-2.6.26.6/arch/x86/lib/copy_user_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/copy_user_64.S	2008-10-11 21:54:19.000000000 -0400
@@ -8556,4 +8320,3 @@
-diff --git a/arch/x86/lib/getuser_32.S b/arch/x86/lib/getuser_32.S
-index 6d84b53f12a2f6a010eb6dfb78158daa3914695f..2f058d699200eea10b8357e27e052c0ee5897626 100644
---- a/arch/x86/lib/getuser_32.S
-+++ b/arch/x86/lib/getuser_32.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/getuser_32.S linux-2.6.26.6/arch/x86/lib/getuser_32.S
+--- linux-2.6.26.6/arch/x86/lib/getuser_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/getuser_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -8614,4 +8377,3 @@
-diff --git a/arch/x86/lib/memcpy_64.S b/arch/x86/lib/memcpy_64.S
-index c22981fa2f3a95240f3a4c99d00da41d1b7392ec..281e8b6f7c0a905ddd7a12cf33da085a40632dfc 100644
---- a/arch/x86/lib/memcpy_64.S
-+++ b/arch/x86/lib/memcpy_64.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/memcpy_64.S linux-2.6.26.6/arch/x86/lib/memcpy_64.S
+--- linux-2.6.26.6/arch/x86/lib/memcpy_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/memcpy_64.S	2008-10-11 21:54:19.000000000 -0400
@@ -8627,4 +8389,3 @@
-diff --git a/arch/x86/lib/memset_64.S b/arch/x86/lib/memset_64.S
-index 2c5948116bd21731d4a85712fddd00d3943fd728..822cb0a78868a9441b2bef1f958e5db35052d5fa 100644
---- a/arch/x86/lib/memset_64.S
-+++ b/arch/x86/lib/memset_64.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/memset_64.S linux-2.6.26.6/arch/x86/lib/memset_64.S
+--- linux-2.6.26.6/arch/x86/lib/memset_64.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/memset_64.S	2008-10-11 21:54:19.000000000 -0400
@@ -8640,5 +8401,4 @@
-diff --git a/arch/x86/lib/mmx_32.c b/arch/x86/lib/mmx_32.c
-index c9f2d9ba8dd8c2da54b0bbd07c37be1d38aa49c4..e7fd2c0616b4032d359108d8b5559d5463a5447d 100644
---- a/arch/x86/lib/mmx_32.c
-+++ b/arch/x86/lib/mmx_32.c
-@@ -29,6 +29,7 @@ void *_mmx_memcpy(void *to, const void *from, size_t len)
+diff -urNp linux-2.6.26.6/arch/x86/lib/mmx_32.c linux-2.6.26.6/arch/x86/lib/mmx_32.c
+--- linux-2.6.26.6/arch/x86/lib/mmx_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/mmx_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -29,6 +29,7 @@ void *_mmx_memcpy(void *to, const void *
@@ -8652 +8412 @@
-@@ -39,44 +40,72 @@ void *_mmx_memcpy(void *to, const void *from, size_t len)
+@@ -39,44 +40,72 @@ void *_mmx_memcpy(void *to, const void *
@@ -8759 +8519 @@
-@@ -166,42 +196,70 @@ static void fast_copy_page(void *to, void *from)
+@@ -166,42 +196,70 @@ static void fast_copy_page(void *to, voi
@@ -8959,4 +8719,3 @@
-diff --git a/arch/x86/lib/putuser_32.S b/arch/x86/lib/putuser_32.S
-index f58fba109d188a2a19d4d18255df9f1e1b52271f..8351a0f5568401d3023f1b406ed4f4baef8fc3f2 100644
---- a/arch/x86/lib/putuser_32.S
-+++ b/arch/x86/lib/putuser_32.S
+diff -urNp linux-2.6.26.6/arch/x86/lib/putuser_32.S linux-2.6.26.6/arch/x86/lib/putuser_32.S
+--- linux-2.6.26.6/arch/x86/lib/putuser_32.S	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/putuser_32.S	2008-10-11 21:54:19.000000000 -0400
@@ -9032,5 +8791,4 @@
-diff --git a/arch/x86/lib/usercopy_32.c b/arch/x86/lib/usercopy_32.c
-index 24e60944971a60522d615bf9dc912851beb32b86..b9686acec1db81b2db9cc4acfa409871d9af173f 100644
---- a/arch/x86/lib/usercopy_32.c
-+++ b/arch/x86/lib/usercopy_32.c
-@@ -29,31 +29,38 @@ static inline int __movsl_is_ok(unsigned long a1, unsigned long a2, unsigned lon
+diff -urNp linux-2.6.26.6/arch/x86/lib/usercopy_32.c linux-2.6.26.6/arch/x86/lib/usercopy_32.c
+--- linux-2.6.26.6/arch/x86/lib/usercopy_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/lib/usercopy_32.c	2008-10-11 21:55:52.000000000 -0400
+@@ -29,31 +29,38 @@ static inline int __movsl_is_ok(unsigned
@@ -9111 +8869 @@
-@@ -107,7 +112,7 @@ strncpy_from_user(char *dst, const char __user *src, long count)
+@@ -107,7 +112,7 @@ strncpy_from_user(char *dst, const char 
@@ -9169 +8927 @@
-@@ -150,7 +161,7 @@ clear_user(void __user *to, unsigned long n)
+@@ -150,7 +161,7 @@ clear_user(void __user *to, unsigned lon
@@ -9188 +8946 @@
-@@ -193,14 +203,17 @@ long strnlen_user(const char __user *s, long n)
+@@ -193,14 +203,17 @@ long strnlen_user(const char __user *s, 
@@ -9207 +8965 @@
-@@ -212,7 +225,7 @@ long strnlen_user(const char __user *s, long n)
+@@ -212,7 +225,7 @@ long strnlen_user(const char __user *s, 
@@ -9229 +8987 @@
-@@ -232,36 +246,36 @@ __copy_user_intel(void __user *to, const void *from, unsigned long size)
+@@ -232,36 +246,36 @@ __copy_user_intel(void __user *to, const
@@ -9282 +9040 @@
-@@ -275,6 +289,8 @@ __copy_user_intel(void __user *to, const void *from, unsigned long size)
+@@ -275,6 +289,8 @@ __copy_user_intel(void __user *to, const
@@ -9291 +9049 @@
-@@ -321,7 +337,117 @@ __copy_user_intel(void __user *to, const void *from, unsigned long size)
+@@ -321,7 +337,117 @@ __copy_user_intel(void __user *to, const
@@ -9410 +9168 @@
-@@ -331,6 +457,7 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -331,6 +457,7 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9418 +9176 @@
-@@ -339,36 +466,36 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -339,36 +466,36 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9471 +9229 @@
-@@ -382,6 +509,8 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -382,6 +509,8 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9480 +9238 @@
-@@ -416,7 +545,7 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -416,7 +545,7 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9489 +9247 @@
-@@ -432,6 +561,7 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -432,6 +561,7 @@ static unsigned long __copy_user_zeroing
@@ -9497 +9255 @@
-@@ -440,36 +570,36 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -440,36 +570,36 @@ static unsigned long __copy_user_zeroing
@@ -9550 +9308 @@
-@@ -484,6 +614,8 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -484,6 +614,8 @@ static unsigned long __copy_user_zeroing
@@ -9559 +9317 @@
-@@ -518,7 +650,7 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -518,7 +650,7 @@ static unsigned long __copy_user_zeroing
@@ -9568 +9326 @@
-@@ -529,6 +661,7 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -529,6 +661,7 @@ static unsigned long __copy_user_intel_n
@@ -9576 +9334 @@
-@@ -537,36 +670,36 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -537,36 +670,36 @@ static unsigned long __copy_user_intel_n
@@ -9629 +9387 @@
-@@ -581,6 +714,8 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -581,6 +714,8 @@ static unsigned long __copy_user_intel_n
@@ -9638 +9396 @@
-@@ -609,7 +744,7 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -609,7 +744,7 @@ static unsigned long __copy_user_intel_n
@@ -9647 +9405 @@
-@@ -622,90 +757,146 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -622,90 +757,146 @@ static unsigned long __copy_user_intel_n
@@ -9696,5 +9454 @@
-+static unsigned long
-+__generic_copy_to_user(void __user *to, const void *from, unsigned long size)
-+{
-+	int __d0, __d1, __d2;
- 
+-
@@ -9741,0 +9496,5 @@
++static unsigned long
++__generic_copy_to_user(void __user *to, const void *from, unsigned long size)
++{
++	int __d0, __d1, __d2;
++
@@ -9883 +9642 @@
-@@ -779,7 +970,7 @@ unsigned long __copy_from_user_ll(void *to, const void __user *from,
+@@ -779,7 +970,7 @@ unsigned long __copy_from_user_ll(void *
@@ -9892 +9651 @@
-@@ -790,10 +981,9 @@ unsigned long __copy_from_user_ll_nozero(void *to, const void __user *from,
+@@ -790,10 +981,9 @@ unsigned long __copy_from_user_ll_nozero
@@ -9905 +9664 @@
-@@ -802,12 +992,12 @@ unsigned long __copy_from_user_ll_nocache(void *to, const void __user *from,
+@@ -802,12 +992,12 @@ unsigned long __copy_from_user_ll_nocach
@@ -9921 +9680 @@
-@@ -817,12 +1007,12 @@ unsigned long __copy_from_user_ll_nocache_nozero(void *to, const void __user *fr
+@@ -817,12 +1007,12 @@ unsigned long __copy_from_user_ll_nocach
@@ -9937 +9696 @@
-@@ -871,8 +1061,35 @@ copy_from_user(void *to, const void __user *from, unsigned long n)
+@@ -871,8 +1061,35 @@ copy_from_user(void *to, const void __us
@@ -9974,5 +9733,4 @@
-diff --git a/arch/x86/mach-voyager/voyager_basic.c b/arch/x86/mach-voyager/voyager_basic.c
-index 46d6f8067690d9f37610718c9af1b924a3233e98..8486e085fed2981d4d87a767f02916a802e0f54d 100644
---- a/arch/x86/mach-voyager/voyager_basic.c
-+++ b/arch/x86/mach-voyager/voyager_basic.c
-@@ -123,7 +123,7 @@ int __init voyager_memory_detect(int region, __u32 * start, __u32 * length)
+diff -urNp linux-2.6.26.6/arch/x86/mach-voyager/voyager_basic.c linux-2.6.26.6/arch/x86/mach-voyager/voyager_basic.c
+--- linux-2.6.26.6/arch/x86/mach-voyager/voyager_basic.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mach-voyager/voyager_basic.c	2008-10-11 21:54:19.000000000 -0400
+@@ -123,7 +123,7 @@ int __init voyager_memory_detect(int reg
@@ -9987 +9745 @@
-@@ -138,7 +138,7 @@ int __init voyager_memory_detect(int region, __u32 * start, __u32 * length)
+@@ -138,7 +138,7 @@ int __init voyager_memory_detect(int reg
@@ -9996,4 +9754,3 @@
-diff --git a/arch/x86/mach-voyager/voyager_smp.c b/arch/x86/mach-voyager/voyager_smp.c
-index 8acbf0cdf1a5fb8eb4d75e1d57905104b23cce14..9b6c9bcfa3437506114413da4dca2213da351b8a 100644
---- a/arch/x86/mach-voyager/voyager_smp.c
-+++ b/arch/x86/mach-voyager/voyager_smp.c
+diff -urNp linux-2.6.26.6/arch/x86/mach-voyager/voyager_smp.c linux-2.6.26.6/arch/x86/mach-voyager/voyager_smp.c
+--- linux-2.6.26.6/arch/x86/mach-voyager/voyager_smp.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mach-voyager/voyager_smp.c	2008-10-11 21:54:19.000000000 -0400
@@ -10039,4 +9796,19 @@
-diff --git a/arch/x86/mm/discontig_32.c b/arch/x86/mm/discontig_32.c
-index 914ccf983687dd276b8cc5827d4430cf093fd822..7c1ff85067871367d3b3e89ab8e37636fa3f8623 100644
---- a/arch/x86/mm/discontig_32.c
-+++ b/arch/x86/mm/discontig_32.c
+diff -urNp linux-2.6.26.6/arch/x86/Makefile linux-2.6.26.6/arch/x86/Makefile
+--- linux-2.6.26.6/arch/x86/Makefile	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/Makefile	2008-10-11 21:54:19.000000000 -0400
+@@ -258,3 +258,12 @@ endef
+ CLEAN_FILES += arch/x86/boot/fdimage \
+ 	       arch/x86/boot/image.iso \
+ 	       arch/x86/boot/mtools.conf
++
++define OLD_LD
++
++*** ${VERSION}.${PATCHLEVEL} PaX kernels no longer build correctly with old versions of binutils.
++*** Please upgrade your binutils to 2.18 or newer
++endef
++
++archprepare:
++	$(if $(LDFLAGS_BUILD_ID),,$(error $(OLD_LD)))
+diff -urNp linux-2.6.26.6/arch/x86/mm/discontig_32.c linux-2.6.26.6/arch/x86/mm/discontig_32.c
+--- linux-2.6.26.6/arch/x86/mm/discontig_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/discontig_32.c	2008-10-11 21:55:52.000000000 -0400
@@ -10060,4 +9832,3 @@
-diff --git a/arch/x86/mm/extable.c b/arch/x86/mm/extable.c
-index 7e8db53528a7618820bd338ccaaf1039a14f241f..23f95c35cfe5234f88889a1c9855836efd4dc2c3 100644
---- a/arch/x86/mm/extable.c
-+++ b/arch/x86/mm/extable.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/extable.c linux-2.6.26.6/arch/x86/mm/extable.c
+--- linux-2.6.26.6/arch/x86/mm/extable.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/extable.c	2008-10-11 21:55:07.000000000 -0400
@@ -10128,4 +9899,3 @@
-diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
-index 8bcb6f40ccb6c61b762fac7def5c26a8eb01ba4b..6d4126042d32377ea79a19bd50946d97e1c17cda 100644
---- a/arch/x86/mm/fault.c
-+++ b/arch/x86/mm/fault.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/fault.c linux-2.6.26.6/arch/x86/mm/fault.c
+--- linux-2.6.26.6/arch/x86/mm/fault.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/fault.c	2008-10-11 21:55:07.000000000 -0400
@@ -10149 +9919 @@
-@@ -55,11 +58,7 @@ static inline int notify_page_fault(struct pt_regs *regs)
+@@ -55,11 +58,7 @@ static inline int notify_page_fault(stru
@@ -10192 +9962 @@
-@@ -343,7 +366,7 @@ static int is_errata93(struct pt_regs *regs, unsigned long address)
+@@ -343,7 +366,7 @@ static int is_errata93(struct pt_regs *r
@@ -10201 +9971 @@
-@@ -380,17 +403,32 @@ static void show_fault_oops(struct pt_regs *regs, unsigned long error_code,
+@@ -380,17 +403,32 @@ static void show_fault_oops(struct pt_re
@@ -10236 +10006 @@
-@@ -583,13 +621,22 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -583,13 +621,22 @@ void __kprobes do_page_fault(struct pt_r
@@ -10260 +10030 @@
-@@ -599,9 +646,6 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -599,9 +646,6 @@ void __kprobes do_page_fault(struct pt_r
@@ -10270 +10040 @@
-@@ -652,7 +696,7 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -652,7 +696,7 @@ void __kprobes do_page_fault(struct pt_r
@@ -10279 +10049 @@
-@@ -665,13 +709,13 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -665,13 +709,13 @@ void __kprobes do_page_fault(struct pt_r
@@ -10682,5 +10452,4 @@
-diff --git a/arch/x86/mm/highmem_32.c b/arch/x86/mm/highmem_32.c
-index 165c871ba9af0211e0c939e0bc2212750d4bf39f..5c44ca0366b1616aaee88d4a1fc15bc2f7df519a 100644
---- a/arch/x86/mm/highmem_32.c
-+++ b/arch/x86/mm/highmem_32.c
-@@ -74,6 +74,10 @@ void *kmap_atomic_prot(struct page *page, enum km_type type, pgprot_t prot)
+diff -urNp linux-2.6.26.6/arch/x86/mm/highmem_32.c linux-2.6.26.6/arch/x86/mm/highmem_32.c
+--- linux-2.6.26.6/arch/x86/mm/highmem_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/highmem_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -74,6 +74,10 @@ void *kmap_atomic_prot(struct page *page
@@ -10697 +10466 @@
-@@ -85,7 +89,17 @@ void *kmap_atomic_prot(struct page *page, enum km_type type, pgprot_t prot)
+@@ -85,7 +89,17 @@ void *kmap_atomic_prot(struct page *page
@@ -10715 +10484 @@
-@@ -101,15 +115,29 @@ void kunmap_atomic(void *kvaddr, enum km_type type)
+@@ -101,15 +115,29 @@ void kunmap_atomic(void *kvaddr, enum km
@@ -10747 +10516 @@
-@@ -128,11 +156,25 @@ void *kmap_atomic_pfn(unsigned long pfn, enum km_type type)
+@@ -128,11 +156,25 @@ void *kmap_atomic_pfn(unsigned long pfn,
@@ -10773,5 +10542,4 @@
-diff --git a/arch/x86/mm/hugetlbpage.c b/arch/x86/mm/hugetlbpage.c
-index 0b3d567e686df15c1b042deb388091ab78a6ae25..1ea737e22a158b3ec19e4b7d1a8d7fcee6deb9cb 100644
---- a/arch/x86/mm/hugetlbpage.c
-+++ b/arch/x86/mm/hugetlbpage.c
-@@ -230,13 +230,18 @@ static unsigned long hugetlb_get_unmapped_area_bottomup(struct file *file,
+diff -urNp linux-2.6.26.6/arch/x86/mm/hugetlbpage.c linux-2.6.26.6/arch/x86/mm/hugetlbpage.c
+--- linux-2.6.26.6/arch/x86/mm/hugetlbpage.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/hugetlbpage.c	2008-10-11 21:54:19.000000000 -0400
+@@ -230,13 +230,18 @@ static unsigned long hugetlb_get_unmappe
@@ -10817 +10585 @@
-@@ -272,9 +277,8 @@ static unsigned long hugetlb_get_unmapped_area_topdown(struct file *file,
+@@ -272,9 +277,8 @@ static unsigned long hugetlb_get_unmappe
@@ -10828 +10596 @@
-@@ -284,7 +288,7 @@ static unsigned long hugetlb_get_unmapped_area_topdown(struct file *file,
+@@ -284,7 +288,7 @@ static unsigned long hugetlb_get_unmappe
@@ -10883 +10651 @@
-@@ -361,10 +370,17 @@ hugetlb_get_unmapped_area(struct file *file, unsigned long addr,
+@@ -361,10 +370,17 @@ hugetlb_get_unmapped_area(struct file *f
@@ -10902 +10670 @@
-@@ -376,7 +392,7 @@ hugetlb_get_unmapped_area(struct file *file, unsigned long addr,
+@@ -376,7 +392,7 @@ hugetlb_get_unmapped_area(struct file *f
@@ -10911,4 +10679,3 @@
-diff --git a/arch/x86/mm/init_32.c b/arch/x86/mm/init_32.c
-index ec30d10154b657a63ab07b5e25b4298c10f4aabe..5d4ab5e05f348a8342b21a9a1b7e4027f95c0c81 100644
---- a/arch/x86/mm/init_32.c
-+++ b/arch/x86/mm/init_32.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/init_32.c linux-2.6.26.6/arch/x86/mm/init_32.c
+--- linux-2.6.26.6/arch/x86/mm/init_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/init_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -10923 +10690 @@
-@@ -58,32 +59,6 @@ unsigned long highstart_pfn, highend_pfn;
+@@ -58,32 +59,6 @@ unsigned long highstart_pfn, highend_pfn
@@ -10956 +10723 @@
-@@ -101,7 +76,11 @@ static pte_t * __init one_page_table_init(pmd_t *pmd)
+@@ -101,7 +76,11 @@ static pte_t * __init one_page_table_ini
@@ -10968 +10735 @@
-@@ -123,6 +102,7 @@ page_table_range_init(unsigned long start, unsigned long end, pgd_t *pgd_base)
+@@ -123,6 +102,7 @@ page_table_range_init(unsigned long star
@@ -10976 +10743 @@
-@@ -131,8 +111,13 @@ page_table_range_init(unsigned long start, unsigned long end, pgd_t *pgd_base)
+@@ -131,8 +111,13 @@ page_table_range_init(unsigned long star
@@ -10992 +10759 @@
-@@ -143,11 +128,23 @@ page_table_range_init(unsigned long start, unsigned long end, pgd_t *pgd_base)
+@@ -143,11 +128,23 @@ page_table_range_init(unsigned long star
@@ -11020 +10787 @@
-@@ -157,9 +154,10 @@ static inline int is_kernel_text(unsigned long addr)
+@@ -157,9 +154,10 @@ static inline int is_kernel_text(unsigne
@@ -11032 +10799 @@
-@@ -167,15 +165,18 @@ static void __init kernel_physical_mapping_init(pgd_t *pgd_base)
+@@ -167,15 +165,18 @@ static void __init kernel_physical_mappi
@@ -11056 +10823 @@
-@@ -187,14 +188,9 @@ static void __init kernel_physical_mapping_init(pgd_t *pgd_base)
+@@ -187,14 +188,9 @@ static void __init kernel_physical_mappi
@@ -11072 +10839 @@
-@@ -207,10 +203,10 @@ static void __init kernel_physical_mapping_init(pgd_t *pgd_base)
+@@ -207,10 +203,10 @@ static void __init kernel_physical_mappi
@@ -11085 +10852 @@
-@@ -239,7 +235,9 @@ static inline int page_kills_ppro(unsigned long pagenr)
+@@ -239,7 +235,9 @@ static inline int page_kills_ppro(unsign
@@ -11096 +10863 @@
-@@ -320,10 +318,10 @@ static void __init set_highmem_pages_init(int bad_ppro)
+@@ -320,10 +318,10 @@ static void __init set_highmem_pages_ini
@@ -11109 +10876 @@
-@@ -345,7 +343,7 @@ void __init native_pagetable_setup_start(pgd_t *base)
+@@ -345,7 +343,7 @@ void __init native_pagetable_setup_start
@@ -11181,0 +10949,3 @@
+-
+-	if (cpu_has_pae && (cpuid_eax(0x80000000) > 0x80000001)) {
+-		cpuid(0x80000001, &v[0], &v[1], &v[2], &v[3]);
@@ -11185,3 +10954,0 @@
--	if (cpu_has_pae && (cpuid_eax(0x80000000) > 0x80000001)) {
--		cpuid(0x80000001, &v[0], &v[1], &v[2], &v[3]);
--
@@ -11225 +10992 @@
-@@ -773,6 +762,46 @@ void free_init_pages(char *what, unsigned long begin, unsigned long end)
+@@ -773,6 +762,46 @@ void free_init_pages(char *what, unsigne
@@ -11272,5 +11039,4 @@
-diff --git a/arch/x86/mm/init_64.c b/arch/x86/mm/init_64.c
-index 7b27710ce3b70aa6f39c9d7c60e75ac90cd2c43d..1396ea496827659874a5965bac106afef1bea1a3 100644
---- a/arch/x86/mm/init_64.c
-+++ b/arch/x86/mm/init_64.c
-@@ -143,6 +143,10 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+diff -urNp linux-2.6.26.6/arch/x86/mm/init_64.c linux-2.6.26.6/arch/x86/mm/init_64.c
+--- linux-2.6.26.6/arch/x86/mm/init_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/init_64.c	2008-10-11 21:54:19.000000000 -0400
+@@ -143,6 +143,10 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -11287 +11053 @@
-@@ -154,7 +158,7 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+@@ -154,7 +158,7 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -11296 +11062 @@
-@@ -164,7 +168,7 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+@@ -164,7 +168,7 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -11305 +11071 @@
-@@ -176,8 +180,17 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+@@ -176,8 +180,17 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -11323 +11089 @@
-@@ -667,7 +680,9 @@ EXPORT_SYMBOL_GPL(memory_add_physaddr_to_nid);
+@@ -667,7 +680,9 @@ EXPORT_SYMBOL_GPL(memory_add_physaddr_to
@@ -11334 +11100 @@
-@@ -755,6 +770,39 @@ void free_init_pages(char *what, unsigned long begin, unsigned long end)
+@@ -755,6 +770,39 @@ void free_init_pages(char *what, unsigne
@@ -11374 +11140 @@
-@@ -913,7 +961,7 @@ int in_gate_area_no_task(unsigned long addr)
+@@ -913,7 +961,7 @@ int in_gate_area_no_task(unsigned long a
@@ -11383,4 +11149,3 @@
-diff --git a/arch/x86/mm/ioremap.c b/arch/x86/mm/ioremap.c
-index d1b867101e5f01e74d296e52cdbd0d4801dd43e5..a23858b33f38bc5753b2cc9f7d5f5b738ff7c4b2 100644
---- a/arch/x86/mm/ioremap.c
-+++ b/arch/x86/mm/ioremap.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/ioremap.c linux-2.6.26.6/arch/x86/mm/ioremap.c
+--- linux-2.6.26.6/arch/x86/mm/ioremap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/ioremap.c	2008-10-11 21:54:19.000000000 -0400
@@ -11398 +11163 @@
-@@ -213,6 +213,8 @@ static void __iomem *__ioremap_caller(resource_size_t phys_addr,
+@@ -213,6 +213,8 @@ static void __iomem *__ioremap_caller(re
@@ -11407,4 +11172,3 @@
-diff --git a/arch/x86/mm/mmap.c b/arch/x86/mm/mmap.c
-index 56fe7124fbec932c0b14f8d9dbe9b448fcdd88b7..b2e24541e1cfbb3b535e3d9f80c28eb98febe262 100644
---- a/arch/x86/mm/mmap.c
-+++ b/arch/x86/mm/mmap.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/mmap.c linux-2.6.26.6/arch/x86/mm/mmap.c
+--- linux-2.6.26.6/arch/x86/mm/mmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/mmap.c	2008-10-11 21:54:19.000000000 -0400
@@ -11466 +11230 @@
-@@ -112,11 +125,23 @@ static unsigned long mmap_legacy_base(void)
+@@ -112,11 +125,23 @@ static unsigned long mmap_legacy_base(vo
@@ -11492,4 +11256,3 @@
-diff --git a/arch/x86/mm/numa_64.c b/arch/x86/mm/numa_64.c
-index c5066d519e5de4cf73dec673f6d51c2ca131075b..190ad34052f0abe4cc5cb760acb6e3593ac18dc7 100644
---- a/arch/x86/mm/numa_64.c
-+++ b/arch/x86/mm/numa_64.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/numa_64.c linux-2.6.26.6/arch/x86/mm/numa_64.c
+--- linux-2.6.26.6/arch/x86/mm/numa_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/numa_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -11505,4 +11268,3 @@
-diff --git a/arch/x86/mm/pageattr.c b/arch/x86/mm/pageattr.c
-index b38429709a6e1f3f2e9c7937512200b63a8f8570..a5f5b604f9404b1405799a69772586cb31029b0f 100644
---- a/arch/x86/mm/pageattr.c
-+++ b/arch/x86/mm/pageattr.c
+diff -urNp linux-2.6.26.6/arch/x86/mm/pageattr.c linux-2.6.26.6/arch/x86/mm/pageattr.c
+--- linux-2.6.26.6/arch/x86/mm/pageattr.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/pageattr.c	2008-10-11 21:54:19.000000000 -0400
@@ -11517 +11279 @@
-@@ -172,7 +173,7 @@ static inline pgprot_t static_protections(pgprot_t prot, unsigned long address,
+@@ -172,7 +173,7 @@ static inline pgprot_t static_protection
@@ -11526 +11288 @@
-@@ -233,8 +234,20 @@ pte_t *lookup_address(unsigned long address, unsigned int *level)
+@@ -233,8 +234,20 @@ pte_t *lookup_address(unsigned long addr
@@ -11547,5 +11309,4 @@
-diff --git a/arch/x86/mm/pat.c b/arch/x86/mm/pat.c
-index 06b7a1c90fb89e43eadd396592cbf6625080020b..22e5c01260f02675062e65286f9a37a86e6928c0 100644
---- a/arch/x86/mm/pat.c
-+++ b/arch/x86/mm/pat.c
-@@ -471,7 +471,7 @@ pgprot_t phys_mem_access_prot(struct file *file, unsigned long pfn,
+diff -urNp linux-2.6.26.6/arch/x86/mm/pat.c linux-2.6.26.6/arch/x86/mm/pat.c
+--- linux-2.6.26.6/arch/x86/mm/pat.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/pat.c	2008-10-11 21:54:19.000000000 -0400
+@@ -471,7 +471,7 @@ pgprot_t phys_mem_access_prot(struct fil
@@ -11560,5 +11321,4 @@
-diff --git a/arch/x86/mm/pgtable_32.c b/arch/x86/mm/pgtable_32.c
-index 369cf065b6a48f78f9870ddaf9f27e59b6980c0c..7c26b730ddd47478d155f97cb13c3aa5dbdeaffe 100644
---- a/arch/x86/mm/pgtable_32.c
-+++ b/arch/x86/mm/pgtable_32.c
-@@ -78,6 +78,10 @@ static void set_pte_pfn(unsigned long vaddr, unsigned long pfn, pgprot_t flags)
+diff -urNp linux-2.6.26.6/arch/x86/mm/pgtable_32.c linux-2.6.26.6/arch/x86/mm/pgtable_32.c
+--- linux-2.6.26.6/arch/x86/mm/pgtable_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/mm/pgtable_32.c	2008-10-11 21:54:19.000000000 -0400
+@@ -78,6 +78,10 @@ static void set_pte_pfn(unsigned long va
@@ -11575 +11335 @@
-@@ -94,11 +98,20 @@ static void set_pte_pfn(unsigned long vaddr, unsigned long pfn, pgprot_t flags)
+@@ -94,11 +98,20 @@ static void set_pte_pfn(unsigned long va
@@ -11596,5 +11356,4 @@
-diff --git a/arch/x86/oprofile/backtrace.c b/arch/x86/oprofile/backtrace.c
-index e2095cba409f200b5b25e9b5bcdbce0ed6288492..0c30e6b5f6d8e178dc2f3dd3c5f3a04c10ae3e5a 100644
---- a/arch/x86/oprofile/backtrace.c
-+++ b/arch/x86/oprofile/backtrace.c
-@@ -37,7 +37,7 @@ static void backtrace_address(void *data, unsigned long addr, int reliable)
+diff -urNp linux-2.6.26.6/arch/x86/oprofile/backtrace.c linux-2.6.26.6/arch/x86/oprofile/backtrace.c
+--- linux-2.6.26.6/arch/x86/oprofile/backtrace.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/oprofile/backtrace.c	2008-10-11 21:54:19.000000000 -0400
+@@ -37,7 +37,7 @@ static void backtrace_address(void *data
@@ -11609 +11368 @@
-@@ -79,7 +79,7 @@ x86_backtrace(struct pt_regs * const regs, unsigned int depth)
+@@ -79,7 +79,7 @@ x86_backtrace(struct pt_regs * const reg
@@ -11618,5 +11377,4 @@
-diff --git a/arch/x86/oprofile/op_model_p4.c b/arch/x86/oprofile/op_model_p4.c
-index 56b4757a1f4706cef329fac43c38e71fcd491bd6..8b22622e94ca9e96d47dd16b743bccdc7902e424 100644
---- a/arch/x86/oprofile/op_model_p4.c
-+++ b/arch/x86/oprofile/op_model_p4.c
-@@ -47,7 +47,7 @@ static inline void setup_num_counters(void)
+diff -urNp linux-2.6.26.6/arch/x86/oprofile/op_model_p4.c linux-2.6.26.6/arch/x86/oprofile/op_model_p4.c
+--- linux-2.6.26.6/arch/x86/oprofile/op_model_p4.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/oprofile/op_model_p4.c	2008-10-11 21:54:19.000000000 -0400
+@@ -47,7 +47,7 @@ static inline void setup_num_counters(vo
@@ -11631,5 +11389,4 @@
-diff --git a/arch/x86/pci/common.c b/arch/x86/pci/common.c
-index 6e64aaf00d1dd9473fff8cfd0e6e09074a31443c..c674a1b0a9451c11d2aa9bb0581271fa6bf9234b 100644
---- a/arch/x86/pci/common.c
-+++ b/arch/x86/pci/common.c
-@@ -342,7 +342,7 @@ static struct dmi_system_id __devinitdata pciprobe_dmi_table[] = {
+diff -urNp linux-2.6.26.6/arch/x86/pci/common.c linux-2.6.26.6/arch/x86/pci/common.c
+--- linux-2.6.26.6/arch/x86/pci/common.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/pci/common.c	2008-10-11 21:54:19.000000000 -0400
+@@ -342,7 +342,7 @@ static struct dmi_system_id __devinitdat
@@ -11644,4 +11401,3 @@
-diff --git a/arch/x86/pci/early.c b/arch/x86/pci/early.c
-index 42df4b6606dfdbc6f21d2cce0cbb6e8ae3e3ea42..af209b0b2463f0e366242d0b253fd92a1f649ca3 100644
---- a/arch/x86/pci/early.c
-+++ b/arch/x86/pci/early.c
+diff -urNp linux-2.6.26.6/arch/x86/pci/early.c linux-2.6.26.6/arch/x86/pci/early.c
+--- linux-2.6.26.6/arch/x86/pci/early.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/pci/early.c	2008-10-11 21:54:19.000000000 -0400
@@ -11657,5 +11413,4 @@
-diff --git a/arch/x86/pci/fixup.c b/arch/x86/pci/fixup.c
-index ff3a6a33634231514c945a66f15328a6a8ce534a..9b0414be63d5dedd6fd838f55bf904131626a56a 100644
---- a/arch/x86/pci/fixup.c
-+++ b/arch/x86/pci/fixup.c
-@@ -364,7 +364,7 @@ static struct dmi_system_id __devinitdata msi_k8t_dmi_table[] = {
+diff -urNp linux-2.6.26.6/arch/x86/pci/fixup.c linux-2.6.26.6/arch/x86/pci/fixup.c
+--- linux-2.6.26.6/arch/x86/pci/fixup.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/pci/fixup.c	2008-10-11 21:54:19.000000000 -0400
+@@ -364,7 +364,7 @@ static struct dmi_system_id __devinitdat
@@ -11670 +11425 @@
-@@ -435,7 +435,7 @@ static struct dmi_system_id __devinitdata toshiba_ohci1394_dmi_table[] = {
+@@ -435,7 +435,7 @@ static struct dmi_system_id __devinitdat
@@ -11679,5 +11434,4 @@
-diff --git a/arch/x86/pci/irq.c b/arch/x86/pci/irq.c
-index ca8df9c260bc0d9093b37f4a5f3b679a6259dcc9..c36c52f109400b33fb267fedaa4dff5e31fa4b4f 100644
---- a/arch/x86/pci/irq.c
-+++ b/arch/x86/pci/irq.c
-@@ -542,7 +542,7 @@ static __init int intel_router_probe(struct irq_router *r, struct pci_dev *route
+diff -urNp linux-2.6.26.6/arch/x86/pci/irq.c linux-2.6.26.6/arch/x86/pci/irq.c
+--- linux-2.6.26.6/arch/x86/pci/irq.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/pci/irq.c	2008-10-11 21:54:19.000000000 -0400
+@@ -542,7 +542,7 @@ static __init int intel_router_probe(str
@@ -11692 +11446 @@
-@@ -1115,7 +1115,7 @@ static struct dmi_system_id __initdata pciirq_dmi_table[] = {
+@@ -1115,7 +1115,7 @@ static struct dmi_system_id __initdata p
@@ -11701,4 +11455,3 @@
-diff --git a/arch/x86/pci/pcbios.c b/arch/x86/pci/pcbios.c
-index 37472fc6f72949b2d54910702962f7361e12bed6..de5375a461b452538923b9713cd222240da7727d 100644
---- a/arch/x86/pci/pcbios.c
-+++ b/arch/x86/pci/pcbios.c
+diff -urNp linux-2.6.26.6/arch/x86/pci/pcbios.c linux-2.6.26.6/arch/x86/pci/pcbios.c
+--- linux-2.6.26.6/arch/x86/pci/pcbios.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/pci/pcbios.c	2008-10-11 21:54:19.000000000 -0400
@@ -11867 +11620 @@
-@@ -166,7 +239,10 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -166,7 +239,10 @@ static int pci_bios_read(unsigned int se
@@ -11879 +11632 @@
-@@ -175,7 +251,8 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -175,7 +251,8 @@ static int pci_bios_read(unsigned int se
@@ -11889 +11642 @@
-@@ -183,7 +260,10 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -183,7 +260,10 @@ static int pci_bios_read(unsigned int se
@@ -11901 +11654 @@
-@@ -192,7 +272,8 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -192,7 +272,8 @@ static int pci_bios_read(unsigned int se
@@ -11911 +11664 @@
-@@ -200,7 +281,10 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -200,7 +281,10 @@ static int pci_bios_read(unsigned int se
@@ -11923 +11676 @@
-@@ -209,7 +293,8 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -209,7 +293,8 @@ static int pci_bios_read(unsigned int se
@@ -11933 +11686 @@
-@@ -232,7 +317,10 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -232,7 +317,10 @@ static int pci_bios_write(unsigned int s
@@ -11945 +11698 @@
-@@ -241,10 +329,14 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -241,10 +329,14 @@ static int pci_bios_write(unsigned int s
@@ -11962 +11715 @@
-@@ -253,10 +345,14 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -253,10 +345,14 @@ static int pci_bios_write(unsigned int s
@@ -11979 +11732 @@
-@@ -265,7 +361,8 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -265,7 +361,8 @@ static int pci_bios_write(unsigned int s
@@ -11989 +11742 @@
-@@ -369,10 +466,13 @@ struct irq_routing_table * pcibios_get_irq_routing_table(void)
+@@ -369,10 +466,13 @@ struct irq_routing_table * pcibios_get_i
@@ -12004 +11757 @@
-@@ -383,7 +483,8 @@ struct irq_routing_table * pcibios_get_irq_routing_table(void)
+@@ -383,7 +483,8 @@ struct irq_routing_table * pcibios_get_i
@@ -12014 +11767 @@
-@@ -407,7 +508,10 @@ int pcibios_set_irq_routing(struct pci_dev *dev, int pin, int irq)
+@@ -407,7 +508,10 @@ int pcibios_set_irq_routing(struct pci_d
@@ -12026 +11779 @@
-@@ -415,7 +519,8 @@ int pcibios_set_irq_routing(struct pci_dev *dev, int pin, int irq)
+@@ -415,7 +519,8 @@ int pcibios_set_irq_routing(struct pci_d
@@ -12036,4 +11789,3 @@
-diff --git a/arch/x86/power/cpu_32.c b/arch/x86/power/cpu_32.c
-index 7dc5d5cf50a2c85c2cad15c84f5e455abd42a34e..fd1c6b53404f639cdaae31a08bdd61a97aa24a1f 100644
---- a/arch/x86/power/cpu_32.c
-+++ b/arch/x86/power/cpu_32.c
+diff -urNp linux-2.6.26.6/arch/x86/power/cpu_32.c linux-2.6.26.6/arch/x86/power/cpu_32.c
+--- linux-2.6.26.6/arch/x86/power/cpu_32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/power/cpu_32.c	2008-10-11 21:54:19.000000000 -0400
@@ -12049,4 +11801,3 @@
-diff --git a/arch/x86/power/cpu_64.c b/arch/x86/power/cpu_64.c
-index 66bdfb591fd8b0adcc1d8181d3d1fcfb14f71808..c6a494a41d6e6637d683ef67fdc457380110b69f 100644
---- a/arch/x86/power/cpu_64.c
-+++ b/arch/x86/power/cpu_64.c
+diff -urNp linux-2.6.26.6/arch/x86/power/cpu_64.c linux-2.6.26.6/arch/x86/power/cpu_64.c
+--- linux-2.6.26.6/arch/x86/power/cpu_64.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/power/cpu_64.c	2008-10-11 21:54:19.000000000 -0400
@@ -12083,5 +11834,4 @@
-diff --git a/arch/x86/vdso/vdso32-setup.c b/arch/x86/vdso/vdso32-setup.c
-index cf058fecfceec989354ec17a3d681cae65315935..c08cb997c168d1cff5cefa0835e60385c149074f 100644
---- a/arch/x86/vdso/vdso32-setup.c
-+++ b/arch/x86/vdso/vdso32-setup.c
-@@ -239,7 +239,7 @@ static inline void map_compat_vdso(int map)
+diff -urNp linux-2.6.26.6/arch/x86/vdso/vdso32-setup.c linux-2.6.26.6/arch/x86/vdso/vdso32-setup.c
+--- linux-2.6.26.6/arch/x86/vdso/vdso32-setup.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/vdso/vdso32-setup.c	2008-10-11 21:54:19.000000000 -0400
+@@ -239,7 +239,7 @@ static inline void map_compat_vdso(int m
@@ -12105 +11855 @@
-@@ -341,7 +341,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm, int exstack)
+@@ -341,7 +341,7 @@ int arch_setup_additional_pages(struct l
@@ -12114 +11864 @@
-@@ -368,7 +368,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm, int exstack)
+@@ -368,7 +368,7 @@ int arch_setup_additional_pages(struct l
@@ -12157 +11907 @@
-@@ -429,7 +435,7 @@ struct vm_area_struct *get_gate_vma(struct task_struct *tsk)
+@@ -429,7 +435,7 @@ struct vm_area_struct *get_gate_vma(stru
@@ -12166,5 +11916,4 @@
-diff --git a/arch/x86/vdso/vma.c b/arch/x86/vdso/vma.c
-index 3fdd51497a838b801cc69dbd8408ea849da75546..f5398f223a794cc39627652740a92caaeb18f165 100644
---- a/arch/x86/vdso/vma.c
-+++ b/arch/x86/vdso/vma.c
-@@ -122,7 +122,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm, int exstack)
+diff -urNp linux-2.6.26.6/arch/x86/vdso/vma.c linux-2.6.26.6/arch/x86/vdso/vma.c
+--- linux-2.6.26.6/arch/x86/vdso/vma.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/vdso/vma.c	2008-10-11 21:54:19.000000000 -0400
+@@ -122,7 +122,7 @@ int arch_setup_additional_pages(struct l
@@ -12179,5 +11928,4 @@
-diff --git a/arch/x86/xen/enlighten.c b/arch/x86/xen/enlighten.c
-index f09c1c69c37a1498da07524c477e98bfc397ebe6..1288637ecda50eed2cea0c4c2ac1eb69ed965368 100644
---- a/arch/x86/xen/enlighten.c
-+++ b/arch/x86/xen/enlighten.c
-@@ -295,7 +295,7 @@ static void xen_set_ldt(const void *addr, unsigned entries)
+diff -urNp linux-2.6.26.6/arch/x86/xen/enlighten.c linux-2.6.26.6/arch/x86/xen/enlighten.c
+--- linux-2.6.26.6/arch/x86/xen/enlighten.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/xen/enlighten.c	2008-10-11 21:54:19.000000000 -0400
+@@ -295,7 +295,7 @@ static void xen_set_ldt(const void *addr
@@ -12192 +11940 @@
-@@ -310,7 +310,7 @@ static void xen_load_gdt(const struct desc_ptr *dtr)
+@@ -310,7 +310,7 @@ static void xen_load_gdt(const struct de
@@ -12201 +11949 @@
-@@ -403,7 +403,7 @@ static void xen_write_idt_entry(gate_desc *dt, int entrynum, const gate_desc *g)
+@@ -403,7 +403,7 @@ static void xen_write_idt_entry(gate_des
@@ -12210,5 +11958,4 @@
-diff --git a/arch/x86/xen/smp.c b/arch/x86/xen/smp.c
-index 94e69000f9826e80da488a694477ee329998d230..5f3de785eaa2a6be7a2e0c318699fc0c20a466be 100644
---- a/arch/x86/xen/smp.c
-+++ b/arch/x86/xen/smp.c
-@@ -154,7 +154,7 @@ void __init xen_smp_prepare_boot_cpu(void)
+diff -urNp linux-2.6.26.6/arch/x86/xen/smp.c linux-2.6.26.6/arch/x86/xen/smp.c
+--- linux-2.6.26.6/arch/x86/xen/smp.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/arch/x86/xen/smp.c	2008-10-11 21:54:19.000000000 -0400
+@@ -154,7 +154,7 @@ void __init xen_smp_prepare_boot_cpu(voi
@@ -12232 +11979 @@
-@@ -228,8 +228,8 @@ cpu_initialize_context(unsigned int cpu, struct task_struct *idle)
+@@ -228,8 +228,8 @@ cpu_initialize_context(unsigned int cpu,
@@ -12243 +11990 @@
-@@ -242,11 +242,11 @@ cpu_initialize_context(unsigned int cpu, struct task_struct *idle)
+@@ -242,11 +242,11 @@ cpu_initialize_context(unsigned int cpu,
@@ -12259,4 +12006,3 @@
-diff --git a/crypto/async_tx/async_tx.c b/crypto/async_tx/async_tx.c
-index bfffb3d219630c07750717a9a728d4ed063e3761..e5b20a3b9243d16ab795226f97b3893c3a3aef1e 100644
---- a/crypto/async_tx/async_tx.c
-+++ b/crypto/async_tx/async_tx.c
+diff -urNp linux-2.6.26.6/crypto/async_tx/async_tx.c linux-2.6.26.6/crypto/async_tx/async_tx.c
+--- linux-2.6.26.6/crypto/async_tx/async_tx.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/crypto/async_tx/async_tx.c	2008-10-11 21:54:19.000000000 -0400
@@ -12274,5 +12020,4 @@
-diff --git a/crypto/lrw.c b/crypto/lrw.c
-index 8ef664e3bcd9a90c93a5436e551549e72df1ff82..3fca060728ed1e82e267261d0582cb95c4cf18c3 100644
---- a/crypto/lrw.c
-+++ b/crypto/lrw.c
-@@ -54,7 +54,7 @@ static int setkey(struct crypto_tfm *parent, const u8 *key,
+diff -urNp linux-2.6.26.6/crypto/lrw.c linux-2.6.26.6/crypto/lrw.c
+--- linux-2.6.26.6/crypto/lrw.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/crypto/lrw.c	2008-10-11 21:54:19.000000000 -0400
+@@ -54,7 +54,7 @@ static int setkey(struct crypto_tfm *par
@@ -12287,5 +12032,78 @@
-diff --git a/drivers/acpi/blacklist.c b/drivers/acpi/blacklist.c
-index ea92bac42c53dd438fae0c82b2e310b8098f7dff..1d5a3bc511df70873079956154b14ba25efe709b 100644
---- a/drivers/acpi/blacklist.c
-+++ b/drivers/acpi/blacklist.c
-@@ -71,7 +71,7 @@ static struct acpi_blacklist_item acpi_blacklist[] __initdata = {
+diff -urNp linux-2.6.26.6/Documentation/dontdiff linux-2.6.26.6/Documentation/dontdiff
+--- linux-2.6.26.6/Documentation/dontdiff	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/Documentation/dontdiff	2008-10-11 21:54:19.000000000 -0400
+@@ -3,6 +3,7 @@
+ *.bin
+ *.cpio
+ *.css
++*.dbg
+ *.dvi
+ *.eps
+ *.gif
+@@ -51,9 +52,14 @@ COPYING
+ CREDITS
+ CVS
+ ChangeSet
++GPATH
++GRTAGS
++GSYMS
++GTAGS
+ Image
+ Kerntypes
+ MODS.txt
++Module.markers
+ Module.symvers
+ PENDING
+ SCCS
+@@ -72,6 +78,7 @@ bbootsect
+ bin2c
+ binkernel.spec
+ bootsect
++bounds.h
+ bsetup
+ btfixupprep
+ build
+@@ -88,6 +95,7 @@ config_data.gz*
+ conmakehash
+ consolemap_deftbl.c*
+ crc32table.h*
++cpustr.h
+ cscope.*
+ defkeymap.c*
+ devlist.h*
+@@ -136,6 +144,7 @@ miboot*
+ mk_elfconfig
+ mkboot
+ mkbugboot
++mkcpustr
+ mkdep
+ mkprep
+ mktables
+@@ -177,16 +186,20 @@ times.h*
+ tkparse
+ trix_boot.h
+ utsrelease.h*
+-vdso.lds
++vdso*.lds
+ version.h*
+ vmlinux
+ vmlinux-*
+ vmlinux.aout
+-vmlinux*.lds*
++vmlinux.bin.all
++vmlinux*.lds
++vmlinux.relocs
+ vmlinux*.scr
+-vsyscall.lds
++vsyscall*.lds
++wakeup.lds
+ wanxlfw.inc
+ uImage
+ unifdef
++utsrelease.h
+ zImage*
+ zconf.hash.c
+diff -urNp linux-2.6.26.6/drivers/acpi/blacklist.c linux-2.6.26.6/drivers/acpi/blacklist.c
+--- linux-2.6.26.6/drivers/acpi/blacklist.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/acpi/blacklist.c	2008-10-11 21:54:19.000000000 -0400
+@@ -71,7 +71,7 @@ static struct acpi_blacklist_item acpi_b
@@ -12300,5 +12118,4 @@
-diff --git a/drivers/acpi/osl.c b/drivers/acpi/osl.c
-index 235a1386888a42fb19c59f6080155a6e774071b3..78928f7eb4bbb86f8bdd468d4fae6e2c9b6eb54e 100644
---- a/drivers/acpi/osl.c
-+++ b/drivers/acpi/osl.c
-@@ -494,6 +494,8 @@ acpi_os_read_memory(acpi_physical_address phys_addr, u32 * value, u32 width)
+diff -urNp linux-2.6.26.6/drivers/acpi/osl.c linux-2.6.26.6/drivers/acpi/osl.c
+--- linux-2.6.26.6/drivers/acpi/osl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/acpi/osl.c	2008-10-11 21:54:19.000000000 -0400
+@@ -494,6 +494,8 @@ acpi_os_read_memory(acpi_physical_addres
@@ -12313 +12130 @@
-@@ -522,6 +524,8 @@ acpi_os_write_memory(acpi_physical_address phys_addr, u32 value, u32 width)
+@@ -522,6 +524,8 @@ acpi_os_write_memory(acpi_physical_addre
@@ -12322,5 +12139,4 @@
-diff --git a/drivers/acpi/processor_core.c b/drivers/acpi/processor_core.c
-index 9dd0fa93b9e1c1e2a9bd459638918ba47c25125e..bc9eea402366e2a07382afb0f55ad56744bc4860 100644
---- a/drivers/acpi/processor_core.c
-+++ b/drivers/acpi/processor_core.c
-@@ -631,7 +631,7 @@ static int __cpuinit acpi_processor_start(struct acpi_device *device)
+diff -urNp linux-2.6.26.6/drivers/acpi/processor_core.c linux-2.6.26.6/drivers/acpi/processor_core.c
+--- linux-2.6.26.6/drivers/acpi/processor_core.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/acpi/processor_core.c	2008-10-11 21:54:19.000000000 -0400
+@@ -631,7 +631,7 @@ static int __cpuinit acpi_processor_star
@@ -12335,5 +12151,4 @@
-diff --git a/drivers/acpi/processor_idle.c b/drivers/acpi/processor_idle.c
-index 556ee1585192e10c0f35d79630d6d3a934cbcf8d..161cbb828360ed59524fef0a94a59ae737bd838f 100644
---- a/drivers/acpi/processor_idle.c
-+++ b/drivers/acpi/processor_idle.c
-@@ -181,7 +181,7 @@ static struct dmi_system_id __cpuinitdata processor_power_dmi_table[] = {
+diff -urNp linux-2.6.26.6/drivers/acpi/processor_idle.c linux-2.6.26.6/drivers/acpi/processor_idle.c
+--- linux-2.6.26.6/drivers/acpi/processor_idle.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/acpi/processor_idle.c	2008-10-11 21:54:19.000000000 -0400
+@@ -181,7 +181,7 @@ static struct dmi_system_id __cpuinitdat
@@ -12348,5 +12163,4 @@
-diff --git a/drivers/acpi/sleep/main.c b/drivers/acpi/sleep/main.c
-index 495c63a3e0afb1fce2e4fcb6801020ad2f8413ad..7adaf2d8165ad47b0586018ee4e88c7f3f126bb5 100644
---- a/drivers/acpi/sleep/main.c
-+++ b/drivers/acpi/sleep/main.c
-@@ -249,7 +249,7 @@ static struct dmi_system_id __initdata acpisleep_dmi_table[] = {
+diff -urNp linux-2.6.26.6/drivers/acpi/sleep/main.c linux-2.6.26.6/drivers/acpi/sleep/main.c
+--- linux-2.6.26.6/drivers/acpi/sleep/main.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/acpi/sleep/main.c	2008-10-11 21:54:19.000000000 -0400
+@@ -249,7 +249,7 @@ static struct dmi_system_id __initdata a
@@ -12361,4 +12175,3 @@
-diff --git a/drivers/acpi/tables/tbfadt.c b/drivers/acpi/tables/tbfadt.c
-index 949d4114eb9feb92ae17ff7183d4cc4b314d0d45..86d1caade234d8d6c7b8effc35efeb09e190ca08 100644
---- a/drivers/acpi/tables/tbfadt.c
-+++ b/drivers/acpi/tables/tbfadt.c
+diff -urNp linux-2.6.26.6/drivers/acpi/tables/tbfadt.c linux-2.6.26.6/drivers/acpi/tables/tbfadt.c
+--- linux-2.6.26.6/drivers/acpi/tables/tbfadt.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/acpi/tables/tbfadt.c	2008-10-11 21:54:19.000000000 -0400
@@ -12374 +12187 @@
-@@ -122,7 +122,7 @@ static struct acpi_fadt_info fadt_info_table[] = {
+@@ -122,7 +122,7 @@ static struct acpi_fadt_info fadt_info_t
@@ -12383,5 +12196,4 @@
-diff --git a/drivers/ata/ahci.c b/drivers/ata/ahci.c
-index 5e6468a7ca4bd2a051b6ee9244297933a3ee7a60..adb293294caf24737fc4053e5577ef261d95de45 100644
---- a/drivers/ata/ahci.c
-+++ b/drivers/ata/ahci.c
-@@ -546,7 +546,7 @@ static const struct pci_device_id ahci_pci_tbl[] = {
+diff -urNp linux-2.6.26.6/drivers/ata/ahci.c linux-2.6.26.6/drivers/ata/ahci.c
+--- linux-2.6.26.6/drivers/ata/ahci.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ata/ahci.c	2008-10-11 21:54:19.000000000 -0400
+@@ -546,7 +546,7 @@ static const struct pci_device_id ahci_p
@@ -12396,5 +12208,4 @@
-diff --git a/drivers/ata/ata_piix.c b/drivers/ata/ata_piix.c
-index a90ae03f56b2e1f09793a8ddc63aca41a281b9f8..eb6a44b2cb623e90f964d69dd0c9c9ad783c97b4 100644
---- a/drivers/ata/ata_piix.c
-+++ b/drivers/ata/ata_piix.c
-@@ -275,7 +275,7 @@ static const struct pci_device_id piix_pci_tbl[] = {
+diff -urNp linux-2.6.26.6/drivers/ata/ata_piix.c linux-2.6.26.6/drivers/ata/ata_piix.c
+--- linux-2.6.26.6/drivers/ata/ata_piix.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ata/ata_piix.c	2008-10-11 21:54:19.000000000 -0400
+@@ -275,7 +275,7 @@ static const struct pci_device_id piix_p
@@ -12409 +12220 @@
-@@ -578,7 +578,7 @@ static const struct ich_laptop ich_laptop[] = {
+@@ -578,7 +578,7 @@ static const struct ich_laptop ich_lapto
@@ -12427,4 +12238,3 @@
-diff --git a/drivers/ata/libata-core.c b/drivers/ata/libata-core.c
-index 303fc0d2b978464dbf6d927a370f4cf743862b6b..794e3b1cb7e7389bb3a83dc476df2ddc592f5a1c 100644
---- a/drivers/ata/libata-core.c
-+++ b/drivers/ata/libata-core.c
+diff -urNp linux-2.6.26.6/drivers/ata/libata-core.c linux-2.6.26.6/drivers/ata/libata-core.c
+--- linux-2.6.26.6/drivers/ata/libata-core.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ata/libata-core.c	2008-10-11 21:54:19.000000000 -0400
@@ -12440 +12250 @@
-@@ -2860,7 +2860,7 @@ static const struct ata_timing ata_timing[] = {
+@@ -2860,7 +2860,7 @@ static const struct ata_timing ata_timin
@@ -12449 +12259 @@
-@@ -3947,7 +3947,7 @@ static const struct ata_blacklist_entry ata_device_blacklist [] = {
+@@ -3947,7 +3947,7 @@ static const struct ata_blacklist_entry 
@@ -12458,5 +12268,4 @@
-diff --git a/drivers/char/agp/frontend.c b/drivers/char/agp/frontend.c
-index e6cb1ab03e06fb115d532de211d584eff2b539f5..d237d82be4be0ab9040508e0165759845dc289c9 100644
---- a/drivers/char/agp/frontend.c
-+++ b/drivers/char/agp/frontend.c
-@@ -820,7 +820,7 @@ static int agpioc_reserve_wrap(struct agp_file_private *priv, void __user *arg)
+diff -urNp linux-2.6.26.6/drivers/char/agp/frontend.c linux-2.6.26.6/drivers/char/agp/frontend.c
+--- linux-2.6.26.6/drivers/char/agp/frontend.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/agp/frontend.c	2008-10-11 21:54:19.000000000 -0400
+@@ -820,7 +820,7 @@ static int agpioc_reserve_wrap(struct ag
@@ -12471,5 +12280,4 @@
-diff --git a/drivers/char/agp/intel-agp.c b/drivers/char/agp/intel-agp.c
-index df702642ab8fb49334ae46c0f0125df4a735376c..5d2e93d29918b463163fed786ca890dba31302cc 100644
---- a/drivers/char/agp/intel-agp.c
-+++ b/drivers/char/agp/intel-agp.c
-@@ -2319,7 +2319,7 @@ static struct pci_device_id agp_intel_pci_table[] = {
+diff -urNp linux-2.6.26.6/drivers/char/agp/intel-agp.c linux-2.6.26.6/drivers/char/agp/intel-agp.c
+--- linux-2.6.26.6/drivers/char/agp/intel-agp.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/agp/intel-agp.c	2008-10-11 21:54:20.000000000 -0400
+@@ -2319,7 +2319,7 @@ static struct pci_device_id agp_intel_pc
@@ -12484,4 +12292,3 @@
-diff --git a/drivers/char/drm/drm_pciids.h b/drivers/char/drm/drm_pciids.h
-index 135bd19499fcc82f8d41e9b6216f9e70205ab814..8427484b880589ff2f0c636a43dad4ea06d784ea 100644
---- a/drivers/char/drm/drm_pciids.h
-+++ b/drivers/char/drm/drm_pciids.h
+diff -urNp linux-2.6.26.6/drivers/char/drm/drm_pciids.h linux-2.6.26.6/drivers/char/drm/drm_pciids.h
+--- linux-2.6.26.6/drivers/char/drm/drm_pciids.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/drm/drm_pciids.h	2008-10-11 21:54:20.000000000 -0400
@@ -12497,5 +12304,4 @@
-diff --git a/drivers/char/hpet.c b/drivers/char/hpet.c
-index e7fb0bca3667670f27ae781893bab44b6f51d006..ff850990076fc6f1415cd0e69692cb7cda77274c 100644
---- a/drivers/char/hpet.c
-+++ b/drivers/char/hpet.c
-@@ -953,7 +953,7 @@ static struct acpi_driver hpet_acpi_driver = {
+diff -urNp linux-2.6.26.6/drivers/char/hpet.c linux-2.6.26.6/drivers/char/hpet.c
+--- linux-2.6.26.6/drivers/char/hpet.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/hpet.c	2008-10-11 21:54:20.000000000 -0400
+@@ -953,7 +953,7 @@ static struct acpi_driver hpet_acpi_driv
@@ -12510,5 +12316,4 @@
-diff --git a/drivers/char/keyboard.c b/drivers/char/keyboard.c
-index d9a0a53c842d2f35632a069591d148bfc843c2d9..e641c472e37ed56059279100c53e65d832690426 100644
---- a/drivers/char/keyboard.c
-+++ b/drivers/char/keyboard.c
-@@ -633,6 +633,16 @@ static void k_spec(struct vc_data *vc, unsigned char value, char up_flag)
+diff -urNp linux-2.6.26.6/drivers/char/keyboard.c linux-2.6.26.6/drivers/char/keyboard.c
+--- linux-2.6.26.6/drivers/char/keyboard.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/keyboard.c	2008-10-11 21:54:20.000000000 -0400
+@@ -633,6 +633,16 @@ static void k_spec(struct vc_data *vc, u
@@ -12531 +12336 @@
-@@ -1386,7 +1396,7 @@ static const struct input_device_id kbd_ids[] = {
+@@ -1386,7 +1396,7 @@ static const struct input_device_id kbd_
@@ -12540,4 +12345,3 @@
-diff --git a/drivers/char/mem.c b/drivers/char/mem.c
-index 934ffafedaea207131f7d193bed9e75c929f4db9..91bad45d1f7e16c2f6e8fef7f150f0678c033752 100644
---- a/drivers/char/mem.c
-+++ b/drivers/char/mem.c
+diff -urNp linux-2.6.26.6/drivers/char/mem.c linux-2.6.26.6/drivers/char/mem.c
+--- linux-2.6.26.6/drivers/char/mem.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/mem.c	2008-10-11 21:54:20.000000000 -0400
@@ -12563 +12367 @@
-@@ -191,6 +196,11 @@ static ssize_t write_mem(struct file * file, const char __user * buf,
+@@ -191,6 +196,11 @@ static ssize_t write_mem(struct file * f
@@ -12575 +12379 @@
-@@ -346,6 +356,11 @@ static int mmap_mem(struct file * file, struct vm_area_struct * vma)
+@@ -346,6 +356,11 @@ static int mmap_mem(struct file * file, 
@@ -12587 +12391 @@
-@@ -584,6 +599,11 @@ static ssize_t write_kmem(struct file * file, const char __user * buf,
+@@ -584,6 +599,11 @@ static ssize_t write_kmem(struct file * 
@@ -12599 +12403 @@
-@@ -787,6 +807,16 @@ static loff_t memory_lseek(struct file * file, loff_t offset, int orig)
+@@ -787,6 +807,16 @@ static loff_t memory_lseek(struct file *
@@ -12616 +12420 @@
-@@ -794,7 +824,6 @@ static int open_port(struct inode * inode, struct file * filp)
+@@ -794,7 +824,6 @@ static int open_port(struct inode * inod
@@ -12624 +12428 @@
-@@ -931,6 +960,11 @@ static int memory_open(struct inode * inode, struct file * filp)
+@@ -931,6 +960,11 @@ static int memory_open(struct inode * in
@@ -12646,5 +12450,4 @@
-diff --git a/drivers/char/nvram.c b/drivers/char/nvram.c
-index 98dec380af495607a0ce360720134234671347e4..d62701ec29fe76ae93016dd5f7b951cdc32e5b98 100644
---- a/drivers/char/nvram.c
-+++ b/drivers/char/nvram.c
-@@ -430,7 +430,10 @@ static const struct file_operations nvram_fops = {
+diff -urNp linux-2.6.26.6/drivers/char/nvram.c linux-2.6.26.6/drivers/char/nvram.c
+--- linux-2.6.26.6/drivers/char/nvram.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/nvram.c	2008-10-11 21:54:20.000000000 -0400
+@@ -430,7 +430,10 @@ static const struct file_operations nvra
@@ -12662,4 +12465,3 @@
-diff --git a/drivers/char/random.c b/drivers/char/random.c
-index 71320d28ba7a0ef5852bb0d56de9d1b0c10567d7..5a09149e203c0c056e2ee6375ae8f19c9ba0d752 100644
---- a/drivers/char/random.c
-+++ b/drivers/char/random.c
+diff -urNp linux-2.6.26.6/drivers/char/random.c linux-2.6.26.6/drivers/char/random.c
+--- linux-2.6.26.6/drivers/char/random.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/random.c	2008-10-11 21:54:20.000000000 -0400
@@ -12707,5 +12509,4 @@
-diff --git a/drivers/char/tpm/tpm.c b/drivers/char/tpm/tpm.c
-index a5d8bcb40000df912d43cb9ad4a8cc9c7453642c..bbb8c2d8845b38fb4fbbae6f005890d3304f114e 100644
---- a/drivers/char/tpm/tpm.c
-+++ b/drivers/char/tpm/tpm.c
-@@ -970,7 +970,7 @@ ssize_t tpm_write(struct file *file, const char __user *buf,
+diff -urNp linux-2.6.26.6/drivers/char/tpm/tpm.c linux-2.6.26.6/drivers/char/tpm/tpm.c
+--- linux-2.6.26.6/drivers/char/tpm/tpm.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/tpm/tpm.c	2008-10-11 21:54:20.000000000 -0400
+@@ -970,7 +970,7 @@ ssize_t tpm_write(struct file *file, con
@@ -12720,5 +12521,4 @@
-diff --git a/drivers/char/vt_ioctl.c b/drivers/char/vt_ioctl.c
-index 3211afd9d57e4080eb610c7bde54098a0c7bf117..c691ae0428b0aaf4648fb39da0102a30908aba04 100644
---- a/drivers/char/vt_ioctl.c
-+++ b/drivers/char/vt_ioctl.c
-@@ -96,6 +96,12 @@ do_kdsk_ioctl(int cmd, struct kbentry __user *user_kbe, int perm, struct kbd_str
+diff -urNp linux-2.6.26.6/drivers/char/vt_ioctl.c linux-2.6.26.6/drivers/char/vt_ioctl.c
+--- linux-2.6.26.6/drivers/char/vt_ioctl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/char/vt_ioctl.c	2008-10-11 21:54:20.000000000 -0400
+@@ -96,6 +96,12 @@ do_kdsk_ioctl(int cmd, struct kbentry __
@@ -12737 +12537 @@
-@@ -236,6 +242,13 @@ do_kdgkb_ioctl(int cmd, struct kbsentry __user *user_kdgkb, int perm)
+@@ -236,6 +242,13 @@ do_kdgkb_ioctl(int cmd, struct kbsentry 
@@ -12751,4 +12551,3 @@
-diff --git a/drivers/edac/edac_core.h b/drivers/edac/edac_core.h
-index b27b13c5eb5ad3871c88247887460a253d1a5276..381898731dce0990ea3d1393fa5b097f14925d10 100644
---- a/drivers/edac/edac_core.h
-+++ b/drivers/edac/edac_core.h
+diff -urNp linux-2.6.26.6/drivers/edac/edac_core.h linux-2.6.26.6/drivers/edac/edac_core.h
+--- linux-2.6.26.6/drivers/edac/edac_core.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/edac/edac_core.h	2008-10-11 21:54:20.000000000 -0400
@@ -12772,4 +12571,3 @@
-diff --git a/drivers/firmware/dmi_scan.c b/drivers/firmware/dmi_scan.c
-index c5e3ed7e903b3a14f405554f8c6163f2d62cb998..f8874a48ef6f9a6a5b04b8b829bd66d6ee148d82 100644
---- a/drivers/firmware/dmi_scan.c
-+++ b/drivers/firmware/dmi_scan.c
+diff -urNp linux-2.6.26.6/drivers/firmware/dmi_scan.c linux-2.6.26.6/drivers/firmware/dmi_scan.c
+--- linux-2.6.26.6/drivers/firmware/dmi_scan.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/firmware/dmi_scan.c	2008-10-11 21:54:20.000000000 -0400
@@ -12788,5 +12586,4 @@
-diff --git a/drivers/hwmon/fscpos.c b/drivers/hwmon/fscpos.c
-index 00f48484e54b6fdd1b120384b485de36d9de07a4..3f455a8880a8087e12166724e89a4f8d6b67613e 100644
---- a/drivers/hwmon/fscpos.c
-+++ b/drivers/hwmon/fscpos.c
-@@ -230,7 +230,6 @@ static ssize_t set_pwm(struct i2c_client *client, struct fscpos_data *data,
+diff -urNp linux-2.6.26.6/drivers/hwmon/fscpos.c linux-2.6.26.6/drivers/hwmon/fscpos.c
+--- linux-2.6.26.6/drivers/hwmon/fscpos.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/hwmon/fscpos.c	2008-10-11 21:54:20.000000000 -0400
+@@ -230,7 +230,6 @@ static ssize_t set_pwm(struct i2c_client
@@ -12800,5 +12597,4 @@
-diff --git a/drivers/hwmon/k8temp.c b/drivers/hwmon/k8temp.c
-index bd2bde0ef95e4c4b411bc1682c2c0243be55c22f..5198e6b5e9599155351b9fc58e71152bbb300ccb 100644
---- a/drivers/hwmon/k8temp.c
-+++ b/drivers/hwmon/k8temp.c
-@@ -130,7 +130,7 @@ static DEVICE_ATTR(name, S_IRUGO, show_name, NULL);
+diff -urNp linux-2.6.26.6/drivers/hwmon/k8temp.c linux-2.6.26.6/drivers/hwmon/k8temp.c
+--- linux-2.6.26.6/drivers/hwmon/k8temp.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/hwmon/k8temp.c	2008-10-11 21:54:20.000000000 -0400
+@@ -130,7 +130,7 @@ static DEVICE_ATTR(name, S_IRUGO, show_n
@@ -12813,5 +12609,4 @@
-diff --git a/drivers/hwmon/sis5595.c b/drivers/hwmon/sis5595.c
-index a276806f3d53cd8b9ab192f3283019b7550531c5..8f11eed6231e9623f073dc33ef56561178fb07f3 100644
---- a/drivers/hwmon/sis5595.c
-+++ b/drivers/hwmon/sis5595.c
-@@ -698,7 +698,7 @@ static struct sis5595_data *sis5595_update_device(struct device *dev)
+diff -urNp linux-2.6.26.6/drivers/hwmon/sis5595.c linux-2.6.26.6/drivers/hwmon/sis5595.c
+--- linux-2.6.26.6/drivers/hwmon/sis5595.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/hwmon/sis5595.c	2008-10-11 21:54:20.000000000 -0400
+@@ -698,7 +698,7 @@ static struct sis5595_data *sis5595_upda
@@ -12826,5 +12621,4 @@
-diff --git a/drivers/hwmon/via686a.c b/drivers/hwmon/via686a.c
-index f1ee5e731968d7e5edd0c2e3b0ab1cdd521bd2ba..6fed98236dcc2bd21b9e4e2a3c132c91a8be04df 100644
---- a/drivers/hwmon/via686a.c
-+++ b/drivers/hwmon/via686a.c
-@@ -768,7 +768,7 @@ static struct via686a_data *via686a_update_device(struct device *dev)
+diff -urNp linux-2.6.26.6/drivers/hwmon/via686a.c linux-2.6.26.6/drivers/hwmon/via686a.c
+--- linux-2.6.26.6/drivers/hwmon/via686a.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/hwmon/via686a.c	2008-10-11 21:54:20.000000000 -0400
+@@ -768,7 +768,7 @@ static struct via686a_data *via686a_upda
@@ -12839,5 +12633,4 @@
-diff --git a/drivers/hwmon/vt8231.c b/drivers/hwmon/vt8231.c
-index 5bc57275cae8e6e8a700373d1670510e442403e9..c0f2031c4b64c8a0e946f7b4cd19355e600f0d04 100644
---- a/drivers/hwmon/vt8231.c
-+++ b/drivers/hwmon/vt8231.c
-@@ -698,7 +698,7 @@ static struct platform_driver vt8231_driver = {
+diff -urNp linux-2.6.26.6/drivers/hwmon/vt8231.c linux-2.6.26.6/drivers/hwmon/vt8231.c
+--- linux-2.6.26.6/drivers/hwmon/vt8231.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/hwmon/vt8231.c	2008-10-11 21:54:20.000000000 -0400
+@@ -698,7 +698,7 @@ static struct platform_driver vt8231_dri
@@ -12852,5 +12645,4 @@
-diff --git a/drivers/hwmon/w83791d.c b/drivers/hwmon/w83791d.c
-index 85077c4c8039faba7499e51e6d03d5d0c6f2f0ec..1a5ad6139e8f848f21f6bf03c86c1e75f33834e3 100644
---- a/drivers/hwmon/w83791d.c
-+++ b/drivers/hwmon/w83791d.c
-@@ -290,8 +290,8 @@ static int w83791d_attach_adapter(struct i2c_adapter *adapter);
+diff -urNp linux-2.6.26.6/drivers/hwmon/w83791d.c linux-2.6.26.6/drivers/hwmon/w83791d.c
+--- linux-2.6.26.6/drivers/hwmon/w83791d.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/hwmon/w83791d.c	2008-10-11 21:54:20.000000000 -0400
+@@ -290,8 +290,8 @@ static int w83791d_attach_adapter(struct
@@ -12867,5 +12659,4 @@
-diff --git a/drivers/i2c/busses/i2c-i801.c b/drivers/i2c/busses/i2c-i801.c
-index b0f771fe43265df51f425593fc1f42ee47ba058e..be4859b4c26b71fd3bc2c904b9480ba9dabebe07 100644
---- a/drivers/i2c/busses/i2c-i801.c
-+++ b/drivers/i2c/busses/i2c-i801.c
-@@ -592,7 +592,7 @@ static struct pci_device_id i801_ids[] = {
+diff -urNp linux-2.6.26.6/drivers/i2c/busses/i2c-i801.c linux-2.6.26.6/drivers/i2c/busses/i2c-i801.c
+--- linux-2.6.26.6/drivers/i2c/busses/i2c-i801.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/i2c/busses/i2c-i801.c	2008-10-11 21:54:20.000000000 -0400
+@@ -592,7 +592,7 @@ static struct pci_device_id i801_ids[] =
@@ -12880,5 +12671,4 @@
-diff --git a/drivers/i2c/busses/i2c-i810.c b/drivers/i2c/busses/i2c-i810.c
-index 42e8d94c276fde7e278016aef70d6ffdf23e2baa..ed7f82b396b71df8b16c2a438c39935e2a57bfa7 100644
---- a/drivers/i2c/busses/i2c-i810.c
-+++ b/drivers/i2c/busses/i2c-i810.c
-@@ -198,7 +198,7 @@ static struct pci_device_id i810_ids[] __devinitdata = {
+diff -urNp linux-2.6.26.6/drivers/i2c/busses/i2c-i810.c linux-2.6.26.6/drivers/i2c/busses/i2c-i810.c
+--- linux-2.6.26.6/drivers/i2c/busses/i2c-i810.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/i2c/busses/i2c-i810.c	2008-10-11 21:54:20.000000000 -0400
+@@ -198,7 +198,7 @@ static struct pci_device_id i810_ids[] _
@@ -12893,5 +12683,4 @@
-diff --git a/drivers/i2c/busses/i2c-piix4.c b/drivers/i2c/busses/i2c-piix4.c
-index ac916596858764481f08afdde261b770be1a1b54..bc6760fcc64486ee3ec4a6241d84c6993951c878 100644
---- a/drivers/i2c/busses/i2c-piix4.c
-+++ b/drivers/i2c/busses/i2c-piix4.c
-@@ -133,7 +133,7 @@ static struct dmi_system_id __devinitdata piix4_dmi_ibm[] = {
+diff -urNp linux-2.6.26.6/drivers/i2c/busses/i2c-piix4.c linux-2.6.26.6/drivers/i2c/busses/i2c-piix4.c
+--- linux-2.6.26.6/drivers/i2c/busses/i2c-piix4.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/i2c/busses/i2c-piix4.c	2008-10-11 21:54:20.000000000 -0400
+@@ -133,7 +133,7 @@ static struct dmi_system_id __devinitdat
@@ -12906 +12695 @@
-@@ -431,7 +431,7 @@ static struct pci_device_id piix4_ids[] = {
+@@ -431,7 +431,7 @@ static struct pci_device_id piix4_ids[] 
@@ -12915,5 +12704,4 @@
-diff --git a/drivers/i2c/busses/i2c-sis630.c b/drivers/i2c/busses/i2c-sis630.c
-index 3765dd7f450f06e7c71f6623d67795c9e4cc056d..f135e4e9b4a21dbe7f40d57ab807ba671c597f60 100644
---- a/drivers/i2c/busses/i2c-sis630.c
-+++ b/drivers/i2c/busses/i2c-sis630.c
-@@ -465,7 +465,7 @@ static struct i2c_adapter sis630_adapter = {
+diff -urNp linux-2.6.26.6/drivers/i2c/busses/i2c-sis630.c linux-2.6.26.6/drivers/i2c/busses/i2c-sis630.c
+--- linux-2.6.26.6/drivers/i2c/busses/i2c-sis630.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/i2c/busses/i2c-sis630.c	2008-10-11 21:54:20.000000000 -0400
+@@ -465,7 +465,7 @@ static struct i2c_adapter sis630_adapter
@@ -12928,5 +12716,4 @@
-diff --git a/drivers/i2c/busses/i2c-sis96x.c b/drivers/i2c/busses/i2c-sis96x.c
-index dc235bb8e24d448ae5f815ff45314bdea789d740..f39c0f5e576486405a1330d20349d5f32462e7df 100644
---- a/drivers/i2c/busses/i2c-sis96x.c
-+++ b/drivers/i2c/busses/i2c-sis96x.c
-@@ -255,7 +255,7 @@ static struct i2c_adapter sis96x_adapter = {
+diff -urNp linux-2.6.26.6/drivers/i2c/busses/i2c-sis96x.c linux-2.6.26.6/drivers/i2c/busses/i2c-sis96x.c
+--- linux-2.6.26.6/drivers/i2c/busses/i2c-sis96x.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/i2c/busses/i2c-sis96x.c	2008-10-11 21:54:20.000000000 -0400
+@@ -255,7 +255,7 @@ static struct i2c_adapter sis96x_adapter
@@ -12941,5 +12728,4 @@
-diff --git a/drivers/ieee1394/dv1394.c b/drivers/ieee1394/dv1394.c
-index 9d19aec5820a303145d8b286e2d1ce2e72b4a586..9b57d2bacfe1909a730b89900454718b9277f131 100644
---- a/drivers/ieee1394/dv1394.c
-+++ b/drivers/ieee1394/dv1394.c
-@@ -739,7 +739,7 @@ static void frame_prepare(struct video_card *video, unsigned int this_frame)
+diff -urNp linux-2.6.26.6/drivers/ieee1394/dv1394.c linux-2.6.26.6/drivers/ieee1394/dv1394.c
+--- linux-2.6.26.6/drivers/ieee1394/dv1394.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/dv1394.c	2008-10-11 21:54:20.000000000 -0400
+@@ -739,7 +739,7 @@ static void frame_prepare(struct video_c
@@ -12954 +12740 @@
-@@ -918,7 +918,7 @@ static int do_dv1394_init(struct video_card *video, struct dv1394_init *init)
+@@ -918,7 +918,7 @@ static int do_dv1394_init(struct video_c
@@ -12963 +12749 @@
-@@ -2174,7 +2174,7 @@ static struct ieee1394_device_id dv1394_id_table[] = {
+@@ -2174,7 +2174,7 @@ static struct ieee1394_device_id dv1394_
@@ -12972,5 +12758,4 @@
-diff --git a/drivers/ieee1394/eth1394.c b/drivers/ieee1394/eth1394.c
-index b166b3575fa6d8904126e8a61ccaf604d5b9739f..53abcf89a28e005732b9fcf0c615039108e74f0c 100644
---- a/drivers/ieee1394/eth1394.c
-+++ b/drivers/ieee1394/eth1394.c
-@@ -451,7 +451,7 @@ static struct ieee1394_device_id eth1394_id_table[] = {
+diff -urNp linux-2.6.26.6/drivers/ieee1394/eth1394.c linux-2.6.26.6/drivers/ieee1394/eth1394.c
+--- linux-2.6.26.6/drivers/ieee1394/eth1394.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/eth1394.c	2008-10-11 21:54:20.000000000 -0400
+@@ -451,7 +451,7 @@ static struct ieee1394_device_id eth1394
@@ -12985,5 +12770,4 @@
-diff --git a/drivers/ieee1394/hosts.c b/drivers/ieee1394/hosts.c
-index 8dd09d8504196eecbe750887ec23f702667b105d..657d83eee4c64642f0901b71c08a10a234e51464 100644
---- a/drivers/ieee1394/hosts.c
-+++ b/drivers/ieee1394/hosts.c
-@@ -78,6 +78,7 @@ static int dummy_isoctl(struct hpsb_iso *iso, enum isoctl_cmd command,
+diff -urNp linux-2.6.26.6/drivers/ieee1394/hosts.c linux-2.6.26.6/drivers/ieee1394/hosts.c
+--- linux-2.6.26.6/drivers/ieee1394/hosts.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/hosts.c	2008-10-11 21:54:20.000000000 -0400
+@@ -78,6 +78,7 @@ static int dummy_isoctl(struct hpsb_iso 
@@ -12997,5 +12781,4 @@
-diff --git a/drivers/ieee1394/ohci1394.c b/drivers/ieee1394/ohci1394.c
-index e509e13cb7a7cdb4c2d154835dea19857082f418..1dee013ad76acaa2c6506867cfb2a789f809a736 100644
---- a/drivers/ieee1394/ohci1394.c
-+++ b/drivers/ieee1394/ohci1394.c
-@@ -147,9 +147,9 @@ printk(level "%s: " fmt "\n" , OHCI1394_DRIVER_NAME , ## args)
+diff -urNp linux-2.6.26.6/drivers/ieee1394/ohci1394.c linux-2.6.26.6/drivers/ieee1394/ohci1394.c
+--- linux-2.6.26.6/drivers/ieee1394/ohci1394.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/ohci1394.c	2008-10-11 21:54:20.000000000 -0400
+@@ -147,9 +147,9 @@ printk(level "%s: " fmt "\n" , OHCI1394_
@@ -13013 +12796 @@
-@@ -3437,7 +3437,7 @@ static struct pci_device_id ohci1394_pci_tbl[] = {
+@@ -3437,7 +3437,7 @@ static struct pci_device_id ohci1394_pci
@@ -13022,5 +12805,4 @@
-diff --git a/drivers/ieee1394/raw1394.c b/drivers/ieee1394/raw1394.c
-index ec2a0adbedb248f2a493b2ca716fc8d7971c98ed..75d2fa33771e11014e8ee7ff9c23a2054c7d4b76 100644
---- a/drivers/ieee1394/raw1394.c
-+++ b/drivers/ieee1394/raw1394.c
-@@ -2958,7 +2958,7 @@ static struct ieee1394_device_id raw1394_id_table[] = {
+diff -urNp linux-2.6.26.6/drivers/ieee1394/raw1394.c linux-2.6.26.6/drivers/ieee1394/raw1394.c
+--- linux-2.6.26.6/drivers/ieee1394/raw1394.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/raw1394.c	2008-10-11 21:54:20.000000000 -0400
+@@ -2958,7 +2958,7 @@ static struct ieee1394_device_id raw1394
@@ -13035,5 +12817,4 @@
-diff --git a/drivers/ieee1394/sbp2.c b/drivers/ieee1394/sbp2.c
-index a5ceff287a289f0346e3c1007abd2abc5e74ddc3..76c2773c4906fcfd06069fa17e23fcec60d447b9 100644
---- a/drivers/ieee1394/sbp2.c
-+++ b/drivers/ieee1394/sbp2.c
-@@ -283,7 +283,7 @@ static struct ieee1394_device_id sbp2_id_table[] = {
+diff -urNp linux-2.6.26.6/drivers/ieee1394/sbp2.c linux-2.6.26.6/drivers/ieee1394/sbp2.c
+--- linux-2.6.26.6/drivers/ieee1394/sbp2.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/sbp2.c	2008-10-11 21:54:20.000000000 -0400
+@@ -283,7 +283,7 @@ static struct ieee1394_device_id sbp2_id
@@ -13048 +12829 @@
-@@ -2101,7 +2101,7 @@ MODULE_DESCRIPTION("IEEE-1394 SBP-2 protocol driver");
+@@ -2101,7 +2101,7 @@ MODULE_DESCRIPTION("IEEE-1394 SBP-2 prot
@@ -13057,5 +12838,4 @@
-diff --git a/drivers/ieee1394/video1394.c b/drivers/ieee1394/video1394.c
-index e24772d336e1ae6c726d8e0a05ae5ea25a9207e0..5a94b1b00dca591c09e296228c67c0180367dc5b 100644
---- a/drivers/ieee1394/video1394.c
-+++ b/drivers/ieee1394/video1394.c
-@@ -893,7 +893,7 @@ static long video1394_ioctl(struct file *file,
+diff -urNp linux-2.6.26.6/drivers/ieee1394/video1394.c linux-2.6.26.6/drivers/ieee1394/video1394.c
+--- linux-2.6.26.6/drivers/ieee1394/video1394.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/ieee1394/video1394.c	2008-10-11 21:54:20.000000000 -0400
+@@ -893,7 +893,7 @@ static long video1394_ioctl(struct file 
@@ -13070 +12850 @@
-@@ -959,7 +959,7 @@ static long video1394_ioctl(struct file *file,
+@@ -959,7 +959,7 @@ static long video1394_ioctl(struct file 
@@ -13079 +12859 @@
-@@ -1030,7 +1030,7 @@ static long video1394_ioctl(struct file *file,
+@@ -1030,7 +1030,7 @@ static long video1394_ioctl(struct file 
@@ -13088 +12868 @@
-@@ -1137,7 +1137,7 @@ static long video1394_ioctl(struct file *file,
+@@ -1137,7 +1137,7 @@ static long video1394_ioctl(struct file 
@@ -13097 +12877 @@
-@@ -1310,7 +1310,7 @@ static struct ieee1394_device_id video1394_id_table[] = {
+@@ -1310,7 +1310,7 @@ static struct ieee1394_device_id video13
@@ -13106,5 +12886,4 @@
-diff --git a/drivers/input/keyboard/atkbd.c b/drivers/input/keyboard/atkbd.c
-index af58a6f1e898278b42bdd5980d51b10718fd807e..3f7906292c65aef2f71233b66af6a51b9834474a 100644
---- a/drivers/input/keyboard/atkbd.c
-+++ b/drivers/input/keyboard/atkbd.c
-@@ -1115,7 +1115,7 @@ static struct serio_device_id atkbd_serio_ids[] = {
+diff -urNp linux-2.6.26.6/drivers/input/keyboard/atkbd.c linux-2.6.26.6/drivers/input/keyboard/atkbd.c
+--- linux-2.6.26.6/drivers/input/keyboard/atkbd.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/keyboard/atkbd.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1115,7 +1115,7 @@ static struct serio_device_id atkbd_seri
@@ -13119,5 +12898,4 @@
-diff --git a/drivers/input/mouse/lifebook.c b/drivers/input/mouse/lifebook.c
-index df81b0aaa9f88911fa335d506f284161c5e24d70..c5f5a37865573e3d3b997d8b79d4be0ea59ad843 100644
---- a/drivers/input/mouse/lifebook.c
-+++ b/drivers/input/mouse/lifebook.c
-@@ -110,7 +110,7 @@ static const struct dmi_system_id lifebook_dmi_table[] = {
+diff -urNp linux-2.6.26.6/drivers/input/mouse/lifebook.c linux-2.6.26.6/drivers/input/mouse/lifebook.c
+--- linux-2.6.26.6/drivers/input/mouse/lifebook.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/mouse/lifebook.c	2008-10-11 21:54:20.000000000 -0400
+@@ -110,7 +110,7 @@ static const struct dmi_system_id lifebo
@@ -13132,5 +12910,4 @@
-diff --git a/drivers/input/mouse/psmouse-base.c b/drivers/input/mouse/psmouse-base.c
-index f5a6be1d3c46325b2173ff00e2588a9de9ca5d81..153762cda8e9ab2c76a607003f9cda037ef6d145 100644
---- a/drivers/input/mouse/psmouse-base.c
-+++ b/drivers/input/mouse/psmouse-base.c
-@@ -1328,7 +1328,7 @@ static struct serio_device_id psmouse_serio_ids[] = {
+diff -urNp linux-2.6.26.6/drivers/input/mouse/psmouse-base.c linux-2.6.26.6/drivers/input/mouse/psmouse-base.c
+--- linux-2.6.26.6/drivers/input/mouse/psmouse-base.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/mouse/psmouse-base.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1328,7 +1328,7 @@ static struct serio_device_id psmouse_se
@@ -13145,5 +12922,4 @@
-diff --git a/drivers/input/mouse/synaptics.c b/drivers/input/mouse/synaptics.c
-index d349c4a5e3e84488a4e812e33e6e547aac4d97e7..3a0266d8965bc6f58587a72ad818456521be3374 100644
---- a/drivers/input/mouse/synaptics.c
-+++ b/drivers/input/mouse/synaptics.c
-@@ -417,7 +417,7 @@ static void synaptics_process_packet(struct psmouse *psmouse)
+diff -urNp linux-2.6.26.6/drivers/input/mouse/synaptics.c linux-2.6.26.6/drivers/input/mouse/synaptics.c
+--- linux-2.6.26.6/drivers/input/mouse/synaptics.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/mouse/synaptics.c	2008-10-11 21:54:20.000000000 -0400
+@@ -417,7 +417,7 @@ static void synaptics_process_packet(str
@@ -13158 +12934 @@
-@@ -624,7 +624,7 @@ static const struct dmi_system_id toshiba_dmi_table[] = {
+@@ -624,7 +624,7 @@ static const struct dmi_system_id toshib
@@ -13167,5 +12943,4 @@
-diff --git a/drivers/input/mousedev.c b/drivers/input/mousedev.c
-index b989748598ae2191cc58f806eb11a19290b847fe..28f5437e3baaf0d0cffc8489b5c28ff036beef69 100644
---- a/drivers/input/mousedev.c
-+++ b/drivers/input/mousedev.c
-@@ -1056,7 +1056,7 @@ static struct input_handler mousedev_handler = {
+diff -urNp linux-2.6.26.6/drivers/input/mousedev.c linux-2.6.26.6/drivers/input/mousedev.c
+--- linux-2.6.26.6/drivers/input/mousedev.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/mousedev.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1056,7 +1056,7 @@ static struct input_handler mousedev_han
@@ -13180,5 +12955,4 @@
-diff --git a/drivers/input/serio/i8042-x86ia64io.h b/drivers/input/serio/i8042-x86ia64io.h
-index 7828ef2e07e497c25b9611b874ec8d9bbd19faab..784255c6047e34209384054478da59b0df1aabc3 100644
---- a/drivers/input/serio/i8042-x86ia64io.h
-+++ b/drivers/input/serio/i8042-x86ia64io.h
-@@ -118,7 +118,7 @@ static struct dmi_system_id __initdata i8042_dmi_noloop_table[] = {
+diff -urNp linux-2.6.26.6/drivers/input/serio/i8042-x86ia64io.h linux-2.6.26.6/drivers/input/serio/i8042-x86ia64io.h
+--- linux-2.6.26.6/drivers/input/serio/i8042-x86ia64io.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/serio/i8042-x86ia64io.h	2008-10-11 21:54:20.000000000 -0400
+@@ -118,7 +118,7 @@ static struct dmi_system_id __initdata i
@@ -13193 +12967 @@
-@@ -298,7 +298,7 @@ static struct dmi_system_id __initdata i8042_dmi_nomux_table[] = {
+@@ -298,7 +298,7 @@ static struct dmi_system_id __initdata i
@@ -13202 +12976 @@
-@@ -317,7 +317,7 @@ static struct dmi_system_id __initdata i8042_dmi_nopnp_table[] = {
+@@ -317,7 +317,7 @@ static struct dmi_system_id __initdata i
@@ -13211,5 +12985,4 @@
-diff --git a/drivers/input/serio/serio_raw.c b/drivers/input/serio/serio_raw.c
-index 0403622ae26752976327823802861b321b521d69..9038ad6454b080bbb1c30b59fdc7840fd716e55a 100644
---- a/drivers/input/serio/serio_raw.c
-+++ b/drivers/input/serio/serio_raw.c
-@@ -369,7 +369,7 @@ static struct serio_device_id serio_raw_serio_ids[] = {
+diff -urNp linux-2.6.26.6/drivers/input/serio/serio_raw.c linux-2.6.26.6/drivers/input/serio/serio_raw.c
+--- linux-2.6.26.6/drivers/input/serio/serio_raw.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/input/serio/serio_raw.c	2008-10-11 21:54:20.000000000 -0400
+@@ -369,7 +369,7 @@ static struct serio_device_id serio_raw_
@@ -13224,4 +12997,3 @@
-diff --git a/drivers/md/bitmap.c b/drivers/md/bitmap.c
-index b26927ce889cead2717db3f4d3896bbd9bacc4e2..34f4e5e6707ab10574b29a5324ed92aae58b57f4 100644
---- a/drivers/md/bitmap.c
-+++ b/drivers/md/bitmap.c
+diff -urNp linux-2.6.26.6/drivers/md/bitmap.c linux-2.6.26.6/drivers/md/bitmap.c
+--- linux-2.6.26.6/drivers/md/bitmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/md/bitmap.c	2008-10-11 21:54:20.000000000 -0400
@@ -13237,5 +13009,4 @@
-diff --git a/drivers/mtd/devices/doc2000.c b/drivers/mtd/devices/doc2000.c
-index 846989f292e3f01a1992dd73f999583263b9ec7f..05c8b24119a54510bc47d1cc1675c10cb1c506cb 100644
---- a/drivers/mtd/devices/doc2000.c
-+++ b/drivers/mtd/devices/doc2000.c
-@@ -779,7 +779,7 @@ static int doc_write(struct mtd_info *mtd, loff_t to, size_t len,
+diff -urNp linux-2.6.26.6/drivers/mtd/devices/doc2000.c linux-2.6.26.6/drivers/mtd/devices/doc2000.c
+--- linux-2.6.26.6/drivers/mtd/devices/doc2000.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/mtd/devices/doc2000.c	2008-10-11 21:54:20.000000000 -0400
+@@ -779,7 +779,7 @@ static int doc_write(struct mtd_info *mt
@@ -13250,5 +13021,4 @@
-diff --git a/drivers/mtd/devices/doc2001.c b/drivers/mtd/devices/doc2001.c
-index 6413efc045e0c98e1e657229fdbdd55e67671b1d..e1765253a7ce0aafed99a24f65fb2157b6f3aa2b 100644
---- a/drivers/mtd/devices/doc2001.c
-+++ b/drivers/mtd/devices/doc2001.c
-@@ -398,6 +398,8 @@ static int doc_read (struct mtd_info *mtd, loff_t from, size_t len,
+diff -urNp linux-2.6.26.6/drivers/mtd/devices/doc2001.c linux-2.6.26.6/drivers/mtd/devices/doc2001.c
+--- linux-2.6.26.6/drivers/mtd/devices/doc2001.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/mtd/devices/doc2001.c	2008-10-11 21:54:20.000000000 -0400
+@@ -398,6 +398,8 @@ static int doc_read (struct mtd_info *mt
@@ -13263,5 +13033,4 @@
-diff --git a/drivers/mtd/devices/slram.c b/drivers/mtd/devices/slram.c
-index cb86db746f28c91f552462696b10d5c99f23c07d..5eb75200c0d3c7edd2ff99a561f82bde9e7ffbe8 100644
---- a/drivers/mtd/devices/slram.c
-+++ b/drivers/mtd/devices/slram.c
-@@ -275,7 +275,7 @@ static int parse_cmdline(char *devname, char *szstart, char *szlength)
+diff -urNp linux-2.6.26.6/drivers/mtd/devices/slram.c linux-2.6.26.6/drivers/mtd/devices/slram.c
+--- linux-2.6.26.6/drivers/mtd/devices/slram.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/mtd/devices/slram.c	2008-10-11 21:54:20.000000000 -0400
+@@ -275,7 +275,7 @@ static int parse_cmdline(char *devname, 
@@ -13276,5 +13045,4 @@
-diff --git a/drivers/mtd/ubi/build.c b/drivers/mtd/ubi/build.c
-index 961416ac06167350bf689c631a85b0ece7f067ec..309cc29a8070e68eefa1c7c6600a9b4252d4260d 100644
---- a/drivers/mtd/ubi/build.c
-+++ b/drivers/mtd/ubi/build.c
-@@ -1057,7 +1057,7 @@ static int __init bytes_str_to_int(const char *str)
+diff -urNp linux-2.6.26.6/drivers/mtd/ubi/build.c linux-2.6.26.6/drivers/mtd/ubi/build.c
+--- linux-2.6.26.6/drivers/mtd/ubi/build.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/mtd/ubi/build.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1057,7 +1057,7 @@ static int __init bytes_str_to_int(const
@@ -13289,4 +13057,3 @@
-diff --git a/drivers/net/eepro100.c b/drivers/net/eepro100.c
-index e3e26c595fa340b8de1a4c28d8152964c9b42d69..fba02289bdc9ec541952c2b1cb1b01cf3fa84435 100644
---- a/drivers/net/eepro100.c
-+++ b/drivers/net/eepro100.c
+diff -urNp linux-2.6.26.6/drivers/net/eepro100.c linux-2.6.26.6/drivers/net/eepro100.c
+--- linux-2.6.26.6/drivers/net/eepro100.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/net/eepro100.c	2008-10-11 21:54:20.000000000 -0400
@@ -13302 +13069 @@
-@@ -2334,33 +2334,33 @@ static void __devexit eepro100_remove_one (struct pci_dev *pdev)
+@@ -2334,33 +2334,33 @@ static void __devexit eepro100_remove_on
@@ -13363,5 +13130,4 @@
-diff --git a/drivers/net/irda/vlsi_ir.c b/drivers/net/irda/vlsi_ir.c
-index d15e00b8591e173aeb55a08623a773ced53b6d8f..0e3a6bc3eb02217456f1255741ead6b2a96a674d 100644
---- a/drivers/net/irda/vlsi_ir.c
-+++ b/drivers/net/irda/vlsi_ir.c
-@@ -906,13 +906,12 @@ static int vlsi_hard_start_xmit(struct sk_buff *skb, struct net_device *ndev)
+diff -urNp linux-2.6.26.6/drivers/net/irda/vlsi_ir.c linux-2.6.26.6/drivers/net/irda/vlsi_ir.c
+--- linux-2.6.26.6/drivers/net/irda/vlsi_ir.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/net/irda/vlsi_ir.c	2008-10-11 21:54:20.000000000 -0400
+@@ -906,13 +906,12 @@ static int vlsi_hard_start_xmit(struct s
@@ -13383,4 +13149,3 @@
-diff --git a/drivers/net/pcnet32.c b/drivers/net/pcnet32.c
-index 1c89b97f4e0931c02699bbac0efcaf26ec73c4cf..913762d76d6f8a12a3437f367e1207a00c0641ba 100644
---- a/drivers/net/pcnet32.c
-+++ b/drivers/net/pcnet32.c
+diff -urNp linux-2.6.26.6/drivers/net/pcnet32.c linux-2.6.26.6/drivers/net/pcnet32.c
+--- linux-2.6.26.6/drivers/net/pcnet32.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/net/pcnet32.c	2008-10-11 21:54:20.000000000 -0400
@@ -13396,4 +13161,3 @@
-diff --git a/drivers/net/tg3.h b/drivers/net/tg3.h
-index d68b579dfedbe3241d56181ea90fa533509c3c31..75300583cf36b2b05b09767443b8e24c19954e51 100644
---- a/drivers/net/tg3.h
-+++ b/drivers/net/tg3.h
+diff -urNp linux-2.6.26.6/drivers/net/tg3.h linux-2.6.26.6/drivers/net/tg3.h
+--- linux-2.6.26.6/drivers/net/tg3.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/net/tg3.h	2008-10-11 21:54:20.000000000 -0400
@@ -13408,5 +13172,4 @@
-diff --git a/drivers/pci/hotplug/cpqphp_nvram.c b/drivers/pci/hotplug/cpqphp_nvram.c
-index cb174888002ba537ee2884a46fcac24513f1b1fe..29489db8653d7898832b2c5b06e78b83a7647fa9 100644
---- a/drivers/pci/hotplug/cpqphp_nvram.c
-+++ b/drivers/pci/hotplug/cpqphp_nvram.c
-@@ -425,9 +425,13 @@ static u32 store_HRT (void __iomem *rom_start)
+diff -urNp linux-2.6.26.6/drivers/pci/hotplug/cpqphp_nvram.c linux-2.6.26.6/drivers/pci/hotplug/cpqphp_nvram.c
+--- linux-2.6.26.6/drivers/pci/hotplug/cpqphp_nvram.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pci/hotplug/cpqphp_nvram.c	2008-10-11 21:54:20.000000000 -0400
+@@ -425,9 +425,13 @@ static u32 store_HRT (void __iomem *rom_
@@ -13426,5 +13189,4 @@
-diff --git a/drivers/pci/pcie/aer/aerdrv.c b/drivers/pci/pcie/aer/aerdrv.c
-index 07c3bdb6edc2ad5b261f3877eed725466f4d895a..c5098b446a8b0313e6f5cd21062a51f4c6727e15 100644
---- a/drivers/pci/pcie/aer/aerdrv.c
-+++ b/drivers/pci/pcie/aer/aerdrv.c
-@@ -58,7 +58,7 @@ static struct pcie_port_service_id aer_id[] = {
+diff -urNp linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv.c linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv.c
+--- linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv.c	2008-10-11 21:54:20.000000000 -0400
+@@ -58,7 +58,7 @@ static struct pcie_port_service_id aer_i
@@ -13439,5 +13201,4 @@
-diff --git a/drivers/pci/pcie/aer/aerdrv_core.c b/drivers/pci/pcie/aer/aerdrv_core.c
-index aaa82392d1dcc4c79e79b9432e68f66ab6b93be6..29ec6e376762b8837d5146584555bae16008bfed 100644
---- a/drivers/pci/pcie/aer/aerdrv_core.c
-+++ b/drivers/pci/pcie/aer/aerdrv_core.c
-@@ -663,7 +663,7 @@ static void aer_isr_one_error(struct pcie_device *p_device,
+diff -urNp linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv_core.c linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv_core.c
+--- linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv_core.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pci/pcie/aer/aerdrv_core.c	2008-10-11 21:54:20.000000000 -0400
+@@ -663,7 +663,7 @@ static void aer_isr_one_error(struct pci
@@ -13452,5 +13213,4 @@
-diff --git a/drivers/pci/pcie/portdrv_pci.c b/drivers/pci/pcie/portdrv_pci.c
-index 51d163238d93e63429bd6d04446c1563aaa8be64..14beb17792a9a079cecff2f546b889cbd53e290f 100644
---- a/drivers/pci/pcie/portdrv_pci.c
-+++ b/drivers/pci/pcie/portdrv_pci.c
-@@ -265,7 +265,7 @@ static void pcie_portdrv_err_resume(struct pci_dev *dev)
+diff -urNp linux-2.6.26.6/drivers/pci/pcie/portdrv_pci.c linux-2.6.26.6/drivers/pci/pcie/portdrv_pci.c
+--- linux-2.6.26.6/drivers/pci/pcie/portdrv_pci.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pci/pcie/portdrv_pci.c	2008-10-11 21:54:20.000000000 -0400
+@@ -265,7 +265,7 @@ static void pcie_portdrv_err_resume(stru
@@ -13465,5 +13225,4 @@
-diff --git a/drivers/pci/proc.c b/drivers/pci/proc.c
-index 963a97642ae9101a7454c7b0b3c0dbcc95f8240e..9f56c6ce1b5271c1cd54560832be20f3cff3cbb6 100644
---- a/drivers/pci/proc.c
-+++ b/drivers/pci/proc.c
-@@ -472,7 +472,16 @@ static const struct file_operations proc_bus_pci_dev_operations = {
+diff -urNp linux-2.6.26.6/drivers/pci/proc.c linux-2.6.26.6/drivers/pci/proc.c
+--- linux-2.6.26.6/drivers/pci/proc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pci/proc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -472,7 +472,16 @@ static const struct file_operations proc
@@ -13486,5 +13245,4 @@
-diff --git a/drivers/pcmcia/ti113x.h b/drivers/pcmcia/ti113x.h
-index d29657bf1b40faecefd0598ad73cc60c42d292c1..6afdff3ad1d44a33a5c3d6d89ce465de3928aebd 100644
---- a/drivers/pcmcia/ti113x.h
-+++ b/drivers/pcmcia/ti113x.h
-@@ -897,7 +897,7 @@ static struct pci_device_id ene_tune_tbl[] = {
+diff -urNp linux-2.6.26.6/drivers/pcmcia/ti113x.h linux-2.6.26.6/drivers/pcmcia/ti113x.h
+--- linux-2.6.26.6/drivers/pcmcia/ti113x.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pcmcia/ti113x.h	2008-10-11 21:54:20.000000000 -0400
+@@ -897,7 +897,7 @@ static struct pci_device_id ene_tune_tbl
@@ -13499,5 +13257,4 @@
-diff --git a/drivers/pcmcia/yenta_socket.c b/drivers/pcmcia/yenta_socket.c
-index 0ab1fb65cdc335541ae9bb0da1668686badef607..cc82c08a0111942dc5edf1b0f52503f10cfdfe04 100644
---- a/drivers/pcmcia/yenta_socket.c
-+++ b/drivers/pcmcia/yenta_socket.c
-@@ -1358,7 +1358,7 @@ static struct pci_device_id yenta_table [] = {
+diff -urNp linux-2.6.26.6/drivers/pcmcia/yenta_socket.c linux-2.6.26.6/drivers/pcmcia/yenta_socket.c
+--- linux-2.6.26.6/drivers/pcmcia/yenta_socket.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pcmcia/yenta_socket.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1358,7 +1358,7 @@ static struct pci_device_id yenta_table 
@@ -13512,5 +13269,4 @@
-diff --git a/drivers/pnp/pnpbios/bioscalls.c b/drivers/pnp/pnpbios/bioscalls.c
-index 7ff824496b397b236eda67c1a39b178b6ea22024..a780801942354367bc625793a7f4c65a9117c293 100644
---- a/drivers/pnp/pnpbios/bioscalls.c
-+++ b/drivers/pnp/pnpbios/bioscalls.c
-@@ -60,7 +60,7 @@ set_base(gdt[(selname) >> 3], (u32)(address)); \
+diff -urNp linux-2.6.26.6/drivers/pnp/pnpbios/bioscalls.c linux-2.6.26.6/drivers/pnp/pnpbios/bioscalls.c
+--- linux-2.6.26.6/drivers/pnp/pnpbios/bioscalls.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pnp/pnpbios/bioscalls.c	2008-10-11 21:54:20.000000000 -0400
+@@ -60,7 +60,7 @@ set_base(gdt[(selname) >> 3], (u32)(addr
@@ -13525 +13281 @@
-@@ -87,6 +87,10 @@ static inline u16 call_pnp_bios(u16 func, u16 arg1, u16 arg2, u16 arg3,
+@@ -87,6 +87,10 @@ static inline u16 call_pnp_bios(u16 func
@@ -13536 +13292 @@
-@@ -96,8 +100,17 @@ static inline u16 call_pnp_bios(u16 func, u16 arg1, u16 arg2, u16 arg3,
+@@ -96,8 +100,17 @@ static inline u16 call_pnp_bios(u16 func
@@ -13554 +13310 @@
-@@ -134,7 +147,16 @@ static inline u16 call_pnp_bios(u16 func, u16 arg1, u16 arg2, u16 arg3,
+@@ -134,7 +147,16 @@ static inline u16 call_pnp_bios(u16 func
@@ -13571 +13327 @@
-@@ -468,16 +490,24 @@ int pnp_bios_read_escd(char *data, u32 nvram_base)
+@@ -468,16 +490,24 @@ int pnp_bios_read_escd(char *data, u32 n
@@ -13598 +13354 @@
-@@ -491,4 +521,9 @@ void pnpbios_calls_init(union pnp_bios_install_struct *header)
+@@ -491,4 +521,9 @@ void pnpbios_calls_init(union pnp_bios_i
@@ -13608,4 +13364,3 @@
-diff --git a/drivers/pnp/quirks.c b/drivers/pnp/quirks.c
-index 1ff3bb585ab2b0b5f0bb88f8477fe334c26c726a..be0045722edf3eba22a55805f9e8b4d1d4dc840d 100644
---- a/drivers/pnp/quirks.c
-+++ b/drivers/pnp/quirks.c
+diff -urNp linux-2.6.26.6/drivers/pnp/quirks.c linux-2.6.26.6/drivers/pnp/quirks.c
+--- linux-2.6.26.6/drivers/pnp/quirks.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pnp/quirks.c	2008-10-11 21:54:20.000000000 -0400
@@ -13621,5 +13376,4 @@
-diff --git a/drivers/pnp/resource.c b/drivers/pnp/resource.c
-index 390b50096e30890f57d6cf6f55dc730d18013b47..04ca8707105f74204558d29c25b7356d0ca68c85 100644
---- a/drivers/pnp/resource.c
-+++ b/drivers/pnp/resource.c
-@@ -378,7 +378,7 @@ int pnp_check_irq(struct pnp_dev *dev, struct resource *res)
+diff -urNp linux-2.6.26.6/drivers/pnp/resource.c linux-2.6.26.6/drivers/pnp/resource.c
+--- linux-2.6.26.6/drivers/pnp/resource.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/pnp/resource.c	2008-10-11 21:54:20.000000000 -0400
+@@ -378,7 +378,7 @@ int pnp_check_irq(struct pnp_dev *dev, s
@@ -13634 +13388 @@
-@@ -451,7 +451,7 @@ int pnp_check_dma(struct pnp_dev *dev, struct resource *res)
+@@ -451,7 +451,7 @@ int pnp_check_dma(struct pnp_dev *dev, s
@@ -13643,4 +13397,3 @@
-diff --git a/drivers/scsi/scsi_logging.h b/drivers/scsi/scsi_logging.h
-index 1f65139e14f8d3e9dc470c696c1e3aedabf344a8..eef6227c3666209791904a4b86e842726704fe9d 100644
---- a/drivers/scsi/scsi_logging.h
-+++ b/drivers/scsi/scsi_logging.h
+diff -urNp linux-2.6.26.6/drivers/scsi/scsi_logging.h linux-2.6.26.6/drivers/scsi/scsi_logging.h
+--- linux-2.6.26.6/drivers/scsi/scsi_logging.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/scsi/scsi_logging.h	2008-10-11 21:54:20.000000000 -0400
@@ -13656,5 +13409,4 @@
-diff --git a/drivers/serial/8250_pci.c b/drivers/serial/8250_pci.c
-index 788c3559522d05254ce769b7a92395635da8fabc..a1acc67f6a77634cd4a58c33fc36d3aa955ce641 100644
---- a/drivers/serial/8250_pci.c
-+++ b/drivers/serial/8250_pci.c
-@@ -2844,7 +2844,7 @@ static struct pci_device_id serial_pci_tbl[] = {
+diff -urNp linux-2.6.26.6/drivers/serial/8250_pci.c linux-2.6.26.6/drivers/serial/8250_pci.c
+--- linux-2.6.26.6/drivers/serial/8250_pci.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/serial/8250_pci.c	2008-10-11 21:54:20.000000000 -0400
+@@ -2844,7 +2844,7 @@ static struct pci_device_id serial_pci_t
@@ -13669,5 +13421,4 @@
-diff --git a/drivers/usb/class/cdc-acm.c b/drivers/usb/class/cdc-acm.c
-index 560337aef47ea4b98d9c5b04d3627bd2e92fab71..7701975e215f12924669a060b24b97436372348f 100644
---- a/drivers/usb/class/cdc-acm.c
-+++ b/drivers/usb/class/cdc-acm.c
-@@ -1264,7 +1264,7 @@ static struct usb_device_id acm_ids[] = {
+diff -urNp linux-2.6.26.6/drivers/usb/class/cdc-acm.c linux-2.6.26.6/drivers/usb/class/cdc-acm.c
+--- linux-2.6.26.6/drivers/usb/class/cdc-acm.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/class/cdc-acm.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1264,7 +1264,7 @@ static struct usb_device_id acm_ids[] = 
@@ -13682,5 +13433,4 @@
-diff --git a/drivers/usb/class/usblp.c b/drivers/usb/class/usblp.c
-index 0647164d36db562758cde201619d98e5ed9327a1..6a710ba2983c73fa0cfc2a8412618f34af4090d9 100644
---- a/drivers/usb/class/usblp.c
-+++ b/drivers/usb/class/usblp.c
-@@ -227,7 +227,7 @@ static const struct quirk_printer_struct quirk_printers[] = {
+diff -urNp linux-2.6.26.6/drivers/usb/class/usblp.c linux-2.6.26.6/drivers/usb/class/usblp.c
+--- linux-2.6.26.6/drivers/usb/class/usblp.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/class/usblp.c	2008-10-11 21:54:20.000000000 -0400
+@@ -227,7 +227,7 @@ static const struct quirk_printer_struct
@@ -13695 +13445 @@
-@@ -1401,7 +1401,7 @@ static struct usb_device_id usblp_ids [] = {
+@@ -1401,7 +1401,7 @@ static struct usb_device_id usblp_ids []
@@ -13704,5 +13454,4 @@
-diff --git a/drivers/usb/core/hub.c b/drivers/usb/core/hub.c
-index 4cfe32a16c37fb689e8bab4796b6918a36728382..05a1f66076c73a0a9efe29bbe4c672fbfd35e871 100644
---- a/drivers/usb/core/hub.c
-+++ b/drivers/usb/core/hub.c
-@@ -3045,7 +3045,7 @@ static struct usb_device_id hub_id_table [] = {
+diff -urNp linux-2.6.26.6/drivers/usb/core/hub.c linux-2.6.26.6/drivers/usb/core/hub.c
+--- linux-2.6.26.6/drivers/usb/core/hub.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/core/hub.c	2008-10-11 21:54:20.000000000 -0400
+@@ -3045,7 +3045,7 @@ static struct usb_device_id hub_id_table
@@ -13717,5 +13466,4 @@
-diff --git a/drivers/usb/host/ehci-pci.c b/drivers/usb/host/ehci-pci.c
-index c46a58f9181ded00f97627f076277fd32db9ff79..85abafeaa0ad6d1ac3dc47bb9a4be4b02856ea24 100644
---- a/drivers/usb/host/ehci-pci.c
-+++ b/drivers/usb/host/ehci-pci.c
-@@ -390,7 +390,7 @@ static const struct pci_device_id pci_ids [] = { {
+diff -urNp linux-2.6.26.6/drivers/usb/host/ehci-pci.c linux-2.6.26.6/drivers/usb/host/ehci-pci.c
+--- linux-2.6.26.6/drivers/usb/host/ehci-pci.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/host/ehci-pci.c	2008-10-11 21:54:20.000000000 -0400
+@@ -390,7 +390,7 @@ static const struct pci_device_id pci_id
@@ -13730,5 +13478,4 @@
-diff --git a/drivers/usb/host/uhci-hcd.c b/drivers/usb/host/uhci-hcd.c
-index 3a7bfe7a8874c321990bb802910ea4a902671c9a..6f1d8c8d4f86354eafbf9aa4f54e52dd9d678645 100644
---- a/drivers/usb/host/uhci-hcd.c
-+++ b/drivers/usb/host/uhci-hcd.c
-@@ -928,7 +928,7 @@ static const struct pci_device_id uhci_pci_ids[] = { {
+diff -urNp linux-2.6.26.6/drivers/usb/host/uhci-hcd.c linux-2.6.26.6/drivers/usb/host/uhci-hcd.c
+--- linux-2.6.26.6/drivers/usb/host/uhci-hcd.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/host/uhci-hcd.c	2008-10-11 21:54:20.000000000 -0400
+@@ -928,7 +928,7 @@ static const struct pci_device_id uhci_p
@@ -13743,5 +13490,4 @@
-diff --git a/drivers/usb/storage/debug.h b/drivers/usb/storage/debug.h
-index 77e244a8c37662c8db8773acc7c52802e7d224c8..4da40ab2aefed16223274c0ec1ba9b19b75ea324 100644
---- a/drivers/usb/storage/debug.h
-+++ b/drivers/usb/storage/debug.h
-@@ -56,9 +56,9 @@ void usb_stor_show_sense( unsigned char key,
+diff -urNp linux-2.6.26.6/drivers/usb/storage/debug.h linux-2.6.26.6/drivers/usb/storage/debug.h
+--- linux-2.6.26.6/drivers/usb/storage/debug.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/storage/debug.h	2008-10-11 21:54:20.000000000 -0400
+@@ -56,9 +56,9 @@ void usb_stor_show_sense( unsigned char 
@@ -13760,5 +13506,4 @@
-diff --git a/drivers/usb/storage/usb.c b/drivers/usb/storage/usb.c
-index e268aacb773a57e5041aac509389543b853614a0..777a569aebea9e1ac25302ec4b5c43f1b661484b 100644
---- a/drivers/usb/storage/usb.c
-+++ b/drivers/usb/storage/usb.c
-@@ -137,7 +137,7 @@ static struct usb_device_id storage_usb_ids [] = {
+diff -urNp linux-2.6.26.6/drivers/usb/storage/usb.c linux-2.6.26.6/drivers/usb/storage/usb.c
+--- linux-2.6.26.6/drivers/usb/storage/usb.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/usb/storage/usb.c	2008-10-11 21:54:20.000000000 -0400
+@@ -137,7 +137,7 @@ static struct usb_device_id storage_usb_
@@ -13773 +13518 @@
-@@ -177,7 +177,7 @@ static struct us_unusual_dev us_unusual_dev_list[] = {
+@@ -177,7 +177,7 @@ static struct us_unusual_dev us_unusual_
@@ -13782,5 +13527,4 @@
-diff --git a/drivers/video/fbcmap.c b/drivers/video/fbcmap.c
-index 91b78e691505d715b67de8c990f48ea8a1b420ea..c0e75fb72bdd0c5deab843ca7aead0cdf5c77a05 100644
---- a/drivers/video/fbcmap.c
-+++ b/drivers/video/fbcmap.c
-@@ -250,8 +250,7 @@ int fb_set_user_cmap(struct fb_cmap_user *cmap, struct fb_info *info)
+diff -urNp linux-2.6.26.6/drivers/video/fbcmap.c linux-2.6.26.6/drivers/video/fbcmap.c
+--- linux-2.6.26.6/drivers/video/fbcmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/fbcmap.c	2008-10-11 21:54:20.000000000 -0400
+@@ -250,8 +250,7 @@ int fb_set_user_cmap(struct fb_cmap_user
@@ -13796,5 +13540,4 @@
-diff --git a/drivers/video/fbmem.c b/drivers/video/fbmem.c
-index ce6b5da41c7cf1fc1bb65571d9e4425cf6aecc24..220878f81d87ef6e87c6491a9387dbb7a74b2c1f 100644
---- a/drivers/video/fbmem.c
-+++ b/drivers/video/fbmem.c
-@@ -395,7 +395,7 @@ static void fb_do_show_logo(struct fb_info *info, struct fb_image *image,
+diff -urNp linux-2.6.26.6/drivers/video/fbmem.c linux-2.6.26.6/drivers/video/fbmem.c
+--- linux-2.6.26.6/drivers/video/fbmem.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/fbmem.c	2008-10-11 21:54:20.000000000 -0400
+@@ -395,7 +395,7 @@ static void fb_do_show_logo(struct fb_in
@@ -13809 +13552 @@
-@@ -407,7 +407,7 @@ static void fb_do_show_logo(struct fb_info *info, struct fb_image *image,
+@@ -407,7 +407,7 @@ static void fb_do_show_logo(struct fb_in
@@ -13818 +13561 @@
-@@ -1084,7 +1084,7 @@ fb_ioctl(struct inode *inode, struct file *file, unsigned int cmd,
+@@ -1084,7 +1084,7 @@ fb_ioctl(struct inode *inode, struct fil
@@ -13827,4 +13570,3 @@
-diff --git a/drivers/video/fbmon.c b/drivers/video/fbmon.c
-index 052e180584987260a19a96a2e253b768af71f11e..d87bedb1c6a24712a440065d289b6e02ae71c1d0 100644
---- a/drivers/video/fbmon.c
-+++ b/drivers/video/fbmon.c
+diff -urNp linux-2.6.26.6/drivers/video/fbmon.c linux-2.6.26.6/drivers/video/fbmon.c
+--- linux-2.6.26.6/drivers/video/fbmon.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/fbmon.c	2008-10-11 21:54:20.000000000 -0400
@@ -13840,5 +13582,4 @@
-diff --git a/drivers/video/i810/i810_accel.c b/drivers/video/i810/i810_accel.c
-index 76764ea3486a7d31a77e0887548ea17696819672..9f3143dd72542c0a10d32582ba3de59d97765554 100644
---- a/drivers/video/i810/i810_accel.c
-+++ b/drivers/video/i810/i810_accel.c
-@@ -73,6 +73,7 @@ static inline int wait_for_space(struct fb_info *info, u32 space)
+diff -urNp linux-2.6.26.6/drivers/video/i810/i810_accel.c linux-2.6.26.6/drivers/video/i810/i810_accel.c
+--- linux-2.6.26.6/drivers/video/i810/i810_accel.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/i810/i810_accel.c	2008-10-11 21:54:20.000000000 -0400
+@@ -73,6 +73,7 @@ static inline int wait_for_space(struct 
@@ -13852,5 +13593,4 @@
-diff --git a/drivers/video/i810/i810_main.c b/drivers/video/i810/i810_main.c
-index a24e680d2b9c0f90e3a82f443583b5a03951171d..43072ac15ef9cda272601bf930eee99c0c3aae32 100644
---- a/drivers/video/i810/i810_main.c
-+++ b/drivers/video/i810/i810_main.c
-@@ -120,7 +120,7 @@ static struct pci_device_id i810fb_pci_tbl[] = {
+diff -urNp linux-2.6.26.6/drivers/video/i810/i810_main.c linux-2.6.26.6/drivers/video/i810/i810_main.c
+--- linux-2.6.26.6/drivers/video/i810/i810_main.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/i810/i810_main.c	2008-10-11 21:54:20.000000000 -0400
+@@ -120,7 +120,7 @@ static struct pci_device_id i810fb_pci_t
@@ -13865 +13605 @@
-@@ -1509,7 +1509,7 @@ static int i810fb_cursor(struct fb_info *info, struct fb_cursor *cursor)
+@@ -1509,7 +1509,7 @@ static int i810fb_cursor(struct fb_info 
@@ -13874,5 +13614,4 @@
-diff --git a/drivers/video/modedb.c b/drivers/video/modedb.c
-index d3c3af53a2905940c77dc4983f01e6a7caf03b16..2f13f034ba6a81c382559b90549f119557172f53 100644
---- a/drivers/video/modedb.c
-+++ b/drivers/video/modedb.c
-@@ -38,232 +38,232 @@ static const struct fb_videomode modedb[] = {
+diff -urNp linux-2.6.26.6/drivers/video/modedb.c linux-2.6.26.6/drivers/video/modedb.c
+--- linux-2.6.26.6/drivers/video/modedb.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/modedb.c	2008-10-11 21:54:20.000000000 -0400
+@@ -38,232 +38,232 @@ static const struct fb_videomode modedb[
@@ -14168,4 +13907,3 @@
-diff --git a/drivers/video/uvesafb.c b/drivers/video/uvesafb.c
-index cdbb56edb6cbdde9b34231b5e985c70c3e39efb4..79b9206b037b328ccefe0535b5d14de357873bbe 100644
---- a/drivers/video/uvesafb.c
-+++ b/drivers/video/uvesafb.c
+diff -urNp linux-2.6.26.6/drivers/video/uvesafb.c linux-2.6.26.6/drivers/video/uvesafb.c
+--- linux-2.6.26.6/drivers/video/uvesafb.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/uvesafb.c	2008-10-11 21:54:20.000000000 -0400
@@ -14189 +13927 @@
-@@ -569,10 +570,34 @@ static int __devinit uvesafb_vbe_getpmi(struct uvesafb_ktask *task,
+@@ -569,10 +570,34 @@ static int __devinit uvesafb_vbe_getpmi(
@@ -14236 +13974 @@
-@@ -1853,6 +1883,12 @@ static int uvesafb_remove(struct platform_device *dev)
+@@ -1853,6 +1883,12 @@ static int uvesafb_remove(struct platfor
@@ -14249,4 +13987,3 @@
-diff --git a/drivers/video/vesafb.c b/drivers/video/vesafb.c
-index e16322d157d0b9446a9e9cf6d0c2a99cc2898c7e..22564704a80ef906a26456a483e91c384715f1d4 100644
---- a/drivers/video/vesafb.c
-+++ b/drivers/video/vesafb.c
+diff -urNp linux-2.6.26.6/drivers/video/vesafb.c linux-2.6.26.6/drivers/video/vesafb.c
+--- linux-2.6.26.6/drivers/video/vesafb.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/drivers/video/vesafb.c	2008-10-11 21:54:20.000000000 -0400
@@ -14261 +13998 @@
-@@ -53,8 +54,8 @@ static int   vram_remap __initdata;		/* Set amount of memory to be used */
+@@ -53,8 +54,8 @@ static int   vram_remap __initdata;		/* 
@@ -14272 +14009 @@
-@@ -224,6 +225,7 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -224,6 +225,7 @@ static int __init vesafb_probe(struct pl
@@ -14280 +14017 @@
-@@ -266,10 +268,6 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -266,10 +268,6 @@ static int __init vesafb_probe(struct pl
@@ -14291 +14028 @@
-@@ -302,9 +300,21 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -302,9 +300,21 @@ static int __init vesafb_probe(struct pl
@@ -14315 +14052 @@
-@@ -312,9 +322,29 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -312,9 +322,29 @@ static int __init vesafb_probe(struct pl
@@ -14348 +14085 @@
-@@ -456,6 +486,11 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -456,6 +486,11 @@ static int __init vesafb_probe(struct pl
@@ -14360,5 +14097,4 @@
-diff --git a/fs/9p/vfs_inode.c b/fs/9p/vfs_inode.c
-index c95295c65045a3540959b0ddb9c227e1366472f3..9dce08fc58495adc49563cc87630cbfc8f42aa90 100644
---- a/fs/9p/vfs_inode.c
-+++ b/fs/9p/vfs_inode.c
-@@ -1022,7 +1022,7 @@ static void *v9fs_vfs_follow_link(struct dentry *dentry, struct nameidata *nd)
+diff -urNp linux-2.6.26.6/fs/9p/vfs_inode.c linux-2.6.26.6/fs/9p/vfs_inode.c
+--- linux-2.6.26.6/fs/9p/vfs_inode.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/9p/vfs_inode.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1022,7 +1022,7 @@ static void *v9fs_vfs_follow_link(struct
@@ -14373,25 +14109,4 @@
-diff --git a/fs/Kconfig b/fs/Kconfig
-index 2694648cbd1b6e7d235bc6dbb46cffa62482294d..a43757315f77551d0c8cd64737b71a9feca5b9ff 100644
---- a/fs/Kconfig
-+++ b/fs/Kconfig
-@@ -926,12 +926,12 @@ config PROC_FS
- 
- config PROC_KCORE
- 	bool "/proc/kcore support" if !ARM
--	depends on PROC_FS && MMU
-+	depends on PROC_FS && MMU && !GRKERNSEC_PROC_ADD
- 
- config PROC_VMCORE
-         bool "/proc/vmcore support (EXPERIMENTAL)"
--        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP
--	default y
-+        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP && !GRKERNSEC
-+	default n
-         help
-         Exports the dump image of crashed kernel in ELF format.
- 
-diff --git a/fs/aio.c b/fs/aio.c
-index 0fb3117ddd93d8a517720a744cd415a4b914f63c..60bb6771c2490783505ab043788efc6244fada04 100644
---- a/fs/aio.c
-+++ b/fs/aio.c
-@@ -114,7 +114,7 @@ static int aio_setup_ring(struct kioctx *ctx)
+diff -urNp linux-2.6.26.6/fs/aio.c linux-2.6.26.6/fs/aio.c
+--- linux-2.6.26.6/fs/aio.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/aio.c	2008-10-11 21:54:20.000000000 -0400
+@@ -114,7 +114,7 @@ static int aio_setup_ring(struct kioctx 
@@ -14406,4 +14121,3 @@
-diff --git a/fs/autofs4/symlink.c b/fs/autofs4/symlink.c
-index b4ea82934d2e3a7a8f2707cbac630b5627faca84..e63ef1885ef5fdcb68395d98b0c9f41e08828bf9 100644
---- a/fs/autofs4/symlink.c
-+++ b/fs/autofs4/symlink.c
+diff -urNp linux-2.6.26.6/fs/autofs4/symlink.c linux-2.6.26.6/fs/autofs4/symlink.c
+--- linux-2.6.26.6/fs/autofs4/symlink.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/autofs4/symlink.c	2008-10-11 21:54:20.000000000 -0400
@@ -14419,5 +14133,4 @@
-diff --git a/fs/befs/linuxvfs.c b/fs/befs/linuxvfs.c
-index e8717de3bab34f16f551004048fd91a4c6029cb1..c30c34828dab9fc0f5a47441dea2ca8210bdb919 100644
---- a/fs/befs/linuxvfs.c
-+++ b/fs/befs/linuxvfs.c
-@@ -489,7 +489,7 @@ static void befs_put_link(struct dentry *dentry, struct nameidata *nd, void *p)
+diff -urNp linux-2.6.26.6/fs/befs/linuxvfs.c linux-2.6.26.6/fs/befs/linuxvfs.c
+--- linux-2.6.26.6/fs/befs/linuxvfs.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/befs/linuxvfs.c	2008-10-11 21:54:20.000000000 -0400
+@@ -489,7 +489,7 @@ static void befs_put_link(struct dentry 
@@ -14432,4 +14145,3 @@
-diff --git a/fs/binfmt_aout.c b/fs/binfmt_aout.c
-index ba4cddb92f1ddf02330760e7b7614d7b261a5a64..5a14b6b2537c37f1bdcc8eebc82c95c047c4703e 100644
---- a/fs/binfmt_aout.c
-+++ b/fs/binfmt_aout.c
+diff -urNp linux-2.6.26.6/fs/binfmt_aout.c linux-2.6.26.6/fs/binfmt_aout.c
+--- linux-2.6.26.6/fs/binfmt_aout.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/binfmt_aout.c	2008-10-11 21:54:20.000000000 -0400
@@ -14444 +14156 @@
-@@ -124,18 +125,22 @@ static int aout_core_dump(long signr, struct pt_regs *regs, struct file *file, u
+@@ -124,18 +125,22 @@ static int aout_core_dump(long signr, st
@@ -14467 +14179 @@
-@@ -291,6 +296,8 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
+@@ -291,6 +296,8 @@ static int load_aout_binary(struct linux
@@ -14476 +14188 @@
-@@ -322,6 +329,28 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
+@@ -322,6 +329,28 @@ static int load_aout_binary(struct linux
@@ -14505 +14217 @@
-@@ -413,7 +442,7 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
+@@ -413,7 +442,7 @@ static int load_aout_binary(struct linux
@@ -14514,4 +14226,3 @@
-diff --git a/fs/binfmt_elf.c b/fs/binfmt_elf.c
-index d48ff5f370f4e5122c3402ed44889564366ad317..71bab76e8634cad3d43734bb6f3fcb7e82a858d8 100644
---- a/fs/binfmt_elf.c
-+++ b/fs/binfmt_elf.c
+diff -urNp linux-2.6.26.6/fs/binfmt_elf.c linux-2.6.26.6/fs/binfmt_elf.c
+--- linux-2.6.26.6/fs/binfmt_elf.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/binfmt_elf.c	2008-10-11 21:54:20.000000000 -0400
@@ -14535 +14246 @@
-@@ -84,6 +90,8 @@ static struct linux_binfmt elf_format = {
+@@ -84,6 +90,8 @@ static struct linux_binfmt elf_format = 
@@ -14544 +14255 @@
-@@ -94,7 +102,7 @@ static int set_brk(unsigned long start, unsigned long end)
+@@ -94,7 +102,7 @@ static int set_brk(unsigned long start, 
@@ -14553 +14264 @@
-@@ -351,10 +359,10 @@ static unsigned long load_elf_interp(struct elfhdr *interp_elf_ex,
+@@ -351,10 +359,10 @@ static unsigned long load_elf_interp(str
@@ -14566 +14277 @@
-@@ -400,6 +408,11 @@ static unsigned long load_elf_interp(struct elfhdr *interp_elf_ex,
+@@ -400,6 +408,11 @@ static unsigned long load_elf_interp(str
@@ -14578 +14289 @@
-@@ -443,8 +456,8 @@ static unsigned long load_elf_interp(struct elfhdr *interp_elf_ex,
+@@ -443,8 +456,8 @@ static unsigned long load_elf_interp(str
@@ -14767 +14478 @@
-@@ -514,6 +698,11 @@ static unsigned long randomize_stack_top(unsigned long stack_top)
+@@ -514,6 +698,11 @@ static unsigned long randomize_stack_top
@@ -14779 +14490 @@
-@@ -532,7 +721,7 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -532,7 +721,7 @@ static int load_elf_binary(struct linux_
@@ -14788 +14499 @@
-@@ -543,11 +732,11 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -543,11 +732,11 @@ static int load_elf_binary(struct linux_
@@ -14801 +14512 @@
-@@ -715,11 +904,80 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -715,11 +904,80 @@ static int load_elf_binary(struct linux_
@@ -14883 +14594 @@
-@@ -800,6 +1058,20 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -800,6 +1058,20 @@ static int load_elf_binary(struct linux_
@@ -14904 +14615 @@
-@@ -832,9 +1104,9 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -832,9 +1104,9 @@ static int load_elf_binary(struct linux_
@@ -14917 +14628 @@
-@@ -862,6 +1134,11 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -862,6 +1134,11 @@ static int load_elf_binary(struct linux_
@@ -14929 +14640 @@
-@@ -873,9 +1150,11 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -873,9 +1150,11 @@ static int load_elf_binary(struct linux_
@@ -14944 +14655 @@
-@@ -1118,8 +1397,10 @@ static int dump_seek(struct file *file, loff_t off)
+@@ -1118,8 +1397,10 @@ static int dump_seek(struct file *file, 
@@ -14956 +14667 @@
-@@ -1131,7 +1412,7 @@ static int dump_seek(struct file *file, loff_t off)
+@@ -1131,7 +1412,7 @@ static int dump_seek(struct file *file, 
@@ -14965 +14676 @@
-@@ -1157,7 +1438,7 @@ static unsigned long vma_dump_size(struct vm_area_struct *vma,
+@@ -1157,7 +1438,7 @@ static unsigned long vma_dump_size(struc
@@ -14974 +14685 @@
-@@ -1243,8 +1524,11 @@ static int writenote(struct memelfnote *men, struct file *file,
+@@ -1243,8 +1524,11 @@ static int writenote(struct memelfnote *
@@ -14987 +14698 @@
-@@ -1957,7 +2241,7 @@ static int elf_core_dump(long signr, struct pt_regs *regs, struct file *file, un
+@@ -1957,7 +2241,7 @@ static int elf_core_dump(long signr, str
@@ -14996 +14707 @@
-@@ -1989,7 +2273,7 @@ static int elf_core_dump(long signr, struct pt_regs *regs, struct file *file, un
+@@ -1989,7 +2273,7 @@ static int elf_core_dump(long signr, str
@@ -15005 +14716 @@
-@@ -2009,6 +2293,7 @@ static int elf_core_dump(long signr, struct pt_regs *regs, struct file *file, un
+@@ -2009,6 +2293,7 @@ static int elf_core_dump(long signr, str
@@ -15013,5 +14724,4 @@
-diff --git a/fs/binfmt_flat.c b/fs/binfmt_flat.c
-index 2cb1acda3a82f70a9f809e880d499999e39edd9d..2d7d8c87a025d445339f7b5982271f3e42ec00f4 100644
---- a/fs/binfmt_flat.c
-+++ b/fs/binfmt_flat.c
-@@ -561,7 +561,9 @@ static int load_flat_file(struct linux_binprm * bprm,
+diff -urNp linux-2.6.26.6/fs/binfmt_flat.c linux-2.6.26.6/fs/binfmt_flat.c
+--- linux-2.6.26.6/fs/binfmt_flat.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/binfmt_flat.c	2008-10-11 21:54:20.000000000 -0400
+@@ -561,7 +561,9 @@ static int load_flat_file(struct linux_b
@@ -15027 +14737 @@
-@@ -583,8 +585,10 @@ static int load_flat_file(struct linux_binprm * bprm,
+@@ -583,8 +585,10 @@ static int load_flat_file(struct linux_b
@@ -15038 +14748 @@
-@@ -657,8 +661,10 @@ static int load_flat_file(struct linux_binprm * bprm,
+@@ -657,8 +661,10 @@ static int load_flat_file(struct linux_b
@@ -15049,5 +14759,4 @@
-diff --git a/fs/binfmt_misc.c b/fs/binfmt_misc.c
-index a0a7157a9968a15c68b8dd099f624d221b0baf3e..b8dc0ce18e3075c8f7422dbc741065917d82eadb 100644
---- a/fs/binfmt_misc.c
-+++ b/fs/binfmt_misc.c
-@@ -710,7 +710,7 @@ static int bm_fill_super(struct super_block * sb, void * data, int silent)
+diff -urNp linux-2.6.26.6/fs/binfmt_misc.c linux-2.6.26.6/fs/binfmt_misc.c
+--- linux-2.6.26.6/fs/binfmt_misc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/binfmt_misc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -710,7 +710,7 @@ static int bm_fill_super(struct super_bl
@@ -15062,5 +14771,4 @@
-diff --git a/fs/bio.c b/fs/bio.c
-index 7db618c1d52ed8cef8c946a61eddaed93b409bb8..88f6280cb690e85b56ead68215261f18f3834b1e 100644
---- a/fs/bio.c
-+++ b/fs/bio.c
-@@ -502,7 +502,7 @@ static int __bio_copy_iov(struct bio *bio, struct bio_vec *iovecs,
+diff -urNp linux-2.6.26.6/fs/bio.c linux-2.6.26.6/fs/bio.c
+--- linux-2.6.26.6/fs/bio.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/bio.c	2008-10-11 21:55:52.000000000 -0400
+@@ -502,7 +502,7 @@ static int __bio_copy_iov(struct bio *bi
@@ -15075,4 +14783,3 @@
-diff --git a/fs/buffer.c b/fs/buffer.c
-index 42d2104170f8e7c2e87d90c5b6f9cc22bdecbb36..dce7988a8df292609d4e1362789992bcc7682ab9 100644
---- a/fs/buffer.c
-+++ b/fs/buffer.c
+diff -urNp linux-2.6.26.6/fs/buffer.c linux-2.6.26.6/fs/buffer.c
+--- linux-2.6.26.6/fs/buffer.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/buffer.c	2008-10-11 21:54:20.000000000 -0400
@@ -15087 +14794 @@
-@@ -2191,6 +2192,7 @@ int generic_cont_expand_simple(struct inode *inode, loff_t size)
+@@ -2191,6 +2192,7 @@ int generic_cont_expand_simple(struct in
@@ -15095,5 +14802,4 @@
-diff --git a/fs/cifs/cifs_uniupr.h b/fs/cifs/cifs_uniupr.h
-index 18a9d978e5190dfc9e3974fdf46f193d0c29d8b6..97671db849b5c4a6a3ace0f6849385e6828be85a 100644
---- a/fs/cifs/cifs_uniupr.h
-+++ b/fs/cifs/cifs_uniupr.h
-@@ -132,7 +132,7 @@ const struct UniCaseRange CifsUniUpperRange[] = {
+diff -urNp linux-2.6.26.6/fs/cifs/cifs_uniupr.h linux-2.6.26.6/fs/cifs/cifs_uniupr.h
+--- linux-2.6.26.6/fs/cifs/cifs_uniupr.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/cifs/cifs_uniupr.h	2008-10-11 21:54:20.000000000 -0400
+@@ -132,7 +132,7 @@ const struct UniCaseRange CifsUniUpperRa
@@ -15108,5 +14814,4 @@
-diff --git a/fs/cifs/link.c b/fs/cifs/link.c
-index 63f644000ce5982320cf1d5de19a88b6e0130173..69274d89ad7e39abc684a4f0856c5ce87f1fc6e1 100644
---- a/fs/cifs/link.c
-+++ b/fs/cifs/link.c
-@@ -318,7 +318,7 @@ cifs_readlink(struct dentry *direntry, char __user *pBuffer, int buflen)
+diff -urNp linux-2.6.26.6/fs/cifs/link.c linux-2.6.26.6/fs/cifs/link.c
+--- linux-2.6.26.6/fs/cifs/link.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/cifs/link.c	2008-10-11 21:54:20.000000000 -0400
+@@ -318,7 +318,7 @@ cifs_readlink(struct dentry *direntry, c
@@ -15121,4 +14826,3 @@
-diff --git a/fs/compat.c b/fs/compat.c
-index ed43e17a5dc68ad6663d28bc5abef135492c2e52..7158120b35c3760b976f94223ade1b6a4cfb415f 100644
---- a/fs/compat.c
-+++ b/fs/compat.c
+diff -urNp linux-2.6.26.6/fs/compat.c linux-2.6.26.6/fs/compat.c
+--- linux-2.6.26.6/fs/compat.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/compat.c	2008-10-11 21:54:20.000000000 -0400
@@ -15133 +14837 @@
-@@ -1294,14 +1295,12 @@ static int compat_copy_strings(int argc, compat_uptr_t __user *argv,
+@@ -1294,14 +1295,12 @@ static int compat_copy_strings(int argc,
@@ -15226,4 +14930,3 @@
-diff --git a/fs/compat_ioctl.c b/fs/compat_ioctl.c
-index 97dba0d92348d27692c4f9c10bc6e99c25333cd8..45512dc7cd27cfbcba22eb0db6772dad7397ecea 100644
---- a/fs/compat_ioctl.c
-+++ b/fs/compat_ioctl.c
+diff -urNp linux-2.6.26.6/fs/compat_ioctl.c linux-2.6.26.6/fs/compat_ioctl.c
+--- linux-2.6.26.6/fs/compat_ioctl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/compat_ioctl.c	2008-10-11 21:54:20.000000000 -0400
@@ -15249,5 +14952,4 @@
-diff --git a/fs/debugfs/inode.c b/fs/debugfs/inode.c
-index e9602d85c11d0220d5cbccf7817c25b10a6d068e..34a8acb48bd14516c7ddbf8179efeecbcd863c95 100644
---- a/fs/debugfs/inode.c
-+++ b/fs/debugfs/inode.c
-@@ -121,7 +121,7 @@ static inline int debugfs_positive(struct dentry *dentry)
+diff -urNp linux-2.6.26.6/fs/debugfs/inode.c linux-2.6.26.6/fs/debugfs/inode.c
+--- linux-2.6.26.6/fs/debugfs/inode.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/debugfs/inode.c	2008-10-11 21:54:20.000000000 -0400
+@@ -121,7 +121,7 @@ static inline int debugfs_positive(struc
@@ -15262,4 +14964,3 @@
-diff --git a/fs/exec.c b/fs/exec.c
-index 85e99483eba0494fedff2b7e937f06313cf098d7..f2ae038040a4c0f066369bf98bf0fd04acfb16c6 100644
---- a/fs/exec.c
-+++ b/fs/exec.c
+diff -urNp linux-2.6.26.6/fs/exec.c linux-2.6.26.6/fs/exec.c
+--- linux-2.6.26.6/fs/exec.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/exec.c	2008-10-11 21:55:07.000000000 -0400
@@ -15292 +14993 @@
-@@ -163,18 +175,10 @@ static struct page *get_arg_page(struct linux_binprm *bprm, unsigned long pos,
+@@ -163,18 +175,10 @@ static struct page *get_arg_page(struct 
@@ -15314 +15015 @@
-@@ -247,6 +251,11 @@ static int __bprm_mm_init(struct linux_binprm *bprm)
+@@ -247,6 +251,11 @@ static int __bprm_mm_init(struct linux_b
@@ -15326 +15027 @@
-@@ -259,6 +268,11 @@ static int __bprm_mm_init(struct linux_binprm *bprm)
+@@ -259,6 +268,11 @@ static int __bprm_mm_init(struct linux_b
@@ -15338 +15039 @@
-@@ -382,7 +396,7 @@ static int count(char __user * __user * argv, int max)
+@@ -382,7 +396,7 @@ static int count(char __user * __user * 
@@ -15347 +15048 @@
-@@ -522,6 +536,10 @@ static int shift_arg_pages(struct vm_area_struct *vma, unsigned long shift)
+@@ -522,6 +536,10 @@ static int shift_arg_pages(struct vm_are
@@ -15358 +15059 @@
-@@ -610,6 +628,14 @@ int setup_arg_pages(struct linux_binprm *bprm,
+@@ -610,6 +628,14 @@ int setup_arg_pages(struct linux_binprm 
@@ -15373 +15074 @@
-@@ -623,21 +649,24 @@ int setup_arg_pages(struct linux_binprm *bprm,
+@@ -623,21 +649,24 @@ int setup_arg_pages(struct linux_binprm 
@@ -15407 +15108 @@
-@@ -649,7 +678,7 @@ int setup_arg_pages(struct linux_binprm *bprm,
+@@ -649,7 +678,7 @@ int setup_arg_pages(struct linux_binprm 
@@ -15638 +15339 @@
-@@ -1702,6 +1907,10 @@ int do_coredump(long signr, int exit_code, struct pt_regs * regs)
+@@ -1702,6 +1907,10 @@ int do_coredump(long signr, int exit_cod
@@ -15649 +15350 @@
-@@ -1722,6 +1931,8 @@ int do_coredump(long signr, int exit_code, struct pt_regs * regs)
+@@ -1722,6 +1931,8 @@ int do_coredump(long signr, int exit_cod
@@ -15658,5 +15359,4 @@
-diff --git a/fs/ext2/balloc.c b/fs/ext2/balloc.c
-index 10bb02c3f25cfcdee98897b6d7efe96e5f3ae6a1..4968eb715842564ebd4eb1bed216c6713a7f1900 100644
---- a/fs/ext2/balloc.c
-+++ b/fs/ext2/balloc.c
-@@ -1192,7 +1192,7 @@ static int ext2_has_free_blocks(struct ext2_sb_info *sbi)
+diff -urNp linux-2.6.26.6/fs/ext2/balloc.c linux-2.6.26.6/fs/ext2/balloc.c
+--- linux-2.6.26.6/fs/ext2/balloc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ext2/balloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1192,7 +1192,7 @@ static int ext2_has_free_blocks(struct e
@@ -15671,5 +15371,4 @@
-diff --git a/fs/ext3/balloc.c b/fs/ext3/balloc.c
-index 92fd0338a6ebe3df16739b65feec4e4ef034206f..348395ad884b4f1cd058f1726b37b89da001c21c 100644
---- a/fs/ext3/balloc.c
-+++ b/fs/ext3/balloc.c
-@@ -1421,7 +1421,7 @@ static int ext3_has_free_blocks(struct ext3_sb_info *sbi)
+diff -urNp linux-2.6.26.6/fs/ext3/balloc.c linux-2.6.26.6/fs/ext3/balloc.c
+--- linux-2.6.26.6/fs/ext3/balloc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ext3/balloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1421,7 +1421,7 @@ static int ext3_has_free_blocks(struct e
@@ -15684,5 +15383,4 @@
-diff --git a/fs/ext3/namei.c b/fs/ext3/namei.c
-index 0b8cf80154f1a5c912a1b2d6cae18ccebea591c1..55e72c69f0a6b54015b7b8a65bdcb39071957be6 100644
---- a/fs/ext3/namei.c
-+++ b/fs/ext3/namei.c
-@@ -1171,9 +1171,9 @@ static struct ext3_dir_entry_2 *do_split(handle_t *handle, struct inode *dir,
+diff -urNp linux-2.6.26.6/fs/ext3/namei.c linux-2.6.26.6/fs/ext3/namei.c
+--- linux-2.6.26.6/fs/ext3/namei.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ext3/namei.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1171,9 +1171,9 @@ static struct ext3_dir_entry_2 *do_split
@@ -15700,4 +15398,3 @@
-diff --git a/fs/ext3/xattr.c b/fs/ext3/xattr.c
-index 175414ac22109ef19bf0cf5841d131000cb7e6d2..8650a38efc8e3adf3d2120164df2a4a7060d8914 100644
---- a/fs/ext3/xattr.c
-+++ b/fs/ext3/xattr.c
+diff -urNp linux-2.6.26.6/fs/ext3/xattr.c linux-2.6.26.6/fs/ext3/xattr.c
+--- linux-2.6.26.6/fs/ext3/xattr.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ext3/xattr.c	2008-10-11 21:54:20.000000000 -0400
@@ -15715,5 +15412,4 @@
-diff --git a/fs/ext4/balloc.c b/fs/ext4/balloc.c
-index 9cc80b9cc8d8fa874659f7d4280d0f0e6fba5eca..256f9be3ecf5c35ca04a3faccaf288674f2eb84e 100644
---- a/fs/ext4/balloc.c
-+++ b/fs/ext4/balloc.c
-@@ -1608,7 +1608,7 @@ static int ext4_has_free_blocks(struct ext4_sb_info *sbi)
+diff -urNp linux-2.6.26.6/fs/ext4/balloc.c linux-2.6.26.6/fs/ext4/balloc.c
+--- linux-2.6.26.6/fs/ext4/balloc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ext4/balloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1608,7 +1608,7 @@ static int ext4_has_free_blocks(struct e
@@ -15728,5 +15424,4 @@
-diff --git a/fs/ext4/namei.c b/fs/ext4/namei.c
-index ab16beaa830d3814250146d044f8d2c4a59c7dd4..ef36c1fabe8433307dc6c250cb3f6774ff4b1308 100644
---- a/fs/ext4/namei.c
-+++ b/fs/ext4/namei.c
-@@ -1173,9 +1173,9 @@ static struct ext4_dir_entry_2 *do_split(handle_t *handle, struct inode *dir,
+diff -urNp linux-2.6.26.6/fs/ext4/namei.c linux-2.6.26.6/fs/ext4/namei.c
+--- linux-2.6.26.6/fs/ext4/namei.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ext4/namei.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1173,9 +1173,9 @@ static struct ext4_dir_entry_2 *do_split
@@ -15744,4 +15439,3 @@
-diff --git a/fs/fcntl.c b/fs/fcntl.c
-index bfd776509a7271e324c5559397542c36c4564a34..959014f2f049e3bcf966122fed29c4f6a9436424 100644
---- a/fs/fcntl.c
-+++ b/fs/fcntl.c
+diff -urNp linux-2.6.26.6/fs/fcntl.c linux-2.6.26.6/fs/fcntl.c
+--- linux-2.6.26.6/fs/fcntl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/fcntl.c	2008-10-11 21:54:20.000000000 -0400
@@ -15756 +15450 @@
-@@ -67,6 +68,7 @@ static int locate_fd(unsigned int orig_start, int cloexec)
+@@ -67,6 +68,7 @@ static int locate_fd(unsigned int orig_s
@@ -15772 +15466 @@
-@@ -133,6 +136,8 @@ asmlinkage long sys_dup2(unsigned int oldfd, unsigned int newfd)
+@@ -133,6 +136,8 @@ asmlinkage long sys_dup2(unsigned int ol
@@ -15781 +15475 @@
-@@ -452,7 +457,8 @@ static inline int sigio_perm(struct task_struct *p,
+@@ -452,7 +457,8 @@ static inline int sigio_perm(struct task
@@ -15791,5 +15485,4 @@
-diff --git a/fs/fuse/control.c b/fs/fuse/control.c
-index 4f3cab32141584264789ab3446f962d631ba04ab..80727a8f8c40321507b5d5798d97b12f8d684f55 100644
---- a/fs/fuse/control.c
-+++ b/fs/fuse/control.c
-@@ -159,7 +159,7 @@ void fuse_ctl_remove_conn(struct fuse_conn *fc)
+diff -urNp linux-2.6.26.6/fs/fuse/control.c linux-2.6.26.6/fs/fuse/control.c
+--- linux-2.6.26.6/fs/fuse/control.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/fuse/control.c	2008-10-11 21:54:20.000000000 -0400
+@@ -159,7 +159,7 @@ void fuse_ctl_remove_conn(struct fuse_co
@@ -15804,5 +15497,4 @@
-diff --git a/fs/fuse/dir.c b/fs/fuse/dir.c
-index 2060bf06b90625cf920aa08f87da07bd286a193f..d3ddaff13122b6849eb987939f341a0821065847 100644
---- a/fs/fuse/dir.c
-+++ b/fs/fuse/dir.c
-@@ -1031,7 +1031,7 @@ static char *read_link(struct dentry *dentry)
+diff -urNp linux-2.6.26.6/fs/fuse/dir.c linux-2.6.26.6/fs/fuse/dir.c
+--- linux-2.6.26.6/fs/fuse/dir.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/fuse/dir.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1031,7 +1031,7 @@ static char *read_link(struct dentry *de
@@ -15817,5 +15509,4 @@
-diff --git a/fs/hfs/inode.c b/fs/hfs/inode.c
-index 97f8446c4ff415e8646a868ecce82d6ef77c20eb..71caa70f16362760a411230037ffa96f0d5fb89a 100644
---- a/fs/hfs/inode.c
-+++ b/fs/hfs/inode.c
-@@ -419,7 +419,7 @@ int hfs_write_inode(struct inode *inode, int unused)
+diff -urNp linux-2.6.26.6/fs/hfs/inode.c linux-2.6.26.6/fs/hfs/inode.c
+--- linux-2.6.26.6/fs/hfs/inode.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/hfs/inode.c	2008-10-11 21:54:20.000000000 -0400
+@@ -419,7 +419,7 @@ int hfs_write_inode(struct inode *inode,
@@ -15830 +15521 @@
-@@ -440,7 +440,7 @@ int hfs_write_inode(struct inode *inode, int unused)
+@@ -440,7 +440,7 @@ int hfs_write_inode(struct inode *inode,
@@ -15839,5 +15530,4 @@
-diff --git a/fs/hfsplus/inode.c b/fs/hfsplus/inode.c
-index 67e1c8b467c496565359331e79ca7c706166a30d..78829c94eda9a59dcabdf3b759c764c1feb18cb5 100644
---- a/fs/hfsplus/inode.c
-+++ b/fs/hfsplus/inode.c
-@@ -421,7 +421,7 @@ int hfsplus_cat_read_inode(struct inode *inode, struct hfs_find_data *fd)
+diff -urNp linux-2.6.26.6/fs/hfsplus/inode.c linux-2.6.26.6/fs/hfsplus/inode.c
+--- linux-2.6.26.6/fs/hfsplus/inode.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/hfsplus/inode.c	2008-10-11 21:54:20.000000000 -0400
+@@ -421,7 +421,7 @@ int hfsplus_cat_read_inode(struct inode 
@@ -15852 +15542 @@
-@@ -438,7 +438,7 @@ int hfsplus_cat_read_inode(struct inode *inode, struct hfs_find_data *fd)
+@@ -438,7 +438,7 @@ int hfsplus_cat_read_inode(struct inode 
@@ -15861 +15551 @@
-@@ -494,7 +494,7 @@ int hfsplus_cat_write_inode(struct inode *inode)
+@@ -494,7 +494,7 @@ int hfsplus_cat_write_inode(struct inode
@@ -15870 +15560 @@
-@@ -516,7 +516,7 @@ int hfsplus_cat_write_inode(struct inode *inode)
+@@ -516,7 +516,7 @@ int hfsplus_cat_write_inode(struct inode
@@ -15879,4 +15569,3 @@
-diff --git a/fs/jffs2/debug.h b/fs/jffs2/debug.h
-index a113ecc3bafeeb5f74172d8d5eb98e09f6eb6979..b6498fb81aec95b6ba24b7a3d0b9af80f4521abf 100644
---- a/fs/jffs2/debug.h
-+++ b/fs/jffs2/debug.h
+diff -urNp linux-2.6.26.6/fs/jffs2/debug.h linux-2.6.26.6/fs/jffs2/debug.h
+--- linux-2.6.26.6/fs/jffs2/debug.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/jffs2/debug.h	2008-10-11 21:54:20.000000000 -0400
@@ -15984,5 +15673,4 @@
-diff --git a/fs/jffs2/erase.c b/fs/jffs2/erase.c
-index dddb2a6c9e2cfc087b6becc7f88d9e85ab1d02b4..2084038cc526579e00a0e0b8bd5f2ce87ea12bf9 100644
---- a/fs/jffs2/erase.c
-+++ b/fs/jffs2/erase.c
-@@ -431,7 +431,8 @@ static void jffs2_mark_erased_block(struct jffs2_sb_info *c, struct jffs2_eraseb
+diff -urNp linux-2.6.26.6/fs/jffs2/erase.c linux-2.6.26.6/fs/jffs2/erase.c
+--- linux-2.6.26.6/fs/jffs2/erase.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/jffs2/erase.c	2008-10-11 21:54:20.000000000 -0400
+@@ -431,7 +431,8 @@ static void jffs2_mark_erased_block(stru
@@ -15998,5 +15686,4 @@
-diff --git a/fs/jffs2/summary.h b/fs/jffs2/summary.h
-index 8bf34f2fa5ce30b6f50f9d16de3ad5b9df31195e..e6c3f2ec7baba0234d7d8368ff5916c0e924d997 100644
---- a/fs/jffs2/summary.h
-+++ b/fs/jffs2/summary.h
-@@ -188,18 +188,18 @@ int jffs2_sum_scan_sumnode(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb
+diff -urNp linux-2.6.26.6/fs/jffs2/summary.h linux-2.6.26.6/fs/jffs2/summary.h
+--- linux-2.6.26.6/fs/jffs2/summary.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/jffs2/summary.h	2008-10-11 21:54:20.000000000 -0400
+@@ -188,18 +188,18 @@ int jffs2_sum_scan_sumnode(struct jffs2_
@@ -16030,5 +15717,4 @@
-diff --git a/fs/jffs2/wbuf.c b/fs/jffs2/wbuf.c
-index 0e78b00035e47a313ba43bafba87dfffbe9cf1b4..7865f7a166a38fdef397d39233b038e0da5dc933 100644
---- a/fs/jffs2/wbuf.c
-+++ b/fs/jffs2/wbuf.c
-@@ -1015,7 +1015,8 @@ static const struct jffs2_unknown_node oob_cleanmarker =
+diff -urNp linux-2.6.26.6/fs/jffs2/wbuf.c linux-2.6.26.6/fs/jffs2/wbuf.c
+--- linux-2.6.26.6/fs/jffs2/wbuf.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/jffs2/wbuf.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1015,7 +1015,8 @@ static const struct jffs2_unknown_node o
@@ -16044,5 +15730,23 @@
-diff --git a/fs/locks.c b/fs/locks.c
-index dce8c747371c77e618ee387158c37451daf63c97..1fa6fddd1c2ba053b6b4ef8d43ca5de387857377 100644
---- a/fs/locks.c
-+++ b/fs/locks.c
-@@ -2019,16 +2019,16 @@ void locks_remove_flock(struct file *filp)
+diff -urNp linux-2.6.26.6/fs/Kconfig linux-2.6.26.6/fs/Kconfig
+--- linux-2.6.26.6/fs/Kconfig	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/Kconfig	2008-10-11 21:54:20.000000000 -0400
+@@ -926,12 +926,12 @@ config PROC_FS
+ 
+ config PROC_KCORE
+ 	bool "/proc/kcore support" if !ARM
+-	depends on PROC_FS && MMU
++	depends on PROC_FS && MMU && !GRKERNSEC_PROC_ADD
+ 
+ config PROC_VMCORE
+         bool "/proc/vmcore support (EXPERIMENTAL)"
+-        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP
+-	default y
++        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP && !GRKERNSEC
++	default n
+         help
+         Exports the dump image of crashed kernel in ELF format.
+ 
+diff -urNp linux-2.6.26.6/fs/locks.c linux-2.6.26.6/fs/locks.c
+--- linux-2.6.26.6/fs/locks.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/locks.c	2008-10-11 21:55:52.000000000 -0400
+@@ -2019,16 +2019,16 @@ void locks_remove_flock(struct file *fil
@@ -16069,4 +15773,3 @@
-diff --git a/fs/namei.c b/fs/namei.c
-index 3b26a240ade94689cf4f8407dbd31d587185da9f..ec535196615c7eeb94643e93a59e8436fb901ece 100644
---- a/fs/namei.c
-+++ b/fs/namei.c
+diff -urNp linux-2.6.26.6/fs/namei.c linux-2.6.26.6/fs/namei.c
+--- linux-2.6.26.6/fs/namei.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/namei.c	2008-10-11 21:54:20.000000000 -0400
@@ -16081 +15784 @@
-@@ -673,7 +674,7 @@ static __always_inline int __do_follow_link(struct path *path, struct nameidata
+@@ -673,7 +674,7 @@ static __always_inline int __do_follow_l
@@ -16090 +15793 @@
-@@ -704,6 +705,13 @@ static inline int do_follow_link(struct path *path, struct nameidata *nd)
+@@ -704,6 +705,13 @@ static inline int do_follow_link(struct 
@@ -16123 +15826 @@
-@@ -1706,9 +1721,17 @@ static int __open_namei_create(struct nameidata *nd, struct path *path,
+@@ -1706,9 +1721,17 @@ static int __open_namei_create(struct na
@@ -16141 +15844 @@
-@@ -1789,6 +1812,17 @@ struct file *do_filp_open(int dfd, const char *pathname,
+@@ -1789,6 +1812,17 @@ struct file *do_filp_open(int dfd, const
@@ -16194 +15897 @@
-@@ -2110,9 +2165,21 @@ asmlinkage long sys_mknodat(int dfd, const char __user *filename, int mode,
+@@ -2110,9 +2165,21 @@ asmlinkage long sys_mknodat(int dfd, con
@@ -16216 +15919 @@
-@@ -2126,6 +2193,9 @@ asmlinkage long sys_mknodat(int dfd, const char __user *filename, int mode,
+@@ -2126,6 +2193,9 @@ asmlinkage long sys_mknodat(int dfd, con
@@ -16226 +15929 @@
-@@ -2184,6 +2254,11 @@ asmlinkage long sys_mkdirat(int dfd, const char __user *pathname, int mode)
+@@ -2184,6 +2254,11 @@ asmlinkage long sys_mkdirat(int dfd, con
@@ -16238 +15941 @@
-@@ -2191,6 +2266,10 @@ asmlinkage long sys_mkdirat(int dfd, const char __user *pathname, int mode)
+@@ -2191,6 +2266,10 @@ asmlinkage long sys_mkdirat(int dfd, con
@@ -16249 +15952 @@
-@@ -2273,6 +2352,8 @@ static long do_rmdir(int dfd, const char __user *pathname)
+@@ -2273,6 +2352,8 @@ static long do_rmdir(int dfd, const char
@@ -16258 +15961 @@
-@@ -2298,11 +2379,26 @@ static long do_rmdir(int dfd, const char __user *pathname)
+@@ -2298,11 +2379,26 @@ static long do_rmdir(int dfd, const char
@@ -16285 +15988 @@
-@@ -2363,6 +2459,8 @@ static long do_unlinkat(int dfd, const char __user *pathname)
+@@ -2363,6 +2459,8 @@ static long do_unlinkat(int dfd, const c
@@ -16294 +15997 @@
-@@ -2382,12 +2480,25 @@ static long do_unlinkat(int dfd, const char __user *pathname)
+@@ -2382,12 +2480,25 @@ static long do_unlinkat(int dfd, const c
@@ -16321 +16024 @@
-@@ -2469,10 +2580,18 @@ asmlinkage long sys_symlinkat(const char __user *oldname,
+@@ -2469,10 +2580,18 @@ asmlinkage long sys_symlinkat(const char
@@ -16340 +16043 @@
-@@ -2569,10 +2688,26 @@ asmlinkage long sys_linkat(int olddfd, const char __user *oldname,
+@@ -2569,10 +2688,26 @@ asmlinkage long sys_linkat(int olddfd, c
@@ -16367 +16070 @@
-@@ -2729,8 +2864,10 @@ int vfs_rename(struct inode *old_dir, struct dentry *old_dentry,
+@@ -2729,8 +2864,10 @@ int vfs_rename(struct inode *old_dir, st
@@ -16378 +16081 @@
-@@ -2800,11 +2937,21 @@ static int do_rename(int olddfd, const char *oldname,
+@@ -2800,11 +2937,21 @@ static int do_rename(int olddfd, const c
@@ -16400,4 +16103,3 @@
-diff --git a/fs/namespace.c b/fs/namespace.c
-index 4fc302c2a0e0f886e4026288bcdc50888ddf3551..fbc11a867042f407e1150ec2da3b70be583335d7 100644
---- a/fs/namespace.c
-+++ b/fs/namespace.c
+diff -urNp linux-2.6.26.6/fs/namespace.c linux-2.6.26.6/fs/namespace.c
+--- linux-2.6.26.6/fs/namespace.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/namespace.c	2008-10-11 21:54:20.000000000 -0400
@@ -16412 +16114 @@
-@@ -1085,6 +1086,8 @@ static int do_umount(struct vfsmount *mnt, int flags)
+@@ -1085,6 +1086,8 @@ static int do_umount(struct vfsmount *mn
@@ -16421 +16123 @@
-@@ -1108,6 +1111,9 @@ static int do_umount(struct vfsmount *mnt, int flags)
+@@ -1108,6 +1111,9 @@ static int do_umount(struct vfsmount *mn
@@ -16431 +16133 @@
-@@ -1940,6 +1946,11 @@ long do_mount(char *dev_name, char *dir_name, char *type_page,
+@@ -1940,6 +1946,11 @@ long do_mount(char *dev_name, char *dir_
@@ -16443 +16145 @@
-@@ -1954,6 +1965,9 @@ long do_mount(char *dev_name, char *dir_name, char *type_page,
+@@ -1954,6 +1965,9 @@ long do_mount(char *dev_name, char *dir_
@@ -16453 +16155 @@
-@@ -2072,6 +2086,9 @@ asmlinkage long sys_mount(char __user * dev_name, char __user * dir_name,
+@@ -2072,6 +2086,9 @@ asmlinkage long sys_mount(char __user * 
@@ -16463,5 +16165,4 @@
-diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.c
-index 806d17fac94427b4c9caf1529046fb317c74589c..7ec0a0b62e25b690ac039c1a57fcc96f8070d732 100644
---- a/fs/nfs/nfs4proc.c
-+++ b/fs/nfs/nfs4proc.c
-@@ -655,7 +655,7 @@ static int _nfs4_do_open_reclaim(struct nfs_open_context *ctx, struct nfs4_state
+diff -urNp linux-2.6.26.6/fs/nfs/nfs4proc.c linux-2.6.26.6/fs/nfs/nfs4proc.c
+--- linux-2.6.26.6/fs/nfs/nfs4proc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/nfs/nfs4proc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -655,7 +655,7 @@ static int _nfs4_do_open_reclaim(struct 
@@ -16476 +16177 @@
-@@ -697,7 +697,7 @@ static int _nfs4_open_delegation_recall(struct nfs_open_context *ctx, struct nfs
+@@ -697,7 +697,7 @@ static int _nfs4_open_delegation_recall(
@@ -16485 +16186 @@
-@@ -990,7 +990,7 @@ static int _nfs4_open_expired(struct nfs_open_context *ctx, struct nfs4_state *s
+@@ -990,7 +990,7 @@ static int _nfs4_open_expired(struct nfs
@@ -16503 +16204 @@
-@@ -1181,7 +1181,7 @@ static int nfs4_do_setattr(struct inode *inode, struct nfs_fattr *fattr,
+@@ -1181,7 +1181,7 @@ static int nfs4_do_setattr(struct inode 
@@ -16512 +16213 @@
-@@ -1494,7 +1494,7 @@ static int _nfs4_server_capabilities(struct nfs_server *server, struct nfs_fh *f
+@@ -1494,7 +1494,7 @@ static int _nfs4_server_capabilities(str
@@ -16521 +16222 @@
-@@ -1527,7 +1527,7 @@ static int _nfs4_lookup_root(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -1527,7 +1527,7 @@ static int _nfs4_lookup_root(struct nfs_
@@ -16530 +16231 @@
-@@ -1616,7 +1616,7 @@ static int _nfs4_proc_getattr(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -1616,7 +1616,7 @@ static int _nfs4_proc_getattr(struct nfs
@@ -16539 +16240 @@
-@@ -1706,7 +1706,7 @@ static int nfs4_proc_lookupfh(struct nfs_server *server, struct nfs_fh *dirfh,
+@@ -1706,7 +1706,7 @@ static int nfs4_proc_lookupfh(struct nfs
@@ -16548 +16249 @@
-@@ -1735,7 +1735,7 @@ static int _nfs4_proc_lookup(struct inode *dir, const struct qstr *name,
+@@ -1735,7 +1735,7 @@ static int _nfs4_proc_lookup(struct inod
@@ -16557 +16258 @@
-@@ -1799,7 +1799,7 @@ static int _nfs4_proc_access(struct inode *inode, struct nfs_access_entry *entry
+@@ -1799,7 +1799,7 @@ static int _nfs4_proc_access(struct inod
@@ -16566 +16267 @@
-@@ -1854,7 +1854,7 @@ static int _nfs4_proc_readlink(struct inode *inode, struct page *page,
+@@ -1854,7 +1854,7 @@ static int _nfs4_proc_readlink(struct in
@@ -16575 +16276 @@
-@@ -1950,7 +1950,7 @@ static int _nfs4_proc_remove(struct inode *dir, struct qstr *name)
+@@ -1950,7 +1950,7 @@ static int _nfs4_proc_remove(struct inod
@@ -16584 +16285 @@
-@@ -2022,7 +2022,7 @@ static int _nfs4_proc_rename(struct inode *old_dir, struct qstr *old_name,
+@@ -2022,7 +2022,7 @@ static int _nfs4_proc_rename(struct inod
@@ -16593 +16294 @@
-@@ -2069,7 +2069,7 @@ static int _nfs4_proc_link(struct inode *inode, struct inode *dir, struct qstr *
+@@ -2069,7 +2069,7 @@ static int _nfs4_proc_link(struct inode 
@@ -16602 +16303 @@
-@@ -2126,7 +2126,7 @@ static int _nfs4_proc_symlink(struct inode *dir, struct dentry *dentry,
+@@ -2126,7 +2126,7 @@ static int _nfs4_proc_symlink(struct ino
@@ -16611 +16312 @@
-@@ -2179,7 +2179,7 @@ static int _nfs4_proc_mkdir(struct inode *dir, struct dentry *dentry,
+@@ -2179,7 +2179,7 @@ static int _nfs4_proc_mkdir(struct inode
@@ -16620 +16321 @@
-@@ -2228,7 +2228,7 @@ static int _nfs4_proc_readdir(struct dentry *dentry, struct rpc_cred *cred,
+@@ -2228,7 +2228,7 @@ static int _nfs4_proc_readdir(struct den
@@ -16629 +16330 @@
-@@ -2298,7 +2298,7 @@ static int _nfs4_proc_mknod(struct inode *dir, struct dentry *dentry,
+@@ -2298,7 +2298,7 @@ static int _nfs4_proc_mknod(struct inode
@@ -16638 +16339 @@
-@@ -2327,7 +2327,7 @@ static int _nfs4_proc_statfs(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -2327,7 +2327,7 @@ static int _nfs4_proc_statfs(struct nfs_
@@ -16647 +16348 @@
-@@ -2355,7 +2355,7 @@ static int _nfs4_do_fsinfo(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -2355,7 +2355,7 @@ static int _nfs4_do_fsinfo(struct nfs_se
@@ -16656 +16357 @@
-@@ -2398,7 +2398,7 @@ static int _nfs4_proc_pathconf(struct nfs_server *server, struct nfs_fh *fhandle
+@@ -2398,7 +2398,7 @@ static int _nfs4_proc_pathconf(struct nf
@@ -16674 +16375 @@
-@@ -2742,7 +2742,7 @@ static int __nfs4_proc_set_acl(struct inode *inode, const void *buf, size_t bufl
+@@ -2742,7 +2742,7 @@ static int __nfs4_proc_set_acl(struct in
@@ -16701 +16402 @@
-@@ -3459,7 +3459,7 @@ static int _nfs4_do_setlk(struct nfs4_state *state, int cmd, struct file_lock *f
+@@ -3459,7 +3459,7 @@ static int _nfs4_do_setlk(struct nfs4_st
@@ -16710 +16411 @@
-@@ -3477,7 +3477,7 @@ static int nfs4_lock_reclaim(struct nfs4_state *state, struct file_lock *request
+@@ -3477,7 +3477,7 @@ static int nfs4_lock_reclaim(struct nfs4
@@ -16728 +16429 @@
-@@ -3588,7 +3588,7 @@ nfs4_proc_lock(struct file *filp, int cmd, struct file_lock *request)
+@@ -3588,7 +3588,7 @@ nfs4_proc_lock(struct file *filp, int cm
@@ -16737,5 +16438,4 @@
-diff --git a/fs/nfsd/export.c b/fs/nfsd/export.c
-index 33bfcf09db46faaffa13472d1ffd351c7dad28fb..d68f2ecb70eb60f00bbbfc5574b6a5a25859e7a4 100644
---- a/fs/nfsd/export.c
-+++ b/fs/nfsd/export.c
-@@ -473,7 +473,7 @@ static int secinfo_parse(char **mesg, char *buf, struct svc_export *exp)
+diff -urNp linux-2.6.26.6/fs/nfsd/export.c linux-2.6.26.6/fs/nfsd/export.c
+--- linux-2.6.26.6/fs/nfsd/export.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/nfsd/export.c	2008-10-11 21:54:20.000000000 -0400
+@@ -473,7 +473,7 @@ static int secinfo_parse(char **mesg, ch
@@ -16750,5 +16450,4 @@
-diff --git a/fs/nls/nls_base.c b/fs/nls/nls_base.c
-index 64965e1c21c46ca2dcb9aae20611a0725e9d4f4b..2b4e67638b2982f5af206031c48f42209e21c2c4 100644
---- a/fs/nls/nls_base.c
-+++ b/fs/nls/nls_base.c
-@@ -42,7 +42,7 @@ static const struct utf8_table utf8_table[] =
+diff -urNp linux-2.6.26.6/fs/nls/nls_base.c linux-2.6.26.6/fs/nls/nls_base.c
+--- linux-2.6.26.6/fs/nls/nls_base.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/nls/nls_base.c	2008-10-11 21:54:20.000000000 -0400
+@@ -42,7 +42,7 @@ static const struct utf8_table utf8_tabl
@@ -16763,5 +16462,4 @@
-diff --git a/fs/ntfs/file.c b/fs/ntfs/file.c
-index 3c5550cd11d67b53a5d3ef6ff49dd6d4312f9d4c..451225e65c05bd8b21d5fa8b325d6d830bb68e86 100644
---- a/fs/ntfs/file.c
-+++ b/fs/ntfs/file.c
-@@ -2291,6 +2291,6 @@ const struct inode_operations ntfs_file_inode_ops = {
+diff -urNp linux-2.6.26.6/fs/ntfs/file.c linux-2.6.26.6/fs/ntfs/file.c
+--- linux-2.6.26.6/fs/ntfs/file.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ntfs/file.c	2008-10-11 21:54:20.000000000 -0400
+@@ -2291,6 +2291,6 @@ const struct inode_operations ntfs_file_
@@ -16776,4 +16474,3 @@
-diff --git a/fs/open.c b/fs/open.c
-index a99ad09c3197a1f60e4332f86520183cffa50bbd..4c2399008c266cf79a42b21524e56e1c292a3af9 100644
---- a/fs/open.c
-+++ b/fs/open.c
+diff -urNp linux-2.6.26.6/fs/open.c linux-2.6.26.6/fs/open.c
+--- linux-2.6.26.6/fs/open.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/open.c	2008-10-11 21:54:20.000000000 -0400
@@ -16788 +16485 @@
-@@ -206,6 +207,9 @@ int do_truncate(struct dentry *dentry, loff_t length, unsigned int time_attrs,
+@@ -206,6 +207,9 @@ int do_truncate(struct dentry *dentry, l
@@ -16798 +16495 @@
-@@ -478,6 +482,9 @@ asmlinkage long sys_faccessat(int dfd, const char __user *filename, int mode)
+@@ -478,6 +482,9 @@ asmlinkage long sys_faccessat(int dfd, c
@@ -16808 +16505 @@
-@@ -509,6 +516,8 @@ asmlinkage long sys_chdir(const char __user * filename)
+@@ -509,6 +516,8 @@ asmlinkage long sys_chdir(const char __u
@@ -16817 +16514 @@
-@@ -535,6 +544,13 @@ asmlinkage long sys_fchdir(unsigned int fd)
+@@ -535,6 +544,13 @@ asmlinkage long sys_fchdir(unsigned int 
@@ -16831 +16528 @@
-@@ -560,8 +576,16 @@ asmlinkage long sys_chroot(const char __user * filename)
+@@ -560,8 +576,16 @@ asmlinkage long sys_chroot(const char __
@@ -16848 +16545 @@
-@@ -592,9 +616,22 @@ asmlinkage long sys_fchmod(unsigned int fd, mode_t mode)
+@@ -592,9 +616,22 @@ asmlinkage long sys_fchmod(unsigned int 
@@ -16871 +16568 @@
-@@ -629,9 +666,21 @@ asmlinkage long sys_fchmodat(int dfd, const char __user *filename,
+@@ -629,9 +666,21 @@ asmlinkage long sys_fchmodat(int dfd, co
@@ -16893 +16590 @@
-@@ -650,7 +699,7 @@ asmlinkage long sys_chmod(const char __user *filename, mode_t mode)
+@@ -650,7 +699,7 @@ asmlinkage long sys_chmod(const char __u
@@ -16902 +16599 @@
-@@ -664,6 +713,12 @@ static int chown_common(struct dentry * dentry, uid_t user, gid_t group)
+@@ -664,6 +713,12 @@ static int chown_common(struct dentry * 
@@ -16915 +16612 @@
-@@ -694,7 +749,7 @@ asmlinkage long sys_chown(const char __user * filename, uid_t user, gid_t group)
+@@ -694,7 +749,7 @@ asmlinkage long sys_chown(const char __u
@@ -16924 +16621 @@
-@@ -719,7 +774,7 @@ asmlinkage long sys_fchownat(int dfd, const char __user *filename, uid_t user,
+@@ -719,7 +774,7 @@ asmlinkage long sys_fchownat(int dfd, co
@@ -16933 +16630 @@
-@@ -738,7 +793,7 @@ asmlinkage long sys_lchown(const char __user * filename, uid_t user, gid_t group
+@@ -738,7 +793,7 @@ asmlinkage long sys_lchown(const char __
@@ -16942 +16639 @@
-@@ -762,7 +817,7 @@ asmlinkage long sys_fchown(unsigned int fd, uid_t user, gid_t group)
+@@ -762,7 +817,7 @@ asmlinkage long sys_fchown(unsigned int 
@@ -16959,4 +16656,3 @@
-diff --git a/fs/partitions/efi.c b/fs/partitions/efi.c
-index e7b07006bc4173c5489c3bb1532f01e0473e4bf1..4210597efd47abc2eecb3a0be54689c2f24aa1a5 100644
---- a/fs/partitions/efi.c
-+++ b/fs/partitions/efi.c
+diff -urNp linux-2.6.26.6/fs/partitions/efi.c linux-2.6.26.6/fs/partitions/efi.c
+--- linux-2.6.26.6/fs/partitions/efi.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/partitions/efi.c	2008-10-11 21:54:20.000000000 -0400
@@ -16972,4 +16668,3 @@
-diff --git a/fs/pipe.c b/fs/pipe.c
-index 700f4e0d9572170a4de51527bc1698768a848afe..287e789f497ab2bd30ce04a260538de43f448e9b 100644
---- a/fs/pipe.c
-+++ b/fs/pipe.c
+diff -urNp linux-2.6.26.6/fs/pipe.c linux-2.6.26.6/fs/pipe.c
+--- linux-2.6.26.6/fs/pipe.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/pipe.c	2008-10-11 21:54:20.000000000 -0400
@@ -16985,5 +16680,4 @@
-diff --git a/fs/proc/array.c b/fs/proc/array.c
-index 0b2a88c495f4cc4e866dadfd7064769704b05463..3936eda35366a47fa4a12eb7c74d1e00ef308dc2 100644
---- a/fs/proc/array.c
-+++ b/fs/proc/array.c
-@@ -310,6 +310,21 @@ static inline void task_context_switch_counts(struct seq_file *m,
+diff -urNp linux-2.6.26.6/fs/proc/array.c linux-2.6.26.6/fs/proc/array.c
+--- linux-2.6.26.6/fs/proc/array.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/array.c	2008-10-11 21:54:20.000000000 -0400
+@@ -310,6 +310,21 @@ static inline void task_context_switch_c
@@ -17011 +16705 @@
-@@ -329,9 +344,20 @@ int proc_pid_status(struct seq_file *m, struct pid_namespace *ns,
+@@ -329,9 +344,20 @@ int proc_pid_status(struct seq_file *m, 
@@ -17032 +16726 @@
-@@ -424,6 +450,19 @@ static int do_task_stat(struct seq_file *m, struct pid_namespace *ns,
+@@ -424,6 +450,19 @@ static int do_task_stat(struct seq_file 
@@ -17052 +16746 @@
-@@ -464,9 +503,15 @@ static int do_task_stat(struct seq_file *m, struct pid_namespace *ns,
+@@ -464,9 +503,15 @@ static int do_task_stat(struct seq_file 
@@ -17068 +16762 @@
-@@ -519,3 +564,10 @@ int proc_pid_statm(struct seq_file *m, struct pid_namespace *ns,
+@@ -519,3 +564,10 @@ int proc_pid_statm(struct seq_file *m, s
@@ -17079,4 +16773,3 @@
-diff --git a/fs/proc/base.c b/fs/proc/base.c
-index 3b455371e7ff50981229d98359344ef92a228d0e..a155b8740cda45535fbfda2dadcb8d88ec3d699d 100644
---- a/fs/proc/base.c
-+++ b/fs/proc/base.c
+diff -urNp linux-2.6.26.6/fs/proc/base.c linux-2.6.26.6/fs/proc/base.c
+--- linux-2.6.26.6/fs/proc/base.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/base.c	2008-10-11 21:54:20.000000000 -0400
@@ -17092 +16785 @@
-@@ -146,7 +148,7 @@ static unsigned int pid_entry_count_dirs(const struct pid_entry *entries,
+@@ -146,7 +148,7 @@ static unsigned int pid_entry_count_dirs
@@ -17101 +16794 @@
-@@ -227,6 +229,9 @@ static int check_mem_permission(struct task_struct *task)
+@@ -227,6 +229,9 @@ static int check_mem_permission(struct t
@@ -17111 +16804 @@
-@@ -305,9 +310,9 @@ static int proc_pid_auxv(struct task_struct *task, char *buffer)
+@@ -305,9 +310,9 @@ static int proc_pid_auxv(struct task_str
@@ -17123 +16816 @@
-@@ -1410,7 +1415,11 @@ static struct inode *proc_pid_make_inode(struct super_block * sb, struct task_st
+@@ -1410,7 +1415,11 @@ static struct inode *proc_pid_make_inode
@@ -17135 +16828 @@
-@@ -1426,17 +1435,45 @@ static int pid_getattr(struct vfsmount *mnt, struct dentry *dentry, struct kstat
+@@ -1426,17 +1435,45 @@ static int pid_getattr(struct vfsmount *
@@ -17182 +16875 @@
-@@ -1464,11 +1501,21 @@ static int pid_revalidate(struct dentry *dentry, struct nameidata *nd)
+@@ -1464,11 +1501,21 @@ static int pid_revalidate(struct dentry 
@@ -17204 +16897 @@
-@@ -1837,12 +1884,22 @@ static int proc_fd_permission(struct inode *inode, int mask,
+@@ -1837,12 +1884,22 @@ static int proc_fd_permission(struct ino
@@ -17229 +16922 @@
-@@ -1953,6 +2010,9 @@ static struct dentry *proc_pident_lookup(struct inode *dir,
+@@ -1953,6 +2010,9 @@ static struct dentry *proc_pident_lookup
@@ -17239 +16932 @@
-@@ -1997,6 +2057,9 @@ static int proc_pident_readdir(struct file *filp,
+@@ -1997,6 +2057,9 @@ static int proc_pident_readdir(struct fi
@@ -17249 +16942 @@
-@@ -2359,6 +2422,9 @@ static struct dentry *proc_base_lookup(struct inode *dir, struct dentry *dentry)
+@@ -2359,6 +2422,9 @@ static struct dentry *proc_base_lookup(s
@@ -17259 +16952 @@
-@@ -2471,6 +2537,9 @@ static const struct pid_entry tgid_base_stuff[] = {
+@@ -2471,6 +2537,9 @@ static const struct pid_entry tgid_base_
@@ -17269 +16962 @@
-@@ -2600,7 +2669,14 @@ static struct dentry *proc_pid_instantiate(struct inode *dir,
+@@ -2600,7 +2669,14 @@ static struct dentry *proc_pid_instantia
@@ -17284 +16977 @@
-@@ -2642,7 +2718,11 @@ struct dentry *proc_pid_lookup(struct inode *dir, struct dentry * dentry, struct
+@@ -2642,7 +2718,11 @@ struct dentry *proc_pid_lookup(struct in
@@ -17296 +16989 @@
-@@ -2707,6 +2787,9 @@ int proc_pid_readdir(struct file * filp, void * dirent, filldir_t filldir)
+@@ -2707,6 +2787,9 @@ int proc_pid_readdir(struct file * filp,
@@ -17306 +16999 @@
-@@ -2725,6 +2808,17 @@ int proc_pid_readdir(struct file * filp, void * dirent, filldir_t filldir)
+@@ -2725,6 +2808,17 @@ int proc_pid_readdir(struct file * filp,
@@ -17324,5 +17017,4 @@
-diff --git a/fs/proc/inode.c b/fs/proc/inode.c
-index b08d10017911f43927646943307e26238e4fe7dc..cf215ae7a2f9b56cfe0bde1b23a4adce56846202 100644
---- a/fs/proc/inode.c
-+++ b/fs/proc/inode.c
-@@ -403,7 +403,11 @@ struct inode *proc_get_inode(struct super_block *sb, unsigned int ino,
+diff -urNp linux-2.6.26.6/fs/proc/inode.c linux-2.6.26.6/fs/proc/inode.c
+--- linux-2.6.26.6/fs/proc/inode.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/inode.c	2008-10-11 21:54:20.000000000 -0400
+@@ -403,7 +403,11 @@ struct inode *proc_get_inode(struct supe
@@ -17340,5 +17032,4 @@
-diff --git a/fs/proc/internal.h b/fs/proc/internal.h
-index 28cbca8059057e5f1b7729b69743aea11cecc27c..161606d3d4869125c8c153de358f901837a8e618 100644
---- a/fs/proc/internal.h
-+++ b/fs/proc/internal.h
-@@ -55,6 +55,9 @@ extern int proc_pid_status(struct seq_file *m, struct pid_namespace *ns,
+diff -urNp linux-2.6.26.6/fs/proc/internal.h linux-2.6.26.6/fs/proc/internal.h
+--- linux-2.6.26.6/fs/proc/internal.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/internal.h	2008-10-11 21:54:20.000000000 -0400
+@@ -55,6 +55,9 @@ extern int proc_pid_status(struct seq_fi
@@ -17354,4 +17045,3 @@
-diff --git a/fs/proc/proc_misc.c b/fs/proc/proc_misc.c
-index 7e277f2ad466da31d9233a06f17963c718c37397..87059998af60cc615ddbaeeee41a2462b4f07ea8 100644
---- a/fs/proc/proc_misc.c
-+++ b/fs/proc/proc_misc.c
+diff -urNp linux-2.6.26.6/fs/proc/proc_misc.c linux-2.6.26.6/fs/proc/proc_misc.c
+--- linux-2.6.26.6/fs/proc/proc_misc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/proc_misc.c	2008-10-11 21:54:20.000000000 -0400
@@ -17421,5 +17111,4 @@
-diff --git a/fs/proc/proc_net.c b/fs/proc/proc_net.c
-index 83f357b30d71c583e4662784e53639b5391cf84e..0c46db3cdc9850eedb1d8aada7344307c7c2eadd 100644
---- a/fs/proc/proc_net.c
-+++ b/fs/proc/proc_net.c
-@@ -69,6 +69,14 @@ static struct net *get_proc_task_net(struct inode *dir)
+diff -urNp linux-2.6.26.6/fs/proc/proc_net.c linux-2.6.26.6/fs/proc/proc_net.c
+--- linux-2.6.26.6/fs/proc/proc_net.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/proc_net.c	2008-10-11 21:54:20.000000000 -0400
+@@ -69,6 +69,14 @@ static struct net *get_proc_task_net(str
@@ -17440,4 +17129,3 @@
-diff --git a/fs/proc/proc_sysctl.c b/fs/proc/proc_sysctl.c
-index 5acc001d49f6c72db83216173136701c2169f950..d263b9a0893da12b9ecf665de4903cc108c176bf 100644
---- a/fs/proc/proc_sysctl.c
-+++ b/fs/proc/proc_sysctl.c
+diff -urNp linux-2.6.26.6/fs/proc/proc_sysctl.c linux-2.6.26.6/fs/proc/proc_sysctl.c
+--- linux-2.6.26.6/fs/proc/proc_sysctl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/proc_sysctl.c	2008-10-11 21:54:20.000000000 -0400
@@ -17453 +17141 @@
-@@ -151,6 +153,9 @@ static struct dentry *proc_sys_lookup(struct inode *dir, struct dentry *dentry,
+@@ -151,6 +153,9 @@ static struct dentry *proc_sys_lookup(st
@@ -17463 +17151 @@
-@@ -332,6 +337,9 @@ static int proc_sys_readdir(struct file *filp, void *dirent, filldir_t filldir)
+@@ -332,6 +337,9 @@ static int proc_sys_readdir(struct file 
@@ -17504 +17192 @@
-@@ -422,6 +454,7 @@ static const struct inode_operations proc_sys_inode_operations = {
+@@ -422,6 +454,7 @@ static const struct inode_operations pro
@@ -17512,4 +17200,3 @@
-diff --git a/fs/proc/root.c b/fs/proc/root.c
-index 95117538a4f6fd3b4fdc90558127caa282d7e800..5bbdb2ec4e6522292683d4362dccfa0d1e5aca8d 100644
---- a/fs/proc/root.c
-+++ b/fs/proc/root.c
+diff -urNp linux-2.6.26.6/fs/proc/root.c linux-2.6.26.6/fs/proc/root.c
+--- linux-2.6.26.6/fs/proc/root.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/root.c	2008-10-11 21:54:20.000000000 -0400
@@ -17532,5 +17219,4 @@
-diff --git a/fs/proc/task_mmu.c b/fs/proc/task_mmu.c
-index 1eaa39a650c391279f9a9d97c6fbf15328323319..ee000da800734918baa95b172fd5ac1f3b2aff5a 100644
---- a/fs/proc/task_mmu.c
-+++ b/fs/proc/task_mmu.c
-@@ -46,15 +46,26 @@ void task_mem(struct seq_file *m, struct mm_struct *mm)
+diff -urNp linux-2.6.26.6/fs/proc/task_mmu.c linux-2.6.26.6/fs/proc/task_mmu.c
+--- linux-2.6.26.6/fs/proc/task_mmu.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/proc/task_mmu.c	2008-10-11 21:54:20.000000000 -0400
+@@ -46,15 +46,26 @@ void task_mem(struct seq_file *m, struct
@@ -17566 +17252 @@
-@@ -198,6 +209,12 @@ static int do_maps_open(struct inode *inode, struct file *file,
+@@ -198,6 +209,12 @@ static int do_maps_open(struct inode *in
@@ -17579 +17265 @@
-@@ -220,13 +237,22 @@ static int show_map(struct seq_file *m, void *v)
+@@ -220,13 +237,22 @@ static int show_map(struct seq_file *m, 
@@ -17602 +17288 @@
-@@ -240,11 +266,11 @@ static int show_map(struct seq_file *m, void *v)
+@@ -240,11 +266,11 @@ static int show_map(struct seq_file *m, 
@@ -17618 +17304 @@
-@@ -377,9 +403,16 @@ static int show_smap(struct seq_file *m, void *v)
+@@ -377,9 +403,16 @@ static int show_smap(struct seq_file *m,
@@ -17638 +17324 @@
-@@ -395,7 +428,11 @@ static int show_smap(struct seq_file *m, void *v)
+@@ -395,7 +428,11 @@ static int show_smap(struct seq_file *m,
@@ -17650 +17336 @@
-@@ -747,6 +784,11 @@ static int show_numa_map_checked(struct seq_file *m, void *v)
+@@ -747,6 +784,11 @@ static int show_numa_map_checked(struct 
@@ -17662,4 +17348,3 @@
-diff --git a/fs/readdir.c b/fs/readdir.c
-index 4e026e5407fb7516c3a52c8533f0159b6b7ecdd9..dd245680d82d2e2b333990277799741584ab1fa6 100644
---- a/fs/readdir.c
-+++ b/fs/readdir.c
+diff -urNp linux-2.6.26.6/fs/readdir.c linux-2.6.26.6/fs/readdir.c
+--- linux-2.6.26.6/fs/readdir.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/readdir.c	2008-10-11 21:54:20.000000000 -0400
@@ -17683 +17368 @@
-@@ -82,6 +85,10 @@ static int fillonedir(void * __buf, const char * name, int namlen, loff_t offset
+@@ -82,6 +85,10 @@ static int fillonedir(void * __buf, cons
@@ -17694 +17379 @@
-@@ -113,6 +120,7 @@ asmlinkage long old_readdir(unsigned int fd, struct old_linux_dirent __user * di
+@@ -113,6 +120,7 @@ asmlinkage long old_readdir(unsigned int
@@ -17710 +17395 @@
-@@ -157,6 +166,10 @@ static int filldir(void * __buf, const char * name, int namlen, loff_t offset,
+@@ -157,6 +166,10 @@ static int filldir(void * __buf, const c
@@ -17721 +17406 @@
-@@ -203,6 +216,7 @@ asmlinkage long sys_getdents(unsigned int fd, struct linux_dirent __user * diren
+@@ -203,6 +216,7 @@ asmlinkage long sys_getdents(unsigned in
@@ -17737 +17422 @@
-@@ -239,6 +254,10 @@ static int filldir64(void * __buf, const char * name, int namlen, loff_t offset,
+@@ -239,6 +254,10 @@ static int filldir64(void * __buf, const
@@ -17748 +17433 @@
-@@ -285,6 +304,7 @@ asmlinkage long sys_getdents64(unsigned int fd, struct linux_dirent64 __user * d
+@@ -285,6 +304,7 @@ asmlinkage long sys_getdents64(unsigned 
@@ -17756,5 +17441,4 @@
-diff --git a/fs/smbfs/symlink.c b/fs/smbfs/symlink.c
-index 00b2909bd469e30fc9c074029cd1d2789515f2b8..2ace3831b2b6f9d8de228b152997ebd1d70f2a2a 100644
---- a/fs/smbfs/symlink.c
-+++ b/fs/smbfs/symlink.c
-@@ -55,7 +55,7 @@ static void *smb_follow_link(struct dentry *dentry, struct nameidata *nd)
+diff -urNp linux-2.6.26.6/fs/smbfs/symlink.c linux-2.6.26.6/fs/smbfs/symlink.c
+--- linux-2.6.26.6/fs/smbfs/symlink.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/smbfs/symlink.c	2008-10-11 21:54:20.000000000 -0400
+@@ -55,7 +55,7 @@ static void *smb_follow_link(struct dent
@@ -17769,5 +17453,4 @@
-diff --git a/fs/sysfs/symlink.c b/fs/sysfs/symlink.c
-index 817f5966edcac2c2e36033902f2ac2ce0f89f626..b7e0febd65876eda5a09ee2606ff978f966a4cba 100644
---- a/fs/sysfs/symlink.c
-+++ b/fs/sysfs/symlink.c
-@@ -175,7 +175,7 @@ static void *sysfs_follow_link(struct dentry *dentry, struct nameidata *nd)
+diff -urNp linux-2.6.26.6/fs/sysfs/symlink.c linux-2.6.26.6/fs/sysfs/symlink.c
+--- linux-2.6.26.6/fs/sysfs/symlink.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/sysfs/symlink.c	2008-10-11 21:54:20.000000000 -0400
+@@ -175,7 +175,7 @@ static void *sysfs_follow_link(struct de
@@ -17782,5 +17465,4 @@
-diff --git a/fs/udf/balloc.c b/fs/udf/balloc.c
-index 1b809bd494bd098a0a7855ba10f300f66a08d46a..9ca5a3fd9363db232e1e762acf54cc8418f0705a 100644
---- a/fs/udf/balloc.c
-+++ b/fs/udf/balloc.c
-@@ -169,9 +169,7 @@ static void udf_bitmap_free_blocks(struct super_block *sb,
+diff -urNp linux-2.6.26.6/fs/udf/balloc.c linux-2.6.26.6/fs/udf/balloc.c
+--- linux-2.6.26.6/fs/udf/balloc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/udf/balloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -169,9 +169,7 @@ static void udf_bitmap_free_blocks(struc
@@ -17797 +17479 @@
-@@ -239,7 +237,7 @@ static int udf_bitmap_prealloc_blocks(struct super_block *sb,
+@@ -239,7 +237,7 @@ static int udf_bitmap_prealloc_blocks(st
@@ -17806 +17488 @@
-@@ -300,7 +298,7 @@ static int udf_bitmap_new_block(struct super_block *sb,
+@@ -300,7 +298,7 @@ static int udf_bitmap_new_block(struct s
@@ -17815 +17497 @@
-@@ -438,9 +436,7 @@ static void udf_table_free_blocks(struct super_block *sb,
+@@ -438,9 +436,7 @@ static void udf_table_free_blocks(struct
@@ -17826 +17508 @@
-@@ -671,8 +667,7 @@ static int udf_table_prealloc_blocks(struct super_block *sb,
+@@ -671,8 +667,7 @@ static int udf_table_prealloc_blocks(str
@@ -17836 +17518 @@
-@@ -750,7 +745,7 @@ static int udf_table_new_block(struct super_block *sb,
+@@ -750,7 +745,7 @@ static int udf_table_new_block(struct su
@@ -17845,5 +17527,4 @@
-diff --git a/fs/ufs/inode.c b/fs/ufs/inode.c
-index 39f8778985655b1f1a166575e013b940af7965d4..168e5518d9c6393acead57ad9762ee795d426d9b 100644
---- a/fs/ufs/inode.c
-+++ b/fs/ufs/inode.c
-@@ -56,9 +56,7 @@ static int ufs_block_to_path(struct inode *inode, sector_t i_block, sector_t off
+diff -urNp linux-2.6.26.6/fs/ufs/inode.c linux-2.6.26.6/fs/ufs/inode.c
+--- linux-2.6.26.6/fs/ufs/inode.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/ufs/inode.c	2008-10-11 21:54:20.000000000 -0400
+@@ -56,9 +56,7 @@ static int ufs_block_to_path(struct inod
@@ -17860 +17541 @@
-@@ -440,8 +438,6 @@ int ufs_getfrag_block(struct inode *inode, sector_t fragment, struct buffer_head
+@@ -440,8 +438,6 @@ int ufs_getfrag_block(struct inode *inod
@@ -17880,4 +17561,3 @@
-diff --git a/fs/utimes.c b/fs/utimes.c
-index b6b664e7145ec7e0debea47c041b7c3faa9a0aee..a61f5de24c245d3cd7cd63d65da1af52683344be 100644
---- a/fs/utimes.c
-+++ b/fs/utimes.c
+diff -urNp linux-2.6.26.6/fs/utimes.c linux-2.6.26.6/fs/utimes.c
+--- linux-2.6.26.6/fs/utimes.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/utimes.c	2008-10-11 21:54:20.000000000 -0400
@@ -17892 +17572 @@
-@@ -57,10 +58,10 @@ long do_utimes(int dfd, char __user *filename, struct timespec *times, int flags
+@@ -57,10 +58,10 @@ long do_utimes(int dfd, char __user *fil
@@ -17904 +17584 @@
-@@ -153,6 +154,12 @@ long do_utimes(int dfd, char __user *filename, struct timespec *times, int flags
+@@ -153,6 +154,12 @@ long do_utimes(int dfd, char __user *fil
@@ -17917,4 +17597,3 @@
-diff --git a/fs/xfs/linux-2.6/xfs_iops.c b/fs/xfs/linux-2.6/xfs_iops.c
-index 2bf287ef54897af2651f24b39792404270179a19..05de325f12b044789a93d9a4c89274a2319d15dc 100644
---- a/fs/xfs/linux-2.6/xfs_iops.c
-+++ b/fs/xfs/linux-2.6/xfs_iops.c
+diff -urNp linux-2.6.26.6/fs/xfs/linux-2.6/xfs_iops.c linux-2.6.26.6/fs/xfs/linux-2.6/xfs_iops.c
+--- linux-2.6.26.6/fs/xfs/linux-2.6/xfs_iops.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/xfs/linux-2.6/xfs_iops.c	2008-10-11 21:54:20.000000000 -0400
@@ -17930,4 +17609,3 @@
-diff --git a/fs/xfs/xfs_bmap.c b/fs/xfs/xfs_bmap.c
-index 53c259f5a5af5e7b85fde5f73ee678670e692ad9..b0452b34b05efa1120cfb1321f9664ea0cc46a23 100644
---- a/fs/xfs/xfs_bmap.c
-+++ b/fs/xfs/xfs_bmap.c
+diff -urNp linux-2.6.26.6/fs/xfs/xfs_bmap.c linux-2.6.26.6/fs/xfs/xfs_bmap.c
+--- linux-2.6.26.6/fs/xfs/xfs_bmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/fs/xfs/xfs_bmap.c	2008-10-11 21:54:20.000000000 -0400
@@ -17943,9 +17621,10 @@
-diff --git a/grsecurity/Kconfig b/grsecurity/Kconfig
-new file mode 100644
-index 0000000000000000000000000000000000000000..8be9ab05829f25d9a7f502149ffa344168d958f8
---- /dev/null
-+++ b/grsecurity/Kconfig
-@@ -0,0 +1,863 @@
-+#
-+# grecurity configuration
-+#
+diff -urNp linux-2.6.26.6/grsecurity/gracl_alloc.c linux-2.6.26.6/grsecurity/gracl_alloc.c
+--- linux-2.6.26.6/grsecurity/gracl_alloc.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_alloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,91 @@
++#include <linux/kernel.h>
++#include <linux/mm.h>
++#include <linux/slab.h>
++#include <linux/vmalloc.h>
++#include <linux/gracl.h>
++#include <linux/grsecurity.h>
@@ -17953 +17632,3 @@
-+menu "Grsecurity"
++static unsigned long alloc_stack_next = 1;
++static unsigned long alloc_stack_size = 1;
++static void **alloc_stack;
@@ -17955,12 +17636,5 @@
-+config GRKERNSEC
-+	bool "Grsecurity"
-+	select CRYPTO
-+	select CRYPTO_SHA256
-+	select SECURITY
-+	select SECURITY_CAPABILITIES
-+	help
-+	  If you say Y here, you will be able to configure many features
-+	  that will enhance the security of your system.  It is highly
-+	  recommended that you say Y here and read through the help
-+	  for each option so that you fully understand the features and
-+	  can evaluate their usefulness for your machine.
++static __inline__ int
++alloc_pop(void)
++{
++	if (alloc_stack_next == 1)
++		return 0;
@@ -17968,4 +17642 @@
-+choice
-+	prompt "Security Level"
-+	depends on GRKERNSEC
-+	default GRKERNSEC_CUSTOM
++	kfree(alloc_stack[alloc_stack_next - 2]);
@@ -17973,9 +17644 @@
-+config GRKERNSEC_LOW
-+	bool "Low"
-+	select GRKERNSEC_LINK
-+	select GRKERNSEC_FIFO
-+	select GRKERNSEC_EXECVE
-+	select GRKERNSEC_RANDNET
-+	select GRKERNSEC_DMESG
-+	select GRKERNSEC_CHROOT_CHDIR
-+	select GRKERNSEC_MODSTOP if (MODULES)
++	alloc_stack_next--;
@@ -17983,8 +17646,2 @@
-+	help
-+	  If you choose this option, several of the grsecurity options will
-+	  be enabled that will give you greater protection against a number
-+	  of attacks, while assuring that none of your software will have any
-+	  conflicts with the additional security measures.  If you run a lot
-+	  of unusual software, or you are having problems with the higher
-+	  security levels, you should say Y here.  With this option, the
-+	  following features are enabled:
++	return 1;
++}
@@ -17992,6 +17649,5 @@
-+	  - Linking restrictions
-+	  - FIFO restrictions
-+	  - Enforcing RLIMIT_NPROC on execve
-+	  - Restricted dmesg
-+	  - Enforced chdir("/") on chroot
-+	  - Runtime module disabling
++static __inline__ void
++alloc_push(void *buf)
++{
++	if (alloc_stack_next >= alloc_stack_size)
++		BUG();
@@ -17999,30 +17655 @@
-+config GRKERNSEC_MEDIUM
-+	bool "Medium"
-+	select PAX
-+	select PAX_EI_PAX
-+	select PAX_PT_PAX_FLAGS
-+	select PAX_HAVE_ACL_FLAGS
-+	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
-+	select GRKERNSEC_CHROOT_SYSCTL
-+	select GRKERNSEC_LINK
-+	select GRKERNSEC_FIFO
-+	select GRKERNSEC_EXECVE
-+	select GRKERNSEC_DMESG
-+	select GRKERNSEC_RANDNET
-+	select GRKERNSEC_FORKFAIL
-+	select GRKERNSEC_TIME
-+	select GRKERNSEC_SIGNAL
-+	select GRKERNSEC_CHROOT
-+	select GRKERNSEC_CHROOT_UNIX
-+	select GRKERNSEC_CHROOT_MOUNT
-+	select GRKERNSEC_CHROOT_PIVOT
-+	select GRKERNSEC_CHROOT_DOUBLE
-+	select GRKERNSEC_CHROOT_CHDIR
-+	select GRKERNSEC_CHROOT_MKNOD
-+	select GRKERNSEC_PROC
-+	select GRKERNSEC_PROC_USERGROUP
-+	select GRKERNSEC_MODSTOP if (MODULES)
-+	select PAX_RANDUSTACK
-+	select PAX_ASLR
-+	select PAX_RANDMMAP
-+	select PAX_REFCOUNT
++	alloc_stack[alloc_stack_next - 1] = buf;
@@ -18030,9 +17657 @@
-+	help
-+	  If you say Y here, several features in addition to those included
-+	  in the low additional security level will be enabled.  These
-+	  features provide even more security to your system, though in rare
-+	  cases they may be incompatible with very old or poorly written
-+	  software.  If you enable this option, make sure that your auth
-+	  service (identd) is running as gid 1001.  With this option, 
-+	  the following features (in addition to those provided in the 
-+	  low additional security level) will be enabled:
++	alloc_stack_next++;
@@ -18040,12 +17659,2 @@
-+	  - Failed fork logging
-+	  - Time change logging
-+	  - Signal logging
-+	  - Deny mounts in chroot
-+	  - Deny double chrooting
-+	  - Deny sysctl writes in chroot
-+	  - Deny mknod in chroot
-+	  - Deny access to abstract AF_UNIX sockets out of chroot
-+	  - Deny pivot_root in chroot
-+	  - Denied writes of /dev/kmem, /dev/mem, and /dev/port
-+	  - /proc restrictions with special GID set to 10 (usually wheel)
-+	  - Address Space Layout Randomization (ASLR)
++	return;
++}
@@ -18053,67 +17662,4 @@
-+config GRKERNSEC_HIGH
-+	bool "High"
-+	select GRKERNSEC_LINK
-+	select GRKERNSEC_FIFO
-+	select GRKERNSEC_EXECVE
-+	select GRKERNSEC_DMESG
-+	select GRKERNSEC_FORKFAIL
-+	select GRKERNSEC_TIME
-+	select GRKERNSEC_SIGNAL
-+	select GRKERNSEC_CHROOT_SHMAT
-+	select GRKERNSEC_CHROOT_UNIX
-+	select GRKERNSEC_CHROOT_MOUNT
-+	select GRKERNSEC_CHROOT_FCHDIR
-+	select GRKERNSEC_CHROOT_PIVOT
-+	select GRKERNSEC_CHROOT_DOUBLE
-+	select GRKERNSEC_CHROOT_CHDIR
-+	select GRKERNSEC_CHROOT_MKNOD
-+	select GRKERNSEC_CHROOT_CAPS
-+	select GRKERNSEC_CHROOT_SYSCTL
-+	select GRKERNSEC_CHROOT_FINDTASK
-+	select GRKERNSEC_PROC
-+	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
-+	select GRKERNSEC_HIDESYM
-+	select GRKERNSEC_BRUTE
-+	select GRKERNSEC_PROC_USERGROUP
-+	select GRKERNSEC_KMEM
-+	select GRKERNSEC_RESLOG
-+	select GRKERNSEC_RANDNET
-+	select GRKERNSEC_PROC_ADD
-+	select GRKERNSEC_CHROOT_CHMOD
-+	select GRKERNSEC_CHROOT_NICE
-+	select GRKERNSEC_AUDIT_MOUNT
-+	select GRKERNSEC_MODSTOP if (MODULES)
-+	select PAX
-+	select PAX_RANDUSTACK
-+	select PAX_ASLR
-+	select PAX_RANDMMAP
-+	select PAX_NOEXEC
-+	select PAX_MPROTECT
-+	select PAX_EI_PAX
-+	select PAX_PT_PAX_FLAGS
-+	select PAX_HAVE_ACL_FLAGS
-+	select PAX_KERNEXEC if (X86 && !EFI && !COMPAT_VDSO && !PARAVIRT && (!X86_32 || X86_WP_WORKS_OK))
-+	select PAX_MEMORY_UDEREF if (!X86_64 && !COMPAT_VDSO)
-+	select PAX_RANDKSTACK if (X86_TSC && !X86_64)
-+	select PAX_SEGMEXEC if (X86 && !X86_64)
-+	select PAX_PAGEEXEC if (!X86)
-+	select PAX_EMUPLT if (ALPHA || PARISC || PPC32 || SPARC32 || SPARC64)
-+	select PAX_DLRESOLVE if (SPARC32 || SPARC64)
-+	select PAX_SYSCALL if (PPC32)
-+	select PAX_EMUTRAMP if (PARISC)
-+	select PAX_EMUSIGRT if (PARISC)
-+	select PAX_ETEXECRELOCS if (ALPHA || IA64 || PARISC)
-+	select PAX_REFCOUNT
-+	help
-+	  If you say Y here, many of the features of grsecurity will be
-+	  enabled, which will protect you against many kinds of attacks
-+	  against your system.  The heightened security comes at a cost
-+	  of an increased chance of incompatibilities with rare software
-+	  on your machine.  Since this security level enables PaX, you should
-+	  view <http://pax.grsecurity.net> and read about the PaX
-+	  project.  While you are there, download chpax and run it on
-+	  binaries that cause problems with PaX.  Also remember that
-+	  since the /proc restrictions are enabled, you must run your
-+	  identd as gid 1001.  This security level enables the following 
-+	  features in addition to those listed in the low and medium 
-+	  security levels:
++void *
++acl_alloc(unsigned long len)
++{
++	void *ret;
@@ -18121,22 +17667,2 @@
-+	  - Additional /proc restrictions
-+	  - Chmod restrictions in chroot
-+	  - No signals, ptrace, or viewing of processes outside of chroot
-+	  - Capability restrictions in chroot
-+	  - Deny fchdir out of chroot
-+	  - Priority restrictions in chroot
-+	  - Segmentation-based implementation of PaX
-+	  - Mprotect restrictions
-+	  - Removal of addresses from /proc/<pid>/[smaps|maps|stat]
-+	  - Kernel stack randomization
-+	  - Mount/unmount/remount logging
-+	  - Kernel symbol hiding
-+	  - Prevention of memory exhaustion-based exploits
-+config GRKERNSEC_CUSTOM
-+	bool "Custom"
-+	help
-+	  If you say Y here, you will be able to configure every grsecurity
-+	  option, which allows you to enable many more features that aren't
-+	  covered in the basic security levels.  These additional features
-+	  include TPE, socket restrictions, and the sysctl system for
-+	  grsecurity.  It is advised that you read through the help for
-+	  each option to determine its usefulness in your situation.
++	if (len > PAGE_SIZE)
++		BUG();
@@ -18144 +17670 @@
-+endchoice
++	ret = kmalloc(len, GFP_KERNEL);
@@ -18146,2 +17672,2 @@
-+menu "Address Space Protection"
-+depends on GRKERNSEC
++	if (ret)
++		alloc_push(ret);
@@ -18149,19 +17675,2 @@
-+config GRKERNSEC_KMEM
-+	bool "Deny writing to /dev/kmem, /dev/mem, and /dev/port"
-+	help
-+	  If you say Y here, /dev/kmem and /dev/mem won't be allowed to
-+	  be written to via mmap or otherwise to modify the running kernel.
-+	  /dev/port will also not be allowed to be opened. If you have module
-+	  support disabled, enabling this will close up four ways that are
-+	  currently used  to insert malicious code into the running kernel.
-+	  Even with all these features enabled, we still highly recommend that
-+	  you use the RBAC system, as it is still possible for an attacker to
-+	  modify the running kernel through privileged I/O granted by ioperm/iopl.
-+	  If you are not using XFree86, you may be able to stop this additional
-+	  case by enabling the 'Disable privileged I/O' option. Though nothing
-+	  legitimately writes to /dev/kmem, XFree86 does need to write to /dev/mem,
-+	  but only to video memory, which is the only writing we allow in this
-+	  case.  If /dev/kmem or /dev/mem are mmaped without PROT_WRITE, they will
-+	  not be allowed to mprotect it with PROT_WRITE later.
-+	  It is highly recommended that you say Y here if you meet all the
-+	  conditions above.
++	return ret;
++}
@@ -18169,15 +17678,5 @@
-+config GRKERNSEC_IO
-+	bool "Disable privileged I/O"
-+	depends on X86
-+	select RTC
-+	help
-+	  If you say Y here, all ioperm and iopl calls will return an error.
-+	  Ioperm and iopl can be used to modify the running kernel.
-+	  Unfortunately, some programs need this access to operate properly,
-+	  the most notable of which are XFree86 and hwclock.  hwclock can be
-+	  remedied by having RTC support in the kernel, so CONFIG_RTC is
-+	  enabled if this option is enabled, to ensure that hwclock operates
-+	  correctly.  XFree86 still will not operate correctly with this option
-+	  enabled, so DO NOT CHOOSE Y IF YOU USE XFree86.  If you use XFree86
-+	  and you still want to protect your kernel against modification,
-+	  use the RBAC system.
++void
++acl_free_all(void)
++{
++	if (gr_acl_is_enabled() || !alloc_stack)
++		return;
@@ -18185,22 +17684 @@
-+config GRKERNSEC_PROC_MEMMAP
-+	bool "Remove addresses from /proc/<pid>/[smaps|maps|stat]"
-+	depends on PAX_NOEXEC || PAX_ASLR
-+	help
-+	  If you say Y here, the /proc/<pid>/maps and /proc/<pid>/stat files will
-+	  give no information about the addresses of its mappings if
-+	  PaX features that rely on random addresses are enabled on the task.
-+	  If you use PaX it is greatly recommended that you say Y here as it
-+	  closes up a hole that makes the full ASLR useless for suid
-+	  binaries.
-+
-+config GRKERNSEC_BRUTE
-+	bool "Deter exploit bruteforcing"
-+	help
-+	  If you say Y here, attempts to bruteforce exploits against forking
-+	  daemons such as apache or sshd will be deterred.  When a child of a
-+	  forking daemon is killed by PaX or crashes due to an illegal
-+	  instruction, the parent process will be delayed 30 seconds upon every
-+	  subsequent fork until the administrator is able to assess the
-+	  situation and restart the daemon.  It is recommended that you also
-+	  enable signal logging in the auditing section so that logs are
-+	  generated when a process performs an illegal instruction.
++	while (alloc_pop()) ;
@@ -18208,17 +17686,6 @@
-+config GRKERNSEC_MODSTOP
-+	bool "Runtime module disabling"
-+	depends on MODULES
-+	help
-+	  If you say Y here, you will be able to disable the ability to (un)load
-+	  modules at runtime.  This feature is useful if you need the ability
-+	  to load kernel modules at boot time, but do not want to allow an
-+	  attacker to load a rootkit kernel module into the system, or to remove
-+	  a loaded kernel module important to system functioning.  You should
-+	  enable the /dev/mem protection feature as well, since rootkits can be
-+	  inserted into the kernel via other methods than kernel modules.  Since
-+	  an untrusted module could still be loaded by modifying init scripts and
-+	  rebooting the system, it is also recommended that you enable the RBAC
-+	  system.  If you enable this option, a sysctl option with name
-+	  "disable_modules" will be created.  Setting this option to "1" disables
-+	  module loading.  After this option is set, no further writes to it are
-+	  allowed until the system is rebooted.
++	if (alloc_stack) {
++		if ((alloc_stack_size * sizeof (void *)) <= PAGE_SIZE)
++			kfree(alloc_stack);
++		else
++			vfree(alloc_stack);
++	}
@@ -18226,15 +17693,3 @@
-+config GRKERNSEC_HIDESYM
-+	bool "Hide kernel symbols"
-+	help
-+	  If you say Y here, getting information on loaded modules, and
-+	  displaying all kernel symbols through a syscall will be restricted
-+	  to users with CAP_SYS_MODULE.  This option is only effective
-+	  provided the following conditions are met:
-+	  1) The kernel using grsecurity is not precompiled by some distribution
-+	  2) You are using the RBAC system and hiding other files such as your
-+	     kernel image and System.map
-+	  3) You have the additional /proc restrictions enabled, which removes
-+	     /proc/kcore
-+	  If the above conditions are met, this option will aid to provide a
-+	  useful protection against local and remote kernel exploitation of
-+	  overflows and arbitrary read/write vulnerabilities.
++	alloc_stack = NULL;
++	alloc_stack_size = 1;
++	alloc_stack_next = 1;
@@ -18242,3 +17697,2 @@
-+endmenu
-+menu "Role Based Access Control Options"
-+depends on GRKERNSEC
++	return;
++}
@@ -18246,6 +17700,8 @@
-+config GRKERNSEC_ACL_HIDEKERN
-+	bool "Hide kernel processes"
-+	help
-+	  If you say Y here, all kernel threads will be hidden to all
-+	  processes but those whose subject has the "view hidden processes"
-+	  flag.
++int
++acl_alloc_stack_init(unsigned long size)
++{
++	if ((size * sizeof (void *)) <= PAGE_SIZE)
++		alloc_stack =
++		    (void **) kmalloc(size * sizeof (void *), GFP_KERNEL);
++	else
++		alloc_stack = (void **) vmalloc(size * sizeof (void *));
@@ -18253,8 +17709 @@
-+config GRKERNSEC_ACL_MAXTRIES
-+	int "Maximum tries before password lockout"
-+	default 3
-+	help
-+	  This option enforces the maximum number of times a user can attempt
-+	  to authorize themselves with the grsecurity RBAC system before being
-+	  denied the ability to attempt authorization again for a specified time.
-+	  The lower the number, the harder it will be to brute-force a password.
++	alloc_stack_size = size;
@@ -18262,8 +17711,33 @@
-+config GRKERNSEC_ACL_TIMEOUT
-+	int "Time to wait after max password tries, in seconds"
-+	default 30
-+	help
-+	  This option specifies the time the user must wait after attempting to
-+	  authorize to the RBAC system with the maximum number of invalid
-+	  passwords.  The higher the number, the harder it will be to brute-force
-+	  a password.
++	if (!alloc_stack)
++		return 0;
++	else
++		return 1;
++}
+diff -urNp linux-2.6.26.6/grsecurity/gracl.c linux-2.6.26.6/grsecurity/gracl.c
+--- linux-2.6.26.6/grsecurity/gracl.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,3722 @@
++#include <linux/kernel.h>
++#include <linux/module.h>
++#include <linux/sched.h>
++#include <linux/mm.h>
++#include <linux/file.h>
++#include <linux/fs.h>
++#include <linux/namei.h>
++#include <linux/mount.h>
++#include <linux/tty.h>
++#include <linux/proc_fs.h>
++#include <linux/smp_lock.h>
++#include <linux/slab.h>
++#include <linux/vmalloc.h>
++#include <linux/types.h>
++#include <linux/sysctl.h>
++#include <linux/netdevice.h>
++#include <linux/ptrace.h>
++#include <linux/gracl.h>
++#include <linux/gralloc.h>
++#include <linux/grsecurity.h>
++#include <linux/grinternal.h>
++#include <linux/pid_namespace.h>
++#include <linux/fdtable.h>
++#include <linux/percpu.h>
@@ -18271,3 +17745,3 @@
-+endmenu
-+menu "Filesystem Protections"
-+depends on GRKERNSEC
++#include <asm/uaccess.h>
++#include <asm/errno.h>
++#include <asm/mman.h>
@@ -18275,11 +17749,3 @@
-+config GRKERNSEC_PROC
-+	bool "Proc restrictions"
-+	help
-+	  If you say Y here, the permissions of the /proc filesystem
-+	  will be altered to enhance system security and privacy.  You MUST
-+  	  choose either a user only restriction or a user and group restriction.
-+	  Depending upon the option you choose, you can either restrict users to
-+	  see only the processes they themselves run, or choose a group that can
-+	  view all processes and files normally restricted to root if you choose
-+	  the "restrict to user only" option.  NOTE: If you're running identd as
-+	  a non-root user, you will have to run it as the group you specify here.
++static struct acl_role_db acl_role_set;
++static struct name_db name_set;
++static struct inodev_db inodev_set;
@@ -18287,7 +17753,3 @@
-+config GRKERNSEC_PROC_USER
-+	bool "Restrict /proc to user only"
-+	depends on GRKERNSEC_PROC
-+	help
-+	  If you say Y here, non-root users will only be able to view their own
-+	  processes, and restricts them from viewing network-related information,
-+	  and viewing kernel symbol and module information.
++/* for keeping track of userspace pointers used for subjects, so we
++   can share references in the kernel as well
++*/
@@ -18295,8 +17757,2 @@
-+config GRKERNSEC_PROC_USERGROUP
-+	bool "Allow special group"
-+	depends on GRKERNSEC_PROC && !GRKERNSEC_PROC_USER
-+	help
-+	  If you say Y here, you will be able to select a group that will be
-+	  able to view all processes, network-related information, and
-+	  kernel and symbol information.  This option is useful if you want
-+	  to run identd as a non-root user.
++static struct dentry *real_root;
++static struct vfsmount *real_root_mnt;
@@ -18304,4 +17760 @@
-+config GRKERNSEC_PROC_GID
-+	int "GID for special group"
-+	depends on GRKERNSEC_PROC_USERGROUP
-+	default 1001
++static struct acl_subj_map_db subj_map_set;
@@ -18309,7 +17762 @@
-+config GRKERNSEC_PROC_ADD
-+	bool "Additional restrictions"
-+	depends on GRKERNSEC_PROC_USER || GRKERNSEC_PROC_USERGROUP
-+	help
-+	  If you say Y here, additional restrictions will be placed on
-+	  /proc that keep normal users from viewing device information and 
-+	  slabinfo information that could be useful for exploits.
++static struct acl_role_label *default_role;
@@ -18317,9 +17764 @@
-+config GRKERNSEC_LINK
-+	bool "Linking restrictions"
-+	help
-+	  If you say Y here, /tmp race exploits will be prevented, since users
-+	  will no longer be able to follow symlinks owned by other users in
-+	  world-writable +t directories (i.e. /tmp), unless the owner of the
-+	  symlink is the owner of the directory. users will also not be
-+	  able to hardlink to files they do not own.  If the sysctl option is
-+	  enabled, a sysctl option with name "linking_restrictions" is created.
++static u16 acl_sp_role_value;
@@ -18327,8 +17766,3 @@
-+config GRKERNSEC_FIFO
-+	bool "FIFO restrictions"
-+	help
-+	  If you say Y here, users will not be able to write to FIFOs they don't
-+	  own in world-writable +t directories (i.e. /tmp), unless the owner of
-+	  the FIFO is the same owner of the directory it's held in.  If the sysctl
-+	  option is enabled, a sysctl option with name "fifo_restrictions" is
-+	  created.
++extern char *gr_shared_page[4];
++static DECLARE_MUTEX(gr_dev_sem);
++DEFINE_RWLOCK(gr_inode_lock);
@@ -18336,7 +17770 @@
-+config GRKERNSEC_CHROOT
-+	bool "Chroot jail restrictions"
-+	help
-+	  If you say Y here, you will be able to choose several options that will
-+	  make breaking out of a chrooted jail much more difficult.  If you
-+	  encounter no software incompatibilities with the following options, it
-+	  is recommended that you enable each one.
++struct gr_arg *gr_usermode;
@@ -18344,7 +17772 @@
-+config GRKERNSEC_CHROOT_MOUNT
-+	bool "Deny mounts"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to
-+	  mount or remount filesystems.  If the sysctl option is enabled, a
-+	  sysctl option with name "chroot_deny_mount" is created.
++static unsigned int gr_status = GR_STATUS_INIT;
@@ -18352,9 +17774,2 @@
-+config GRKERNSEC_CHROOT_DOUBLE
-+	bool "Deny double-chroots"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to chroot
-+	  again outside the chroot.  This is a widely used method of breaking
-+	  out of a chroot jail and should not be allowed.  If the sysctl 
-+	  option is enabled, a sysctl option with name 
-+	  "chroot_deny_chroot" is created.
++extern int chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum);
++extern void gr_clear_learn_entries(void);
@@ -18362,11 +17777,4 @@
-+config GRKERNSEC_CHROOT_PIVOT
-+	bool "Deny pivot_root in chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to use
-+	  a function called pivot_root() that was introduced in Linux 2.3.41.  It
-+	  works similar to chroot in that it changes the root filesystem.  This
-+	  function could be misused in a chrooted process to attempt to break out
-+	  of the chroot, and therefore should not be allowed.  If the sysctl
-+	  option is enabled, a sysctl option with name "chroot_deny_pivot" is
-+	  created.
++#ifdef CONFIG_GRKERNSEC_RESLOG
++extern void gr_log_resource(const struct task_struct *task,
++			    const int res, const unsigned long wanted, const int gt);
++#endif
@@ -18374,11 +17782,2 @@
-+config GRKERNSEC_CHROOT_CHDIR
-+	bool "Enforce chdir(\"/\") on all chroots"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, the current working directory of all newly-chrooted
-+	  applications will be set to the the root directory of the chroot.
-+	  The man page on chroot(2) states:
-+	  Note that this call does not change  the  current  working
-+	  directory,  so  that `.' can be outside the tree rooted at
-+	  `/'.  In particular, the  super-user  can  escape  from  a
-+	  `chroot jail' by doing `mkdir foo; chroot foo; cd ..'.
++unsigned char *gr_system_salt;
++unsigned char *gr_system_sum;
@@ -18386,3 +17785,2 @@
-+	  It is recommended that you say Y here, since it's not known to break
-+	  any software.  If the sysctl option is enabled, a sysctl option with
-+	  name "chroot_enforce_chdir" is created.
++static struct sprole_pw **acl_special_roles = NULL;
++static __u16 num_sprole_pws = 0;
@@ -18390,9 +17788 @@
-+config GRKERNSEC_CHROOT_CHMOD
-+	bool "Deny (f)chmod +s"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to chmod
-+	  or fchmod files to make them have suid or sgid bits.  This protects
-+	  against another published method of breaking a chroot.  If the sysctl
-+	  option is enabled, a sysctl option with name "chroot_deny_chmod" is
-+	  created.
++static struct acl_role_label *kernel_role = NULL;
@@ -18400,8 +17790,2 @@
-+config GRKERNSEC_CHROOT_FCHDIR
-+	bool "Deny fchdir out of chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, a well-known method of breaking chroots by fchdir'ing
-+	  to a file descriptor of the chrooting process that points to a directory
-+	  outside the filesystem will be stopped.  If the sysctl option
-+	  is enabled, a sysctl option with name "chroot_deny_fchdir" is created.
++static unsigned int gr_auth_attempts = 0;
++static unsigned long gr_auth_expires = 0UL;
@@ -18409,13 +17793,4 @@
-+config GRKERNSEC_CHROOT_MKNOD
-+	bool "Deny mknod"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be allowed to
-+	  mknod.  The problem with using mknod inside a chroot is that it
-+	  would allow an attacker to create a device entry that is the same
-+	  as one on the physical root of your system, which could range from
-+	  anything from the console device to a device for your harddrive (which
-+	  they could then use to wipe the drive or steal data).  It is recommended
-+	  that you say Y here, unless you run into software incompatibilities.
-+	  If the sysctl option is enabled, a sysctl option with name
-+	  "chroot_deny_mknod" is created.
++extern struct vfsmount *sock_mnt;
++extern struct vfsmount *pipe_mnt;
++extern struct vfsmount *shm_mnt;
++static struct acl_object_label *fakefs_obj;
@@ -18423,8 +17798,4 @@
-+config GRKERNSEC_CHROOT_SHMAT
-+	bool "Deny shmat() out of chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to attach
-+	  to shared memory segments that were created outside of the chroot jail.
-+	  It is recommended that you say Y here.  If the sysctl option is enabled,
-+	  a sysctl option with name "chroot_deny_shmat" is created.
++extern int gr_init_uidset(void);
++extern void gr_free_uidset(void);
++extern void gr_remove_uid(uid_t uid);
++extern int gr_find_uid(uid_t uid);
@@ -18432,9 +17803,5 @@
-+config GRKERNSEC_CHROOT_UNIX
-+	bool "Deny access to abstract AF_UNIX sockets out of chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to
-+	  connect to abstract (meaning not belonging to a filesystem) Unix
-+	  domain sockets that were bound outside of a chroot.  It is recommended
-+	  that you say Y here.  If the sysctl option is enabled, a sysctl option
-+	  with name "chroot_deny_unix" is created.
++__inline__ int
++gr_acl_is_enabled(void)
++{
++	return (gr_status & GR_READY);
++}
@@ -18442,9 +17809,14 @@
-+config GRKERNSEC_CHROOT_FINDTASK
-+	bool "Protect outside processes"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to
-+	  kill, send signals with fcntl, ptrace, capget, getpgid, getsid,
-+	  or view any process outside of the chroot.  If the sysctl
-+	  option is enabled, a sysctl option with name "chroot_findtask" is
-+	  created.
++char gr_roletype_to_char(void)
++{
++	switch (current->role->roletype &
++		(GR_ROLE_DEFAULT | GR_ROLE_USER | GR_ROLE_GROUP |
++		 GR_ROLE_SPECIAL)) {
++	case GR_ROLE_DEFAULT:
++		return 'D';
++	case GR_ROLE_USER:
++		return 'U';
++	case GR_ROLE_GROUP:
++		return 'G';
++	case GR_ROLE_SPECIAL:
++		return 'S';
++	}
@@ -18452,10 +17824,2 @@
-+config GRKERNSEC_CHROOT_NICE
-+	bool "Restrict priority changes"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to raise
-+	  the priority of processes in the chroot, or alter the priority of
-+	  processes outside the chroot.  This provides more security than simply
-+	  removing CAP_SYS_NICE from the process' capability set.  If the
-+	  sysctl option is enabled, a sysctl option with name "chroot_restrict_nice"
-+	  is created.
++	return 'X';
++}
@@ -18463,9 +17827,10 @@
-+config GRKERNSEC_CHROOT_SYSCTL
-+	bool "Deny sysctl writes"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, an attacker in a chroot will not be able to
-+	  write to sysctl entries, either by sysctl(2) or through a /proc
-+	  interface.  It is strongly recommended that you say Y here. If the
-+	  sysctl option is enabled, a sysctl option with name
-+	  "chroot_deny_sysctl" is created.
++__inline__ int
++gr_acl_tpe_check(void)
++{
++	if (unlikely(!(gr_status & GR_READY)))
++		return 0;
++	if (current->role->roletype & GR_ROLE_TPE)
++		return 1;
++	else
++		return 0;
++}
@@ -18473,12 +17838,11 @@
-+config GRKERNSEC_CHROOT_CAPS
-+	bool "Capability restrictions"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, the capabilities on all root processes within a
-+	  chroot jail will be lowered to stop module insertion, raw i/o,
-+	  system and net admin tasks, rebooting the system, modifying immutable
-+	  files, modifying IPC owned by another, and changing the system time.
-+	  This is left an option because it can break some apps.  Disable this
-+	  if your chrooted apps are having problems performing those kinds of
-+	  tasks.  If the sysctl option is enabled, a sysctl option with
-+	  name "chroot_caps" is created.
++int
++gr_handle_rawio(const struct inode *inode)
++{
++#ifdef CONFIG_GRKERNSEC_CHROOT_CAPS
++	if (inode && S_ISBLK(inode->i_mode) &&
++	    grsec_enable_chroot_caps && proc_is_chrooted(current) &&
++	    !capable(CAP_SYS_RAWIO))
++		return 1;
++#endif
++	return 0;
++}
@@ -18486,3 +17850,9 @@
-+endmenu
-+menu "Kernel Auditing"
-+depends on GRKERNSEC
++static int
++gr_streq(const char *a, const char *b, const unsigned int lena, const unsigned int lenb)
++{
++	int i;
++	unsigned long *l1;
++	unsigned long *l2;
++	unsigned char *c1;
++	unsigned char *c2;
++	int num_longs;
@@ -18490,8 +17860,2 @@
-+config GRKERNSEC_AUDIT_GROUP
-+	bool "Single group for auditing"
-+	help
-+	  If you say Y here, the exec, chdir, (un)mount, and ipc logging features
-+	  will only operate on a group you specify.  This option is recommended
-+	  if you only want to watch certain users instead of having a large
-+	  amount of logs from the entire system.  If the sysctl option is enabled,
-+	  a sysctl option with name "audit_group" is created.
++	if (likely(lena != lenb))
++		return 0;
@@ -18499,4 +17863,2 @@
-+config GRKERNSEC_AUDIT_GID
-+	int "GID for auditing"
-+	depends on GRKERNSEC_AUDIT_GROUP
-+	default 1007
++	l1 = (unsigned long *)a;
++	l2 = (unsigned long *)b;
@@ -18504,10 +17866 @@
-+config GRKERNSEC_EXECLOG
-+	bool "Exec logging"
-+	help
-+	  If you say Y here, all execve() calls will be logged (since the
-+	  other exec*() calls are frontends to execve(), all execution
-+	  will be logged).  Useful for shell-servers that like to keep track
-+	  of their users.  If the sysctl option is enabled, a sysctl option with
-+	  name "exec_logging" is created.
-+	  WARNING: This option when enabled will produce a LOT of logs, especially
-+	  on an active system.
++	num_longs = lena / sizeof(unsigned long);
@@ -18515,8 +17868,4 @@
-+config GRKERNSEC_RESLOG
-+	bool "Resource logging"
-+	help
-+	  If you say Y here, all attempts to overstep resource limits will
-+	  be logged with the resource name, the requested size, and the current
-+	  limit.  It is highly recommended that you say Y here.  If the sysctl
-+	  option is enabled, a sysctl option with name "resource_logging" is
-+	  created.  If the RBAC system is enabled, the sysctl value is ignored.
++	for (i = num_longs; i--; l1++, l2++) {
++		if (unlikely(*l1 != *l2))
++			return 0;
++	}
@@ -18524,8 +17873,2 @@
-+config GRKERNSEC_CHROOT_EXECLOG
-+	bool "Log execs within chroot"
-+	help
-+	  If you say Y here, all executions inside a chroot jail will be logged
-+	  to syslog.  This can cause a large amount of logs if certain
-+	  applications (eg. djb's daemontools) are installed on the system, and
-+	  is therefore left as an option.  If the sysctl option is enabled, a
-+	  sysctl option with name "chroot_execlog" is created.
++	c1 = (unsigned char *) l1;
++	c2 = (unsigned char *) l2;
@@ -18533,5 +17876 @@
-+config GRKERNSEC_AUDIT_CHDIR
-+	bool "Chdir logging"
-+	help
-+	  If you say Y here, all chdir() calls will be logged.  If the sysctl
-+ 	  option is enabled, a sysctl option with name "audit_chdir" is created.
++	i = lena - (num_longs * sizeof(unsigned long));	
@@ -18539,6 +17878,4 @@
-+config GRKERNSEC_AUDIT_MOUNT
-+	bool "(Un)Mount logging"
-+	help
-+	  If you say Y here, all mounts and unmounts will be logged.  If the
-+	  sysctl option is enabled, a sysctl option with name "audit_mount" is
-+	  created.
++	for (; i--; c1++, c2++) {
++		if (unlikely(*c1 != *c2))
++			return 0;
++	}
@@ -18546,6 +17883,2 @@
-+config GRKERNSEC_AUDIT_IPC
-+	bool "IPC logging"
-+	help
-+	  If you say Y here, creation and removal of message queues, semaphores,
-+	  and shared memory will be logged.  If the sysctl option is enabled, a
-+	  sysctl option with name "audit_ipc" is created.
++	return 1;
++}
@@ -18553,8 +17886,7 @@
-+config GRKERNSEC_SIGNAL
-+	bool "Signal logging"
-+	help
-+	  If you say Y here, certain important signals will be logged, such as
-+	  SIGSEGV, which will as a result inform you of when a error in a program
-+	  occurred, which in some cases could mean a possible exploit attempt.
-+	  If the sysctl option is enabled, a sysctl option with name
-+	  "signal_logging" is created.
++static char * __our_d_path(struct dentry *dentry, struct vfsmount *vfsmnt,
++	                   struct dentry *root, struct vfsmount *rootmnt,
++			   char *buffer, int buflen)
++{
++	char * end = buffer+buflen;
++	char * retval;
++	int namelen;
@@ -18562,458 +17894,2 @@
-+config GRKERNSEC_FORKFAIL
-+	bool "Fork failure logging"
-+	help
-+	  If you say Y here, all failed fork() attempts will be logged.
-+	  This could suggest a fork bomb, or someone attempting to overstep
-+	  their process limit.  If the sysctl option is enabled, a sysctl option
-+	  with name "forkfail_logging" is created.
-+
-+config GRKERNSEC_TIME
-+	bool "Time change logging"
-+	help
-+	  If you say Y here, any changes of the system clock will be logged.
-+	  If the sysctl option is enabled, a sysctl option with name
-+	  "timechange_logging" is created.
-+
-+config GRKERNSEC_PROC_IPADDR
-+	bool "/proc/<pid>/ipaddr support"
-+	help
-+	  If you say Y here, a new entry will be added to each /proc/<pid>
-+	  directory that contains the IP address of the person using the task.
-+	  The IP is carried across local TCP and AF_UNIX stream sockets.
-+	  This information can be useful for IDS/IPSes to perform remote response
-+	  to a local attack.  The entry is readable by only the owner of the
-+	  process (and root if he has CAP_DAC_OVERRIDE, which can be removed via
-+	  the RBAC system), and thus does not create privacy concerns.
-+
-+config GRKERNSEC_AUDIT_TEXTREL
-+	bool 'ELF text relocations logging (READ HELP)'
-+	depends on PAX_MPROTECT
-+	help
-+	  If you say Y here, text relocations will be logged with the filename
-+	  of the offending library or binary.  The purpose of the feature is
-+	  to help Linux distribution developers get rid of libraries and
-+	  binaries that need text relocations which hinder the future progress
-+	  of PaX.  Only Linux distribution developers should say Y here, and
-+	  never on a production machine, as this option creates an information
-+	  leak that could aid an attacker in defeating the randomization of
-+	  a single memory region.  If the sysctl option is enabled, a sysctl
-+	  option with name "audit_textrel" is created.
-+
-+endmenu
-+
-+menu "Executable Protections"
-+depends on GRKERNSEC
-+
-+config GRKERNSEC_EXECVE
-+	bool "Enforce RLIMIT_NPROC on execs"
-+	help
-+	  If you say Y here, users with a resource limit on processes will
-+	  have the value checked during execve() calls.  The current system
-+	  only checks the system limit during fork() calls.  If the sysctl option
-+	  is enabled, a sysctl option with name "execve_limiting" is created.
-+
-+config GRKERNSEC_DMESG
-+	bool "Dmesg(8) restriction"
-+	help
-+	  If you say Y here, non-root users will not be able to use dmesg(8)
-+	  to view up to the last 4kb of messages in the kernel's log buffer.
-+	  If the sysctl option is enabled, a sysctl option with name "dmesg" is
-+	  created.
-+
-+config GRKERNSEC_TPE
-+	bool "Trusted Path Execution (TPE)"
-+	help
-+	  If you say Y here, you will be able to choose a gid to add to the
-+	  supplementary groups of users you want to mark as "untrusted."
-+	  These users will not be able to execute any files that are not in
-+	  root-owned directories writable only by root.  If the sysctl option
-+	  is enabled, a sysctl option with name "tpe" is created.
-+
-+config GRKERNSEC_TPE_ALL
-+	bool "Partially restrict non-root users"
-+	depends on GRKERNSEC_TPE
-+	help
-+	  If you say Y here, All non-root users other than the ones in the
-+	  group specified in the main TPE option will only be allowed to
-+	  execute files in directories they own that are not group or
-+	  world-writable, or in directories owned by root and writable only by
-+	  root.  If the sysctl option is enabled, a sysctl option with name
-+	  "tpe_restrict_all" is created.
-+
-+config GRKERNSEC_TPE_INVERT
-+	bool "Invert GID option"
-+	depends on GRKERNSEC_TPE
-+	help
-+	  If you say Y here, the group you specify in the TPE configuration will
-+	  decide what group TPE restrictions will be *disabled* for.  This
-+	  option is useful if you want TPE restrictions to be applied to most
-+	  users on the system.
-+
-+config GRKERNSEC_TPE_GID
-+	int "GID for untrusted users"
-+	depends on GRKERNSEC_TPE && !GRKERNSEC_TPE_INVERT
-+	default 1005
-+	help
-+	  If you have selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *disabled* for.
-+	  If you have not selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *enabled* for.
-+	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
-+	  is created.
-+
-+config GRKERNSEC_TPE_GID
-+	int "GID for trusted users"
-+	depends on GRKERNSEC_TPE && GRKERNSEC_TPE_INVERT
-+	default 1005
-+	help
-+	  If you have selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *disabled* for.
-+	  If you have not selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *enabled* for.
-+	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
-+	  is created.
-+
-+endmenu
-+menu "Network Protections"
-+depends on GRKERNSEC
-+
-+config GRKERNSEC_RANDNET
-+	bool "Larger entropy pools"
-+	help
-+	  If you say Y here, the entropy pools used for many features of Linux
-+	  and grsecurity will be doubled in size.  Since several grsecurity
-+	  features use additional randomness, it is recommended that you say Y
-+	  here.  Saying Y here has a similar effect as modifying
-+	  /proc/sys/kernel/random/poolsize.
-+
-+config GRKERNSEC_SOCKET
-+	bool "Socket restrictions"
-+	help
-+	  If you say Y here, you will be able to choose from several options.
-+	  If you assign a GID on your system and add it to the supplementary
-+	  groups of users you want to restrict socket access to, this patch
-+	  will perform up to three things, based on the option(s) you choose.
-+
-+config GRKERNSEC_SOCKET_ALL
-+	bool "Deny any sockets to group"
-+	depends on GRKERNSEC_SOCKET
-+	help
-+	  If you say Y here, you will be able to choose a GID of whose users will
-+	  be unable to connect to other hosts from your machine or run server
-+	  applications from your machine.  If the sysctl option is enabled, a
-+	  sysctl option with name "socket_all" is created.
-+
-+config GRKERNSEC_SOCKET_ALL_GID
-+	int "GID to deny all sockets for"
-+	depends on GRKERNSEC_SOCKET_ALL
-+	default 1004
-+	help
-+	  Here you can choose the GID to disable socket access for. Remember to
-+	  add the users you want socket access disabled for to the GID
-+	  specified here.  If the sysctl option is enabled, a sysctl option
-+	  with name "socket_all_gid" is created.
-+
-+config GRKERNSEC_SOCKET_CLIENT
-+	bool "Deny client sockets to group"
-+	depends on GRKERNSEC_SOCKET
-+	help
-+	  If you say Y here, you will be able to choose a GID of whose users will
-+	  be unable to connect to other hosts from your machine, but will be
-+	  able to run servers.  If this option is enabled, all users in the group
-+	  you specify will have to use passive mode when initiating ftp transfers
-+	  from the shell on your machine.  If the sysctl option is enabled, a
-+	  sysctl option with name "socket_client" is created.
-+
-+config GRKERNSEC_SOCKET_CLIENT_GID
-+	int "GID to deny client sockets for"
-+	depends on GRKERNSEC_SOCKET_CLIENT
-+	default 1003
-+	help
-+	  Here you can choose the GID to disable client socket access for.
-+	  Remember to add the users you want client socket access disabled for to
-+	  the GID specified here.  If the sysctl option is enabled, a sysctl
-+	  option with name "socket_client_gid" is created.
-+
-+config GRKERNSEC_SOCKET_SERVER
-+	bool "Deny server sockets to group"
-+	depends on GRKERNSEC_SOCKET
-+	help
-+	  If you say Y here, you will be able to choose a GID of whose users will
-+	  be unable to run server applications from your machine.  If the sysctl
-+	  option is enabled, a sysctl option with name "socket_server" is created.
-+
-+config GRKERNSEC_SOCKET_SERVER_GID
-+	int "GID to deny server sockets for"
-+	depends on GRKERNSEC_SOCKET_SERVER
-+	default 1002
-+	help
-+	  Here you can choose the GID to disable server socket access for.
-+	  Remember to add the users you want server socket access disabled for to
-+	  the GID specified here.  If the sysctl option is enabled, a sysctl
-+	  option with name "socket_server_gid" is created.
-+
-+endmenu
-+menu "Sysctl support"
-+depends on GRKERNSEC && SYSCTL
-+
-+config GRKERNSEC_SYSCTL
-+	bool "Sysctl support"
-+	help
-+	  If you say Y here, you will be able to change the options that
-+	  grsecurity runs with at bootup, without having to recompile your
-+	  kernel.  You can echo values to files in /proc/sys/kernel/grsecurity
-+	  to enable (1) or disable (0) various features.  All the sysctl entries
-+	  are mutable until the "grsec_lock" entry is set to a non-zero value.
-+	  All features enabled in the kernel configuration are disabled at boot
-+	  if you do not say Y to the "Turn on features by default" option.
-+	  All options should be set at startup, and the grsec_lock entry should
-+	  be set to a non-zero value after all the options are set.
-+	  *THIS IS EXTREMELY IMPORTANT*
-+
-+config GRKERNSEC_SYSCTL_ON
-+	bool "Turn on features by default"
-+	depends on GRKERNSEC_SYSCTL
-+	help
-+	  If you say Y here, instead of having all features enabled in the
-+	  kernel configuration disabled at boot time, the features will be
-+	  enabled at boot time.  It is recommended you say Y here unless
-+	  there is some reason you would want all sysctl-tunable features to
-+	  be disabled by default.  As mentioned elsewhere, it is important
-+	  to enable the grsec_lock entry once you have finished modifying
-+	  the sysctl entries.
-+
-+endmenu
-+menu "Logging Options"
-+depends on GRKERNSEC
-+
-+config GRKERNSEC_FLOODTIME
-+	int "Seconds in between log messages (minimum)"
-+	default 10
-+	help
-+	  This option allows you to enforce the number of seconds between
-+	  grsecurity log messages.  The default should be suitable for most
-+	  people, however, if you choose to change it, choose a value small enough
-+	  to allow informative logs to be produced, but large enough to
-+	  prevent flooding.
-+
-+config GRKERNSEC_FLOODBURST
-+	int "Number of messages in a burst (maximum)"
-+	default 4
-+	help
-+	  This option allows you to choose the maximum number of messages allowed
-+	  within the flood time interval you chose in a separate option.  The
-+	  default should be suitable for most people, however if you find that
-+	  many of your logs are being interpreted as flooding, you may want to
-+	  raise this value.
-+
-+endmenu
-+
-+endmenu
-diff --git a/grsecurity/Makefile b/grsecurity/Makefile
-new file mode 100644
-index 0000000000000000000000000000000000000000..6769e8568c521caec84b835d9ff1a5ffddd8d1b6
---- /dev/null
-+++ b/grsecurity/Makefile
-@@ -0,0 +1,20 @@
-+# grsecurity's ACL system was originally written in 2001 by Michael Dalton
-+# during 2001-2005 it has been completely redesigned by Brad Spengler
-+# into an RBAC system
-+#
-+# All code in this directory and various hooks inserted throughout the kernel
-+# are copyright Brad Spengler, and released under the GPL v2 or higher
-+
-+obj-y = grsec_chdir.o grsec_chroot.o grsec_exec.o grsec_fifo.o grsec_fork.o \
-+	grsec_mount.o grsec_sig.o grsec_sock.o grsec_sysctl.o \
-+	grsec_time.o grsec_tpe.o grsec_ipc.o grsec_link.o grsec_textrel.o
-+
-+obj-$(CONFIG_GRKERNSEC) += grsec_init.o grsum.o gracl.o gracl_ip.o gracl_segv.o \
-+	gracl_cap.o gracl_alloc.o gracl_shm.o grsec_mem.o gracl_fs.o \
-+	gracl_learn.o grsec_log.o
-+obj-$(CONFIG_GRKERNSEC_RESLOG) += gracl_res.o
-+
-+ifndef CONFIG_GRKERNSEC
-+obj-y += grsec_disabled.o
-+endif
-+
-diff --git a/grsecurity/gracl.c b/grsecurity/gracl.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..bd7cfd8b97e79f094480e12c90ca2ef0bbda0b51
---- /dev/null
-+++ b/grsecurity/gracl.c
-@@ -0,0 +1,3722 @@
-+#include <linux/kernel.h>
-+#include <linux/module.h>
-+#include <linux/sched.h>
-+#include <linux/mm.h>
-+#include <linux/file.h>
-+#include <linux/fs.h>
-+#include <linux/namei.h>
-+#include <linux/mount.h>
-+#include <linux/tty.h>
-+#include <linux/proc_fs.h>
-+#include <linux/smp_lock.h>
-+#include <linux/slab.h>
-+#include <linux/vmalloc.h>
-+#include <linux/types.h>
-+#include <linux/sysctl.h>
-+#include <linux/netdevice.h>
-+#include <linux/ptrace.h>
-+#include <linux/gracl.h>
-+#include <linux/gralloc.h>
-+#include <linux/grsecurity.h>
-+#include <linux/grinternal.h>
-+#include <linux/pid_namespace.h>
-+#include <linux/fdtable.h>
-+#include <linux/percpu.h>
-+
-+#include <asm/uaccess.h>
-+#include <asm/errno.h>
-+#include <asm/mman.h>
-+
-+static struct acl_role_db acl_role_set;
-+static struct name_db name_set;
-+static struct inodev_db inodev_set;
-+
-+/* for keeping track of userspace pointers used for subjects, so we
-+   can share references in the kernel as well
-+*/
-+
-+static struct dentry *real_root;
-+static struct vfsmount *real_root_mnt;
-+
-+static struct acl_subj_map_db subj_map_set;
-+
-+static struct acl_role_label *default_role;
-+
-+static u16 acl_sp_role_value;
-+
-+extern char *gr_shared_page[4];
-+static DECLARE_MUTEX(gr_dev_sem);
-+DEFINE_RWLOCK(gr_inode_lock);
-+
-+struct gr_arg *gr_usermode;
-+
-+static unsigned int gr_status = GR_STATUS_INIT;
-+
-+extern int chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum);
-+extern void gr_clear_learn_entries(void);
-+
-+#ifdef CONFIG_GRKERNSEC_RESLOG
-+extern void gr_log_resource(const struct task_struct *task,
-+			    const int res, const unsigned long wanted, const int gt);
-+#endif
-+
-+unsigned char *gr_system_salt;
-+unsigned char *gr_system_sum;
-+
-+static struct sprole_pw **acl_special_roles = NULL;
-+static __u16 num_sprole_pws = 0;
-+
-+static struct acl_role_label *kernel_role = NULL;
-+
-+static unsigned int gr_auth_attempts = 0;
-+static unsigned long gr_auth_expires = 0UL;
-+
-+extern struct vfsmount *sock_mnt;
-+extern struct vfsmount *pipe_mnt;
-+extern struct vfsmount *shm_mnt;
-+static struct acl_object_label *fakefs_obj;
-+
-+extern int gr_init_uidset(void);
-+extern void gr_free_uidset(void);
-+extern void gr_remove_uid(uid_t uid);
-+extern int gr_find_uid(uid_t uid);
-+
-+__inline__ int
-+gr_acl_is_enabled(void)
-+{
-+	return (gr_status & GR_READY);
-+}
-+
-+char gr_roletype_to_char(void)
-+{
-+	switch (current->role->roletype &
-+		(GR_ROLE_DEFAULT | GR_ROLE_USER | GR_ROLE_GROUP |
-+		 GR_ROLE_SPECIAL)) {
-+	case GR_ROLE_DEFAULT:
-+		return 'D';
-+	case GR_ROLE_USER:
-+		return 'U';
-+	case GR_ROLE_GROUP:
-+		return 'G';
-+	case GR_ROLE_SPECIAL:
-+		return 'S';
-+	}
-+
-+	return 'X';
-+}
-+
-+__inline__ int
-+gr_acl_tpe_check(void)
-+{
-+	if (unlikely(!(gr_status & GR_READY)))
-+		return 0;
-+	if (current->role->roletype & GR_ROLE_TPE)
-+		return 1;
-+	else
-+		return 0;
-+}
-+
-+int
-+gr_handle_rawio(const struct inode *inode)
-+{
-+#ifdef CONFIG_GRKERNSEC_CHROOT_CAPS
-+	if (inode && S_ISBLK(inode->i_mode) &&
-+	    grsec_enable_chroot_caps && proc_is_chrooted(current) &&
-+	    !capable(CAP_SYS_RAWIO))
-+		return 1;
-+#endif
-+	return 0;
-+}
-+
-+static int
-+gr_streq(const char *a, const char *b, const unsigned int lena, const unsigned int lenb)
-+{
-+	int i;
-+	unsigned long *l1;
-+	unsigned long *l2;
-+	unsigned char *c1;
-+	unsigned char *c2;
-+	int num_longs;
-+
-+	if (likely(lena != lenb))
-+		return 0;
-+
-+	l1 = (unsigned long *)a;
-+	l2 = (unsigned long *)b;
-+
-+	num_longs = lena / sizeof(unsigned long);
-+
-+	for (i = num_longs; i--; l1++, l2++) {
-+		if (unlikely(*l1 != *l2))
-+			return 0;
-+	}
-+
-+	c1 = (unsigned char *) l1;
-+	c2 = (unsigned char *) l2;
-+
-+	i = lena - (num_longs * sizeof(unsigned long));	
-+
-+	for (; i--; c1++, c2++) {
-+		if (unlikely(*c1 != *c2))
-+			return 0;
-+	}
-+
-+	return 1;
-+}
-+
-+static char * __our_d_path(struct dentry *dentry, struct vfsmount *vfsmnt,
-+	                   struct dentry *root, struct vfsmount *rootmnt,
-+			   char *buffer, int buflen)
-+{
-+	char * end = buffer+buflen;
-+	char * retval;
-+	int namelen;
-+
-+	*--end = '\0';
-+	buflen--;
++	*--end = '\0';
++	buflen--;
@@ -22566,6 +21442,4 @@
-diff --git a/grsecurity/gracl_alloc.c b/grsecurity/gracl_alloc.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..207dd450db814071c2e6b6b564996e9a4dc95641
---- /dev/null
-+++ b/grsecurity/gracl_alloc.c
-@@ -0,0 +1,91 @@
+diff -urNp linux-2.6.26.6/grsecurity/gracl_cap.c linux-2.6.26.6/grsecurity/gracl_cap.c
+--- linux-2.6.26.6/grsecurity/gracl_cap.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_cap.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,129 @@
@@ -22573,3 +21447,2 @@
-+#include <linux/mm.h>
-+#include <linux/slab.h>
-+#include <linux/vmalloc.h>
++#include <linux/module.h>
++#include <linux/sched.h>
@@ -22577,0 +21451 @@
++#include <linux/grinternal.h>
@@ -22579,3 +21453,36 @@
-+static unsigned long alloc_stack_next = 1;
-+static unsigned long alloc_stack_size = 1;
-+static void **alloc_stack;
++static const char *captab_log[] = {
++	"CAP_CHOWN",
++	"CAP_DAC_OVERRIDE",
++	"CAP_DAC_READ_SEARCH",
++	"CAP_FOWNER",
++	"CAP_FSETID",
++	"CAP_KILL",
++	"CAP_SETGID",
++	"CAP_SETUID",
++	"CAP_SETPCAP",
++	"CAP_LINUX_IMMUTABLE",
++	"CAP_NET_BIND_SERVICE",
++	"CAP_NET_BROADCAST",
++	"CAP_NET_ADMIN",
++	"CAP_NET_RAW",
++	"CAP_IPC_LOCK",
++	"CAP_IPC_OWNER",
++	"CAP_SYS_MODULE",
++	"CAP_SYS_RAWIO",
++	"CAP_SYS_CHROOT",
++	"CAP_SYS_PTRACE",
++	"CAP_SYS_PACCT",
++	"CAP_SYS_ADMIN",
++	"CAP_SYS_BOOT",
++	"CAP_SYS_NICE",
++	"CAP_SYS_RESOURCE",
++	"CAP_SYS_TIME",
++	"CAP_SYS_TTY_CONFIG",
++	"CAP_MKNOD",
++	"CAP_LEASE",
++	"CAP_AUDIT_WRITE",
++	"CAP_AUDIT_CONTROL",
++	"CAP_SETFCAP",
++	"CAP_MAC_OVERRIDE",
++	"CAP_MAC_ADMIN"
++};
@@ -22583,2 +21490,5 @@
-+static __inline__ int
-+alloc_pop(void)
++EXPORT_SYMBOL(gr_task_is_capable);
++EXPORT_SYMBOL(gr_is_capable_nolog);
++
++int
++gr_task_is_capable(struct task_struct *task, const int cap)
@@ -22586,2 +21496,2 @@
-+	if (alloc_stack_next == 1)
-+		return 0;
++	struct acl_subject_label *curracl;
++	kernel_cap_t cap_drop = __cap_empty_set, cap_mask = __cap_empty_set;
@@ -22589 +21499,2 @@
-+	kfree(alloc_stack[alloc_stack_next - 2]);
++	if (!gr_acl_is_enabled())
++		return 1;
@@ -22591 +21502 @@
-+	alloc_stack_next--;
++	curracl = task->acl;
@@ -22593,136 +21504,2 @@
-+	return 1;
-+}
-+
-+static __inline__ void
-+alloc_push(void *buf)
-+{
-+	if (alloc_stack_next >= alloc_stack_size)
-+		BUG();
-+
-+	alloc_stack[alloc_stack_next - 1] = buf;
-+
-+	alloc_stack_next++;
-+
-+	return;
-+}
-+
-+void *
-+acl_alloc(unsigned long len)
-+{
-+	void *ret;
-+
-+	if (len > PAGE_SIZE)
-+		BUG();
-+
-+	ret = kmalloc(len, GFP_KERNEL);
-+
-+	if (ret)
-+		alloc_push(ret);
-+
-+	return ret;
-+}
-+
-+void
-+acl_free_all(void)
-+{
-+	if (gr_acl_is_enabled() || !alloc_stack)
-+		return;
-+
-+	while (alloc_pop()) ;
-+
-+	if (alloc_stack) {
-+		if ((alloc_stack_size * sizeof (void *)) <= PAGE_SIZE)
-+			kfree(alloc_stack);
-+		else
-+			vfree(alloc_stack);
-+	}
-+
-+	alloc_stack = NULL;
-+	alloc_stack_size = 1;
-+	alloc_stack_next = 1;
-+
-+	return;
-+}
-+
-+int
-+acl_alloc_stack_init(unsigned long size)
-+{
-+	if ((size * sizeof (void *)) <= PAGE_SIZE)
-+		alloc_stack =
-+		    (void **) kmalloc(size * sizeof (void *), GFP_KERNEL);
-+	else
-+		alloc_stack = (void **) vmalloc(size * sizeof (void *));
-+
-+	alloc_stack_size = size;
-+
-+	if (!alloc_stack)
-+		return 0;
-+	else
-+		return 1;
-+}
-diff --git a/grsecurity/gracl_cap.c b/grsecurity/gracl_cap.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..d65049ce66662774f5d72ca0c8423ecc4f6f683b
---- /dev/null
-+++ b/grsecurity/gracl_cap.c
-@@ -0,0 +1,129 @@
-+#include <linux/kernel.h>
-+#include <linux/module.h>
-+#include <linux/sched.h>
-+#include <linux/gracl.h>
-+#include <linux/grsecurity.h>
-+#include <linux/grinternal.h>
-+
-+static const char *captab_log[] = {
-+	"CAP_CHOWN",
-+	"CAP_DAC_OVERRIDE",
-+	"CAP_DAC_READ_SEARCH",
-+	"CAP_FOWNER",
-+	"CAP_FSETID",
-+	"CAP_KILL",
-+	"CAP_SETGID",
-+	"CAP_SETUID",
-+	"CAP_SETPCAP",
-+	"CAP_LINUX_IMMUTABLE",
-+	"CAP_NET_BIND_SERVICE",
-+	"CAP_NET_BROADCAST",
-+	"CAP_NET_ADMIN",
-+	"CAP_NET_RAW",
-+	"CAP_IPC_LOCK",
-+	"CAP_IPC_OWNER",
-+	"CAP_SYS_MODULE",
-+	"CAP_SYS_RAWIO",
-+	"CAP_SYS_CHROOT",
-+	"CAP_SYS_PTRACE",
-+	"CAP_SYS_PACCT",
-+	"CAP_SYS_ADMIN",
-+	"CAP_SYS_BOOT",
-+	"CAP_SYS_NICE",
-+	"CAP_SYS_RESOURCE",
-+	"CAP_SYS_TIME",
-+	"CAP_SYS_TTY_CONFIG",
-+	"CAP_MKNOD",
-+	"CAP_LEASE",
-+	"CAP_AUDIT_WRITE",
-+	"CAP_AUDIT_CONTROL",
-+	"CAP_SETFCAP",
-+	"CAP_MAC_OVERRIDE",
-+	"CAP_MAC_ADMIN"
-+};
-+
-+EXPORT_SYMBOL(gr_task_is_capable);
-+EXPORT_SYMBOL(gr_is_capable_nolog);
-+
-+int
-+gr_task_is_capable(struct task_struct *task, const int cap)
-+{
-+	struct acl_subject_label *curracl;
-+	kernel_cap_t cap_drop = __cap_empty_set, cap_mask = __cap_empty_set;
-+
-+	if (!gr_acl_is_enabled())
-+		return 1;
-+
-+	curracl = task->acl;
-+
-+	cap_drop = curracl->cap_lower;
-+	cap_mask = curracl->cap_mask;
++	cap_drop = curracl->cap_lower;
++	cap_mask = curracl->cap_mask;
@@ -22798,5 +21575,3 @@
-diff --git a/grsecurity/gracl_fs.c b/grsecurity/gracl_fs.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..67910eccd93a9a919f59d764465e8382c312f301
---- /dev/null
-+++ b/grsecurity/gracl_fs.c
+diff -urNp linux-2.6.26.6/grsecurity/gracl_fs.c linux-2.6.26.6/grsecurity/gracl_fs.c
+--- linux-2.6.26.6/grsecurity/gracl_fs.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_fs.c	2008-10-11 21:54:20.000000000 -0400
@@ -23227,5 +22002,3 @@
-diff --git a/grsecurity/gracl_ip.c b/grsecurity/gracl_ip.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..443681dace6bcdc59a3343053abb684f3b6de360
---- /dev/null
-+++ b/grsecurity/gracl_ip.c
+diff -urNp linux-2.6.26.6/grsecurity/gracl_ip.c linux-2.6.26.6/grsecurity/gracl_ip.c
+--- linux-2.6.26.6/grsecurity/gracl_ip.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_ip.c	2008-10-11 21:54:20.000000000 -0400
@@ -23546,5 +22319,3 @@
-diff --git a/grsecurity/gracl_learn.c b/grsecurity/gracl_learn.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..4b44acb12086de6386550b60564af026023700d2
---- /dev/null
-+++ b/grsecurity/gracl_learn.c
+diff -urNp linux-2.6.26.6/grsecurity/gracl_learn.c linux-2.6.26.6/grsecurity/gracl_learn.c
+--- linux-2.6.26.6/grsecurity/gracl_learn.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_learn.c	2008-10-11 21:54:20.000000000 -0400
@@ -23763,5 +22534,3 @@
-diff --git a/grsecurity/gracl_res.c b/grsecurity/gracl_res.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..04779c92cef8ee719015aa3a4b47352d70d8b788
---- /dev/null
-+++ b/grsecurity/gracl_res.c
+diff -urNp linux-2.6.26.6/grsecurity/gracl_res.c linux-2.6.26.6/grsecurity/gracl_res.c
+--- linux-2.6.26.6/grsecurity/gracl_res.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_res.c	2008-10-11 21:54:20.000000000 -0400
@@ -23814,5 +22583,3 @@
-diff --git a/grsecurity/gracl_segv.c b/grsecurity/gracl_segv.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..7b1965dc6250073b90a0f75d7a5807cae10300cb
---- /dev/null
-+++ b/grsecurity/gracl_segv.c
+diff -urNp linux-2.6.26.6/grsecurity/gracl_segv.c linux-2.6.26.6/grsecurity/gracl_segv.c
+--- linux-2.6.26.6/grsecurity/gracl_segv.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_segv.c	2008-10-11 21:54:20.000000000 -0400
@@ -24124,5 +22891,3 @@
-diff --git a/grsecurity/gracl_shm.c b/grsecurity/gracl_shm.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..c43caefe0da5dfdd163b2f49e9d417293e08488f
---- /dev/null
-+++ b/grsecurity/gracl_shm.c
+diff -urNp linux-2.6.26.6/grsecurity/gracl_shm.c linux-2.6.26.6/grsecurity/gracl_shm.c
+--- linux-2.6.26.6/grsecurity/gracl_shm.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/gracl_shm.c	2008-10-11 21:54:20.000000000 -0400
@@ -24163,5 +22928,3 @@
-diff --git a/grsecurity/grsec_chdir.c b/grsecurity/grsec_chdir.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..bc0be01b02a0774733a0fa06313a5e81ea55c13b
---- /dev/null
-+++ b/grsecurity/grsec_chdir.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_chdir.c linux-2.6.26.6/grsecurity/grsec_chdir.c
+--- linux-2.6.26.6/grsecurity/grsec_chdir.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_chdir.c	2008-10-11 21:54:20.000000000 -0400
@@ -24188,5 +22951,3 @@
-diff --git a/grsecurity/grsec_chroot.c b/grsecurity/grsec_chroot.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3cc4a6184a9704ae1b35938603dc80dc767157a1
---- /dev/null
-+++ b/grsecurity/grsec_chroot.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_chroot.c linux-2.6.26.6/grsecurity/grsec_chroot.c
+--- linux-2.6.26.6/grsecurity/grsec_chroot.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_chroot.c	2008-10-11 21:54:20.000000000 -0400
@@ -24530,5 +23291,3 @@
-diff --git a/grsecurity/grsec_disabled.c b/grsecurity/grsec_disabled.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..adcffcecef0b97b0503eee87a004066a6b3cbfbf
---- /dev/null
-+++ b/grsecurity/grsec_disabled.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_disabled.c linux-2.6.26.6/grsecurity/grsec_disabled.c
+--- linux-2.6.26.6/grsecurity/grsec_disabled.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_disabled.c	2008-10-11 21:54:20.000000000 -0400
@@ -24954,5 +23713,3 @@
-diff --git a/grsecurity/grsec_exec.c b/grsecurity/grsec_exec.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..8e34c0b1c91a511efaec526ef781e32623c619ba
---- /dev/null
-+++ b/grsecurity/grsec_exec.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_exec.c linux-2.6.26.6/grsecurity/grsec_exec.c
+--- linux-2.6.26.6/grsecurity/grsec_exec.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_exec.c	2008-10-11 21:54:20.000000000 -0400
@@ -25048,5 +23805,3 @@
-diff --git a/grsecurity/grsec_fifo.c b/grsecurity/grsec_fifo.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..cf3169ac19c93c78cf469398010bafd3d4dd4e07
---- /dev/null
-+++ b/grsecurity/grsec_fifo.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_fifo.c linux-2.6.26.6/grsecurity/grsec_fifo.c
+--- linux-2.6.26.6/grsecurity/grsec_fifo.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_fifo.c	2008-10-11 21:54:20.000000000 -0400
@@ -25076,5 +23831,3 @@
-diff --git a/grsecurity/grsec_fork.c b/grsecurity/grsec_fork.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3d4310db2bb08d7c6c879f875bdbe892622b6081
---- /dev/null
-+++ b/grsecurity/grsec_fork.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_fork.c linux-2.6.26.6/grsecurity/grsec_fork.c
+--- linux-2.6.26.6/grsecurity/grsec_fork.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_fork.c	2008-10-11 21:54:20.000000000 -0400
@@ -25097,5 +23850,3 @@
-diff --git a/grsecurity/grsec_init.c b/grsecurity/grsec_init.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..eaf846cc4228cac3ab463dc8dfb3a2d94d1a9dcd
---- /dev/null
-+++ b/grsecurity/grsec_init.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_init.c linux-2.6.26.6/grsecurity/grsec_init.c
+--- linux-2.6.26.6/grsecurity/grsec_init.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_init.c	2008-10-11 21:54:20.000000000 -0400
@@ -25333,5 +24084,3 @@
-diff --git a/grsecurity/grsec_ipc.c b/grsecurity/grsec_ipc.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..9cace6e9dea7b972c155e52ead74dc4da2c96b5d
---- /dev/null
-+++ b/grsecurity/grsec_ipc.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_ipc.c linux-2.6.26.6/grsecurity/grsec_ipc.c
+--- linux-2.6.26.6/grsecurity/grsec_ipc.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_ipc.c	2008-10-11 21:54:20.000000000 -0400
@@ -25420,5 +24169,3 @@
-diff --git a/grsecurity/grsec_link.c b/grsecurity/grsec_link.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..b8309ee50af1302d8bdad0f1b85de1c5470b1215
---- /dev/null
-+++ b/grsecurity/grsec_link.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_link.c linux-2.6.26.6/grsecurity/grsec_link.c
+--- linux-2.6.26.6/grsecurity/grsec_link.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_link.c	2008-10-11 21:54:20.000000000 -0400
@@ -25465,5 +24212,3 @@
-diff --git a/grsecurity/grsec_log.c b/grsecurity/grsec_log.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..243bc5b89d3ccd37fae3833d56753ba3185c6779
---- /dev/null
-+++ b/grsecurity/grsec_log.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_log.c linux-2.6.26.6/grsecurity/grsec_log.c
+--- linux-2.6.26.6/grsecurity/grsec_log.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_log.c	2008-10-11 21:54:20.000000000 -0400
@@ -25740,5 +24485,3 @@
-diff --git a/grsecurity/grsec_mem.c b/grsecurity/grsec_mem.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3361642bf7c1ba85444491160dc6818bc8890e9a
---- /dev/null
-+++ b/grsecurity/grsec_mem.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_mem.c linux-2.6.26.6/grsecurity/grsec_mem.c
+--- linux-2.6.26.6/grsecurity/grsec_mem.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_mem.c	2008-10-11 21:54:20.000000000 -0400
@@ -25817,5 +24560,3 @@
-diff --git a/grsecurity/grsec_mount.c b/grsecurity/grsec_mount.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..28866541d8e9093f53179a9ffbf9c3ef84b3659f
---- /dev/null
-+++ b/grsecurity/grsec_mount.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_mount.c linux-2.6.26.6/grsecurity/grsec_mount.c
+--- linux-2.6.26.6/grsecurity/grsec_mount.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_mount.c	2008-10-11 21:54:20.000000000 -0400
@@ -25857,5 +24598,3 @@
-diff --git a/grsecurity/grsec_sig.c b/grsecurity/grsec_sig.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..51ae9baa8f9a3a7fecb2690ce1565da0d632d39c
---- /dev/null
-+++ b/grsecurity/grsec_sig.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_sig.c linux-2.6.26.6/grsecurity/grsec_sig.c
+--- linux-2.6.26.6/grsecurity/grsec_sig.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_sig.c	2008-10-11 21:54:20.000000000 -0400
@@ -25921,5 +24660,3 @@
-diff --git a/grsecurity/grsec_sock.c b/grsecurity/grsec_sock.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..82b43fa76de0394a7bc27d658ef5b980bec0502a
---- /dev/null
-+++ b/grsecurity/grsec_sock.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_sock.c linux-2.6.26.6/grsecurity/grsec_sock.c
+--- linux-2.6.26.6/grsecurity/grsec_sock.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_sock.c	2008-10-11 21:54:20.000000000 -0400
@@ -26201,5 +24938,3 @@
-diff --git a/grsecurity/grsec_sysctl.c b/grsecurity/grsec_sysctl.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..79865a41d0627df565ea2defe779c2703ea8deec
---- /dev/null
-+++ b/grsecurity/grsec_sysctl.c
+diff -urNp linux-2.6.26.6/grsecurity/grsec_sysctl.c linux-2.6.26.6/grsecurity/grsec_sysctl.c
+--- linux-2.6.26.6/grsecurity/grsec_sysctl.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_sysctl.c	2008-10-11 21:54:20.000000000 -0400
@@ -26632,22 +25367,807 @@
-+int gr_check_modstop(void)
-+{
-+#ifdef CONFIG_GRKERNSEC_MODSTOP
-+	if (grsec_modstop == 1) {
-+		gr_log_noargs(GR_DONT_AUDIT, GR_STOPMOD_MSG);
-+		return 1;
-+	}
-+#endif
-+	return 0;
-+}
-diff --git a/grsecurity/grsec_textrel.c b/grsecurity/grsec_textrel.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..143ed92d5ad412940eff915c3ef6c4609d3494c1
---- /dev/null
-+++ b/grsecurity/grsec_textrel.c
-@@ -0,0 +1,16 @@
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/mm.h>
-+#include <linux/file.h>
-+#include <linux/grinternal.h>
-+#include <linux/grsecurity.h>
++int gr_check_modstop(void)
++{
++#ifdef CONFIG_GRKERNSEC_MODSTOP
++	if (grsec_modstop == 1) {
++		gr_log_noargs(GR_DONT_AUDIT, GR_STOPMOD_MSG);
++		return 1;
++	}
++#endif
++	return 0;
++}
+diff -urNp linux-2.6.26.6/grsecurity/grsec_textrel.c linux-2.6.26.6/grsecurity/grsec_textrel.c
+--- linux-2.6.26.6/grsecurity/grsec_textrel.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_textrel.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,16 @@
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/mm.h>
++#include <linux/file.h>
++#include <linux/grinternal.h>
++#include <linux/grsecurity.h>
++
++void
++gr_log_textrel(struct vm_area_struct * vma)
++{
++#ifdef CONFIG_GRKERNSEC_AUDIT_TEXTREL
++	if (grsec_enable_audit_textrel)
++		gr_log_textrel_ulong_ulong(GR_DO_AUDIT, GR_TEXTREL_AUDIT_MSG, vma->vm_file, vma->vm_start, vma->vm_pgoff);
++#endif
++	return;
++}
+diff -urNp linux-2.6.26.6/grsecurity/grsec_time.c linux-2.6.26.6/grsecurity/grsec_time.c
+--- linux-2.6.26.6/grsecurity/grsec_time.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_time.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,13 @@
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/grinternal.h>
++
++void
++gr_log_timechange(void)
++{
++#ifdef CONFIG_GRKERNSEC_TIME
++	if (grsec_enable_time)
++		gr_log_noargs(GR_DONT_AUDIT_GOOD, GR_TIME_MSG);
++#endif
++	return;
++}
+diff -urNp linux-2.6.26.6/grsecurity/grsec_tpe.c linux-2.6.26.6/grsecurity/grsec_tpe.c
+--- linux-2.6.26.6/grsecurity/grsec_tpe.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsec_tpe.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,37 @@
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/file.h>
++#include <linux/fs.h>
++#include <linux/grinternal.h>
++
++extern int gr_acl_tpe_check(void);
++
++int
++gr_tpe_allow(const struct file *file)
++{
++#ifdef CONFIG_GRKERNSEC
++	struct inode *inode = file->f_path.dentry->d_parent->d_inode;
++
++	if (current->uid && ((grsec_enable_tpe &&
++#ifdef CONFIG_GRKERNSEC_TPE_INVERT
++	    !in_group_p(grsec_tpe_gid)
++#else
++	    in_group_p(grsec_tpe_gid)
++#endif
++	    ) || gr_acl_tpe_check()) &&
++	    (inode->i_uid || (!inode->i_uid && ((inode->i_mode & S_IWGRP) ||
++						(inode->i_mode & S_IWOTH))))) {
++		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
++		return 0;
++	}
++#ifdef CONFIG_GRKERNSEC_TPE_ALL
++	if (current->uid && grsec_enable_tpe && grsec_enable_tpe_all &&
++	    ((inode->i_uid && (inode->i_uid != current->uid)) ||
++	     (inode->i_mode & S_IWGRP) || (inode->i_mode & S_IWOTH))) {
++		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
++		return 0;
++	}
++#endif
++#endif
++	return 1;
++}
+diff -urNp linux-2.6.26.6/grsecurity/grsum.c linux-2.6.26.6/grsecurity/grsum.c
+--- linux-2.6.26.6/grsecurity/grsum.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/grsum.c	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,59 @@
++#include <linux/err.h>
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/mm.h>
++#include <linux/scatterlist.h>
++#include <linux/crypto.h>
++#include <linux/gracl.h>
++
++
++#if !defined(CONFIG_CRYPTO) || defined(CONFIG_CRYPTO_MODULE) || !defined(CONFIG_CRYPTO_SHA256) || defined(CONFIG_CRYPTO_SHA256_MODULE)
++#error "crypto and sha256 must be built into the kernel"
++#endif
++
++int
++chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum)
++{
++	char *p;
++	struct crypto_hash *tfm;
++	struct hash_desc desc;
++	struct scatterlist sg;
++	unsigned char temp_sum[GR_SHA_LEN];
++	volatile int retval = 0;
++	volatile int dummy = 0;
++	unsigned int i;
++
++	tfm = crypto_alloc_hash("sha256", 0, CRYPTO_ALG_ASYNC);
++	if (IS_ERR(tfm)) {
++		/* should never happen, since sha256 should be built in */
++		return 1;
++	}
++
++	desc.tfm = tfm;
++	desc.flags = 0;
++
++	crypto_hash_init(&desc);
++
++	p = salt;
++	sg_set_buf(&sg, p, GR_SALT_LEN);
++	crypto_hash_update(&desc, &sg, sg.length);
++
++	p = entry->pw;
++	sg_set_buf(&sg, p, strlen(p));
++	
++	crypto_hash_update(&desc, &sg, sg.length);
++
++	crypto_hash_final(&desc, temp_sum);
++
++	memset(entry->pw, 0, GR_PW_LEN);
++
++	for (i = 0; i < GR_SHA_LEN; i++)
++		if (sum[i] != temp_sum[i])
++			retval = 1;
++		else
++			dummy = 1;	// waste a cycle
++
++	crypto_free_hash(tfm);
++
++	return retval;
++}
+diff -urNp linux-2.6.26.6/grsecurity/Kconfig linux-2.6.26.6/grsecurity/Kconfig
+--- linux-2.6.26.6/grsecurity/Kconfig	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/Kconfig	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,863 @@
++#
++# grecurity configuration
++#
++
++menu "Grsecurity"
++
++config GRKERNSEC
++	bool "Grsecurity"
++	select CRYPTO
++	select CRYPTO_SHA256
++	select SECURITY
++	select SECURITY_CAPABILITIES
++	help
++	  If you say Y here, you will be able to configure many features
++	  that will enhance the security of your system.  It is highly
++	  recommended that you say Y here and read through the help
++	  for each option so that you fully understand the features and
++	  can evaluate their usefulness for your machine.
++
++choice
++	prompt "Security Level"
++	depends on GRKERNSEC
++	default GRKERNSEC_CUSTOM
++
++config GRKERNSEC_LOW
++	bool "Low"
++	select GRKERNSEC_LINK
++	select GRKERNSEC_FIFO
++	select GRKERNSEC_EXECVE
++	select GRKERNSEC_RANDNET
++	select GRKERNSEC_DMESG
++	select GRKERNSEC_CHROOT_CHDIR
++	select GRKERNSEC_MODSTOP if (MODULES)
++
++	help
++	  If you choose this option, several of the grsecurity options will
++	  be enabled that will give you greater protection against a number
++	  of attacks, while assuring that none of your software will have any
++	  conflicts with the additional security measures.  If you run a lot
++	  of unusual software, or you are having problems with the higher
++	  security levels, you should say Y here.  With this option, the
++	  following features are enabled:
++
++	  - Linking restrictions
++	  - FIFO restrictions
++	  - Enforcing RLIMIT_NPROC on execve
++	  - Restricted dmesg
++	  - Enforced chdir("/") on chroot
++	  - Runtime module disabling
++
++config GRKERNSEC_MEDIUM
++	bool "Medium"
++	select PAX
++	select PAX_EI_PAX
++	select PAX_PT_PAX_FLAGS
++	select PAX_HAVE_ACL_FLAGS
++	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
++	select GRKERNSEC_CHROOT_SYSCTL
++	select GRKERNSEC_LINK
++	select GRKERNSEC_FIFO
++	select GRKERNSEC_EXECVE
++	select GRKERNSEC_DMESG
++	select GRKERNSEC_RANDNET
++	select GRKERNSEC_FORKFAIL
++	select GRKERNSEC_TIME
++	select GRKERNSEC_SIGNAL
++	select GRKERNSEC_CHROOT
++	select GRKERNSEC_CHROOT_UNIX
++	select GRKERNSEC_CHROOT_MOUNT
++	select GRKERNSEC_CHROOT_PIVOT
++	select GRKERNSEC_CHROOT_DOUBLE
++	select GRKERNSEC_CHROOT_CHDIR
++	select GRKERNSEC_CHROOT_MKNOD
++	select GRKERNSEC_PROC
++	select GRKERNSEC_PROC_USERGROUP
++	select GRKERNSEC_MODSTOP if (MODULES)
++	select PAX_RANDUSTACK
++	select PAX_ASLR
++	select PAX_RANDMMAP
++	select PAX_REFCOUNT
++
++	help
++	  If you say Y here, several features in addition to those included
++	  in the low additional security level will be enabled.  These
++	  features provide even more security to your system, though in rare
++	  cases they may be incompatible with very old or poorly written
++	  software.  If you enable this option, make sure that your auth
++	  service (identd) is running as gid 1001.  With this option, 
++	  the following features (in addition to those provided in the 
++	  low additional security level) will be enabled:
++
++	  - Failed fork logging
++	  - Time change logging
++	  - Signal logging
++	  - Deny mounts in chroot
++	  - Deny double chrooting
++	  - Deny sysctl writes in chroot
++	  - Deny mknod in chroot
++	  - Deny access to abstract AF_UNIX sockets out of chroot
++	  - Deny pivot_root in chroot
++	  - Denied writes of /dev/kmem, /dev/mem, and /dev/port
++	  - /proc restrictions with special GID set to 10 (usually wheel)
++	  - Address Space Layout Randomization (ASLR)
++
++config GRKERNSEC_HIGH
++	bool "High"
++	select GRKERNSEC_LINK
++	select GRKERNSEC_FIFO
++	select GRKERNSEC_EXECVE
++	select GRKERNSEC_DMESG
++	select GRKERNSEC_FORKFAIL
++	select GRKERNSEC_TIME
++	select GRKERNSEC_SIGNAL
++	select GRKERNSEC_CHROOT_SHMAT
++	select GRKERNSEC_CHROOT_UNIX
++	select GRKERNSEC_CHROOT_MOUNT
++	select GRKERNSEC_CHROOT_FCHDIR
++	select GRKERNSEC_CHROOT_PIVOT
++	select GRKERNSEC_CHROOT_DOUBLE
++	select GRKERNSEC_CHROOT_CHDIR
++	select GRKERNSEC_CHROOT_MKNOD
++	select GRKERNSEC_CHROOT_CAPS
++	select GRKERNSEC_CHROOT_SYSCTL
++	select GRKERNSEC_CHROOT_FINDTASK
++	select GRKERNSEC_PROC
++	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
++	select GRKERNSEC_HIDESYM
++	select GRKERNSEC_BRUTE
++	select GRKERNSEC_PROC_USERGROUP
++	select GRKERNSEC_KMEM
++	select GRKERNSEC_RESLOG
++	select GRKERNSEC_RANDNET
++	select GRKERNSEC_PROC_ADD
++	select GRKERNSEC_CHROOT_CHMOD
++	select GRKERNSEC_CHROOT_NICE
++	select GRKERNSEC_AUDIT_MOUNT
++	select GRKERNSEC_MODSTOP if (MODULES)
++	select PAX
++	select PAX_RANDUSTACK
++	select PAX_ASLR
++	select PAX_RANDMMAP
++	select PAX_NOEXEC
++	select PAX_MPROTECT
++	select PAX_EI_PAX
++	select PAX_PT_PAX_FLAGS
++	select PAX_HAVE_ACL_FLAGS
++	select PAX_KERNEXEC if (X86 && !EFI && !COMPAT_VDSO && !PARAVIRT && (!X86_32 || X86_WP_WORKS_OK))
++	select PAX_MEMORY_UDEREF if (!X86_64 && !COMPAT_VDSO)
++	select PAX_RANDKSTACK if (X86_TSC && !X86_64)
++	select PAX_SEGMEXEC if (X86 && !X86_64)
++	select PAX_PAGEEXEC if (!X86)
++	select PAX_EMUPLT if (ALPHA || PARISC || PPC32 || SPARC32 || SPARC64)
++	select PAX_DLRESOLVE if (SPARC32 || SPARC64)
++	select PAX_SYSCALL if (PPC32)
++	select PAX_EMUTRAMP if (PARISC)
++	select PAX_EMUSIGRT if (PARISC)
++	select PAX_ETEXECRELOCS if (ALPHA || IA64 || PARISC)
++	select PAX_REFCOUNT
++	help
++	  If you say Y here, many of the features of grsecurity will be
++	  enabled, which will protect you against many kinds of attacks
++	  against your system.  The heightened security comes at a cost
++	  of an increased chance of incompatibilities with rare software
++	  on your machine.  Since this security level enables PaX, you should
++	  view <http://pax.grsecurity.net> and read about the PaX
++	  project.  While you are there, download chpax and run it on
++	  binaries that cause problems with PaX.  Also remember that
++	  since the /proc restrictions are enabled, you must run your
++	  identd as gid 1001.  This security level enables the following 
++	  features in addition to those listed in the low and medium 
++	  security levels:
++
++	  - Additional /proc restrictions
++	  - Chmod restrictions in chroot
++	  - No signals, ptrace, or viewing of processes outside of chroot
++	  - Capability restrictions in chroot
++	  - Deny fchdir out of chroot
++	  - Priority restrictions in chroot
++	  - Segmentation-based implementation of PaX
++	  - Mprotect restrictions
++	  - Removal of addresses from /proc/<pid>/[smaps|maps|stat]
++	  - Kernel stack randomization
++	  - Mount/unmount/remount logging
++	  - Kernel symbol hiding
++	  - Prevention of memory exhaustion-based exploits
++config GRKERNSEC_CUSTOM
++	bool "Custom"
++	help
++	  If you say Y here, you will be able to configure every grsecurity
++	  option, which allows you to enable many more features that aren't
++	  covered in the basic security levels.  These additional features
++	  include TPE, socket restrictions, and the sysctl system for
++	  grsecurity.  It is advised that you read through the help for
++	  each option to determine its usefulness in your situation.
++
++endchoice
++
++menu "Address Space Protection"
++depends on GRKERNSEC
++
++config GRKERNSEC_KMEM
++	bool "Deny writing to /dev/kmem, /dev/mem, and /dev/port"
++	help
++	  If you say Y here, /dev/kmem and /dev/mem won't be allowed to
++	  be written to via mmap or otherwise to modify the running kernel.
++	  /dev/port will also not be allowed to be opened. If you have module
++	  support disabled, enabling this will close up four ways that are
++	  currently used  to insert malicious code into the running kernel.
++	  Even with all these features enabled, we still highly recommend that
++	  you use the RBAC system, as it is still possible for an attacker to
++	  modify the running kernel through privileged I/O granted by ioperm/iopl.
++	  If you are not using XFree86, you may be able to stop this additional
++	  case by enabling the 'Disable privileged I/O' option. Though nothing
++	  legitimately writes to /dev/kmem, XFree86 does need to write to /dev/mem,
++	  but only to video memory, which is the only writing we allow in this
++	  case.  If /dev/kmem or /dev/mem are mmaped without PROT_WRITE, they will
++	  not be allowed to mprotect it with PROT_WRITE later.
++	  It is highly recommended that you say Y here if you meet all the
++	  conditions above.
++
++config GRKERNSEC_IO
++	bool "Disable privileged I/O"
++	depends on X86
++	select RTC
++	help
++	  If you say Y here, all ioperm and iopl calls will return an error.
++	  Ioperm and iopl can be used to modify the running kernel.
++	  Unfortunately, some programs need this access to operate properly,
++	  the most notable of which are XFree86 and hwclock.  hwclock can be
++	  remedied by having RTC support in the kernel, so CONFIG_RTC is
++	  enabled if this option is enabled, to ensure that hwclock operates
++	  correctly.  XFree86 still will not operate correctly with this option
++	  enabled, so DO NOT CHOOSE Y IF YOU USE XFree86.  If you use XFree86
++	  and you still want to protect your kernel against modification,
++	  use the RBAC system.
++
++config GRKERNSEC_PROC_MEMMAP
++	bool "Remove addresses from /proc/<pid>/[smaps|maps|stat]"
++	depends on PAX_NOEXEC || PAX_ASLR
++	help
++	  If you say Y here, the /proc/<pid>/maps and /proc/<pid>/stat files will
++	  give no information about the addresses of its mappings if
++	  PaX features that rely on random addresses are enabled on the task.
++	  If you use PaX it is greatly recommended that you say Y here as it
++	  closes up a hole that makes the full ASLR useless for suid
++	  binaries.
++
++config GRKERNSEC_BRUTE
++	bool "Deter exploit bruteforcing"
++	help
++	  If you say Y here, attempts to bruteforce exploits against forking
++	  daemons such as apache or sshd will be deterred.  When a child of a
++	  forking daemon is killed by PaX or crashes due to an illegal
++	  instruction, the parent process will be delayed 30 seconds upon every
++	  subsequent fork until the administrator is able to assess the
++	  situation and restart the daemon.  It is recommended that you also
++	  enable signal logging in the auditing section so that logs are
++	  generated when a process performs an illegal instruction.
++
++config GRKERNSEC_MODSTOP
++	bool "Runtime module disabling"
++	depends on MODULES
++	help
++	  If you say Y here, you will be able to disable the ability to (un)load
++	  modules at runtime.  This feature is useful if you need the ability
++	  to load kernel modules at boot time, but do not want to allow an
++	  attacker to load a rootkit kernel module into the system, or to remove
++	  a loaded kernel module important to system functioning.  You should
++	  enable the /dev/mem protection feature as well, since rootkits can be
++	  inserted into the kernel via other methods than kernel modules.  Since
++	  an untrusted module could still be loaded by modifying init scripts and
++	  rebooting the system, it is also recommended that you enable the RBAC
++	  system.  If you enable this option, a sysctl option with name
++	  "disable_modules" will be created.  Setting this option to "1" disables
++	  module loading.  After this option is set, no further writes to it are
++	  allowed until the system is rebooted.
++
++config GRKERNSEC_HIDESYM
++	bool "Hide kernel symbols"
++	help
++	  If you say Y here, getting information on loaded modules, and
++	  displaying all kernel symbols through a syscall will be restricted
++	  to users with CAP_SYS_MODULE.  This option is only effective
++	  provided the following conditions are met:
++	  1) The kernel using grsecurity is not precompiled by some distribution
++	  2) You are using the RBAC system and hiding other files such as your
++	     kernel image and System.map
++	  3) You have the additional /proc restrictions enabled, which removes
++	     /proc/kcore
++	  If the above conditions are met, this option will aid to provide a
++	  useful protection against local and remote kernel exploitation of
++	  overflows and arbitrary read/write vulnerabilities.
++
++endmenu
++menu "Role Based Access Control Options"
++depends on GRKERNSEC
++
++config GRKERNSEC_ACL_HIDEKERN
++	bool "Hide kernel processes"
++	help
++	  If you say Y here, all kernel threads will be hidden to all
++	  processes but those whose subject has the "view hidden processes"
++	  flag.
++
++config GRKERNSEC_ACL_MAXTRIES
++	int "Maximum tries before password lockout"
++	default 3
++	help
++	  This option enforces the maximum number of times a user can attempt
++	  to authorize themselves with the grsecurity RBAC system before being
++	  denied the ability to attempt authorization again for a specified time.
++	  The lower the number, the harder it will be to brute-force a password.
++
++config GRKERNSEC_ACL_TIMEOUT
++	int "Time to wait after max password tries, in seconds"
++	default 30
++	help
++	  This option specifies the time the user must wait after attempting to
++	  authorize to the RBAC system with the maximum number of invalid
++	  passwords.  The higher the number, the harder it will be to brute-force
++	  a password.
++
++endmenu
++menu "Filesystem Protections"
++depends on GRKERNSEC
++
++config GRKERNSEC_PROC
++	bool "Proc restrictions"
++	help
++	  If you say Y here, the permissions of the /proc filesystem
++	  will be altered to enhance system security and privacy.  You MUST
++  	  choose either a user only restriction or a user and group restriction.
++	  Depending upon the option you choose, you can either restrict users to
++	  see only the processes they themselves run, or choose a group that can
++	  view all processes and files normally restricted to root if you choose
++	  the "restrict to user only" option.  NOTE: If you're running identd as
++	  a non-root user, you will have to run it as the group you specify here.
++
++config GRKERNSEC_PROC_USER
++	bool "Restrict /proc to user only"
++	depends on GRKERNSEC_PROC
++	help
++	  If you say Y here, non-root users will only be able to view their own
++	  processes, and restricts them from viewing network-related information,
++	  and viewing kernel symbol and module information.
++
++config GRKERNSEC_PROC_USERGROUP
++	bool "Allow special group"
++	depends on GRKERNSEC_PROC && !GRKERNSEC_PROC_USER
++	help
++	  If you say Y here, you will be able to select a group that will be
++	  able to view all processes, network-related information, and
++	  kernel and symbol information.  This option is useful if you want
++	  to run identd as a non-root user.
++
++config GRKERNSEC_PROC_GID
++	int "GID for special group"
++	depends on GRKERNSEC_PROC_USERGROUP
++	default 1001
++
++config GRKERNSEC_PROC_ADD
++	bool "Additional restrictions"
++	depends on GRKERNSEC_PROC_USER || GRKERNSEC_PROC_USERGROUP
++	help
++	  If you say Y here, additional restrictions will be placed on
++	  /proc that keep normal users from viewing device information and 
++	  slabinfo information that could be useful for exploits.
++
++config GRKERNSEC_LINK
++	bool "Linking restrictions"
++	help
++	  If you say Y here, /tmp race exploits will be prevented, since users
++	  will no longer be able to follow symlinks owned by other users in
++	  world-writable +t directories (i.e. /tmp), unless the owner of the
++	  symlink is the owner of the directory. users will also not be
++	  able to hardlink to files they do not own.  If the sysctl option is
++	  enabled, a sysctl option with name "linking_restrictions" is created.
++
++config GRKERNSEC_FIFO
++	bool "FIFO restrictions"
++	help
++	  If you say Y here, users will not be able to write to FIFOs they don't
++	  own in world-writable +t directories (i.e. /tmp), unless the owner of
++	  the FIFO is the same owner of the directory it's held in.  If the sysctl
++	  option is enabled, a sysctl option with name "fifo_restrictions" is
++	  created.
++
++config GRKERNSEC_CHROOT
++	bool "Chroot jail restrictions"
++	help
++	  If you say Y here, you will be able to choose several options that will
++	  make breaking out of a chrooted jail much more difficult.  If you
++	  encounter no software incompatibilities with the following options, it
++	  is recommended that you enable each one.
++
++config GRKERNSEC_CHROOT_MOUNT
++	bool "Deny mounts"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to
++	  mount or remount filesystems.  If the sysctl option is enabled, a
++	  sysctl option with name "chroot_deny_mount" is created.
++
++config GRKERNSEC_CHROOT_DOUBLE
++	bool "Deny double-chroots"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to chroot
++	  again outside the chroot.  This is a widely used method of breaking
++	  out of a chroot jail and should not be allowed.  If the sysctl 
++	  option is enabled, a sysctl option with name 
++	  "chroot_deny_chroot" is created.
++
++config GRKERNSEC_CHROOT_PIVOT
++	bool "Deny pivot_root in chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to use
++	  a function called pivot_root() that was introduced in Linux 2.3.41.  It
++	  works similar to chroot in that it changes the root filesystem.  This
++	  function could be misused in a chrooted process to attempt to break out
++	  of the chroot, and therefore should not be allowed.  If the sysctl
++	  option is enabled, a sysctl option with name "chroot_deny_pivot" is
++	  created.
++
++config GRKERNSEC_CHROOT_CHDIR
++	bool "Enforce chdir(\"/\") on all chroots"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, the current working directory of all newly-chrooted
++	  applications will be set to the the root directory of the chroot.
++	  The man page on chroot(2) states:
++	  Note that this call does not change  the  current  working
++	  directory,  so  that `.' can be outside the tree rooted at
++	  `/'.  In particular, the  super-user  can  escape  from  a
++	  `chroot jail' by doing `mkdir foo; chroot foo; cd ..'.
++
++	  It is recommended that you say Y here, since it's not known to break
++	  any software.  If the sysctl option is enabled, a sysctl option with
++	  name "chroot_enforce_chdir" is created.
++
++config GRKERNSEC_CHROOT_CHMOD
++	bool "Deny (f)chmod +s"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to chmod
++	  or fchmod files to make them have suid or sgid bits.  This protects
++	  against another published method of breaking a chroot.  If the sysctl
++	  option is enabled, a sysctl option with name "chroot_deny_chmod" is
++	  created.
++
++config GRKERNSEC_CHROOT_FCHDIR
++	bool "Deny fchdir out of chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, a well-known method of breaking chroots by fchdir'ing
++	  to a file descriptor of the chrooting process that points to a directory
++	  outside the filesystem will be stopped.  If the sysctl option
++	  is enabled, a sysctl option with name "chroot_deny_fchdir" is created.
++
++config GRKERNSEC_CHROOT_MKNOD
++	bool "Deny mknod"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be allowed to
++	  mknod.  The problem with using mknod inside a chroot is that it
++	  would allow an attacker to create a device entry that is the same
++	  as one on the physical root of your system, which could range from
++	  anything from the console device to a device for your harddrive (which
++	  they could then use to wipe the drive or steal data).  It is recommended
++	  that you say Y here, unless you run into software incompatibilities.
++	  If the sysctl option is enabled, a sysctl option with name
++	  "chroot_deny_mknod" is created.
++
++config GRKERNSEC_CHROOT_SHMAT
++	bool "Deny shmat() out of chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to attach
++	  to shared memory segments that were created outside of the chroot jail.
++	  It is recommended that you say Y here.  If the sysctl option is enabled,
++	  a sysctl option with name "chroot_deny_shmat" is created.
++
++config GRKERNSEC_CHROOT_UNIX
++	bool "Deny access to abstract AF_UNIX sockets out of chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to
++	  connect to abstract (meaning not belonging to a filesystem) Unix
++	  domain sockets that were bound outside of a chroot.  It is recommended
++	  that you say Y here.  If the sysctl option is enabled, a sysctl option
++	  with name "chroot_deny_unix" is created.
++
++config GRKERNSEC_CHROOT_FINDTASK
++	bool "Protect outside processes"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to
++	  kill, send signals with fcntl, ptrace, capget, getpgid, getsid,
++	  or view any process outside of the chroot.  If the sysctl
++	  option is enabled, a sysctl option with name "chroot_findtask" is
++	  created.
++
++config GRKERNSEC_CHROOT_NICE
++	bool "Restrict priority changes"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to raise
++	  the priority of processes in the chroot, or alter the priority of
++	  processes outside the chroot.  This provides more security than simply
++	  removing CAP_SYS_NICE from the process' capability set.  If the
++	  sysctl option is enabled, a sysctl option with name "chroot_restrict_nice"
++	  is created.
++
++config GRKERNSEC_CHROOT_SYSCTL
++	bool "Deny sysctl writes"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, an attacker in a chroot will not be able to
++	  write to sysctl entries, either by sysctl(2) or through a /proc
++	  interface.  It is strongly recommended that you say Y here. If the
++	  sysctl option is enabled, a sysctl option with name
++	  "chroot_deny_sysctl" is created.
++
++config GRKERNSEC_CHROOT_CAPS
++	bool "Capability restrictions"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, the capabilities on all root processes within a
++	  chroot jail will be lowered to stop module insertion, raw i/o,
++	  system and net admin tasks, rebooting the system, modifying immutable
++	  files, modifying IPC owned by another, and changing the system time.
++	  This is left an option because it can break some apps.  Disable this
++	  if your chrooted apps are having problems performing those kinds of
++	  tasks.  If the sysctl option is enabled, a sysctl option with
++	  name "chroot_caps" is created.
++
++endmenu
++menu "Kernel Auditing"
++depends on GRKERNSEC
++
++config GRKERNSEC_AUDIT_GROUP
++	bool "Single group for auditing"
++	help
++	  If you say Y here, the exec, chdir, (un)mount, and ipc logging features
++	  will only operate on a group you specify.  This option is recommended
++	  if you only want to watch certain users instead of having a large
++	  amount of logs from the entire system.  If the sysctl option is enabled,
++	  a sysctl option with name "audit_group" is created.
++
++config GRKERNSEC_AUDIT_GID
++	int "GID for auditing"
++	depends on GRKERNSEC_AUDIT_GROUP
++	default 1007
++
++config GRKERNSEC_EXECLOG
++	bool "Exec logging"
++	help
++	  If you say Y here, all execve() calls will be logged (since the
++	  other exec*() calls are frontends to execve(), all execution
++	  will be logged).  Useful for shell-servers that like to keep track
++	  of their users.  If the sysctl option is enabled, a sysctl option with
++	  name "exec_logging" is created.
++	  WARNING: This option when enabled will produce a LOT of logs, especially
++	  on an active system.
++
++config GRKERNSEC_RESLOG
++	bool "Resource logging"
++	help
++	  If you say Y here, all attempts to overstep resource limits will
++	  be logged with the resource name, the requested size, and the current
++	  limit.  It is highly recommended that you say Y here.  If the sysctl
++	  option is enabled, a sysctl option with name "resource_logging" is
++	  created.  If the RBAC system is enabled, the sysctl value is ignored.
++
++config GRKERNSEC_CHROOT_EXECLOG
++	bool "Log execs within chroot"
++	help
++	  If you say Y here, all executions inside a chroot jail will be logged
++	  to syslog.  This can cause a large amount of logs if certain
++	  applications (eg. djb's daemontools) are installed on the system, and
++	  is therefore left as an option.  If the sysctl option is enabled, a
++	  sysctl option with name "chroot_execlog" is created.
++
++config GRKERNSEC_AUDIT_CHDIR
++	bool "Chdir logging"
++	help
++	  If you say Y here, all chdir() calls will be logged.  If the sysctl
++ 	  option is enabled, a sysctl option with name "audit_chdir" is created.
++
++config GRKERNSEC_AUDIT_MOUNT
++	bool "(Un)Mount logging"
++	help
++	  If you say Y here, all mounts and unmounts will be logged.  If the
++	  sysctl option is enabled, a sysctl option with name "audit_mount" is
++	  created.
++
++config GRKERNSEC_AUDIT_IPC
++	bool "IPC logging"
++	help
++	  If you say Y here, creation and removal of message queues, semaphores,
++	  and shared memory will be logged.  If the sysctl option is enabled, a
++	  sysctl option with name "audit_ipc" is created.
++
++config GRKERNSEC_SIGNAL
++	bool "Signal logging"
++	help
++	  If you say Y here, certain important signals will be logged, such as
++	  SIGSEGV, which will as a result inform you of when a error in a program
++	  occurred, which in some cases could mean a possible exploit attempt.
++	  If the sysctl option is enabled, a sysctl option with name
++	  "signal_logging" is created.
++
++config GRKERNSEC_FORKFAIL
++	bool "Fork failure logging"
++	help
++	  If you say Y here, all failed fork() attempts will be logged.
++	  This could suggest a fork bomb, or someone attempting to overstep
++	  their process limit.  If the sysctl option is enabled, a sysctl option
++	  with name "forkfail_logging" is created.
++
++config GRKERNSEC_TIME
++	bool "Time change logging"
++	help
++	  If you say Y here, any changes of the system clock will be logged.
++	  If the sysctl option is enabled, a sysctl option with name
++	  "timechange_logging" is created.
++
++config GRKERNSEC_PROC_IPADDR
++	bool "/proc/<pid>/ipaddr support"
++	help
++	  If you say Y here, a new entry will be added to each /proc/<pid>
++	  directory that contains the IP address of the person using the task.
++	  The IP is carried across local TCP and AF_UNIX stream sockets.
++	  This information can be useful for IDS/IPSes to perform remote response
++	  to a local attack.  The entry is readable by only the owner of the
++	  process (and root if he has CAP_DAC_OVERRIDE, which can be removed via
++	  the RBAC system), and thus does not create privacy concerns.
++
++config GRKERNSEC_AUDIT_TEXTREL
++	bool 'ELF text relocations logging (READ HELP)'
++	depends on PAX_MPROTECT
++	help
++	  If you say Y here, text relocations will be logged with the filename
++	  of the offending library or binary.  The purpose of the feature is
++	  to help Linux distribution developers get rid of libraries and
++	  binaries that need text relocations which hinder the future progress
++	  of PaX.  Only Linux distribution developers should say Y here, and
++	  never on a production machine, as this option creates an information
++	  leak that could aid an attacker in defeating the randomization of
++	  a single memory region.  If the sysctl option is enabled, a sysctl
++	  option with name "audit_textrel" is created.
@@ -26655,18 +26175 @@
-+void
-+gr_log_textrel(struct vm_area_struct * vma)
-+{
-+#ifdef CONFIG_GRKERNSEC_AUDIT_TEXTREL
-+	if (grsec_enable_audit_textrel)
-+		gr_log_textrel_ulong_ulong(GR_DO_AUDIT, GR_TEXTREL_AUDIT_MSG, vma->vm_file, vma->vm_start, vma->vm_pgoff);
-+#endif
-+	return;
-+}
-diff --git a/grsecurity/grsec_time.c b/grsecurity/grsec_time.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..9501ab48e537e79b8335a51c79fdca1910edc2d2
---- /dev/null
-+++ b/grsecurity/grsec_time.c
-@@ -0,0 +1,13 @@
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/grinternal.h>
++endmenu
@@ -26674,20 +26177,2 @@
-+void
-+gr_log_timechange(void)
-+{
-+#ifdef CONFIG_GRKERNSEC_TIME
-+	if (grsec_enable_time)
-+		gr_log_noargs(GR_DONT_AUDIT_GOOD, GR_TIME_MSG);
-+#endif
-+	return;
-+}
-diff --git a/grsecurity/grsec_tpe.c b/grsecurity/grsec_tpe.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..10a764ef7f4521fdb86c455effc6295b99349c28
---- /dev/null
-+++ b/grsecurity/grsec_tpe.c
-@@ -0,0 +1,37 @@
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/file.h>
-+#include <linux/fs.h>
-+#include <linux/grinternal.h>
++menu "Executable Protections"
++depends on GRKERNSEC
@@ -26695 +26180,7 @@
-+extern int gr_acl_tpe_check(void);
++config GRKERNSEC_EXECVE
++	bool "Enforce RLIMIT_NPROC on execs"
++	help
++	  If you say Y here, users with a resource limit on processes will
++	  have the value checked during execve() calls.  The current system
++	  only checks the system limit during fork() calls.  If the sysctl option
++	  is enabled, a sysctl option with name "execve_limiting" is created.
@@ -26697,5 +26188,7 @@
-+int
-+gr_tpe_allow(const struct file *file)
-+{
-+#ifdef CONFIG_GRKERNSEC
-+	struct inode *inode = file->f_path.dentry->d_parent->d_inode;
++config GRKERNSEC_DMESG
++	bool "Dmesg(8) restriction"
++	help
++	  If you say Y here, non-root users will not be able to use dmesg(8)
++	  to view up to the last 4kb of messages in the kernel's log buffer.
++	  If the sysctl option is enabled, a sysctl option with name "dmesg" is
++	  created.
@@ -26703,36 +26196,8 @@
-+	if (current->uid && ((grsec_enable_tpe &&
-+#ifdef CONFIG_GRKERNSEC_TPE_INVERT
-+	    !in_group_p(grsec_tpe_gid)
-+#else
-+	    in_group_p(grsec_tpe_gid)
-+#endif
-+	    ) || gr_acl_tpe_check()) &&
-+	    (inode->i_uid || (!inode->i_uid && ((inode->i_mode & S_IWGRP) ||
-+						(inode->i_mode & S_IWOTH))))) {
-+		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
-+		return 0;
-+	}
-+#ifdef CONFIG_GRKERNSEC_TPE_ALL
-+	if (current->uid && grsec_enable_tpe && grsec_enable_tpe_all &&
-+	    ((inode->i_uid && (inode->i_uid != current->uid)) ||
-+	     (inode->i_mode & S_IWGRP) || (inode->i_mode & S_IWOTH))) {
-+		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
-+		return 0;
-+	}
-+#endif
-+#endif
-+	return 1;
-+}
-diff --git a/grsecurity/grsum.c b/grsecurity/grsum.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3971640ec3c77b7968a8bd596efe486c8b01b891
---- /dev/null
-+++ b/grsecurity/grsum.c
-@@ -0,0 +1,59 @@
-+#include <linux/err.h>
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/mm.h>
-+#include <linux/scatterlist.h>
-+#include <linux/crypto.h>
-+#include <linux/gracl.h>
++config GRKERNSEC_TPE
++	bool "Trusted Path Execution (TPE)"
++	help
++	  If you say Y here, you will be able to choose a gid to add to the
++	  supplementary groups of users you want to mark as "untrusted."
++	  These users will not be able to execute any files that are not in
++	  root-owned directories writable only by root.  If the sysctl option
++	  is enabled, a sysctl option with name "tpe" is created.
@@ -26739,0 +26205,10 @@
++config GRKERNSEC_TPE_ALL
++	bool "Partially restrict non-root users"
++	depends on GRKERNSEC_TPE
++	help
++	  If you say Y here, All non-root users other than the ones in the
++	  group specified in the main TPE option will only be allowed to
++	  execute files in directories they own that are not group or
++	  world-writable, or in directories owned by root and writable only by
++	  root.  If the sysctl option is enabled, a sysctl option with name
++	  "tpe_restrict_all" is created.
@@ -26741,3 +26216,8 @@
-+#if !defined(CONFIG_CRYPTO) || defined(CONFIG_CRYPTO_MODULE) || !defined(CONFIG_CRYPTO_SHA256) || defined(CONFIG_CRYPTO_SHA256_MODULE)
-+#error "crypto and sha256 must be built into the kernel"
-+#endif
++config GRKERNSEC_TPE_INVERT
++	bool "Invert GID option"
++	depends on GRKERNSEC_TPE
++	help
++	  If you say Y here, the group you specify in the TPE configuration will
++	  decide what group TPE restrictions will be *disabled* for.  This
++	  option is useful if you want TPE restrictions to be applied to most
++	  users on the system.
@@ -26745,11 +26225,11 @@
-+int
-+chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum)
-+{
-+	char *p;
-+	struct crypto_hash *tfm;
-+	struct hash_desc desc;
-+	struct scatterlist sg;
-+	unsigned char temp_sum[GR_SHA_LEN];
-+	volatile int retval = 0;
-+	volatile int dummy = 0;
-+	unsigned int i;
++config GRKERNSEC_TPE_GID
++	int "GID for untrusted users"
++	depends on GRKERNSEC_TPE && !GRKERNSEC_TPE_INVERT
++	default 1005
++	help
++	  If you have selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *disabled* for.
++	  If you have not selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *enabled* for.
++	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
++	  is created.
@@ -26757,5 +26237,11 @@
-+	tfm = crypto_alloc_hash("sha256", 0, CRYPTO_ALG_ASYNC);
-+	if (IS_ERR(tfm)) {
-+		/* should never happen, since sha256 should be built in */
-+		return 1;
-+	}
++config GRKERNSEC_TPE_GID
++	int "GID for trusted users"
++	depends on GRKERNSEC_TPE && GRKERNSEC_TPE_INVERT
++	default 1005
++	help
++	  If you have selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *disabled* for.
++	  If you have not selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *enabled* for.
++	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
++	  is created.
@@ -26763,2 +26249,3 @@
-+	desc.tfm = tfm;
-+	desc.flags = 0;
++endmenu
++menu "Network Protections"
++depends on GRKERNSEC
@@ -26766 +26253,8 @@
-+	crypto_hash_init(&desc);
++config GRKERNSEC_RANDNET
++	bool "Larger entropy pools"
++	help
++	  If you say Y here, the entropy pools used for many features of Linux
++	  and grsecurity will be doubled in size.  Since several grsecurity
++	  features use additional randomness, it is recommended that you say Y
++	  here.  Saying Y here has a similar effect as modifying
++	  /proc/sys/kernel/random/poolsize.
@@ -26768,3 +26262,7 @@
-+	p = salt;
-+	sg_set_buf(&sg, p, GR_SALT_LEN);
-+	crypto_hash_update(&desc, &sg, sg.length);
++config GRKERNSEC_SOCKET
++	bool "Socket restrictions"
++	help
++	  If you say Y here, you will be able to choose from several options.
++	  If you assign a GID on your system and add it to the supplementary
++	  groups of users you want to restrict socket access to, this patch
++	  will perform up to three things, based on the option(s) you choose.
@@ -26772,4 +26270,8 @@
-+	p = entry->pw;
-+	sg_set_buf(&sg, p, strlen(p));
-+	
-+	crypto_hash_update(&desc, &sg, sg.length);
++config GRKERNSEC_SOCKET_ALL
++	bool "Deny any sockets to group"
++	depends on GRKERNSEC_SOCKET
++	help
++	  If you say Y here, you will be able to choose a GID of whose users will
++	  be unable to connect to other hosts from your machine or run server
++	  applications from your machine.  If the sysctl option is enabled, a
++	  sysctl option with name "socket_all" is created.
@@ -26777 +26279,9 @@
-+	crypto_hash_final(&desc, temp_sum);
++config GRKERNSEC_SOCKET_ALL_GID
++	int "GID to deny all sockets for"
++	depends on GRKERNSEC_SOCKET_ALL
++	default 1004
++	help
++	  Here you can choose the GID to disable socket access for. Remember to
++	  add the users you want socket access disabled for to the GID
++	  specified here.  If the sysctl option is enabled, a sysctl option
++	  with name "socket_all_gid" is created.
@@ -26779 +26289,10 @@
-+	memset(entry->pw, 0, GR_PW_LEN);
++config GRKERNSEC_SOCKET_CLIENT
++	bool "Deny client sockets to group"
++	depends on GRKERNSEC_SOCKET
++	help
++	  If you say Y here, you will be able to choose a GID of whose users will
++	  be unable to connect to other hosts from your machine, but will be
++	  able to run servers.  If this option is enabled, all users in the group
++	  you specify will have to use passive mode when initiating ftp transfers
++	  from the shell on your machine.  If the sysctl option is enabled, a
++	  sysctl option with name "socket_client" is created.
@@ -26781,5 +26300,9 @@
-+	for (i = 0; i < GR_SHA_LEN; i++)
-+		if (sum[i] != temp_sum[i])
-+			retval = 1;
-+		else
-+			dummy = 1;	// waste a cycle
++config GRKERNSEC_SOCKET_CLIENT_GID
++	int "GID to deny client sockets for"
++	depends on GRKERNSEC_SOCKET_CLIENT
++	default 1003
++	help
++	  Here you can choose the GID to disable client socket access for.
++	  Remember to add the users you want client socket access disabled for to
++	  the GID specified here.  If the sysctl option is enabled, a sysctl
++	  option with name "socket_client_gid" is created.
@@ -26787 +26310,7 @@
-+	crypto_free_hash(tfm);
++config GRKERNSEC_SOCKET_SERVER
++	bool "Deny server sockets to group"
++	depends on GRKERNSEC_SOCKET
++	help
++	  If you say Y here, you will be able to choose a GID of whose users will
++	  be unable to run server applications from your machine.  If the sysctl
++	  option is enabled, a sysctl option with name "socket_server" is created.
@@ -26789,7 +26318,95 @@
-+	return retval;
-+}
-diff --git a/include/asm-alpha/elf.h b/include/asm-alpha/elf.h
-index fc1002ea1e0c766c5150e633d1a83dfa7700a17f..3aa3841844722bd35b0d77057dcb84a6ca2d0b74 100644
---- a/include/asm-alpha/elf.h
-+++ b/include/asm-alpha/elf.h
-@@ -91,6 +91,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_NFPREG];
++config GRKERNSEC_SOCKET_SERVER_GID
++	int "GID to deny server sockets for"
++	depends on GRKERNSEC_SOCKET_SERVER
++	default 1002
++	help
++	  Here you can choose the GID to disable server socket access for.
++	  Remember to add the users you want server socket access disabled for to
++	  the GID specified here.  If the sysctl option is enabled, a sysctl
++	  option with name "socket_server_gid" is created.
++
++endmenu
++menu "Sysctl support"
++depends on GRKERNSEC && SYSCTL
++
++config GRKERNSEC_SYSCTL
++	bool "Sysctl support"
++	help
++	  If you say Y here, you will be able to change the options that
++	  grsecurity runs with at bootup, without having to recompile your
++	  kernel.  You can echo values to files in /proc/sys/kernel/grsecurity
++	  to enable (1) or disable (0) various features.  All the sysctl entries
++	  are mutable until the "grsec_lock" entry is set to a non-zero value.
++	  All features enabled in the kernel configuration are disabled at boot
++	  if you do not say Y to the "Turn on features by default" option.
++	  All options should be set at startup, and the grsec_lock entry should
++	  be set to a non-zero value after all the options are set.
++	  *THIS IS EXTREMELY IMPORTANT*
++
++config GRKERNSEC_SYSCTL_ON
++	bool "Turn on features by default"
++	depends on GRKERNSEC_SYSCTL
++	help
++	  If you say Y here, instead of having all features enabled in the
++	  kernel configuration disabled at boot time, the features will be
++	  enabled at boot time.  It is recommended you say Y here unless
++	  there is some reason you would want all sysctl-tunable features to
++	  be disabled by default.  As mentioned elsewhere, it is important
++	  to enable the grsec_lock entry once you have finished modifying
++	  the sysctl entries.
++
++endmenu
++menu "Logging Options"
++depends on GRKERNSEC
++
++config GRKERNSEC_FLOODTIME
++	int "Seconds in between log messages (minimum)"
++	default 10
++	help
++	  This option allows you to enforce the number of seconds between
++	  grsecurity log messages.  The default should be suitable for most
++	  people, however, if you choose to change it, choose a value small enough
++	  to allow informative logs to be produced, but large enough to
++	  prevent flooding.
++
++config GRKERNSEC_FLOODBURST
++	int "Number of messages in a burst (maximum)"
++	default 4
++	help
++	  This option allows you to choose the maximum number of messages allowed
++	  within the flood time interval you chose in a separate option.  The
++	  default should be suitable for most people, however if you find that
++	  many of your logs are being interpreted as flooding, you may want to
++	  raise this value.
++
++endmenu
++
++endmenu
+diff -urNp linux-2.6.26.6/grsecurity/Makefile linux-2.6.26.6/grsecurity/Makefile
+--- linux-2.6.26.6/grsecurity/Makefile	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/grsecurity/Makefile	2008-10-11 21:54:20.000000000 -0400
+@@ -0,0 +1,20 @@
++# grsecurity's ACL system was originally written in 2001 by Michael Dalton
++# during 2001-2005 it has been completely redesigned by Brad Spengler
++# into an RBAC system
++#
++# All code in this directory and various hooks inserted throughout the kernel
++# are copyright Brad Spengler, and released under the GPL v2 or higher
++
++obj-y = grsec_chdir.o grsec_chroot.o grsec_exec.o grsec_fifo.o grsec_fork.o \
++	grsec_mount.o grsec_sig.o grsec_sock.o grsec_sysctl.o \
++	grsec_time.o grsec_tpe.o grsec_ipc.o grsec_link.o grsec_textrel.o
++
++obj-$(CONFIG_GRKERNSEC) += grsec_init.o grsum.o gracl.o gracl_ip.o gracl_segv.o \
++	gracl_cap.o gracl_alloc.o gracl_shm.o grsec_mem.o gracl_fs.o \
++	gracl_learn.o grsec_log.o
++obj-$(CONFIG_GRKERNSEC_RESLOG) += gracl_res.o
++
++ifndef CONFIG_GRKERNSEC
++obj-y += grsec_disabled.o
++endif
++
+diff -urNp linux-2.6.26.6/include/asm-alpha/elf.h linux-2.6.26.6/include/asm-alpha/elf.h
+--- linux-2.6.26.6/include/asm-alpha/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-alpha/elf.h	2008-10-11 21:54:20.000000000 -0400
+@@ -91,6 +91,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_N
@@ -26809,4 +26426,3 @@
-diff --git a/include/asm-alpha/kmap_types.h b/include/asm-alpha/kmap_types.h
-index 3e6735a34c571b011172cf54ee3e09db254434da..f39e3316bde9122932ed022da915d35d63d4d866 100644
---- a/include/asm-alpha/kmap_types.h
-+++ b/include/asm-alpha/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-alpha/kmap_types.h linux-2.6.26.6/include/asm-alpha/kmap_types.h
+--- linux-2.6.26.6/include/asm-alpha/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-alpha/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26823,4 +26439,3 @@
-diff --git a/include/asm-alpha/pgtable.h b/include/asm-alpha/pgtable.h
-index 3f0c59f6d8aa07dc5b68f96d1e928ac7f5b222d5..cf1e100bf6d08402668a15899f3be907687257e4 100644
---- a/include/asm-alpha/pgtable.h
-+++ b/include/asm-alpha/pgtable.h
+diff -urNp linux-2.6.26.6/include/asm-alpha/pgtable.h linux-2.6.26.6/include/asm-alpha/pgtable.h
+--- linux-2.6.26.6/include/asm-alpha/pgtable.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-alpha/pgtable.h	2008-10-11 21:54:20.000000000 -0400
@@ -26845,4 +26460,3 @@
-diff --git a/include/asm-arm/elf.h b/include/asm-arm/elf.h
-index 4ca7516274898dafae96518f76a4f6656a352264..5ba8d3798e159bba6cc9361d8ec7999d0ebc6196 100644
---- a/include/asm-arm/elf.h
-+++ b/include/asm-arm/elf.h
+diff -urNp linux-2.6.26.6/include/asm-arm/elf.h linux-2.6.26.6/include/asm-arm/elf.h
+--- linux-2.6.26.6/include/asm-arm/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-arm/elf.h	2008-10-11 21:54:20.000000000 -0400
@@ -26865,4 +26479,3 @@
-diff --git a/include/asm-arm/kmap_types.h b/include/asm-arm/kmap_types.h
-index 45def13ee17a5fc4150a92173f57f556679faee5..3d0f36f7581b3a40f26555b0861e687af99dd189 100644
---- a/include/asm-arm/kmap_types.h
-+++ b/include/asm-arm/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-arm/kmap_types.h linux-2.6.26.6/include/asm-arm/kmap_types.h
+--- linux-2.6.26.6/include/asm-arm/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-arm/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26877,5 +26490,4 @@
-diff --git a/include/asm-avr32/elf.h b/include/asm-avr32/elf.h
-index 64ce40ee1d585d052e437d4f8ada3026e200bcfb..a87cd885547864d05f07da637805ebbaf36a43ef 100644
---- a/include/asm-avr32/elf.h
-+++ b/include/asm-avr32/elf.h
-@@ -85,8 +85,14 @@ typedef struct user_fpu_struct elf_fpregset_t;
+diff -urNp linux-2.6.26.6/include/asm-avr32/elf.h linux-2.6.26.6/include/asm-avr32/elf.h
+--- linux-2.6.26.6/include/asm-avr32/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-avr32/elf.h	2008-10-11 21:54:20.000000000 -0400
+@@ -85,8 +85,14 @@ typedef struct user_fpu_struct elf_fpreg
@@ -26897,4 +26509,3 @@
-diff --git a/include/asm-avr32/kmap_types.h b/include/asm-avr32/kmap_types.h
-index b7f5c6870107544024c03383bfe6974126b46e77..556135c6edde57fd6790b3402a921e1b3e98c92e 100644
---- a/include/asm-avr32/kmap_types.h
-+++ b/include/asm-avr32/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-avr32/kmap_types.h linux-2.6.26.6/include/asm-avr32/kmap_types.h
+--- linux-2.6.26.6/include/asm-avr32/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-avr32/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26911,4 +26522,3 @@
-diff --git a/include/asm-blackfin/kmap_types.h b/include/asm-blackfin/kmap_types.h
-index e215f7104974fb76957d66695185f9e925edc519..0f30004ef284b9aa7c99baab4905794c79c257af 100644
---- a/include/asm-blackfin/kmap_types.h
-+++ b/include/asm-blackfin/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-blackfin/kmap_types.h linux-2.6.26.6/include/asm-blackfin/kmap_types.h
+--- linux-2.6.26.6/include/asm-blackfin/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-blackfin/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26923,4 +26533,3 @@
-diff --git a/include/asm-cris/kmap_types.h b/include/asm-cris/kmap_types.h
-index 492988cb9077978be3a9589173e37381aaaed87a..12b486c65088791314f6ccdf9eafa022ad79bec1 100644
---- a/include/asm-cris/kmap_types.h
-+++ b/include/asm-cris/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-cris/kmap_types.h linux-2.6.26.6/include/asm-cris/kmap_types.h
+--- linux-2.6.26.6/include/asm-cris/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-cris/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26935,4 +26544,3 @@
-diff --git a/include/asm-frv/kmap_types.h b/include/asm-frv/kmap_types.h
-index f8e16b2a58047c35877fe8d8637133af25ec8023..c73ff7949f55c24142124471b26c0bceacbec1e3 100644
---- a/include/asm-frv/kmap_types.h
-+++ b/include/asm-frv/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-frv/kmap_types.h linux-2.6.26.6/include/asm-frv/kmap_types.h
+--- linux-2.6.26.6/include/asm-frv/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-frv/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26947,4 +26555,3 @@
-diff --git a/include/asm-generic/futex.h b/include/asm-generic/futex.h
-index 3c2344f48136d98351f92b6e9d678e29c052658c..4590a7dc48d2503491969364402bfe1dae73ea93 100644
---- a/include/asm-generic/futex.h
-+++ b/include/asm-generic/futex.h
+diff -urNp linux-2.6.26.6/include/asm-generic/futex.h linux-2.6.26.6/include/asm-generic/futex.h
+--- linux-2.6.26.6/include/asm-generic/futex.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-generic/futex.h	2008-10-11 21:54:20.000000000 -0400
@@ -26960 +26567 @@
-@@ -48,7 +48,7 @@ futex_atomic_op_inuser (int encoded_op, int __user *uaddr)
+@@ -48,7 +48,7 @@ futex_atomic_op_inuser (int encoded_op, 
@@ -26969,4 +26576,3 @@
-diff --git a/include/asm-generic/vmlinux.lds.h b/include/asm-generic/vmlinux.lds.h
-index 5a544bf1edb5ff08dd8716c006415bd188c5c3b7..588cfefc43441cf65fc4f20740c4ae26136490ec 100644
---- a/include/asm-generic/vmlinux.lds.h
-+++ b/include/asm-generic/vmlinux.lds.h
+diff -urNp linux-2.6.26.6/include/asm-generic/vmlinux.lds.h linux-2.6.26.6/include/asm-generic/vmlinux.lds.h
+--- linux-2.6.26.6/include/asm-generic/vmlinux.lds.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-generic/vmlinux.lds.h	2008-10-11 21:54:20.000000000 -0400
@@ -26981,4 +26587,3 @@
-diff --git a/include/asm-h8300/kmap_types.h b/include/asm-h8300/kmap_types.h
-index 1ec8a3427120876f6ef7d998b72798a37c0cc53a..ffdcd189a2c57f6872a389b93d68c9a331fa93f7 100644
---- a/include/asm-h8300/kmap_types.h
-+++ b/include/asm-h8300/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-h8300/kmap_types.h linux-2.6.26.6/include/asm-h8300/kmap_types.h
+--- linux-2.6.26.6/include/asm-h8300/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-h8300/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -26993,5 +26598,4 @@
-diff --git a/include/asm-ia64/elf.h b/include/asm-ia64/elf.h
-index 5e0c1a6bce8dea81ef7c8df40855de065a655eca..27f3dfd1438d246823852a3354cd0b9eb92e3d52 100644
---- a/include/asm-ia64/elf.h
-+++ b/include/asm-ia64/elf.h
-@@ -187,7 +187,12 @@ typedef elf_greg_t elf_gregset_t[ELF_NGREG];
+diff -urNp linux-2.6.26.6/include/asm-ia64/elf.h linux-2.6.26.6/include/asm-ia64/elf.h
+--- linux-2.6.26.6/include/asm-ia64/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-ia64/elf.h	2008-10-11 21:54:20.000000000 -0400
+@@ -187,7 +187,12 @@ typedef elf_greg_t elf_gregset_t[ELF_NGR
@@ -27010,4 +26614,3 @@
-diff --git a/include/asm-ia64/kmap_types.h b/include/asm-ia64/kmap_types.h
-index 5d1658aa2b3bf2a4770ce77c02519439a0c73857..1108681a68a80b79d595df71846e2cb75a3512d7 100644
---- a/include/asm-ia64/kmap_types.h
-+++ b/include/asm-ia64/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-ia64/kmap_types.h linux-2.6.26.6/include/asm-ia64/kmap_types.h
+--- linux-2.6.26.6/include/asm-ia64/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-ia64/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27024,4 +26627,3 @@
-diff --git a/include/asm-ia64/pgtable.h b/include/asm-ia64/pgtable.h
-index 7a9bff47564f10c3165123e378ce226e90d55f2b..80631a4752c1871eac482135066c6d55368ddfdc 100644
---- a/include/asm-ia64/pgtable.h
-+++ b/include/asm-ia64/pgtable.h
+diff -urNp linux-2.6.26.6/include/asm-ia64/pgtable.h linux-2.6.26.6/include/asm-ia64/pgtable.h
+--- linux-2.6.26.6/include/asm-ia64/pgtable.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-ia64/pgtable.h	2008-10-11 21:54:20.000000000 -0400
@@ -27046,4 +26648,3 @@
-diff --git a/include/asm-m32r/kmap_types.h b/include/asm-m32r/kmap_types.h
-index fa94dc6410ea1129083a401f01558e5028e05c23..9e51e834a3a88e7ed07309df18fb5ba09e94e847 100644
---- a/include/asm-m32r/kmap_types.h
-+++ b/include/asm-m32r/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-m32r/kmap_types.h linux-2.6.26.6/include/asm-m32r/kmap_types.h
+--- linux-2.6.26.6/include/asm-m32r/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-m32r/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27060,4 +26661,3 @@
-diff --git a/include/asm-m68k/kmap_types.h b/include/asm-m68k/kmap_types.h
-index c843c63d380161411f70e046e16c66705b9a6fac..949e1a9aef996ee72120424fed48f9868105fcf7 100644
---- a/include/asm-m68k/kmap_types.h
-+++ b/include/asm-m68k/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-m68k/kmap_types.h linux-2.6.26.6/include/asm-m68k/kmap_types.h
+--- linux-2.6.26.6/include/asm-m68k/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-m68k/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27072,4 +26672,3 @@
-diff --git a/include/asm-m68knommu/kmap_types.h b/include/asm-m68knommu/kmap_types.h
-index bfb6707575d1a878f9fbd98cf3627dcc28e18085..612b63c99b0aecee9aab7cf8b7c01536cb944fdd 100644
---- a/include/asm-m68knommu/kmap_types.h
-+++ b/include/asm-m68knommu/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-m68knommu/kmap_types.h linux-2.6.26.6/include/asm-m68knommu/kmap_types.h
+--- linux-2.6.26.6/include/asm-m68knommu/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-m68knommu/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27084,5 +26683,4 @@
-diff --git a/include/asm-mips/elf.h b/include/asm-mips/elf.h
-index f69f7acba6378542b606bed125bd409a3ec90cbf..768ad378e335d76997c44603e7a2ebebf8f8f169 100644
---- a/include/asm-mips/elf.h
-+++ b/include/asm-mips/elf.h
-@@ -368,4 +368,11 @@ extern int dump_task_fpu(struct task_struct *, elf_fpregset_t *);
+diff -urNp linux-2.6.26.6/include/asm-mips/elf.h linux-2.6.26.6/include/asm-mips/elf.h
+--- linux-2.6.26.6/include/asm-mips/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-mips/elf.h	2008-10-11 21:54:20.000000000 -0400
+@@ -368,4 +368,11 @@ extern int dump_task_fpu(struct task_str
@@ -27100,4 +26698,3 @@
-diff --git a/include/asm-mips/kmap_types.h b/include/asm-mips/kmap_types.h
-index 806aae3c533892b1e65917c4742943ff2692374b..a94b8d27713c603d4aaa1eee2bb3bcdf7e8089b7 100644
---- a/include/asm-mips/kmap_types.h
-+++ b/include/asm-mips/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-mips/kmap_types.h linux-2.6.26.6/include/asm-mips/kmap_types.h
+--- linux-2.6.26.6/include/asm-mips/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-mips/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27114,5 +26711,4 @@
-diff --git a/include/asm-mips/page.h b/include/asm-mips/page.h
-index 8735aa0b89630987f9d7341efa88e13a4bf9eb7a..b5f0dce80fff356a5ea1f5fd4fb28f421280602f 100644
---- a/include/asm-mips/page.h
-+++ b/include/asm-mips/page.h
-@@ -79,7 +79,7 @@ extern void copy_user_highpage(struct page *to, struct page *from,
+diff -urNp linux-2.6.26.6/include/asm-mips/page.h linux-2.6.26.6/include/asm-mips/page.h
+--- linux-2.6.26.6/include/asm-mips/page.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-mips/page.h	2008-10-11 21:54:20.000000000 -0400
+@@ -79,7 +79,7 @@ extern void copy_user_highpage(struct pa
@@ -27127,4 +26723,3 @@
-diff --git a/include/asm-mips/system.h b/include/asm-mips/system.h
-index a944eda4faf5ef5f1f3e6ff53932056cf4ce7e4f..9c5b6d1f7ce9ae23fb4cc9e44a2a00e1e7b7395b 100644
---- a/include/asm-mips/system.h
-+++ b/include/asm-mips/system.h
+diff -urNp linux-2.6.26.6/include/asm-mips/system.h linux-2.6.26.6/include/asm-mips/system.h
+--- linux-2.6.26.6/include/asm-mips/system.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-mips/system.h	2008-10-11 21:54:20.000000000 -0400
@@ -27139,5 +26734,4 @@
-diff --git a/include/asm-parisc/elf.h b/include/asm-parisc/elf.h
-index d0a4a82628181578a943ae082c60ae8b63959411..0fb90ecdb6e180601c582746bd7de74738a0efa6 100644
---- a/include/asm-parisc/elf.h
-+++ b/include/asm-parisc/elf.h
-@@ -333,6 +333,13 @@ struct pt_regs;	/* forward declaration... */
+diff -urNp linux-2.6.26.6/include/asm-parisc/elf.h linux-2.6.26.6/include/asm-parisc/elf.h
+--- linux-2.6.26.6/include/asm-parisc/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-parisc/elf.h	2008-10-11 21:54:20.000000000 -0400
+@@ -333,6 +333,13 @@ struct pt_regs;	/* forward declaration..
@@ -27157,4 +26751,3 @@
-diff --git a/include/asm-parisc/kmap_types.h b/include/asm-parisc/kmap_types.h
-index 806aae3c533892b1e65917c4742943ff2692374b..a94b8d27713c603d4aaa1eee2bb3bcdf7e8089b7 100644
---- a/include/asm-parisc/kmap_types.h
-+++ b/include/asm-parisc/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-parisc/kmap_types.h linux-2.6.26.6/include/asm-parisc/kmap_types.h
+--- linux-2.6.26.6/include/asm-parisc/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-parisc/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27171,4 +26764,3 @@
-diff --git a/include/asm-parisc/pgtable.h b/include/asm-parisc/pgtable.h
-index 470a4b88124da2fcfb8c9936f523abd2662079a2..e8ad38e85007387ce420a4ad11d016c2a917cefa 100644
---- a/include/asm-parisc/pgtable.h
-+++ b/include/asm-parisc/pgtable.h
+diff -urNp linux-2.6.26.6/include/asm-parisc/pgtable.h linux-2.6.26.6/include/asm-parisc/pgtable.h
+--- linux-2.6.26.6/include/asm-parisc/pgtable.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-parisc/pgtable.h	2008-10-11 21:54:20.000000000 -0400
@@ -27193,5 +26785,4 @@
-diff --git a/include/asm-powerpc/elf.h b/include/asm-powerpc/elf.h
-index 9080d85cb9d006619d0b8543f36232c41b594bf1..91eafe88c5fc5670699f89c631e8b39643cd881b 100644
---- a/include/asm-powerpc/elf.h
-+++ b/include/asm-powerpc/elf.h
-@@ -160,6 +160,18 @@ typedef elf_vrreg_t elf_vrregset_t[ELF_NVRREG];
+diff -urNp linux-2.6.26.6/include/asm-powerpc/elf.h linux-2.6.26.6/include/asm-powerpc/elf.h
+--- linux-2.6.26.6/include/asm-powerpc/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-powerpc/elf.h	2008-10-11 21:54:20.000000000 -0400
+@@ -160,6 +160,18 @@ typedef elf_vrreg_t elf_vrregset_t[ELF_N
@@ -27216,4 +26807,3 @@
-diff --git a/include/asm-powerpc/kmap_types.h b/include/asm-powerpc/kmap_types.h
-index b6bac6f61c16d60465b17da5cc77ba81e059ec5e..74d63c5429ead26adcd1c7265c27a6e8881bef1e 100644
---- a/include/asm-powerpc/kmap_types.h
-+++ b/include/asm-powerpc/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-powerpc/kmap_types.h linux-2.6.26.6/include/asm-powerpc/kmap_types.h
+--- linux-2.6.26.6/include/asm-powerpc/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-powerpc/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27228,20 +26818,3 @@
-diff --git a/include/asm-powerpc/page.h b/include/asm-powerpc/page.h
-index cffdf0eb0df68068fb0720a8ba9adff870be5fbe..5d7b2b4f76a99ed9ec6103eae53e9d6045d018c3 100644
---- a/include/asm-powerpc/page.h
-+++ b/include/asm-powerpc/page.h
-@@ -100,8 +100,9 @@ extern phys_addr_t kernstart_addr;
-  * and needs to be executable.  This means the whole heap ends
-  * up being executable.
-  */
--#define VM_DATA_DEFAULT_FLAGS32	(VM_READ | VM_WRITE | VM_EXEC | \
--				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
-+#define VM_DATA_DEFAULT_FLAGS32 \
-+	(((current->personality & READ_IMPLIES_EXEC) ? VM_EXEC : 0) | \
-+	 VM_READ | VM_WRITE | VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
- 
- #define VM_DATA_DEFAULT_FLAGS64	(VM_READ | VM_WRITE | \
- 				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
-diff --git a/include/asm-powerpc/page_64.h b/include/asm-powerpc/page_64.h
-index 25af4fc8daf40976d030c66dc553fd6c1802662e..7847f8a4ad3dd4b7a3caf2fc8f41426367406ae1 100644
---- a/include/asm-powerpc/page_64.h
-+++ b/include/asm-powerpc/page_64.h
+diff -urNp linux-2.6.26.6/include/asm-powerpc/page_64.h linux-2.6.26.6/include/asm-powerpc/page_64.h
+--- linux-2.6.26.6/include/asm-powerpc/page_64.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-powerpc/page_64.h	2008-10-11 21:54:20.000000000 -0400
@@ -27269,5 +26842,19 @@
-diff --git a/include/asm-ppc/mmu_context.h b/include/asm-ppc/mmu_context.h
-index 9f097e25b169bbba0940f4745cffdfa544ccfa98..7b9bd29d18e3bd9485c4ce9a850390c7136b35a0 100644
---- a/include/asm-ppc/mmu_context.h
-+++ b/include/asm-ppc/mmu_context.h
-@@ -141,7 +141,8 @@ static inline void get_mmu_context(struct mm_struct *mm)
+diff -urNp linux-2.6.26.6/include/asm-powerpc/page.h linux-2.6.26.6/include/asm-powerpc/page.h
+--- linux-2.6.26.6/include/asm-powerpc/page.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-powerpc/page.h	2008-10-11 21:54:20.000000000 -0400
+@@ -100,8 +100,9 @@ extern phys_addr_t kernstart_addr;
+  * and needs to be executable.  This means the whole heap ends
+  * up being executable.
+  */
+-#define VM_DATA_DEFAULT_FLAGS32	(VM_READ | VM_WRITE | VM_EXEC | \
+-				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
++#define VM_DATA_DEFAULT_FLAGS32 \
++	(((current->personality & READ_IMPLIES_EXEC) ? VM_EXEC : 0) | \
++	 VM_READ | VM_WRITE | VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
+ 
+ #define VM_DATA_DEFAULT_FLAGS64	(VM_READ | VM_WRITE | \
+ 				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
+diff -urNp linux-2.6.26.6/include/asm-ppc/mmu_context.h linux-2.6.26.6/include/asm-ppc/mmu_context.h
+--- linux-2.6.26.6/include/asm-ppc/mmu_context.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-ppc/mmu_context.h	2008-10-11 21:54:20.000000000 -0400
+@@ -141,7 +141,8 @@ static inline void get_mmu_context(struc
@@ -27283,5 +26870,4 @@
-diff --git a/include/asm-ppc/pgtable.h b/include/asm-ppc/pgtable.h
-index 55f9d38e3bf8702d302054ead258bf588edf199b..3bcd84900ec41634558a40a9b56d83c0586987d6 100644
---- a/include/asm-ppc/pgtable.h
-+++ b/include/asm-ppc/pgtable.h
-@@ -390,11 +390,21 @@ extern unsigned long ioremap_bot, ioremap_base;
+diff -urNp linux-2.6.26.6/include/asm-ppc/pgtable.h linux-2.6.26.6/include/asm-ppc/pgtable.h
+--- linux-2.6.26.6/include/asm-ppc/pgtable.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-ppc/pgtable.h	2008-10-11 21:54:20.000000000 -0400
+@@ -390,11 +390,21 @@ extern unsigned long ioremap_bot, iorema
@@ -27312 +26898 @@
-@@ -406,21 +416,21 @@ extern unsigned long ioremap_bot, ioremap_base;
+@@ -406,21 +416,21 @@ extern unsigned long ioremap_bot, iorema
@@ -27344,4 +26930,3 @@
-diff --git a/include/asm-s390/kmap_types.h b/include/asm-s390/kmap_types.h
-index fd1574648223b5aaa3a9bb60255098a64b4db919..b5fabe7c834e05fb08f97201bb42fe9dc29fbf33 100644
---- a/include/asm-s390/kmap_types.h
-+++ b/include/asm-s390/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-s390/kmap_types.h linux-2.6.26.6/include/asm-s390/kmap_types.h
+--- linux-2.6.26.6/include/asm-s390/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-s390/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27356,4 +26941,3 @@
-diff --git a/include/asm-sh/kmap_types.h b/include/asm-sh/kmap_types.h
-index 84d565c696befbaee91e7770721d1ec2a5ed6f8c..1afe64ecf096b8da52c0cb921447910397253cfd 100644
---- a/include/asm-sh/kmap_types.h
-+++ b/include/asm-sh/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-sh/kmap_types.h linux-2.6.26.6/include/asm-sh/kmap_types.h
+--- linux-2.6.26.6/include/asm-sh/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sh/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27370,4 +26954,3 @@
-diff --git a/include/asm-sparc/elf.h b/include/asm-sparc/elf.h
-index d043f80bc2fd4b858a260c91d00e1592bc780caf..1f14718f116a3a06f1a05d661b5c096ebe1507df 100644
---- a/include/asm-sparc/elf.h
-+++ b/include/asm-sparc/elf.h
+diff -urNp linux-2.6.26.6/include/asm-sparc/elf.h linux-2.6.26.6/include/asm-sparc/elf.h
+--- linux-2.6.26.6/include/asm-sparc/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sparc/elf.h	2008-10-11 21:54:20.000000000 -0400
@@ -27388,4 +26971,3 @@
-diff --git a/include/asm-sparc/kmap_types.h b/include/asm-sparc/kmap_types.h
-index e215f7104974fb76957d66695185f9e925edc519..0f30004ef284b9aa7c99baab4905794c79c257af 100644
---- a/include/asm-sparc/kmap_types.h
-+++ b/include/asm-sparc/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-sparc/kmap_types.h linux-2.6.26.6/include/asm-sparc/kmap_types.h
+--- linux-2.6.26.6/include/asm-sparc/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sparc/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27400,4 +26982,3 @@
-diff --git a/include/asm-sparc/pgtable.h b/include/asm-sparc/pgtable.h
-index 60512296b2ca9468b04b174d61a867cf9c954680..9ecda08e235c0c42c61ab4e56b2faf554095a4ed 100644
---- a/include/asm-sparc/pgtable.h
-+++ b/include/asm-sparc/pgtable.h
+diff -urNp linux-2.6.26.6/include/asm-sparc/pgtable.h linux-2.6.26.6/include/asm-sparc/pgtable.h
+--- linux-2.6.26.6/include/asm-sparc/pgtable.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sparc/pgtable.h	2008-10-11 21:54:20.000000000 -0400
@@ -27435,4 +27016,3 @@
-diff --git a/include/asm-sparc/pgtsrmmu.h b/include/asm-sparc/pgtsrmmu.h
-index 808555fc1d58bd6257adef1876b621df9e23426d..f038dc5fd241376d1f15daf0ff0c120c10b0bff3 100644
---- a/include/asm-sparc/pgtsrmmu.h
-+++ b/include/asm-sparc/pgtsrmmu.h
+diff -urNp linux-2.6.26.6/include/asm-sparc/pgtsrmmu.h linux-2.6.26.6/include/asm-sparc/pgtsrmmu.h
+--- linux-2.6.26.6/include/asm-sparc/pgtsrmmu.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sparc/pgtsrmmu.h	2008-10-11 21:54:20.000000000 -0400
@@ -27456,4 +27036,3 @@
-diff --git a/include/asm-sparc64/elf.h b/include/asm-sparc64/elf.h
-index 0818a1308f4e7a252b213d07a0025f5e70c72dca..ab3ff260d7be9a983e39d789d48040491d19146e 100644
---- a/include/asm-sparc64/elf.h
-+++ b/include/asm-sparc64/elf.h
+diff -urNp linux-2.6.26.6/include/asm-sparc64/elf.h linux-2.6.26.6/include/asm-sparc64/elf.h
+--- linux-2.6.26.6/include/asm-sparc64/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sparc64/elf.h	2008-10-11 21:54:20.000000000 -0400
@@ -27473,4 +27052,3 @@
-diff --git a/include/asm-sparc64/kmap_types.h b/include/asm-sparc64/kmap_types.h
-index 34c1d3d9a3b0cb30ae0d19502d88a6ee82069977..6993ca7c252ce8280b855a8813442b7d5f7f323c 100644
---- a/include/asm-sparc64/kmap_types.h
-+++ b/include/asm-sparc64/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-sparc64/kmap_types.h linux-2.6.26.6/include/asm-sparc64/kmap_types.h
+--- linux-2.6.26.6/include/asm-sparc64/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-sparc64/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27485,4 +27063,3 @@
-diff --git a/include/asm-um/kmap_types.h b/include/asm-um/kmap_types.h
-index 6c03acdb4405bf0eb1fc4a05d546cebf25aae6e7..a5e021544af6482c3ce30fd911d44dbcbcd7599b 100644
---- a/include/asm-um/kmap_types.h
-+++ b/include/asm-um/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-um/kmap_types.h linux-2.6.26.6/include/asm-um/kmap_types.h
+--- linux-2.6.26.6/include/asm-um/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-um/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27497,4 +27074,3 @@
-diff --git a/include/asm-um/page.h b/include/asm-um/page.h
-index 916e1a61999f4b414b94e31db9b928c09ef69aff..dfcf6f4d1df81d0c68c188480fe41a1ffdc0f923 100644
---- a/include/asm-um/page.h
-+++ b/include/asm-um/page.h
+diff -urNp linux-2.6.26.6/include/asm-um/page.h linux-2.6.26.6/include/asm-um/page.h
+--- linux-2.6.26.6/include/asm-um/page.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-um/page.h	2008-10-11 21:55:07.000000000 -0400
@@ -27511,4 +27087,3 @@
-diff --git a/include/asm-v850/kmap_types.h b/include/asm-v850/kmap_types.h
-index 3288976b161f52b18a278a42d2d66980d78fe875..321e0b2d5e4fa77eded63e21628d1afb77fa551e 100644
---- a/include/asm-v850/kmap_types.h
-+++ b/include/asm-v850/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-v850/kmap_types.h linux-2.6.26.6/include/asm-v850/kmap_types.h
+--- linux-2.6.26.6/include/asm-v850/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-v850/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -27523,5 +27098,4 @@
-diff --git a/include/asm-x86/alternative.h b/include/asm-x86/alternative.h
-index 1f6a9ca1012607de987efdf28d2ce19db3c423e5..c9cbedab64403ec2b9e5b4a2b8f02d780d5aaafa 100644
---- a/include/asm-x86/alternative.h
-+++ b/include/asm-x86/alternative.h
-@@ -94,7 +94,7 @@ static inline void alternatives_smp_switch(int smp) {}
+diff -urNp linux-2.6.26.6/include/asm-x86/alternative.h linux-2.6.26.6/include/asm-x86/alternative.h
+--- linux-2.6.26.6/include/asm-x86/alternative.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/alternative.h	2008-10-11 21:54:20.000000000 -0400
+@@ -94,7 +94,7 @@ static inline void alternatives_smp_swit
@@ -27536 +27110 @@
-@@ -118,7 +118,7 @@ static inline void alternatives_smp_switch(int smp) {}
+@@ -118,7 +118,7 @@ static inline void alternatives_smp_swit
@@ -27545 +27119 @@
-@@ -133,7 +133,7 @@ static inline void alternatives_smp_switch(int smp) {}
+@@ -133,7 +133,7 @@ static inline void alternatives_smp_swit
@@ -27554,4 +27128,3 @@
-diff --git a/include/asm-x86/apic.h b/include/asm-x86/apic.h
-index be9639a9a186244fef74318f901172415a7e9343..f347663e589e41c7743f626ace897ce2fdd0f37b 100644
---- a/include/asm-x86/apic.h
-+++ b/include/asm-x86/apic.h
+diff -urNp linux-2.6.26.6/include/asm-x86/apic.h linux-2.6.26.6/include/asm-x86/apic.h
+--- linux-2.6.26.6/include/asm-x86/apic.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/apic.h	2008-10-11 21:54:20.000000000 -0400
@@ -27567,4 +27140,3 @@
-diff --git a/include/asm-x86/atomic_32.h b/include/asm-x86/atomic_32.h
-index 21a4825148c09e34c70db728f68951ff32e631f8..5f8795e21a4d0a19853f31c2a3dccd67973550df 100644
---- a/include/asm-x86/atomic_32.h
-+++ b/include/asm-x86/atomic_32.h
+diff -urNp linux-2.6.26.6/include/asm-x86/atomic_32.h linux-2.6.26.6/include/asm-x86/atomic_32.h
+--- linux-2.6.26.6/include/asm-x86/atomic_32.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/atomic_32.h	2008-10-11 21:54:20.000000000 -0400
@@ -27588 +27160 @@
-@@ -61,7 +69,15 @@ static inline void atomic_add(int i, atomic_t *v)
+@@ -61,7 +69,15 @@ static inline void atomic_add(int i, ato
@@ -27605 +27177 @@
-@@ -79,7 +95,16 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -79,7 +95,16 @@ static inline int atomic_sub_and_test(in
@@ -27623 +27195 @@
-@@ -93,7 +118,18 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -93,7 +118,18 @@ static inline int atomic_sub_and_test(in
@@ -27643 +27215 @@
-@@ -105,7 +141,18 @@ static inline void atomic_inc(atomic_t *v)
+@@ -105,7 +141,18 @@ static inline void atomic_inc(atomic_t *
@@ -27663 +27235 @@
-@@ -121,7 +168,19 @@ static inline int atomic_dec_and_test(atomic_t *v)
+@@ -121,7 +168,19 @@ static inline int atomic_dec_and_test(at
@@ -27684 +27256 @@
-@@ -139,7 +198,19 @@ static inline int atomic_inc_and_test(atomic_t *v)
+@@ -139,7 +198,19 @@ static inline int atomic_inc_and_test(at
@@ -27705 +27277 @@
-@@ -158,7 +229,16 @@ static inline int atomic_add_negative(int i, atomic_t *v)
+@@ -158,7 +229,16 @@ static inline int atomic_add_negative(in
@@ -27723 +27295 @@
-@@ -181,7 +261,15 @@ static inline int atomic_add_return(int i, atomic_t *v)
+@@ -181,7 +261,15 @@ static inline int atomic_add_return(int 
@@ -27740,4 +27312,3 @@
-diff --git a/include/asm-x86/atomic_64.h b/include/asm-x86/atomic_64.h
-index 3e0cd7d3833569bab88b4e7414201aafa0d0dab2..de5b9a79929d4b8e47df2aecb973c52f391a7964 100644
---- a/include/asm-x86/atomic_64.h
-+++ b/include/asm-x86/atomic_64.h
+diff -urNp linux-2.6.26.6/include/asm-x86/atomic_64.h linux-2.6.26.6/include/asm-x86/atomic_64.h
+--- linux-2.6.26.6/include/asm-x86/atomic_64.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/atomic_64.h	2008-10-11 21:54:20.000000000 -0400
@@ -27761 +27332 @@
-@@ -68,7 +76,15 @@ static inline void atomic_add(int i, atomic_t *v)
+@@ -68,7 +76,15 @@ static inline void atomic_add(int i, ato
@@ -27778 +27349 @@
-@@ -86,7 +102,16 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -86,7 +102,16 @@ static inline int atomic_sub_and_test(in
@@ -27796 +27367 @@
-@@ -100,7 +125,19 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -100,7 +125,19 @@ static inline int atomic_sub_and_test(in
@@ -27817 +27388 @@
-@@ -113,7 +150,19 @@ static inline void atomic_inc(atomic_t *v)
+@@ -113,7 +150,19 @@ static inline void atomic_inc(atomic_t *
@@ -27838 +27409 @@
-@@ -130,7 +179,20 @@ static inline int atomic_dec_and_test(atomic_t *v)
+@@ -130,7 +179,20 @@ static inline int atomic_dec_and_test(at
@@ -27860 +27431 @@
-@@ -148,7 +210,20 @@ static inline int atomic_inc_and_test(atomic_t *v)
+@@ -148,7 +210,20 @@ static inline int atomic_inc_and_test(at
@@ -27882 +27453 @@
-@@ -167,7 +242,16 @@ static inline int atomic_add_negative(int i, atomic_t *v)
+@@ -167,7 +242,16 @@ static inline int atomic_add_negative(in
@@ -27900 +27471 @@
-@@ -183,7 +267,15 @@ static inline int atomic_add_negative(int i, atomic_t *v)
+@@ -183,7 +267,15 @@ static inline int atomic_add_negative(in
@@ -27934 +27505 @@
-@@ -246,7 +346,15 @@ static inline void atomic64_add(long i, atomic64_t *v)
+@@ -246,7 +346,15 @@ static inline void atomic64_add(long i, 
@@ -27951 +27522 @@
-@@ -264,7 +372,16 @@ static inline int atomic64_sub_and_test(long i, atomic64_t *v)
+@@ -264,7 +372,16 @@ static inline int atomic64_sub_and_test(
@@ -27969 +27540 @@
-@@ -278,7 +395,19 @@ static inline int atomic64_sub_and_test(long i, atomic64_t *v)
+@@ -278,7 +395,19 @@ static inline int atomic64_sub_and_test(
@@ -27990 +27561 @@
-@@ -291,7 +420,19 @@ static inline void atomic64_inc(atomic64_t *v)
+@@ -291,7 +420,19 @@ static inline void atomic64_inc(atomic64
@@ -28011 +27582 @@
-@@ -308,7 +449,20 @@ static inline int atomic64_dec_and_test(atomic64_t *v)
+@@ -308,7 +449,20 @@ static inline int atomic64_dec_and_test(
@@ -28033 +27604 @@
-@@ -326,7 +480,20 @@ static inline int atomic64_inc_and_test(atomic64_t *v)
+@@ -326,7 +480,20 @@ static inline int atomic64_inc_and_test(
@@ -28055 +27626 @@
-@@ -345,7 +512,16 @@ static inline int atomic64_add_negative(long i, atomic64_t *v)
+@@ -345,7 +512,16 @@ static inline int atomic64_add_negative(
@@ -28073 +27644 @@
-@@ -361,7 +537,15 @@ static inline int atomic64_add_negative(long i, atomic64_t *v)
+@@ -361,7 +537,15 @@ static inline int atomic64_add_negative(
@@ -28090,4 +27661,3 @@
-diff --git a/include/asm-x86/boot.h b/include/asm-x86/boot.h
-index 2faed7ecb092a7893c89c573b7ac9870e060d8a7..8cf3d040702c485533e7b4df1c7d411b67969de7 100644
---- a/include/asm-x86/boot.h
-+++ b/include/asm-x86/boot.h
+diff -urNp linux-2.6.26.6/include/asm-x86/boot.h linux-2.6.26.6/include/asm-x86/boot.h
+--- linux-2.6.26.6/include/asm-x86/boot.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/boot.h	2008-10-11 21:54:20.000000000 -0400
@@ -28111,4 +27681,3 @@
-diff --git a/include/asm-x86/cache.h b/include/asm-x86/cache.h
-index 1e0bac86f38f8ee4f950380e4e1845a49fec6b30..2f84a3ad7a34624aac67306451dae7d33ae4a5ff 100644
---- a/include/asm-x86/cache.h
-+++ b/include/asm-x86/cache.h
+diff -urNp linux-2.6.26.6/include/asm-x86/cache.h linux-2.6.26.6/include/asm-x86/cache.h
+--- linux-2.6.26.6/include/asm-x86/cache.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/cache.h	2008-10-11 21:54:20.000000000 -0400
@@ -28123,5 +27692,4 @@
-diff --git a/include/asm-x86/checksum_32.h b/include/asm-x86/checksum_32.h
-index 52bbb0d8c4c15ce08c2d155fc23f031b98384547..01e55cc8aa49a33cda0d3252f00c3f8ddb725909 100644
---- a/include/asm-x86/checksum_32.h
-+++ b/include/asm-x86/checksum_32.h
-@@ -31,6 +31,14 @@ asmlinkage __wsum csum_partial_copy_generic(const void *src, void *dst,
+diff -urNp linux-2.6.26.6/include/asm-x86/checksum_32.h linux-2.6.26.6/include/asm-x86/checksum_32.h
+--- linux-2.6.26.6/include/asm-x86/checksum_32.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/checksum_32.h	2008-10-11 21:54:20.000000000 -0400
+@@ -31,6 +31,14 @@ asmlinkage __wsum csum_partial_copy_gene
@@ -28142 +27710 @@
-@@ -50,7 +58,7 @@ static inline __wsum csum_partial_copy_from_user(const void __user *src,
+@@ -50,7 +58,7 @@ static inline __wsum csum_partial_copy_f
@@ -28151 +27719 @@
-@@ -177,7 +185,7 @@ static inline __wsum csum_and_copy_to_user(const void *src,
+@@ -177,7 +185,7 @@ static inline __wsum csum_and_copy_to_us
@@ -28160,5 +27728,4 @@
-diff --git a/include/asm-x86/desc.h b/include/asm-x86/desc.h
-index 28bddbcb38be7e3d27cd73fc0a725aef68a26ad0..97b85a912bef1dd4b15cfe08067a22b1c85ad51d 100644
---- a/include/asm-x86/desc.h
-+++ b/include/asm-x86/desc.h
-@@ -16,6 +16,7 @@ static inline void fill_ldt(struct desc_struct *desc,
+diff -urNp linux-2.6.26.6/include/asm-x86/desc.h linux-2.6.26.6/include/asm-x86/desc.h
+--- linux-2.6.26.6/include/asm-x86/desc.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/desc.h	2008-10-11 21:54:20.000000000 -0400
+@@ -16,6 +16,7 @@ static inline void fill_ldt(struct desc_
@@ -28172 +27739 @@
-@@ -27,14 +28,15 @@ static inline void fill_ldt(struct desc_struct *desc,
+@@ -27,14 +28,15 @@ static inline void fill_ldt(struct desc_
@@ -28178 +27745,6 @@
-+
+ 
+-#ifdef CONFIG_X86_64
+-extern struct desc_struct cpu_gdt_table[GDT_ENTRIES];
+-extern struct desc_ptr cpu_gdt_descr[];
+-/* the cpu gdt accessor */
+-#define get_cpu_gdt_table(x) ((struct desc_struct *)cpu_gdt_descr[x].address)
@@ -28185,6 +27757 @@
- #ifdef CONFIG_X86_64
--extern struct desc_struct cpu_gdt_table[GDT_ENTRIES];
--extern struct desc_ptr cpu_gdt_descr[];
--/* the cpu gdt accessor */
--#define get_cpu_gdt_table(x) ((struct desc_struct *)cpu_gdt_descr[x].address)
--
++#ifdef CONFIG_X86_64
@@ -28194 +27761 @@
-@@ -51,16 +53,6 @@ static inline void pack_gate(gate_desc *gate, unsigned type, unsigned long func,
+@@ -51,16 +53,6 @@ static inline void pack_gate(gate_desc *
@@ -28211 +27778 @@
-@@ -69,7 +61,6 @@ static inline void pack_gate(gate_desc *gate, unsigned char type,
+@@ -69,7 +61,6 @@ static inline void pack_gate(gate_desc *
@@ -28219 +27786 @@
-@@ -106,19 +97,48 @@ static inline int desc_empty(const void *ptr)
+@@ -106,19 +97,48 @@ static inline int desc_empty(const void 
@@ -28268 +27835 @@
-@@ -130,7 +150,17 @@ static inline void native_write_gdt_entry(struct desc_struct *gdt, int entry,
+@@ -130,7 +150,17 @@ static inline void native_write_gdt_entr
@@ -28286 +27853 @@
-@@ -202,7 +232,19 @@ static inline void native_set_ldt(const void *addr, unsigned int entries)
+@@ -202,7 +232,19 @@ static inline void native_set_ldt(const 
@@ -28306 +27873 @@
-@@ -237,8 +279,19 @@ static inline void native_load_tls(struct thread_struct *t, unsigned int cpu)
+@@ -237,8 +279,19 @@ static inline void native_load_tls(struc
@@ -28326 +27893 @@
-@@ -354,6 +407,18 @@ static inline void set_system_gate_ist(int n, void *addr, unsigned ist)
+@@ -354,6 +407,18 @@ static inline void set_system_gate_ist(i
@@ -28345,4 +27912,3 @@
-diff --git a/include/asm-x86/e820.h b/include/asm-x86/e820.h
-index 7004251fc66bd7925a787bd09ccb675dc0714de8..93c1986ede715f3d755ddbda9a39b51383dfcd61 100644
---- a/include/asm-x86/e820.h
-+++ b/include/asm-x86/e820.h
+diff -urNp linux-2.6.26.6/include/asm-x86/e820.h linux-2.6.26.6/include/asm-x86/e820.h
+--- linux-2.6.26.6/include/asm-x86/e820.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/e820.h	2008-10-11 21:54:20.000000000 -0400
@@ -28358,4 +27924,3 @@
-diff --git a/include/asm-x86/elf.h b/include/asm-x86/elf.h
-index 8f232dc5b5fe09dc81274a5eb830ee352c052169..fef42b5122264ffaa48cfef76a9fe56e16250b26 100644
---- a/include/asm-x86/elf.h
-+++ b/include/asm-x86/elf.h
+diff -urNp linux-2.6.26.6/include/asm-x86/elf.h linux-2.6.26.6/include/asm-x86/elf.h
+--- linux-2.6.26.6/include/asm-x86/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/elf.h	2008-10-11 21:54:20.000000000 -0400
@@ -28407 +27972 @@
-@@ -329,7 +346,4 @@ extern int arch_setup_additional_pages(struct linux_binprm *bprm,
+@@ -329,7 +346,4 @@ extern int arch_setup_additional_pages(s
@@ -28415,4 +27980,3 @@
-diff --git a/include/asm-x86/futex.h b/include/asm-x86/futex.h
-index e7a76b37b333cc8b40295d7379f8cbb46b241a29..c6a5ea881180a7a7adcf8a71985804041cd48206 100644
---- a/include/asm-x86/futex.h
-+++ b/include/asm-x86/futex.h
+diff -urNp linux-2.6.26.6/include/asm-x86/futex.h linux-2.6.26.6/include/asm-x86/futex.h
+--- linux-2.6.26.6/include/asm-x86/futex.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/futex.h	2008-10-11 21:55:52.000000000 -0400
@@ -28471 +28035 @@
-@@ -61,11 +96,20 @@ static inline int futex_atomic_op_inuser(int encoded_op, int __user *uaddr)
+@@ -61,11 +96,20 @@ static inline int futex_atomic_op_inuser
@@ -28492 +28056 @@
-@@ -109,7 +153,7 @@ static inline int futex_atomic_op_inuser(int encoded_op, int __user *uaddr)
+@@ -109,7 +153,7 @@ static inline int futex_atomic_op_inuser
@@ -28501 +28065 @@
-@@ -122,14 +166,27 @@ static inline int futex_atomic_cmpxchg_inatomic(int __user *uaddr, int oldval,
+@@ -122,14 +166,27 @@ static inline int futex_atomic_cmpxchg_i
@@ -28530,5 +28094,4 @@
-diff --git a/include/asm-x86/i387.h b/include/asm-x86/i387.h
-index 56d00e31aec0064856fb0c04a80df039b037a30b..202a6dfb4d2c4c2bcd5f0b917ca55501d163bf7e 100644
---- a/include/asm-x86/i387.h
-+++ b/include/asm-x86/i387.h
-@@ -159,13 +159,8 @@ static inline void restore_fpu(struct task_struct *tsk)
+diff -urNp linux-2.6.26.6/include/asm-x86/i387.h linux-2.6.26.6/include/asm-x86/i387.h
+--- linux-2.6.26.6/include/asm-x86/i387.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/i387.h	2008-10-11 21:54:20.000000000 -0400
+@@ -159,13 +159,8 @@ static inline void restore_fpu(struct ta
@@ -28550,5 +28113,4 @@
-diff --git a/include/asm-x86/io_64.h b/include/asm-x86/io_64.h
-index 0930bedf9e4d0ca4636a50d766368106ddf4d3ab..9b5712599670cf463e6be25a61b06bef4192a6e5 100644
---- a/include/asm-x86/io_64.h
-+++ b/include/asm-x86/io_64.h
-@@ -158,6 +158,17 @@ static inline void *phys_to_virt(unsigned long address)
+diff -urNp linux-2.6.26.6/include/asm-x86/io_64.h linux-2.6.26.6/include/asm-x86/io_64.h
+--- linux-2.6.26.6/include/asm-x86/io_64.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/io_64.h	2008-10-11 21:54:20.000000000 -0400
+@@ -158,6 +158,17 @@ static inline void *phys_to_virt(unsigne
@@ -28572,5 +28134,4 @@
-diff --git a/include/asm-x86/irqflags.h b/include/asm-x86/irqflags.h
-index c242527f970e8e7f8ae33e6dc080216560fbaa96..9f9015af426eef0bae74a34ee97a6ef76e278e8d 100644
---- a/include/asm-x86/irqflags.h
-+++ b/include/asm-x86/irqflags.h
-@@ -120,6 +120,8 @@ static inline unsigned long __raw_local_irq_save(void)
+diff -urNp linux-2.6.26.6/include/asm-x86/irqflags.h linux-2.6.26.6/include/asm-x86/irqflags.h
+--- linux-2.6.26.6/include/asm-x86/irqflags.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/irqflags.h	2008-10-11 21:54:20.000000000 -0400
+@@ -120,6 +120,8 @@ static inline unsigned long __raw_local_
@@ -28585,4 +28146,3 @@
-diff --git a/include/asm-x86/kmap_types.h b/include/asm-x86/kmap_types.h
-index 5f4174132a222a34d453b2fb915a0993a6e923be..727fdd7471f5a63ec1bb5dbb18880ab9705901ec 100644
---- a/include/asm-x86/kmap_types.h
-+++ b/include/asm-x86/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-x86/kmap_types.h linux-2.6.26.6/include/asm-x86/kmap_types.h
+--- linux-2.6.26.6/include/asm-x86/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -28599,4 +28159,3 @@
-diff --git a/include/asm-x86/linkage.h b/include/asm-x86/linkage.h
-index 64e444f8e85b2d9fccaf50cc78ceaa1da0654877..bf7e8a638b48d0957126cca69133af86bba64bb5 100644
---- a/include/asm-x86/linkage.h
-+++ b/include/asm-x86/linkage.h
+diff -urNp linux-2.6.26.6/include/asm-x86/linkage.h linux-2.6.26.6/include/asm-x86/linkage.h
+--- linux-2.6.26.6/include/asm-x86/linkage.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/linkage.h	2008-10-11 21:54:20.000000000 -0400
@@ -28626,4 +28185,3 @@
-diff --git a/include/asm-x86/local.h b/include/asm-x86/local.h
-index 330a72496abd94f9eb85cce30f8ae590b1b57e18..857322e13086f398877e503aea328d49b25ef62b 100644
---- a/include/asm-x86/local.h
-+++ b/include/asm-x86/local.h
+diff -urNp linux-2.6.26.6/include/asm-x86/local.h linux-2.6.26.6/include/asm-x86/local.h
+--- linux-2.6.26.6/include/asm-x86/local.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/local.h	2008-10-11 21:54:20.000000000 -0400
@@ -28725 +28283 @@
-@@ -55,7 +119,24 @@ static inline int local_sub_and_test(long i, local_t *l)
+@@ -55,7 +119,24 @@ static inline int local_sub_and_test(lon
@@ -28751 +28309 @@
-@@ -73,7 +154,24 @@ static inline int local_dec_and_test(local_t *l)
+@@ -73,7 +154,24 @@ static inline int local_dec_and_test(loc
@@ -28777 +28335 @@
-@@ -91,7 +189,24 @@ static inline int local_inc_and_test(local_t *l)
+@@ -91,7 +189,24 @@ static inline int local_inc_and_test(loc
@@ -28803 +28361 @@
-@@ -110,7 +225,24 @@ static inline int local_add_negative(long i, local_t *l)
+@@ -110,7 +225,24 @@ static inline int local_add_negative(lon
@@ -28829 +28387 @@
-@@ -133,7 +265,23 @@ static inline long local_add_return(long i, local_t *l)
+@@ -133,7 +265,23 @@ static inline long local_add_return(long
@@ -28854,5 +28412,4 @@
-diff --git a/include/asm-x86/mach-default/apm.h b/include/asm-x86/mach-default/apm.h
-index 989f34c37d321249f838efe86d4e9c2086b42233..a94d903ddc71017be4c9cfd7ba0e49145076bf4f 100644
---- a/include/asm-x86/mach-default/apm.h
-+++ b/include/asm-x86/mach-default/apm.h
-@@ -34,7 +34,7 @@ static inline void apm_bios_call_asm(u32 func, u32 ebx_in, u32 ecx_in,
+diff -urNp linux-2.6.26.6/include/asm-x86/mach-default/apm.h linux-2.6.26.6/include/asm-x86/mach-default/apm.h
+--- linux-2.6.26.6/include/asm-x86/mach-default/apm.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/mach-default/apm.h	2008-10-11 21:54:20.000000000 -0400
+@@ -34,7 +34,7 @@ static inline void apm_bios_call_asm(u32
@@ -28867 +28424 @@
-@@ -58,7 +58,7 @@ static inline u8 apm_bios_call_simple_asm(u32 func, u32 ebx_in,
+@@ -58,7 +58,7 @@ static inline u8 apm_bios_call_simple_as
@@ -28876,4 +28433,3 @@
-diff --git a/include/asm-x86/mman.h b/include/asm-x86/mman.h
-index c1682b542dafe2c02247e9d721fd69d335c874b7..1b60217bf400b415e58651d5cf94473713b6a5e5 100644
---- a/include/asm-x86/mman.h
-+++ b/include/asm-x86/mman.h
+diff -urNp linux-2.6.26.6/include/asm-x86/mman.h linux-2.6.26.6/include/asm-x86/mman.h
+--- linux-2.6.26.6/include/asm-x86/mman.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/mman.h	2008-10-11 21:54:20.000000000 -0400
@@ -28895,38 +28451,4 @@
-diff --git a/include/asm-x86/mmu.h b/include/asm-x86/mmu.h
-index 00e88679e11f780af5654ae54f2bfafc7e572369..a16a08026d34e6f217c0eadcc63c51110a27948e 100644
---- a/include/asm-x86/mmu.h
-+++ b/include/asm-x86/mmu.h
-@@ -11,13 +11,26 @@
-  * cpu_vm_mask is used to optimize ldt flushing.
-  */
- typedef struct {
--	void *ldt;
-+	struct desc_struct *ldt;
- #ifdef CONFIG_X86_64
- 	rwlock_t ldtlock;
- #endif
- 	int size;
- 	struct mutex lock;
--	void *vdso;
-+	unsigned long vdso;
-+
-+#ifdef CONFIG_X86_32
-+#if defined(CONFIG_PAX_PAGEEXEC) || defined(CONFIG_PAX_SEGMEXEC)
-+	unsigned long user_cs_base;
-+	unsigned long user_cs_limit;
-+
-+#if defined(CONFIG_PAX_PAGEEXEC) && defined(CONFIG_SMP)
-+	cpumask_t cpu_user_cs_mask;
-+#endif
-+
-+#endif
-+#endif
-+
- } mm_context_t;
- 
- #ifdef CONFIG_SMP
-diff --git a/include/asm-x86/mmu_context_32.h b/include/asm-x86/mmu_context_32.h
-index 9756ae0f1dd3acd1dca75744946afdaa824077b3..a6185077a4e73cd8a42110ee697c5af65cf4cada 100644
---- a/include/asm-x86/mmu_context_32.h
-+++ b/include/asm-x86/mmu_context_32.h
-@@ -55,6 +55,22 @@ static inline void switch_mm(struct mm_struct *prev,
+diff -urNp linux-2.6.26.6/include/asm-x86/mmu_context_32.h linux-2.6.26.6/include/asm-x86/mmu_context_32.h
+--- linux-2.6.26.6/include/asm-x86/mmu_context_32.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/mmu_context_32.h	2008-10-11 21:54:20.000000000 -0400
+@@ -55,6 +55,22 @@ static inline void switch_mm(struct mm_s
@@ -28955 +28477 @@
-@@ -67,6 +83,19 @@ static inline void switch_mm(struct mm_struct *prev,
+@@ -67,6 +83,19 @@ static inline void switch_mm(struct mm_s
@@ -28975,4 +28497,35 @@
-diff --git a/include/asm-x86/module.h b/include/asm-x86/module.h
-index bfedb247871cfbc39ecb2823f428ac62f57eb9f4..e6170a7b1084162f1c28e27170132c815fd93853 100644
---- a/include/asm-x86/module.h
-+++ b/include/asm-x86/module.h
+diff -urNp linux-2.6.26.6/include/asm-x86/mmu.h linux-2.6.26.6/include/asm-x86/mmu.h
+--- linux-2.6.26.6/include/asm-x86/mmu.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/mmu.h	2008-10-11 21:54:20.000000000 -0400
+@@ -11,13 +11,26 @@
+  * cpu_vm_mask is used to optimize ldt flushing.
+  */
+ typedef struct {
+-	void *ldt;
++	struct desc_struct *ldt;
+ #ifdef CONFIG_X86_64
+ 	rwlock_t ldtlock;
+ #endif
+ 	int size;
+ 	struct mutex lock;
+-	void *vdso;
++	unsigned long vdso;
++
++#ifdef CONFIG_X86_32
++#if defined(CONFIG_PAX_PAGEEXEC) || defined(CONFIG_PAX_SEGMEXEC)
++	unsigned long user_cs_base;
++	unsigned long user_cs_limit;
++
++#if defined(CONFIG_PAX_PAGEEXEC) && defined(CONFIG_SMP)
++	cpumask_t cpu_user_cs_mask;
++#endif
++
++#endif
++#endif
++
+ } mm_context_t;
+ 
+ #ifdef CONFIG_SMP
+diff -urNp linux-2.6.26.6/include/asm-x86/module.h linux-2.6.26.6/include/asm-x86/module.h
+--- linux-2.6.26.6/include/asm-x86/module.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/module.h	2008-10-11 21:54:20.000000000 -0400
@@ -28993,4 +28546,3 @@
-diff --git a/include/asm-x86/page_32.h b/include/asm-x86/page_32.h
-index ccf0ba3c3abac74f4329221876987df4b284ac95..b09e853b7eb584ffabd8a3d435d3981739ba9ac7 100644
---- a/include/asm-x86/page_32.h
-+++ b/include/asm-x86/page_32.h
+diff -urNp linux-2.6.26.6/include/asm-x86/page_32.h linux-2.6.26.6/include/asm-x86/page_32.h
+--- linux-2.6.26.6/include/asm-x86/page_32.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/page_32.h	2008-10-11 21:54:20.000000000 -0400
@@ -29021,4 +28573,3 @@
-diff --git a/include/asm-x86/page_64.h b/include/asm-x86/page_64.h
-index 6ea72859c491abaeec409afcdeb548e1c464192e..1af587ecc8ca9dcff00d5be7f34a5fe3a6b5a047 100644
---- a/include/asm-x86/page_64.h
-+++ b/include/asm-x86/page_64.h
+diff -urNp linux-2.6.26.6/include/asm-x86/page_64.h linux-2.6.26.6/include/asm-x86/page_64.h
+--- linux-2.6.26.6/include/asm-x86/page_64.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/page_64.h	2008-10-11 21:54:20.000000000 -0400
@@ -29035 +28586 @@
-@@ -89,5 +92,6 @@ extern unsigned long init_memory_mapping(unsigned long start,
+@@ -89,5 +92,6 @@ extern unsigned long init_memory_mapping
@@ -29042,5 +28593,4 @@
-diff --git a/include/asm-x86/paravirt.h b/include/asm-x86/paravirt.h
-index 0f13b945e2400323cb65dfd6f8a7cc5b035c3319..8c5c39fd4ed7844cff429f52e0ef18410fcc7abf 100644
---- a/include/asm-x86/paravirt.h
-+++ b/include/asm-x86/paravirt.h
-@@ -1383,24 +1383,24 @@ static inline unsigned long __raw_local_irq_save(void)
+diff -urNp linux-2.6.26.6/include/asm-x86/paravirt.h linux-2.6.26.6/include/asm-x86/paravirt.h
+--- linux-2.6.26.6/include/asm-x86/paravirt.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/paravirt.h	2008-10-11 21:54:20.000000000 -0400
+@@ -1383,24 +1383,24 @@ static inline unsigned long __raw_local_
@@ -29075,4 +28625,3 @@
-diff --git a/include/asm-x86/pda.h b/include/asm-x86/pda.h
-index 101fb9e11954e8bd45c21a4524c5c8c8f9019132..62b734986a44a03ed3958b2d272d2124bec968e7 100644
---- a/include/asm-x86/pda.h
-+++ b/include/asm-x86/pda.h
+diff -urNp linux-2.6.26.6/include/asm-x86/pda.h linux-2.6.26.6/include/asm-x86/pda.h
+--- linux-2.6.26.6/include/asm-x86/pda.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pda.h	2008-10-11 21:54:20.000000000 -0400
@@ -29091,4 +28640,3 @@
-diff --git a/include/asm-x86/percpu.h b/include/asm-x86/percpu.h
-index 736fc3bb8e1eaa1f8280ed471c70c6deffe20512..545b4d9ebefab308fc50c3dd754b06bb71b44751 100644
---- a/include/asm-x86/percpu.h
-+++ b/include/asm-x86/percpu.h
+diff -urNp linux-2.6.26.6/include/asm-x86/percpu.h linux-2.6.26.6/include/asm-x86/percpu.h
+--- linux-2.6.26.6/include/asm-x86/percpu.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/percpu.h	2008-10-11 21:54:20.000000000 -0400
@@ -29099,8 +28647,81 @@
-+#include <asm-generic/sections.h>
-+#include <linux/threads.h>
-+#define __per_cpu_offset __per_cpu_offset
-+extern unsigned long __per_cpu_offset[NR_CPUS];
-+#define per_cpu_offset(x) (__per_cpu_offset[x] + (unsigned long)__per_cpu_start)
-+
- /* fs segment starts at (positive) offset == __per_cpu_offset[cpu] */
- #define __percpu_seg "%%fs:"
++#include <asm-generic/sections.h>
++#include <linux/threads.h>
++#define __per_cpu_offset __per_cpu_offset
++extern unsigned long __per_cpu_offset[NR_CPUS];
++#define per_cpu_offset(x) (__per_cpu_offset[x] + (unsigned long)__per_cpu_start)
++
+ /* fs segment starts at (positive) offset == __per_cpu_offset[cpu] */
+ #define __percpu_seg "%%fs:"
+ 
+diff -urNp linux-2.6.26.6/include/asm-x86/pgalloc.h linux-2.6.26.6/include/asm-x86/pgalloc.h
+--- linux-2.6.26.6/include/asm-x86/pgalloc.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pgalloc.h	2008-10-11 21:54:20.000000000 -0400
+@@ -47,7 +47,11 @@ static inline void pmd_populate_kernel(s
+ 				       pmd_t *pmd, pte_t *pte)
+ {
+ 	paravirt_alloc_pte(mm, __pa(pte) >> PAGE_SHIFT);
++#ifdef CONFIG_COMPAT_VDSO
+ 	set_pmd(pmd, __pmd(__pa(pte) | _PAGE_TABLE));
++#else
++	set_pmd(pmd, __pmd(__pa(pte) | _KERNPG_TABLE));
++#endif
+ }
+ 
+ static inline void pmd_populate(struct mm_struct *mm, pmd_t *pmd,
+diff -urNp linux-2.6.26.6/include/asm-x86/pgtable-2level.h linux-2.6.26.6/include/asm-x86/pgtable-2level.h
+--- linux-2.6.26.6/include/asm-x86/pgtable-2level.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pgtable-2level.h	2008-10-11 21:54:20.000000000 -0400
+@@ -18,7 +18,19 @@ static inline void native_set_pte(pte_t 
+ 
+ static inline void native_set_pmd(pmd_t *pmdp, pmd_t pmd)
+ {
++
++#ifdef CONFIG_PAX_KERNEXEC
++	unsigned long cr0;
++
++	pax_open_kernel(cr0);
++#endif
++
+ 	*pmdp = pmd;
++
++#ifdef CONFIG_PAX_KERNEXEC
++	pax_close_kernel(cr0);
++#endif
++
+ }
+ 
+ static inline void native_set_pte_atomic(pte_t *ptep, pte_t pte)
+diff -urNp linux-2.6.26.6/include/asm-x86/pgtable_32.h linux-2.6.26.6/include/asm-x86/pgtable_32.h
+--- linux-2.6.26.6/include/asm-x86/pgtable_32.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pgtable_32.h	2008-10-11 21:54:20.000000000 -0400
+@@ -25,8 +25,6 @@
+ struct mm_struct;
+ struct vm_area_struct;
+ 
+-extern pgd_t swapper_pg_dir[1024];
+-
+ static inline void pgtable_cache_init(void) { }
+ static inline void check_pgt_cache(void) { }
+ void paging_init(void);
+@@ -45,6 +43,11 @@ void paging_init(void);
+ # include <asm/pgtable-2level-defs.h>
+ #endif
+ 
++extern pgd_t swapper_pg_dir[PTRS_PER_PGD];
++#ifdef CONFIG_X86_PAE
++extern pmd_t swapper_pm_dir[PTRS_PER_PGD][PTRS_PER_PMD];
++#endif
++
+ #define PGDIR_SIZE	(1UL << PGDIR_SHIFT)
+ #define PGDIR_MASK	(~(PGDIR_SIZE - 1))
+ 
+@@ -81,7 +84,7 @@ void paging_init(void);
+ #undef TEST_ACCESS_OK
+ 
+ /* The boot page tables (all created as a single array) */
+-extern unsigned long pg0[];
++extern pte_t pg0[];
+ 
+ #define pte_present(x)	((x).pte_low & (_PAGE_PRESENT | _PAGE_PROTNONE))
+ 
+@@ -208,6 +211,9 @@ static inline void __init paravirt_paget
@@ -29108,14 +28729 @@
-diff --git a/include/asm-x86/pgalloc.h b/include/asm-x86/pgalloc.h
-index 91e4641f3f319de6072c63b436c17fb252c9e5b6..bda641f3f10348ba3f6a0ce5066dab4989607b0d 100644
---- a/include/asm-x86/pgalloc.h
-+++ b/include/asm-x86/pgalloc.h
-@@ -47,7 +47,11 @@ static inline void pmd_populate_kernel(struct mm_struct *mm,
- 				       pmd_t *pmd, pte_t *pte)
- {
- 	paravirt_alloc_pte(mm, __pa(pte) >> PAGE_SHIFT);
-+#ifdef CONFIG_COMPAT_VDSO
- 	set_pmd(pmd, __pmd(__pa(pte) | _PAGE_TABLE));
-+#else
-+	set_pmd(pmd, __pmd(__pa(pte) | _KERNPG_TABLE));
-+#endif
- }
+ #endif /* !__ASSEMBLY__ */
@@ -29123,6 +28731,10 @@
- static inline void pmd_populate(struct mm_struct *mm, pmd_t *pmd,
-diff --git a/include/asm-x86/pgtable-2level.h b/include/asm-x86/pgtable-2level.h
-index 46bc52c0eae18ce519f1fe073edbed48ab846dc8..be168d5f0c87ecaa3a570360832be98d83744b49 100644
---- a/include/asm-x86/pgtable-2level.h
-+++ b/include/asm-x86/pgtable-2level.h
-@@ -18,7 +18,19 @@ static inline void native_set_pte(pte_t *ptep , pte_t pte)
++#define HAVE_ARCH_UNMAPPED_AREA
++#define HAVE_ARCH_UNMAPPED_AREA_TOPDOWN
++
+ /*
+  * kern_addr_valid() is (1) for FLATMEM and (0) for
+  * SPARSEMEM and DISCONTIGMEM
+diff -urNp linux-2.6.26.6/include/asm-x86/pgtable-3level.h linux-2.6.26.6/include/asm-x86/pgtable-3level.h
+--- linux-2.6.26.6/include/asm-x86/pgtable-3level.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pgtable-3level.h	2008-10-11 21:54:20.000000000 -0400
+@@ -70,12 +70,36 @@ static inline void native_set_pte_atomic
@@ -29139 +28751 @@
- 	*pmdp = pmd;
+ 	set_64bit((unsigned long long *)(pmdp), native_pmd_val(pmd));
@@ -29147,8 +28759 @@
- static inline void native_set_pte_atomic(pte_t *ptep, pte_t pte)
-diff --git a/include/asm-x86/pgtable-3level.h b/include/asm-x86/pgtable-3level.h
-index c93dbb6c26247dfa76d92b5a5dd8e73c7c41dd3c..627f141fd913f304d602e2934313016434a5b7ed 100644
---- a/include/asm-x86/pgtable-3level.h
-+++ b/include/asm-x86/pgtable-3level.h
-@@ -70,12 +70,36 @@ static inline void native_set_pte_atomic(pte_t *ptep, pte_t pte)
- 
- static inline void native_set_pmd(pmd_t *pmdp, pmd_t pmd)
+ static inline void native_set_pud(pud_t *pudp, pud_t pud)
@@ -29163 +28768 @@
- 	set_64bit((unsigned long long *)(pmdp), native_pmd_val(pmd));
+ 	set_64bit((unsigned long long *)(pudp), native_pud_val(pud));
@@ -29171 +28776,7 @@
- static inline void native_set_pud(pud_t *pudp, pud_t pud)
+ /*
+diff -urNp linux-2.6.26.6/include/asm-x86/pgtable_64.h linux-2.6.26.6/include/asm-x86/pgtable_64.h
+--- linux-2.6.26.6/include/asm-x86/pgtable_64.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pgtable_64.h	2008-10-11 21:54:20.000000000 -0400
+@@ -101,7 +101,19 @@ static inline pte_t native_ptep_get_and_
+ 
+ static inline void native_set_pmd(pmd_t *pmdp, pmd_t pmd)
@@ -29180 +28791 @@
- 	set_64bit((unsigned long long *)(pudp), native_pud_val(pud));
+ 	*pmdp = pmd;
@@ -29188,5 +28799,25 @@
- /*
-diff --git a/include/asm-x86/pgtable.h b/include/asm-x86/pgtable.h
-index 97c271b2910b3266b4aaafa53385dfd8148bf374..eda8df2cea92adbb90f3fee554d9b28cd9a9861f 100644
---- a/include/asm-x86/pgtable.h
-+++ b/include/asm-x86/pgtable.h
+ static inline void native_pmd_clear(pmd_t *pmd)
+@@ -153,17 +165,17 @@ static inline void native_pgd_clear(pgd_
+ 
+ static inline int pgd_bad(pgd_t pgd)
+ {
+-	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
++	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
+ }
+ 
+ static inline int pud_bad(pud_t pud)
+ {
+-	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
++	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
+ }
+ 
+ static inline int pmd_bad(pmd_t pmd)
+ {
+-	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
++	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
+ }
+ 
+ #define pte_none(x)	(!pte_val((x)))
+diff -urNp linux-2.6.26.6/include/asm-x86/pgtable.h linux-2.6.26.6/include/asm-x86/pgtable.h
+--- linux-2.6.26.6/include/asm-x86/pgtable.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/pgtable.h	2008-10-11 21:54:20.000000000 -0400
@@ -29203 +28834 @@
-@@ -104,7 +107,7 @@ extern pteval_t __PAGE_KERNEL, __PAGE_KERNEL_EXEC;
+@@ -104,7 +107,7 @@ extern pteval_t __PAGE_KERNEL, __PAGE_KE
@@ -29212 +28843 @@
-@@ -158,10 +161,17 @@ extern unsigned long empty_zero_page[PAGE_SIZE / sizeof(unsigned long)];
+@@ -158,10 +161,17 @@ extern unsigned long empty_zero_page[PAG
@@ -29230 +28861 @@
-@@ -223,9 +233,29 @@ static inline pte_t pte_wrprotect(pte_t pte)
+@@ -223,9 +233,29 @@ static inline pte_t pte_wrprotect(pte_t 
@@ -29261 +28892 @@
-@@ -268,8 +298,6 @@ static inline pte_t pte_mkspecial(pte_t pte)
+@@ -268,8 +298,6 @@ static inline pte_t pte_mkspecial(pte_t 
@@ -29270 +28901 @@
-@@ -480,7 +508,19 @@ static inline void ptep_set_wrprotect(struct mm_struct *mm,
+@@ -480,7 +508,19 @@ static inline void ptep_set_wrprotect(st
@@ -29291,93 +28922,3 @@
-diff --git a/include/asm-x86/pgtable_32.h b/include/asm-x86/pgtable_32.h
-index 32ca03109a4c5f0f6e222cea946f3141bcbca796..5d762034e4b2b3793d6209e79c4023b611fab62e 100644
---- a/include/asm-x86/pgtable_32.h
-+++ b/include/asm-x86/pgtable_32.h
-@@ -25,8 +25,6 @@
- struct mm_struct;
- struct vm_area_struct;
- 
--extern pgd_t swapper_pg_dir[1024];
--
- static inline void pgtable_cache_init(void) { }
- static inline void check_pgt_cache(void) { }
- void paging_init(void);
-@@ -45,6 +43,11 @@ void paging_init(void);
- # include <asm/pgtable-2level-defs.h>
- #endif
- 
-+extern pgd_t swapper_pg_dir[PTRS_PER_PGD];
-+#ifdef CONFIG_X86_PAE
-+extern pmd_t swapper_pm_dir[PTRS_PER_PGD][PTRS_PER_PMD];
-+#endif
-+
- #define PGDIR_SIZE	(1UL << PGDIR_SHIFT)
- #define PGDIR_MASK	(~(PGDIR_SIZE - 1))
- 
-@@ -81,7 +84,7 @@ void paging_init(void);
- #undef TEST_ACCESS_OK
- 
- /* The boot page tables (all created as a single array) */
--extern unsigned long pg0[];
-+extern pte_t pg0[];
- 
- #define pte_present(x)	((x).pte_low & (_PAGE_PRESENT | _PAGE_PROTNONE))
- 
-@@ -208,6 +211,9 @@ static inline void __init paravirt_pagetable_setup_done(pgd_t *base)
- 
- #endif /* !__ASSEMBLY__ */
- 
-+#define HAVE_ARCH_UNMAPPED_AREA
-+#define HAVE_ARCH_UNMAPPED_AREA_TOPDOWN
-+
- /*
-  * kern_addr_valid() is (1) for FLATMEM and (0) for
-  * SPARSEMEM and DISCONTIGMEM
-diff --git a/include/asm-x86/pgtable_64.h b/include/asm-x86/pgtable_64.h
-index 3922ecad4d83b118c1987b757e296d942826a80b..0e279e01a3570d0809613e3276909d1626d485c7 100644
---- a/include/asm-x86/pgtable_64.h
-+++ b/include/asm-x86/pgtable_64.h
-@@ -101,7 +101,19 @@ static inline pte_t native_ptep_get_and_clear(pte_t *xp)
- 
- static inline void native_set_pmd(pmd_t *pmdp, pmd_t pmd)
- {
-+
-+#ifdef CONFIG_PAX_KERNEXEC
-+	unsigned long cr0;
-+
-+	pax_open_kernel(cr0);
-+#endif
-+
- 	*pmdp = pmd;
-+
-+#ifdef CONFIG_PAX_KERNEXEC
-+	pax_close_kernel(cr0);
-+#endif
-+
- }
- 
- static inline void native_pmd_clear(pmd_t *pmd)
-@@ -153,17 +165,17 @@ static inline void native_pgd_clear(pgd_t *pgd)
- 
- static inline int pgd_bad(pgd_t pgd)
- {
--	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
-+	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
- }
- 
- static inline int pud_bad(pud_t pud)
- {
--	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
-+	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
- }
- 
- static inline int pmd_bad(pmd_t pmd)
- {
--	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
-+	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
- }
- 
- #define pte_none(x)	(!pte_val((x)))
-diff --git a/include/asm-x86/processor.h b/include/asm-x86/processor.h
-index 559105220a477e2be9cfbd87eee62d1cd68767c2..9d9250df27cabd8c3cc04fa0d71e57c8a1237f6f 100644
---- a/include/asm-x86/processor.h
-+++ b/include/asm-x86/processor.h
+diff -urNp linux-2.6.26.6/include/asm-x86/processor.h linux-2.6.26.6/include/asm-x86/processor.h
+--- linux-2.6.26.6/include/asm-x86/processor.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/processor.h	2008-10-11 21:54:20.000000000 -0400
@@ -29393 +28934 @@
-@@ -814,11 +814,20 @@ static inline void spin_lock_prefetch(const void *x)
+@@ -814,11 +814,20 @@ static inline void spin_lock_prefetch(co
@@ -29416 +28957 @@
-@@ -833,7 +842,7 @@ static inline void spin_lock_prefetch(const void *x)
+@@ -833,7 +842,7 @@ static inline void spin_lock_prefetch(co
@@ -29425 +28966 @@
-@@ -844,11 +853,7 @@ static inline void spin_lock_prefetch(const void *x)
+@@ -844,11 +853,7 @@ static inline void spin_lock_prefetch(co
@@ -29438 +28979 @@
-@@ -863,7 +868,7 @@ extern unsigned long thread_saved_pc(struct task_struct *tsk);
+@@ -863,7 +868,7 @@ extern unsigned long thread_saved_pc(str
@@ -29447 +28988 @@
-@@ -879,7 +884,7 @@ extern unsigned long thread_saved_pc(struct task_struct *tsk);
+@@ -879,7 +884,7 @@ extern unsigned long thread_saved_pc(str
@@ -29456 +28997 @@
-@@ -916,6 +921,10 @@ extern void start_thread(struct pt_regs *regs, unsigned long new_ip,
+@@ -916,6 +921,10 @@ extern void start_thread(struct pt_regs 
@@ -29467,4 +29008,3 @@
-diff --git a/include/asm-x86/ptrace.h b/include/asm-x86/ptrace.h
-index 9f922b0b95d6d3961275c9cac804acf22cbb8ef6..2bf2aa553bf46932c53ff90906cc3b271164fe6d 100644
---- a/include/asm-x86/ptrace.h
-+++ b/include/asm-x86/ptrace.h
+diff -urNp linux-2.6.26.6/include/asm-x86/ptrace.h linux-2.6.26.6/include/asm-x86/ptrace.h
+--- linux-2.6.26.6/include/asm-x86/ptrace.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/ptrace.h	2008-10-11 21:54:20.000000000 -0400
@@ -29487 +29027 @@
-@@ -152,28 +152,29 @@ static inline unsigned long regs_return_value(struct pt_regs *regs)
+@@ -152,28 +152,29 @@ static inline unsigned long regs_return_
@@ -29523,4 +29063,3 @@
-diff --git a/include/asm-x86/reboot.h b/include/asm-x86/reboot.h
-index e63741f19392e24d587b3383c18e6de2da1dab18..82d72aa7657b779adc08388d986cfffeddb9b478 100644
---- a/include/asm-x86/reboot.h
-+++ b/include/asm-x86/reboot.h
+diff -urNp linux-2.6.26.6/include/asm-x86/reboot.h linux-2.6.26.6/include/asm-x86/reboot.h
+--- linux-2.6.26.6/include/asm-x86/reboot.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/reboot.h	2008-10-11 21:54:20.000000000 -0400
@@ -29536,5 +29075,4 @@
-diff --git a/include/asm-x86/rwsem.h b/include/asm-x86/rwsem.h
-index 750f2a3542b3931044e77835dceac28457bbece8..37e5c9c01f34ae3269fa6300de472b86aafaa72c 100644
---- a/include/asm-x86/rwsem.h
-+++ b/include/asm-x86/rwsem.h
-@@ -106,10 +106,26 @@ static inline void __down_read(struct rw_semaphore *sem)
+diff -urNp linux-2.6.26.6/include/asm-x86/rwsem.h linux-2.6.26.6/include/asm-x86/rwsem.h
+--- linux-2.6.26.6/include/asm-x86/rwsem.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/rwsem.h	2008-10-11 21:54:20.000000000 -0400
+@@ -106,10 +106,26 @@ static inline void __down_read(struct rw
@@ -29569 +29107 @@
-@@ -124,13 +140,29 @@ static inline int __down_read_trylock(struct rw_semaphore *sem)
+@@ -124,13 +140,29 @@ static inline int __down_read_trylock(st
@@ -29603 +29141 @@
-@@ -148,12 +180,28 @@ static inline void __down_write_nested(struct rw_semaphore *sem, int subclass)
+@@ -148,12 +180,28 @@ static inline void __down_write_nested(s
@@ -29634 +29172 @@
-@@ -186,10 +234,26 @@ static inline void __up_read(struct rw_semaphore *sem)
+@@ -186,10 +234,26 @@ static inline void __up_read(struct rw_s
@@ -29663 +29201 @@
-@@ -204,11 +268,27 @@ static inline void __up_write(struct rw_semaphore *sem)
+@@ -204,11 +268,27 @@ static inline void __up_write(struct rw_
@@ -29693 +29231 @@
-@@ -222,10 +302,26 @@ static inline void __downgrade_write(struct rw_semaphore *sem)
+@@ -222,10 +302,26 @@ static inline void __downgrade_write(str
@@ -29722 +29260 @@
-@@ -237,7 +333,23 @@ static inline void __downgrade_write(struct rw_semaphore *sem)
+@@ -237,7 +333,23 @@ static inline void __downgrade_write(str
@@ -29747 +29285 @@
-@@ -249,7 +361,23 @@ static inline int rwsem_atomic_update(int delta, struct rw_semaphore *sem)
+@@ -249,7 +361,23 @@ static inline int rwsem_atomic_update(in
@@ -29772,4 +29310,3 @@
-diff --git a/include/asm-x86/segment.h b/include/asm-x86/segment.h
-index ed5131dd7d92af9980f34341aed73bbe2eaa340d..e2eb634a4116eb09b360e4d3d86c67b5528a39cc 100644
---- a/include/asm-x86/segment.h
-+++ b/include/asm-x86/segment.h
+diff -urNp linux-2.6.26.6/include/asm-x86/segment.h linux-2.6.26.6/include/asm-x86/segment.h
+--- linux-2.6.26.6/include/asm-x86/segment.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/segment.h	2008-10-11 21:54:20.000000000 -0400
@@ -29810,5 +29347,4 @@
-diff --git a/include/asm-x86/spinlock.h b/include/asm-x86/spinlock.h
-index bf2a3d2dfa62b53cb685eae44180726feb853768..0e8ec8447767463d707827781fd6c4fb8424107e 100644
---- a/include/asm-x86/spinlock.h
-+++ b/include/asm-x86/spinlock.h
-@@ -227,18 +227,50 @@ static inline int __raw_write_can_lock(raw_rwlock_t *lock)
+diff -urNp linux-2.6.26.6/include/asm-x86/spinlock.h linux-2.6.26.6/include/asm-x86/spinlock.h
+--- linux-2.6.26.6/include/asm-x86/spinlock.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/spinlock.h	2008-10-11 21:54:20.000000000 -0400
+@@ -227,18 +227,50 @@ static inline int __raw_write_can_lock(r
@@ -29818,0 +29355 @@
+-		     "call __read_lock_failed\n\t"
@@ -29828 +29365 @@
-+		     "1:\n"
+ 		     "1:\n"
@@ -29836,2 +29373 @@
- 		     "call __read_lock_failed\n\t"
--		     "1:\n"
++		     "call __read_lock_failed\n\t"
@@ -29845,0 +29382 @@
+-		     "call __write_lock_failed\n\t"
@@ -29855 +29392 @@
-+		     "1:\n"
+ 		     "1:\n"
@@ -29863,2 +29400 @@
- 		     "call __write_lock_failed\n\t"
--		     "1:\n"
++		     "call __write_lock_failed\n\t"
@@ -29869 +29405 @@
-@@ -265,12 +297,45 @@ static inline int __raw_write_trylock(raw_rwlock_t *lock)
+@@ -265,12 +297,45 @@ static inline int __raw_write_trylock(ra
@@ -29917,4 +29453,3 @@
-diff --git a/include/asm-x86/system.h b/include/asm-x86/system.h
-index a2f04cd79b29617e4677a0a1a1c23f4f1d434b23..15ce7a66d66e282b39f10591a8487c364e49afb0 100644
---- a/include/asm-x86/system.h
-+++ b/include/asm-x86/system.h
+diff -urNp linux-2.6.26.6/include/asm-x86/system.h linux-2.6.26.6/include/asm-x86/system.h
+--- linux-2.6.26.6/include/asm-x86/system.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/system.h	2008-10-11 21:54:20.000000000 -0400
@@ -29941 +29476 @@
-@@ -166,7 +170,7 @@ static inline unsigned long get_limit(unsigned long segment)
+@@ -166,7 +170,7 @@ static inline unsigned long get_limit(un
@@ -29981,4 +29516,3 @@
-diff --git a/include/asm-x86/uaccess_32.h b/include/asm-x86/uaccess_32.h
-index 8e7595c1f34e69959e42eb98a33b2a64b56ba848..4af5c4f5c60632a082230257d90a747affd0f78e 100644
---- a/include/asm-x86/uaccess_32.h
-+++ b/include/asm-x86/uaccess_32.h
+diff -urNp linux-2.6.26.6/include/asm-x86/uaccess_32.h linux-2.6.26.6/include/asm-x86/uaccess_32.h
+--- linux-2.6.26.6/include/asm-x86/uaccess_32.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/uaccess_32.h	2008-10-11 21:54:20.000000000 -0400
@@ -30036 +29570 @@
-@@ -377,15 +384,19 @@ struct __large_struct { unsigned long buf[100]; };
+@@ -377,15 +384,19 @@ struct __large_struct { unsigned long bu
@@ -30080,4 +29614,3 @@
-diff --git a/include/asm-x86/uaccess_64.h b/include/asm-x86/uaccess_64.h
-index b8a2f43399032e1ce617e38a35eb28919f08a287..cf27e8629408545321a8c00c33115a56b26c0acc 100644
---- a/include/asm-x86/uaccess_64.h
-+++ b/include/asm-x86/uaccess_64.h
+diff -urNp linux-2.6.26.6/include/asm-x86/uaccess_64.h linux-2.6.26.6/include/asm-x86/uaccess_64.h
+--- linux-2.6.26.6/include/asm-x86/uaccess_64.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-x86/uaccess_64.h	2008-10-11 21:54:20.000000000 -0400
@@ -30092,4 +29625,3 @@
-diff --git a/include/asm-xtensa/kmap_types.h b/include/asm-xtensa/kmap_types.h
-index 9e822d2e3bcecf69871eb65acdf81655c02e1124..ec535f19b4ee8640d6b81f61c3e1ef6e56022c29 100644
---- a/include/asm-xtensa/kmap_types.h
-+++ b/include/asm-xtensa/kmap_types.h
+diff -urNp linux-2.6.26.6/include/asm-xtensa/kmap_types.h linux-2.6.26.6/include/asm-xtensa/kmap_types.h
+--- linux-2.6.26.6/include/asm-xtensa/kmap_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/asm-xtensa/kmap_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -30104,4 +29636,3 @@
-diff --git a/include/linux/a.out.h b/include/linux/a.out.h
-index e86dfca44589f49e083e53a3f905868ba2e89955..40cc55f81ce250ddb6da3b6446524b91eea8f72e 100644
---- a/include/linux/a.out.h
-+++ b/include/linux/a.out.h
+diff -urNp linux-2.6.26.6/include/linux/a.out.h linux-2.6.26.6/include/linux/a.out.h
+--- linux-2.6.26.6/include/linux/a.out.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/a.out.h	2008-10-11 21:54:20.000000000 -0400
@@ -30123,4 +29654,3 @@
-diff --git a/include/linux/cache.h b/include/linux/cache.h
-index 97e24881c4c6f477496130c982e1962e770df9eb..e7576b9f0ea92680498e580019e0d617800cd8e7 100644
---- a/include/linux/cache.h
-+++ b/include/linux/cache.h
+diff -urNp linux-2.6.26.6/include/linux/cache.h linux-2.6.26.6/include/linux/cache.h
+--- linux-2.6.26.6/include/linux/cache.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/cache.h	2008-10-11 21:54:20.000000000 -0400
@@ -30138,5 +29668,4 @@
-diff --git a/include/linux/capability.h b/include/linux/capability.h
-index 02673846d20539b25949c3e10356ae09e9be762b..d92662c1a19187ae50eef0abf4727e3edc73ef15 100644
---- a/include/linux/capability.h
-+++ b/include/linux/capability.h
-@@ -504,6 +504,7 @@ extern const kernel_cap_t __cap_init_eff_set;
+diff -urNp linux-2.6.26.6/include/linux/capability.h linux-2.6.26.6/include/linux/capability.h
+--- linux-2.6.26.6/include/linux/capability.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/capability.h	2008-10-11 21:54:20.000000000 -0400
+@@ -504,6 +504,7 @@ extern const kernel_cap_t __cap_init_eff
@@ -30150,4 +29679,3 @@
-diff --git a/include/linux/cpumask.h b/include/linux/cpumask.h
-index c24875bd9c5b0ef1b6347f61a87716c5e8673914..5ae039e71f0979edd42bcd1f5a60564182b30eae 100644
---- a/include/linux/cpumask.h
-+++ b/include/linux/cpumask.h
+diff -urNp linux-2.6.26.6/include/linux/cpumask.h linux-2.6.26.6/include/linux/cpumask.h
+--- linux-2.6.26.6/include/linux/cpumask.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/cpumask.h	2008-10-11 21:55:52.000000000 -0400
@@ -30175,4 +29703,3 @@
-diff --git a/include/linux/elf.h b/include/linux/elf.h
-index ff9fbed90123faff8fb8e3a7817a831f6bc5e276..69f07407b9dbfc8fd5d3790c3369e25e94345b69 100644
---- a/include/linux/elf.h
-+++ b/include/linux/elf.h
+diff -urNp linux-2.6.26.6/include/linux/elf.h linux-2.6.26.6/include/linux/elf.h
+--- linux-2.6.26.6/include/linux/elf.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/elf.h	2008-10-11 21:54:20.000000000 -0400
@@ -30250,5 +29777,3 @@
-diff --git a/include/linux/gracl.h b/include/linux/gracl.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..b0b09274a866614c40f3a5434333d20626b2a00f
---- /dev/null
-+++ b/include/linux/gracl.h
+diff -urNp linux-2.6.26.6/include/linux/gracl.h linux-2.6.26.6/include/linux/gracl.h
+--- linux-2.6.26.6/include/linux/gracl.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/include/linux/gracl.h	2008-10-11 21:54:20.000000000 -0400
@@ -30574,5 +30099,3 @@
-diff --git a/include/linux/gralloc.h b/include/linux/gralloc.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..35865f3ad088d10a01ef9e214ce1483152938200
---- /dev/null
-+++ b/include/linux/gralloc.h
+diff -urNp linux-2.6.26.6/include/linux/gralloc.h linux-2.6.26.6/include/linux/gralloc.h
+--- linux-2.6.26.6/include/linux/gralloc.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/include/linux/gralloc.h	2008-10-11 21:54:20.000000000 -0400
@@ -30588,5 +30111,3 @@
-diff --git a/include/linux/grdefs.h b/include/linux/grdefs.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..51e04d99d44dbad116813ef98517341f917b5254
---- /dev/null
-+++ b/include/linux/grdefs.h
+diff -urNp linux-2.6.26.6/include/linux/grdefs.h linux-2.6.26.6/include/linux/grdefs.h
+--- linux-2.6.26.6/include/linux/grdefs.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/include/linux/grdefs.h	2008-10-11 21:54:20.000000000 -0400
@@ -30725,5 +30246,3 @@
-diff --git a/include/linux/grinternal.h b/include/linux/grinternal.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..9c4a6373d220ef61d7de30aef0f371caaf38f877
---- /dev/null
-+++ b/include/linux/grinternal.h
+diff -urNp linux-2.6.26.6/include/linux/grinternal.h linux-2.6.26.6/include/linux/grinternal.h
+--- linux-2.6.26.6/include/linux/grinternal.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/include/linux/grinternal.h	2008-10-11 21:54:20.000000000 -0400
@@ -30941,5 +30460,3 @@
-diff --git a/include/linux/grmsg.h b/include/linux/grmsg.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..e230f65b535327e3912522e4d8ff9a0e7602bee4
---- /dev/null
-+++ b/include/linux/grmsg.h
+diff -urNp linux-2.6.26.6/include/linux/grmsg.h linux-2.6.26.6/include/linux/grmsg.h
+--- linux-2.6.26.6/include/linux/grmsg.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/include/linux/grmsg.h	2008-10-11 21:54:20.000000000 -0400
@@ -31055,5 +30572,3 @@
-diff --git a/include/linux/grsecurity.h b/include/linux/grsecurity.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..32bd7592bf35b6ac61340e300bbf273bff3b239d
---- /dev/null
-+++ b/include/linux/grsecurity.h
+diff -urNp linux-2.6.26.6/include/linux/grsecurity.h linux-2.6.26.6/include/linux/grsecurity.h
+--- linux-2.6.26.6/include/linux/grsecurity.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/include/linux/grsecurity.h	2008-10-11 21:54:20.000000000 -0400
@@ -31261,5 +30776,4 @@
-diff --git a/include/linux/highmem.h b/include/linux/highmem.h
-index 7dcbc82f3b7bf4a19969d0cf19824cf373a2a91b..3a6c11ea2d9183ae5a388657b1d119ad80f9bda2 100644
---- a/include/linux/highmem.h
-+++ b/include/linux/highmem.h
-@@ -122,6 +122,13 @@ static inline void clear_highpage(struct page *page)
+diff -urNp linux-2.6.26.6/include/linux/highmem.h linux-2.6.26.6/include/linux/highmem.h
+--- linux-2.6.26.6/include/linux/highmem.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/highmem.h	2008-10-11 21:54:20.000000000 -0400
+@@ -122,6 +122,13 @@ static inline void clear_highpage(struct
@@ -31279,5 +30793,4 @@
-diff --git a/include/linux/jbd.h b/include/linux/jbd.h
-index 07a9b52a265418cb4b213ae8b1fff8e6eefbdd9d..9e861c6700870f8bc410d2d2c7a337352e2566e2 100644
---- a/include/linux/jbd.h
-+++ b/include/linux/jbd.h
-@@ -66,7 +66,7 @@ extern u8 journal_enable_debug;
+diff -urNp linux-2.6.26.6/include/linux/jbd2.h linux-2.6.26.6/include/linux/jbd2.h
+--- linux-2.6.26.6/include/linux/jbd2.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/jbd2.h	2008-10-11 21:54:20.000000000 -0400
+@@ -66,7 +66,7 @@ extern u8 jbd2_journal_enable_debug;
@@ -31291,6 +30804,5 @@
- static inline void *jbd_alloc(size_t size, gfp_t flags)
-diff --git a/include/linux/jbd2.h b/include/linux/jbd2.h
-index d147f0f903604e0a1d6ae08fefd22255be2fd3c3..bc27dd6cfee939c5536877f8de7fd734e1478487 100644
---- a/include/linux/jbd2.h
-+++ b/include/linux/jbd2.h
-@@ -66,7 +66,7 @@ extern u8 jbd2_journal_enable_debug;
+ static inline void *jbd2_alloc(size_t size, gfp_t flags)
+diff -urNp linux-2.6.26.6/include/linux/jbd.h linux-2.6.26.6/include/linux/jbd.h
+--- linux-2.6.26.6/include/linux/jbd.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/jbd.h	2008-10-11 21:54:20.000000000 -0400
+@@ -66,7 +66,7 @@ extern u8 journal_enable_debug;
@@ -31304,5 +30816,4 @@
- static inline void *jbd2_alloc(size_t size, gfp_t flags)
-diff --git a/include/linux/libata.h b/include/linux/libata.h
-index e57e5d08312d44929321204c1c0600b1068f82eb..c4d13a0a40bb1890fcc3ea65779eaf7b1b161696 100644
---- a/include/linux/libata.h
-+++ b/include/linux/libata.h
+ static inline void *jbd_alloc(size_t size, gfp_t flags)
+diff -urNp linux-2.6.26.6/include/linux/libata.h linux-2.6.26.6/include/linux/libata.h
+--- linux-2.6.26.6/include/linux/libata.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/libata.h	2008-10-11 21:54:20.000000000 -0400
@@ -31324,4 +30835,3 @@
-diff --git a/include/linux/mm.h b/include/linux/mm.h
-index 586a943cab018647da208582bc1f19e0dc485f1d..e97849674c7af48fa14e4180ce47c6ae47b5de7f 100644
---- a/include/linux/mm.h
-+++ b/include/linux/mm.h
+diff -urNp linux-2.6.26.6/include/linux/mm.h linux-2.6.26.6/include/linux/mm.h
+--- linux-2.6.26.6/include/linux/mm.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/mm.h	2008-10-11 21:54:20.000000000 -0400
@@ -31336 +30846 @@
-@@ -109,6 +110,14 @@ extern unsigned int kobjsize(const void *objp);
+@@ -109,6 +110,14 @@ extern unsigned int kobjsize(const void 
@@ -31368 +30878 @@
-@@ -1161,6 +1173,10 @@ extern struct vm_area_struct * find_vma(struct mm_struct * mm, unsigned long add
+@@ -1161,6 +1173,10 @@ extern struct vm_area_struct * find_vma(
@@ -31379 +30889 @@
-@@ -1177,7 +1193,6 @@ static inline unsigned long vma_pages(struct vm_area_struct *vma)
+@@ -1177,7 +1193,6 @@ static inline unsigned long vma_pages(st
@@ -31387 +30897 @@
-@@ -1266,5 +1281,11 @@ int vmemmap_populate_basepages(struct page *start_page,
+@@ -1266,5 +1281,11 @@ int vmemmap_populate_basepages(struct pa
@@ -31399,4 +30909,3 @@
-diff --git a/include/linux/mm_types.h b/include/linux/mm_types.h
-index 02a27ae78539cfe536106f46a8f89b50ea63985e..787434a31b02ba20ca6fc4d545fa63b9d8f5cbbe 100644
---- a/include/linux/mm_types.h
-+++ b/include/linux/mm_types.h
+diff -urNp linux-2.6.26.6/include/linux/mm_types.h linux-2.6.26.6/include/linux/mm_types.h
+--- linux-2.6.26.6/include/linux/mm_types.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/mm_types.h	2008-10-11 21:54:20.000000000 -0400
@@ -31437,4 +30946,3 @@
-diff --git a/include/linux/module.h b/include/linux/module.h
-index 3e03b1acbc94a8ba7fbbd28e394f442c4710f2f9..b23e97c3896a5bf1117b8fae2ff3fa5e0a7732d8 100644
---- a/include/linux/module.h
-+++ b/include/linux/module.h
+diff -urNp linux-2.6.26.6/include/linux/module.h linux-2.6.26.6/include/linux/module.h
+--- linux-2.6.26.6/include/linux/module.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/module.h	2008-10-11 21:54:20.000000000 -0400
@@ -31462,5 +30970,4 @@
-diff --git a/include/linux/moduleloader.h b/include/linux/moduleloader.h
-index eb1033957486670348f892b4d93117958af76c0a..06529f3addd580e3986a05007ecfee4644ce883c 100644
---- a/include/linux/moduleloader.h
-+++ b/include/linux/moduleloader.h
-@@ -17,9 +17,21 @@ int module_frob_arch_sections(Elf_Ehdr *hdr,
+diff -urNp linux-2.6.26.6/include/linux/moduleloader.h linux-2.6.26.6/include/linux/moduleloader.h
+--- linux-2.6.26.6/include/linux/moduleloader.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/moduleloader.h	2008-10-11 21:54:20.000000000 -0400
+@@ -17,9 +17,21 @@ int module_frob_arch_sections(Elf_Ehdr *
@@ -31488,4 +30995,3 @@
-diff --git a/include/linux/namei.h b/include/linux/namei.h
-index 24d88e98a62648180a553fdfb457837bcbcb5c00..4a1e2c9d23212d90c27015904cfdb8e129286b94 100644
---- a/include/linux/namei.h
-+++ b/include/linux/namei.h
+diff -urNp linux-2.6.26.6/include/linux/namei.h linux-2.6.26.6/include/linux/namei.h
+--- linux-2.6.26.6/include/linux/namei.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/namei.h	2008-10-11 21:54:20.000000000 -0400
@@ -31501 +31007 @@
-@@ -83,12 +83,12 @@ extern int follow_up(struct vfsmount **, struct dentry **);
+@@ -83,12 +83,12 @@ extern int follow_up(struct vfsmount **,
@@ -31516,5 +31022,4 @@
-diff --git a/include/linux/nodemask.h b/include/linux/nodemask.h
-index 848025cd708783795c96a35c08a6176d0fe84a9f..c259bd8f1bd3aef443d6677535924868ae0e114d 100644
---- a/include/linux/nodemask.h
-+++ b/include/linux/nodemask.h
-@@ -442,11 +442,11 @@ static inline int num_node_state(enum node_states state)
+diff -urNp linux-2.6.26.6/include/linux/nodemask.h linux-2.6.26.6/include/linux/nodemask.h
+--- linux-2.6.26.6/include/linux/nodemask.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/nodemask.h	2008-10-11 21:55:52.000000000 -0400
+@@ -442,11 +442,11 @@ static inline int num_node_state(enum no
@@ -31536,4 +31041,3 @@
-diff --git a/include/linux/percpu.h b/include/linux/percpu.h
-index 4cdd393e71e1bb70ee0286c16f2aeb08d1458d98..e12c358bc759a0a2f48d49b56a50e5e5288406a2 100644
---- a/include/linux/percpu.h
-+++ b/include/linux/percpu.h
+diff -urNp linux-2.6.26.6/include/linux/percpu.h linux-2.6.26.6/include/linux/percpu.h
+--- linux-2.6.26.6/include/linux/percpu.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/percpu.h	2008-10-11 21:54:20.000000000 -0400
@@ -31549,4 +31053,3 @@
-diff --git a/include/linux/poison.h b/include/linux/poison.h
-index 9f31683728fd7e2c59f738ae35ab6835066270c1..f28e10432d9b22914a3ca94a24c05b122064c94c 100644
---- a/include/linux/poison.h
-+++ b/include/linux/poison.h
+diff -urNp linux-2.6.26.6/include/linux/poison.h linux-2.6.26.6/include/linux/poison.h
+--- linux-2.6.26.6/include/linux/poison.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/poison.h	2008-10-11 21:54:20.000000000 -0400
@@ -31564,5 +31067,4 @@
-diff --git a/include/linux/random.h b/include/linux/random.h
-index 36f125c0c6037f0270941e96e63790151a66fe34..1250dc939625c3577d8d3775edd8b3d677e37d8e 100644
---- a/include/linux/random.h
-+++ b/include/linux/random.h
-@@ -72,6 +72,11 @@ unsigned long randomize_range(unsigned long start, unsigned long end, unsigned l
+diff -urNp linux-2.6.26.6/include/linux/random.h linux-2.6.26.6/include/linux/random.h
+--- linux-2.6.26.6/include/linux/random.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/random.h	2008-10-11 21:54:20.000000000 -0400
+@@ -72,6 +72,11 @@ unsigned long randomize_range(unsigned l
@@ -31580,4 +31082,3 @@
-diff --git a/include/linux/sched.h b/include/linux/sched.h
-index 2103c739c90f958cf1cbc48e91a3f8d4a6b8bcd1..1b25ea0d7f8e68c83663f0595e61ddf3996caf2f 100644
---- a/include/linux/sched.h
-+++ b/include/linux/sched.h
+diff -urNp linux-2.6.26.6/include/linux/sched.h linux-2.6.26.6/include/linux/sched.h
+--- linux-2.6.26.6/include/linux/sched.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/sched.h	2008-10-11 21:54:20.000000000 -0400
@@ -31705 +31206 @@
-@@ -1855,7 +1920,7 @@ extern void __cleanup_sighand(struct sighand_struct *);
+@@ -1855,7 +1920,7 @@ extern void __cleanup_sighand(struct sig
@@ -31714 +31215 @@
-@@ -1957,8 +2022,8 @@ static inline void unlock_task_sighand(struct task_struct *tsk,
+@@ -1957,8 +2022,8 @@ static inline void unlock_task_sighand(s
@@ -31725 +31226 @@
-@@ -2130,6 +2195,12 @@ extern void arch_pick_mmap_layout(struct mm_struct *mm);
+@@ -2130,6 +2195,12 @@ extern void arch_pick_mmap_layout(struct
@@ -31738,4 +31239,3 @@
-diff --git a/include/linux/screen_info.h b/include/linux/screen_info.h
-index 1ee2c05142f627ba68cfcf17205a1ae3e38b8893..81b7ec456f2c9b0753516c2dae01f92dc1ceb22f 100644
---- a/include/linux/screen_info.h
-+++ b/include/linux/screen_info.h
+diff -urNp linux-2.6.26.6/include/linux/screen_info.h linux-2.6.26.6/include/linux/screen_info.h
+--- linux-2.6.26.6/include/linux/screen_info.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/screen_info.h	2008-10-11 21:54:20.000000000 -0400
@@ -31752,5 +31252,4 @@
-diff --git a/include/linux/shm.h b/include/linux/shm.h
-index eca6235a46c0b1b89d951a90216b132c6a21cfb7..c7417edfe6ef06ec8681b7b6dbe265f13cbef2cd 100644
---- a/include/linux/shm.h
-+++ b/include/linux/shm.h
-@@ -95,6 +95,10 @@ struct shmid_kernel /* private to the kernel */
+diff -urNp linux-2.6.26.6/include/linux/shm.h linux-2.6.26.6/include/linux/shm.h
+--- linux-2.6.26.6/include/linux/shm.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/shm.h	2008-10-11 21:54:20.000000000 -0400
+@@ -95,6 +95,10 @@ struct shmid_kernel /* private to the ke
@@ -31767,4 +31266,3 @@
-diff --git a/include/linux/slab.h b/include/linux/slab.h
-index 9aa90a6f20e02e920e883f17e7393aa0e0046400..a39b24c03bc647b9cf7cba514a3d927f04fee865 100644
---- a/include/linux/slab.h
-+++ b/include/linux/slab.h
+diff -urNp linux-2.6.26.6/include/linux/slab.h linux-2.6.26.6/include/linux/slab.h
+--- linux-2.6.26.6/include/linux/slab.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/slab.h	2008-10-11 21:54:20.000000000 -0400
@@ -31784,4 +31282,3 @@
-diff --git a/include/linux/sysctl.h b/include/linux/sysctl.h
-index 24141b4d1a116a4523ab9085e8f830cdd26cb471..fa061750e9f1cfe02f8ed0a19892a1e552739bde 100644
---- a/include/linux/sysctl.h
-+++ b/include/linux/sysctl.h
+diff -urNp linux-2.6.26.6/include/linux/sysctl.h linux-2.6.26.6/include/linux/sysctl.h
+--- linux-2.6.26.6/include/linux/sysctl.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/sysctl.h	2008-10-11 21:54:20.000000000 -0400
@@ -31811,4 +31308,3 @@
-diff --git a/include/linux/thread_info.h b/include/linux/thread_info.h
-index 38a56477f27ada34c3cd6e56c912205b066bc413..84fb648574e0b6d48d8716bba3d3f7ee674ecf00 100644
---- a/include/linux/thread_info.h
-+++ b/include/linux/thread_info.h
+diff -urNp linux-2.6.26.6/include/linux/thread_info.h linux-2.6.26.6/include/linux/thread_info.h
+--- linux-2.6.26.6/include/linux/thread_info.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/thread_info.h	2008-10-11 21:55:52.000000000 -0400
@@ -31824,5 +31320,4 @@
-diff --git a/include/linux/uaccess.h b/include/linux/uaccess.h
-index fec6decfb983503ec8ae24bafa793f09b5f902b2..da099cef4319498579a80aad2d1d1857d79a7820 100644
---- a/include/linux/uaccess.h
-+++ b/include/linux/uaccess.h
-@@ -76,11 +76,11 @@ static inline unsigned long __copy_from_user_nocache(void *to,
+diff -urNp linux-2.6.26.6/include/linux/uaccess.h linux-2.6.26.6/include/linux/uaccess.h
+--- linux-2.6.26.6/include/linux/uaccess.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/linux/uaccess.h	2008-10-11 21:54:20.000000000 -0400
+@@ -76,11 +76,11 @@ static inline unsigned long __copy_from_
@@ -31842,4 +31337,3 @@
-diff --git a/include/net/sctp/sctp.h b/include/net/sctp/sctp.h
-index 90b1e8d23b1638e59d45e9623d5a2f6ff81c8356..57cb4e7e9881cb654fdf195d84182ea225142e1c 100644
---- a/include/net/sctp/sctp.h
-+++ b/include/net/sctp/sctp.h
+diff -urNp linux-2.6.26.6/include/net/sctp/sctp.h linux-2.6.26.6/include/net/sctp/sctp.h
+--- linux-2.6.26.6/include/net/sctp/sctp.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/net/sctp/sctp.h	2008-10-11 21:54:20.000000000 -0400
@@ -31857,5 +31351,4 @@
-diff --git a/include/sound/core.h b/include/sound/core.h
-index 695ee53488a382ab85d90f1deb5e3b83a5fe82e6..c374e80428e282caaf659da68594d79f6623c97e 100644
---- a/include/sound/core.h
-+++ b/include/sound/core.h
-@@ -406,9 +406,9 @@ void snd_verbose_printd(const char *file, int line, const char *format, ...)
+diff -urNp linux-2.6.26.6/include/sound/core.h linux-2.6.26.6/include/sound/core.h
+--- linux-2.6.26.6/include/sound/core.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/sound/core.h	2008-10-11 21:54:20.000000000 -0400
+@@ -406,9 +406,9 @@ void snd_verbose_printd(const char *file
@@ -31873 +31366 @@
-@@ -422,7 +422,7 @@ void snd_verbose_printd(const char *file, int line, const char *format, ...)
+@@ -422,7 +422,7 @@ void snd_verbose_printd(const char *file
@@ -31882,4 +31375,3 @@
-diff --git a/include/video/uvesafb.h b/include/video/uvesafb.h
-index 95bcef19395482b089e3ea421ddb24395c394dfb..d73a2f1c0f2426a52390800e4b7aa1dfd3a35b67 100644
---- a/include/video/uvesafb.h
-+++ b/include/video/uvesafb.h
+diff -urNp linux-2.6.26.6/include/video/uvesafb.h linux-2.6.26.6/include/video/uvesafb.h
+--- linux-2.6.26.6/include/video/uvesafb.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/include/video/uvesafb.h	2008-10-11 21:54:20.000000000 -0400
@@ -31894,40 +31386,4 @@
-diff --git a/init/Kconfig b/init/Kconfig
-index 6199d1120900841ca57367cc33a01f36eff72d12..bec72028139c2e66e28a204ee9215da2b444a827 100644
---- a/init/Kconfig
-+++ b/init/Kconfig
-@@ -572,6 +572,7 @@ config SYSCTL_SYSCALL_CHECK
- config KALLSYMS
- 	 bool "Load all symbols for debugging/ksymoops" if EMBEDDED
- 	 default y
-+	 depends on !GRKERNSEC_HIDESYM
- 	 help
- 	   Say Y here to let the kernel print out symbolic crash information and
- 	   symbolic stack backtraces. This increases the size of the kernel
-@@ -791,8 +792,8 @@ config MARKERS
- source "arch/Kconfig"
- 
- config PROC_PAGE_MONITOR
-- 	default y
--	depends on PROC_FS && MMU
-+ 	default n
-+	depends on PROC_FS && MMU && !GRKERNSEC
- 	bool "Enable /proc page monitoring" if EMBEDDED
-  	help
- 	  Various /proc files exist to monitor process memory utilization:
-@@ -804,9 +805,9 @@ endmenu		# General setup
- 
- config SLABINFO
- 	bool
--	depends on PROC_FS
-+	depends on PROC_FS && !GRKERNSEC_PROC_ADD
- 	depends on SLAB || SLUB_DEBUG
--	default y
-+	default n
- 
- config RT_MUTEXES
- 	boolean
-diff --git a/init/do_mounts.c b/init/do_mounts.c
-index 660c1e50c91b7a622b2e65bf1095cd4e982b58af..d9a836ecacef831335d8de5fa63240771d9709d0 100644
---- a/init/do_mounts.c
-+++ b/init/do_mounts.c
-@@ -213,11 +213,11 @@ static void __init get_fs_names(char *page)
+diff -urNp linux-2.6.26.6/init/do_mounts.c linux-2.6.26.6/init/do_mounts.c
+--- linux-2.6.26.6/init/do_mounts.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/do_mounts.c	2008-10-11 21:54:20.000000000 -0400
+@@ -213,11 +213,11 @@ static void __init get_fs_names(char *pa
@@ -31947 +31403 @@
-@@ -303,18 +303,18 @@ void __init change_floppy(char *fmt, ...)
+@@ -303,18 +303,18 @@ void __init change_floppy(char *fmt, ...
@@ -31979,4 +31435,3 @@
-diff --git a/init/do_mounts.h b/init/do_mounts.h
-index 735705d137ff9beaf0f7866e7c804d7080183780..5146aa61420d9dc5d72d9d7d7ede91c74889e3aa 100644
---- a/init/do_mounts.h
-+++ b/init/do_mounts.h
+diff -urNp linux-2.6.26.6/init/do_mounts.h linux-2.6.26.6/init/do_mounts.h
+--- linux-2.6.26.6/init/do_mounts.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/do_mounts.h	2008-10-11 21:54:20.000000000 -0400
@@ -32002,5 +31457,4 @@
-diff --git a/init/do_mounts_initrd.c b/init/do_mounts_initrd.c
-index 614241b5200cf906c066288ac15a42df835490ce..932d79c4e83f568c33fcb4d2d386b54b18e542fc 100644
---- a/init/do_mounts_initrd.c
-+++ b/init/do_mounts_initrd.c
-@@ -32,7 +32,7 @@ static int __init do_linuxrc(void * shell)
+diff -urNp linux-2.6.26.6/init/do_mounts_initrd.c linux-2.6.26.6/init/do_mounts_initrd.c
+--- linux-2.6.26.6/init/do_mounts_initrd.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/do_mounts_initrd.c	2008-10-11 21:55:52.000000000 -0400
+@@ -32,7 +32,7 @@ static int __init do_linuxrc(void * shel
@@ -32089,4 +31543,3 @@
-diff --git a/init/do_mounts_md.c b/init/do_mounts_md.c
-index 693d24694a6c9f1839a4f7f2f7828f4671d16459..034b44a7ad5d96f74aba70149b54cb59523b210b 100644
---- a/init/do_mounts_md.c
-+++ b/init/do_mounts_md.c
+diff -urNp linux-2.6.26.6/init/do_mounts_md.c linux-2.6.26.6/init/do_mounts_md.c
+--- linux-2.6.26.6/init/do_mounts_md.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/do_mounts_md.c	2008-10-11 21:54:20.000000000 -0400
@@ -32120,4 +31573,3 @@
-diff --git a/init/initramfs.c b/init/initramfs.c
-index 8eeeccb328c9f984812941592258ebd72e5d96e6..b905f50abd01f04ab8bedd6fcf9b1905c4002442 100644
---- a/init/initramfs.c
-+++ b/init/initramfs.c
+diff -urNp linux-2.6.26.6/init/initramfs.c linux-2.6.26.6/init/initramfs.c
+--- linux-2.6.26.6/init/initramfs.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/initramfs.c	2008-10-11 21:54:20.000000000 -0400
@@ -32133 +31585 @@
-@@ -249,11 +249,11 @@ static void __init clean_path(char *path, mode_t mode)
+@@ -249,11 +249,11 @@ static void __init clean_path(char *path
@@ -32206,5 +31658,38 @@
-diff --git a/init/main.c b/init/main.c
-index f7fb20021d48d5a4a175cc79d84f6b3cfb9eab53..34068b6f94e22198059719a4f0b3ff20e32187fe 100644
---- a/init/main.c
-+++ b/init/main.c
-@@ -103,6 +103,7 @@ static inline void mark_rodata_ro(void) { }
+diff -urNp linux-2.6.26.6/init/Kconfig linux-2.6.26.6/init/Kconfig
+--- linux-2.6.26.6/init/Kconfig	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/Kconfig	2008-10-11 21:54:20.000000000 -0400
+@@ -572,6 +572,7 @@ config SYSCTL_SYSCALL_CHECK
+ config KALLSYMS
+ 	 bool "Load all symbols for debugging/ksymoops" if EMBEDDED
+ 	 default y
++	 depends on !GRKERNSEC_HIDESYM
+ 	 help
+ 	   Say Y here to let the kernel print out symbolic crash information and
+ 	   symbolic stack backtraces. This increases the size of the kernel
+@@ -791,8 +792,8 @@ config MARKERS
+ source "arch/Kconfig"
+ 
+ config PROC_PAGE_MONITOR
+- 	default y
+-	depends on PROC_FS && MMU
++ 	default n
++	depends on PROC_FS && MMU && !GRKERNSEC
+ 	bool "Enable /proc page monitoring" if EMBEDDED
+  	help
+ 	  Various /proc files exist to monitor process memory utilization:
+@@ -804,9 +805,9 @@ endmenu		# General setup
+ 
+ config SLABINFO
+ 	bool
+-	depends on PROC_FS
++	depends on PROC_FS && !GRKERNSEC_PROC_ADD
+ 	depends on SLAB || SLUB_DEBUG
+-	default y
++	default n
+ 
+ config RT_MUTEXES
+ 	boolean
+diff -urNp linux-2.6.26.6/init/main.c linux-2.6.26.6/init/main.c
+--- linux-2.6.26.6/init/main.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/main.c	2008-10-11 21:54:20.000000000 -0400
+@@ -103,6 +103,7 @@ static inline void mark_rodata_ro(void) 
@@ -32218 +31703 @@
-@@ -189,6 +190,40 @@ static int __init set_reset_devices(char *str)
+@@ -189,6 +190,40 @@ static int __init set_reset_devices(char
@@ -32259 +31744 @@
-@@ -387,7 +422,7 @@ static void __init setup_nr_cpu_ids(void)
+@@ -387,7 +422,7 @@ static void __init setup_nr_cpu_ids(void
@@ -32268 +31753 @@
-@@ -697,6 +732,7 @@ static void __init do_one_initcall(initcall_t fn)
+@@ -697,6 +732,7 @@ static void __init do_one_initcall(initc
@@ -32276 +31761 @@
-@@ -722,16 +758,16 @@ static void __init do_one_initcall(initcall_t fn)
+@@ -722,16 +758,16 @@ static void __init do_one_initcall(initc
@@ -32297 +31782 @@
-@@ -878,6 +914,8 @@ static int __init kernel_init(void * unused)
+@@ -878,6 +914,8 @@ static int __init kernel_init(void * unu
@@ -32306,4 +31791,3 @@
-diff --git a/init/noinitramfs.c b/init/noinitramfs.c
-index f4c1a3a1b8c52bd06dbdcadf6833b5328693b0e3..96c19bdb5fda2b6160523a2bbf7210921d421a50 100644
---- a/init/noinitramfs.c
-+++ b/init/noinitramfs.c
+diff -urNp linux-2.6.26.6/init/noinitramfs.c linux-2.6.26.6/init/noinitramfs.c
+--- linux-2.6.26.6/init/noinitramfs.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/init/noinitramfs.c	2008-10-11 21:54:20.000000000 -0400
@@ -32328,5 +31812,4 @@
-diff --git a/ipc/ipc_sysctl.c b/ipc/ipc_sysctl.c
-index d3497465cc0a5aa461dabce18b0f7af4dc537cea..1378a3965810b6ddb348a96e7a105fa48c942483 100644
---- a/ipc/ipc_sysctl.c
-+++ b/ipc/ipc_sysctl.c
-@@ -222,7 +222,7 @@ static struct ctl_table ipc_kern_table[] = {
+diff -urNp linux-2.6.26.6/ipc/ipc_sysctl.c linux-2.6.26.6/ipc/ipc_sysctl.c
+--- linux-2.6.26.6/ipc/ipc_sysctl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/ipc/ipc_sysctl.c	2008-10-11 21:54:20.000000000 -0400
+@@ -222,7 +222,7 @@ static struct ctl_table ipc_kern_table[]
@@ -32341 +31824 @@
-@@ -232,7 +232,7 @@ static struct ctl_table ipc_root_table[] = {
+@@ -232,7 +232,7 @@ static struct ctl_table ipc_root_table[]
@@ -32350,4 +31833,3 @@
-diff --git a/ipc/msg.c b/ipc/msg.c
-index b4eee1c6101d6fda19583015a8f4881bc74f8f4b..dfe1e735bab7f88501c93b9cc922c8d31f72d55a 100644
---- a/ipc/msg.c
-+++ b/ipc/msg.c
+diff -urNp linux-2.6.26.6/ipc/msg.c linux-2.6.26.6/ipc/msg.c
+--- linux-2.6.26.6/ipc/msg.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/ipc/msg.c	2008-10-11 21:54:20.000000000 -0400
@@ -32362 +31844 @@
-@@ -314,6 +315,7 @@ asmlinkage long sys_msgget(key_t key, int msgflg)
+@@ -314,6 +315,7 @@ asmlinkage long sys_msgget(key_t key, in
@@ -32370 +31852 @@
-@@ -324,7 +326,11 @@ asmlinkage long sys_msgget(key_t key, int msgflg)
+@@ -324,7 +326,11 @@ asmlinkage long sys_msgget(key_t key, in
@@ -32383 +31865 @@
-@@ -434,6 +440,7 @@ static int msgctl_down(struct ipc_namespace *ns, int msqid, int cmd,
+@@ -434,6 +440,7 @@ static int msgctl_down(struct ipc_namesp
@@ -32391,4 +31873,3 @@
-diff --git a/ipc/sem.c b/ipc/sem.c
-index e9418df5ff3ecf0c3cb3bb6e6fbac9de5fcac828..90d8a99be5dc69ac27913728c79ba1ed494d21bb 100644
---- a/ipc/sem.c
-+++ b/ipc/sem.c
+diff -urNp linux-2.6.26.6/ipc/sem.c linux-2.6.26.6/ipc/sem.c
+--- linux-2.6.26.6/ipc/sem.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/ipc/sem.c	2008-10-11 21:54:20.000000000 -0400
@@ -32403 +31884 @@
-@@ -314,6 +315,7 @@ asmlinkage long sys_semget(key_t key, int nsems, int semflg)
+@@ -314,6 +315,7 @@ asmlinkage long sys_semget(key_t key, in
@@ -32411 +31892 @@
-@@ -328,7 +330,11 @@ asmlinkage long sys_semget(key_t key, int nsems, int semflg)
+@@ -328,7 +330,11 @@ asmlinkage long sys_semget(key_t key, in
@@ -32424 +31905 @@
-@@ -876,6 +882,7 @@ static int semctl_down(struct ipc_namespace *ns, int semid,
+@@ -876,6 +882,7 @@ static int semctl_down(struct ipc_namesp
@@ -32432,4 +31913,3 @@
-diff --git a/ipc/shm.c b/ipc/shm.c
-index 790240cd067f60860957951db601dfb2fc81e373..255b5fad038b1e9b3734dd99c2cc9668c476b87b 100644
---- a/ipc/shm.c
-+++ b/ipc/shm.c
+diff -urNp linux-2.6.26.6/ipc/shm.c linux-2.6.26.6/ipc/shm.c
+--- linux-2.6.26.6/ipc/shm.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/ipc/shm.c	2008-10-11 21:54:20.000000000 -0400
@@ -32444 +31924 @@
-@@ -69,6 +70,14 @@ static void shm_destroy (struct ipc_namespace *ns, struct shmid_kernel *shp);
+@@ -69,6 +70,14 @@ static void shm_destroy (struct ipc_name
@@ -32459 +31939 @@
-@@ -87,6 +96,8 @@ static void do_shm_rmid(struct ipc_namespace *ns, struct kern_ipc_perm *ipcp)
+@@ -87,6 +96,8 @@ static void do_shm_rmid(struct ipc_names
@@ -32468 +31948 @@
-@@ -407,6 +418,14 @@ static int newseg(struct ipc_namespace *ns, struct ipc_params *params)
+@@ -407,6 +418,14 @@ static int newseg(struct ipc_namespace *
@@ -32483 +31963 @@
-@@ -460,6 +479,7 @@ asmlinkage long sys_shmget (key_t key, size_t size, int shmflg)
+@@ -460,6 +479,7 @@ asmlinkage long sys_shmget (key_t key, s
@@ -32491 +31971 @@
-@@ -471,7 +491,11 @@ asmlinkage long sys_shmget (key_t key, size_t size, int shmflg)
+@@ -471,7 +491,11 @@ asmlinkage long sys_shmget (key_t key, s
@@ -32504 +31984 @@
-@@ -883,9 +907,21 @@ long do_shmat(int shmid, char __user *shmaddr, int shmflg, ulong *raddr)
+@@ -883,9 +907,21 @@ long do_shmat(int shmid, char __user *sh
@@ -32526,5 +32006,4 @@
-diff --git a/kernel/acct.c b/kernel/acct.c
-index 91e1cfd734d286f922597108e54065ef691d31b2..2b8098ef362006cc69b9f6320bfc3356f878d6b0 100644
---- a/kernel/acct.c
-+++ b/kernel/acct.c
-@@ -519,7 +519,7 @@ static void do_acct_process(struct pid_namespace *ns, struct file *file)
+diff -urNp linux-2.6.26.6/kernel/acct.c linux-2.6.26.6/kernel/acct.c
+--- linux-2.6.26.6/kernel/acct.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/acct.c	2008-10-11 21:54:20.000000000 -0400
+@@ -519,7 +519,7 @@ static void do_acct_process(struct pid_n
@@ -32539,4 +32018,3 @@
-diff --git a/kernel/capability.c b/kernel/capability.c
-index 901e0fdc3fffa3b32fca26e0aa4e1985b244bd10..002127f85026d1cfcb6e763a14e418fcb259670d 100644
---- a/kernel/capability.c
-+++ b/kernel/capability.c
+diff -urNp linux-2.6.26.6/kernel/capability.c linux-2.6.26.6/kernel/capability.c
+--- linux-2.6.26.6/kernel/capability.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/capability.c	2008-10-11 21:54:20.000000000 -0400
@@ -32578,4 +32056,3 @@
-diff --git a/kernel/configs.c b/kernel/configs.c
-index 4c345210ed8cca3ffb1c64a9e4aef92cf97eedf8..45030e00a4870a1b95bb30f87e6876aadda442ad 100644
---- a/kernel/configs.c
-+++ b/kernel/configs.c
+diff -urNp linux-2.6.26.6/kernel/configs.c linux-2.6.26.6/kernel/configs.c
+--- linux-2.6.26.6/kernel/configs.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/configs.c	2008-10-11 21:54:20.000000000 -0400
@@ -32602,4 +32079,3 @@
-diff --git a/kernel/cpu.c b/kernel/cpu.c
-index c77bc3a1c7226b504be0a50f05136662dd464a73..9c7ec93738c054a72e564b0fc812d93557da3948 100644
---- a/kernel/cpu.c
-+++ b/kernel/cpu.c
+diff -urNp linux-2.6.26.6/kernel/cpu.c linux-2.6.26.6/kernel/cpu.c
+--- linux-2.6.26.6/kernel/cpu.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/cpu.c	2008-10-11 21:54:20.000000000 -0400
@@ -32615,4 +32091,3 @@
-diff --git a/kernel/exit.c b/kernel/exit.c
-index f68b081124bfa42940f88609c8ebf0e9b011e161..f9b059b1b4e2065f4147d9a992c7a075ea91ad20 100644
---- a/kernel/exit.c
-+++ b/kernel/exit.c
+diff -urNp linux-2.6.26.6/kernel/exit.c linux-2.6.26.6/kernel/exit.c
+--- linux-2.6.26.6/kernel/exit.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/exit.c	2008-10-11 21:54:20.000000000 -0400
@@ -32631 +32106 @@
-@@ -132,6 +137,7 @@ static void __exit_signal(struct task_struct *tsk)
+@@ -132,6 +137,7 @@ static void __exit_signal(struct task_st
@@ -32691 +32166 @@
-@@ -1256,7 +1287,7 @@ static int wait_task_zombie(struct task_struct *p, int noreap,
+@@ -1256,7 +1287,7 @@ static int wait_task_zombie(struct task_
@@ -32700,4 +32175,3 @@
-diff --git a/kernel/fork.c b/kernel/fork.c
-index 19908b26cf80494a0db8f3410384521081293a32..d3807ad53ea28270f40d9c33a93f8befab074eff 100644
---- a/kernel/fork.c
-+++ b/kernel/fork.c
+diff -urNp linux-2.6.26.6/kernel/fork.c linux-2.6.26.6/kernel/fork.c
+--- linux-2.6.26.6/kernel/fork.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/fork.c	2008-10-11 21:54:20.000000000 -0400
@@ -32712 +32186 @@
-@@ -213,7 +214,7 @@ static struct task_struct *dup_task_struct(struct task_struct *orig)
+@@ -213,7 +214,7 @@ static struct task_struct *dup_task_stru
@@ -32721 +32195 @@
-@@ -250,8 +251,8 @@ static int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
+@@ -250,8 +251,8 @@ static int dup_mmap(struct mm_struct *mm
@@ -32732 +32206 @@
-@@ -288,6 +289,7 @@ static int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
+@@ -288,6 +289,7 @@ static int dup_mmap(struct mm_struct *mm
@@ -32740 +32214 @@
-@@ -324,6 +326,31 @@ static int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
+@@ -324,6 +326,31 @@ static int dup_mmap(struct mm_struct *mm
@@ -32772 +32246 @@
-@@ -505,7 +532,7 @@ void mm_release(struct task_struct *tsk, struct mm_struct *mm)
+@@ -505,7 +532,7 @@ void mm_release(struct task_struct *tsk,
@@ -32781 +32255 @@
-@@ -513,7 +540,7 @@ void mm_release(struct task_struct *tsk, struct mm_struct *mm)
+@@ -513,7 +540,7 @@ void mm_release(struct task_struct *tsk,
@@ -32790 +32264 @@
-@@ -914,6 +941,9 @@ static struct task_struct *copy_process(unsigned long clone_flags,
+@@ -914,6 +941,9 @@ static struct task_struct *copy_process(
@@ -32800 +32274 @@
-@@ -1080,6 +1110,8 @@ static struct task_struct *copy_process(unsigned long clone_flags,
+@@ -1080,6 +1110,8 @@ static struct task_struct *copy_process(
@@ -32827,5 +32301,4 @@
-diff --git a/kernel/futex.c b/kernel/futex.c
-index 7d1136e97c142d198b897dab1846acd99f1f655f..ca0d49729b9abbdb407e98e3aec97086b1aae1a4 100644
---- a/kernel/futex.c
-+++ b/kernel/futex.c
-@@ -188,6 +188,11 @@ static int get_futex_key(u32 __user *uaddr, struct rw_semaphore *fshared,
+diff -urNp linux-2.6.26.6/kernel/futex.c linux-2.6.26.6/kernel/futex.c
+--- linux-2.6.26.6/kernel/futex.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/futex.c	2008-10-11 21:55:52.000000000 -0400
+@@ -188,6 +188,11 @@ static int get_futex_key(u32 __user *uad
@@ -32843 +32316 @@
-@@ -214,8 +219,8 @@ static int get_futex_key(u32 __user *uaddr, struct rw_semaphore *fshared,
+@@ -214,8 +219,8 @@ static int get_futex_key(u32 __user *uad
@@ -32854 +32327 @@
-@@ -1345,7 +1350,7 @@ static int futex_wait(u32 __user *uaddr, struct rw_semaphore *fshared,
+@@ -1345,7 +1350,7 @@ static int futex_wait(u32 __user *uaddr,
@@ -32872,5 +32345,4 @@
-diff --git a/kernel/irq/handle.c b/kernel/irq/handle.c
-index 5fa6198e91394a935bcb8f51d70cdef9222c261f..410bf604aa88da9e7ce390aa4b690628b12312a8 100644
---- a/kernel/irq/handle.c
-+++ b/kernel/irq/handle.c
-@@ -55,7 +55,8 @@ struct irq_desc irq_desc[NR_IRQS] __cacheline_aligned_in_smp = {
+diff -urNp linux-2.6.26.6/kernel/irq/handle.c linux-2.6.26.6/kernel/irq/handle.c
+--- linux-2.6.26.6/kernel/irq/handle.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/irq/handle.c	2008-10-11 21:54:20.000000000 -0400
+@@ -55,7 +55,8 @@ struct irq_desc irq_desc[NR_IRQS] __cach
@@ -32886,5 +32358,4 @@
-diff --git a/kernel/kallsyms.c b/kernel/kallsyms.c
-index 6fc0040f3e3abacade62c7d63f74d240974d80fe..f73033979fada98646f2e47d2f9e1a18fdfc1151 100644
---- a/kernel/kallsyms.c
-+++ b/kernel/kallsyms.c
-@@ -62,6 +62,19 @@ static inline int is_kernel_text(unsigned long addr)
+diff -urNp linux-2.6.26.6/kernel/kallsyms.c linux-2.6.26.6/kernel/kallsyms.c
+--- linux-2.6.26.6/kernel/kallsyms.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/kallsyms.c	2008-10-11 21:54:20.000000000 -0400
+@@ -62,6 +62,19 @@ static inline int is_kernel_text(unsigne
@@ -32910 +32381 @@
-@@ -366,7 +379,6 @@ static unsigned long get_ksymbol_core(struct kallsym_iter *iter)
+@@ -366,7 +379,6 @@ static unsigned long get_ksymbol_core(st
@@ -32918 +32389 @@
-@@ -450,7 +462,7 @@ static int kallsyms_open(struct inode *inode, struct file *file)
+@@ -450,7 +462,7 @@ static int kallsyms_open(struct inode *i
@@ -32927 +32398 @@
-@@ -472,7 +484,15 @@ static const struct file_operations kallsyms_operations = {
+@@ -472,7 +484,15 @@ static const struct file_operations kall
@@ -32943,4 +32414,3 @@
-diff --git a/kernel/kmod.c b/kernel/kmod.c
-index 8df97d3dfda8611423d7cac323cb9ef5dce5170c..b563303948d6f69c46071ec0a40bf0b2358acd8f 100644
---- a/kernel/kmod.c
-+++ b/kernel/kmod.c
+diff -urNp linux-2.6.26.6/kernel/kmod.c linux-2.6.26.6/kernel/kmod.c
+--- linux-2.6.26.6/kernel/kmod.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/kmod.c	2008-10-11 21:54:20.000000000 -0400
@@ -32956,5 +32426,4 @@
-diff --git a/kernel/kprobes.c b/kernel/kprobes.c
-index 1485ca8d0e00503104e81248a7c5e30b58edfb79..2fbe127e384774f11e8c5773a3d3976aadcb1ee9 100644
---- a/kernel/kprobes.c
-+++ b/kernel/kprobes.c
-@@ -174,7 +174,7 @@ kprobe_opcode_t __kprobes *get_insn_slot(void)
+diff -urNp linux-2.6.26.6/kernel/kprobes.c linux-2.6.26.6/kernel/kprobes.c
+--- linux-2.6.26.6/kernel/kprobes.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/kprobes.c	2008-10-11 21:54:20.000000000 -0400
+@@ -174,7 +174,7 @@ kprobe_opcode_t __kprobes *get_insn_slot
@@ -32969 +32438 @@
-@@ -206,7 +206,7 @@ static int __kprobes collect_one_slot(struct kprobe_insn_page *kip, int idx)
+@@ -206,7 +206,7 @@ static int __kprobes collect_one_slot(st
@@ -32978,4 +32447,3 @@
-diff --git a/kernel/lockdep.c b/kernel/lockdep.c
-index 81a4e4a3f087adfc650eb6baf2c05147f209e062..8349c34593a06759977c43a8fe33d978d52a27d6 100644
---- a/kernel/lockdep.c
-+++ b/kernel/lockdep.c
+diff -urNp linux-2.6.26.6/kernel/lockdep.c linux-2.6.26.6/kernel/lockdep.c
+--- linux-2.6.26.6/kernel/lockdep.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/lockdep.c	2008-10-11 21:54:20.000000000 -0400
@@ -33008,4 +32476,3 @@
-diff --git a/kernel/module.c b/kernel/module.c
-index 5f80478b746d4eeb1a1dc92040c1e8eacd31bc34..e917b5aa2c66c4bd1b743e6e4b336752922f4c97 100644
---- a/kernel/module.c
-+++ b/kernel/module.c
+diff -urNp linux-2.6.26.6/kernel/module.c linux-2.6.26.6/kernel/module.c
+--- linux-2.6.26.6/kernel/module.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/module.c	2008-10-11 21:55:52.000000000 -0400
@@ -33024 +32491 @@
-@@ -70,6 +75,8 @@ static DECLARE_WAIT_QUEUE_HEAD(module_wq);
+@@ -70,6 +75,8 @@ static DECLARE_WAIT_QUEUE_HEAD(module_wq
@@ -33033 +32500 @@
-@@ -273,7 +280,7 @@ static unsigned long find_symbol(const char *name,
+@@ -273,7 +280,7 @@ static unsigned long find_symbol(const c
@@ -33042 +32509 @@
-@@ -289,7 +296,7 @@ static unsigned long find_symbol(const char *name,
+@@ -289,7 +296,7 @@ static unsigned long find_symbol(const c
@@ -33051 +32518 @@
-@@ -352,6 +359,8 @@ static inline unsigned int block_size(int val)
+@@ -352,6 +359,8 @@ static inline unsigned int block_size(in
@@ -33060 +32527 @@
-@@ -359,7 +368,7 @@ static void *percpu_modalloc(unsigned long size, unsigned long align,
+@@ -359,7 +368,7 @@ static void *percpu_modalloc(unsigned lo
@@ -33069 +32536 @@
-@@ -441,7 +450,11 @@ static void percpu_modcopy(void *pcpudest, const void *from, unsigned long size)
+@@ -441,7 +450,11 @@ static void percpu_modcopy(void *pcpudes
@@ -33081 +32548 @@
-@@ -692,6 +705,9 @@ sys_delete_module(const char __user *name_user, unsigned int flags)
+@@ -692,6 +705,9 @@ sys_delete_module(const char __user *nam
@@ -33091 +32558 @@
-@@ -1400,16 +1416,19 @@ static void free_module(struct module *mod)
+@@ -1400,16 +1416,19 @@ static void free_module(struct module *m
@@ -33114 +32581 @@
-@@ -1473,10 +1492,14 @@ static int simplify_symbols(Elf_Shdr *sechdrs,
+@@ -1473,10 +1492,14 @@ static int simplify_symbols(Elf_Shdr *se
@@ -33130 +32597 @@
-@@ -1495,10 +1518,19 @@ static int simplify_symbols(Elf_Shdr *sechdrs,
+@@ -1495,10 +1518,19 @@ static int simplify_symbols(Elf_Shdr *se
@@ -33152 +32619 @@
-@@ -1513,11 +1545,27 @@ static int simplify_symbols(Elf_Shdr *sechdrs,
+@@ -1513,11 +1545,27 @@ static int simplify_symbols(Elf_Shdr *se
@@ -33182 +32649 @@
-@@ -1569,11 +1617,14 @@ static void layout_sections(struct module *mod,
+@@ -1569,11 +1617,14 @@ static void layout_sections(struct modul
@@ -33199 +32666 @@
-@@ -1587,12 +1638,15 @@ static void layout_sections(struct module *mod,
+@@ -1587,12 +1638,15 @@ static void layout_sections(struct modul
@@ -33218 +32685 @@
-@@ -1719,14 +1773,31 @@ static void add_kallsyms(struct module *mod,
+@@ -1719,14 +1773,31 @@ static void add_kallsyms(struct module *
@@ -33253 +32720 @@
-@@ -1776,6 +1847,10 @@ static struct module *load_module(void __user *umod,
+@@ -1776,6 +1847,10 @@ static struct module *load_module(void _
@@ -33264 +32731 @@
-@@ -1935,21 +2010,57 @@ static struct module *load_module(void __user *umod,
+@@ -1935,21 +2010,57 @@ static struct module *load_module(void _
@@ -33278,3 +32745 @@
- 
--	ptr = module_alloc(mod->init_size);
--	if (!ptr && mod->init_size) {
++
@@ -33283,2 +32748 @@
- 		err = -ENOMEM;
--		goto free_core;
++		err = -ENOMEM;
@@ -33286,3 +32750 @@
- 	}
--	memset(ptr, 0, mod->init_size);
--	mod->module_init = ptr;
++	}
@@ -33297 +32759,3 @@
-+
+ 
+-	ptr = module_alloc(mod->init_size);
+-	if (!ptr && mod->init_size) {
@@ -33312 +32776,2 @@
-+		err = -ENOMEM;
+ 		err = -ENOMEM;
+-		goto free_core;
@@ -33314 +32779,3 @@
-+	}
+ 	}
+-	memset(ptr, 0, mod->init_size);
+-	mod->module_init = ptr;
@@ -33330 +32797 @@
-@@ -1959,17 +2070,41 @@ static struct module *load_module(void __user *umod,
+@@ -1959,17 +2070,41 @@ static struct module *load_module(void _
@@ -33351,0 +32819,2 @@
++
++		if (sechdrs[i].sh_type != SHT_NOBITS) {
@@ -33356,2 +32824,0 @@
-+		if (sechdrs[i].sh_type != SHT_NOBITS) {
-+
@@ -33381 +32848 @@
-@@ -2052,8 +2187,8 @@ static struct module *load_module(void __user *umod,
+@@ -2052,8 +2187,8 @@ static struct module *load_module(void _
@@ -33391 +32858 @@
-@@ -2112,12 +2247,12 @@ static struct module *load_module(void __user *umod,
+@@ -2112,12 +2247,12 @@ static struct module *load_module(void _
@@ -33410 +32877 @@
-@@ -2170,9 +2305,13 @@ static struct module *load_module(void __user *umod,
+@@ -2170,9 +2305,13 @@ static struct module *load_module(void _
@@ -33468 +32935 @@
-@@ -2286,10 +2437,14 @@ static const char *get_ksymbol(struct module *mod,
+@@ -2286,10 +2437,14 @@ static const char *get_ksymbol(struct mo
@@ -33486 +32953 @@
-@@ -2334,8 +2489,10 @@ const char *module_address_lookup(unsigned long addr,
+@@ -2334,8 +2489,10 @@ const char *module_address_lookup(unsign
@@ -33499 +32966 @@
-@@ -2357,8 +2514,10 @@ int lookup_module_symbol_name(unsigned long addr, char *symname)
+@@ -2357,8 +2514,10 @@ int lookup_module_symbol_name(unsigned l
@@ -33512 +32979 @@
-@@ -2381,8 +2540,10 @@ int lookup_module_symbol_attrs(unsigned long addr, unsigned long *size,
+@@ -2381,8 +2540,10 @@ int lookup_module_symbol_attrs(unsigned 
@@ -33525 +32992 @@
-@@ -2513,7 +2674,7 @@ static int m_show(struct seq_file *m, void *p)
+@@ -2513,7 +2674,7 @@ static int m_show(struct seq_file *m, vo
@@ -33534 +33001 @@
-@@ -2522,7 +2683,7 @@ static int m_show(struct seq_file *m, void *p)
+@@ -2522,7 +2683,7 @@ static int m_show(struct seq_file *m, vo
@@ -33543 +33010 @@
-@@ -2578,7 +2739,8 @@ int is_module_address(unsigned long addr)
+@@ -2578,7 +2739,8 @@ int is_module_address(unsigned long addr
@@ -33553 +33020 @@
-@@ -2596,8 +2758,8 @@ struct module *__module_text_address(unsigned long addr)
+@@ -2596,8 +2758,8 @@ struct module *__module_text_address(uns
@@ -33564,5 +33031,4 @@
-diff --git a/kernel/mutex.c b/kernel/mutex.c
-index d046a345d365793e84076e2517ec02cdd11bc40d..4c5d625d52d5c212f22c2f67942c8907fa30598f 100644
---- a/kernel/mutex.c
-+++ b/kernel/mutex.c
-@@ -82,7 +82,7 @@ __mutex_lock_slowpath(atomic_t *lock_count);
+diff -urNp linux-2.6.26.6/kernel/mutex.c linux-2.6.26.6/kernel/mutex.c
+--- linux-2.6.26.6/kernel/mutex.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/mutex.c	2008-10-11 21:54:20.000000000 -0400
+@@ -82,7 +82,7 @@ __mutex_lock_slowpath(atomic_t *lock_cou
@@ -33577,4 +33043,3 @@
-diff --git a/kernel/panic.c b/kernel/panic.c
-index 425567f45b9f776148f1767b2f4af2d357a0c2fd..2bb7637790f2e7f65c61602c4f6c91948957cf06 100644
---- a/kernel/panic.c
-+++ b/kernel/panic.c
+diff -urNp linux-2.6.26.6/kernel/panic.c linux-2.6.26.6/kernel/panic.c
+--- linux-2.6.26.6/kernel/panic.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/panic.c	2008-10-11 21:54:20.000000000 -0400
@@ -33590,4 +33055,3 @@
-diff --git a/kernel/pid.c b/kernel/pid.c
-index 20d59fa2d493c7a20b83ff151745e38a847e0366..52e46f3e5cbca5dec3e48d7303ab3a29d4348ce4 100644
---- a/kernel/pid.c
-+++ b/kernel/pid.c
+diff -urNp linux-2.6.26.6/kernel/pid.c linux-2.6.26.6/kernel/pid.c
+--- linux-2.6.26.6/kernel/pid.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/pid.c	2008-10-11 21:54:20.000000000 -0400
@@ -33602 +33066 @@
-@@ -44,7 +45,7 @@ struct pid init_struct_pid = INIT_STRUCT_PID;
+@@ -44,7 +45,7 @@ struct pid init_struct_pid = INIT_STRUCT
@@ -33627,4 +33091,3 @@
-diff --git a/kernel/posix-cpu-timers.c b/kernel/posix-cpu-timers.c
-index f1525ad06cb3ebbb83680b2bc0176854002217ca..442b0482ecb21ac9b71fb726fbad30d0b195111a 100644
---- a/kernel/posix-cpu-timers.c
-+++ b/kernel/posix-cpu-timers.c
+diff -urNp linux-2.6.26.6/kernel/posix-cpu-timers.c linux-2.6.26.6/kernel/posix-cpu-timers.c
+--- linux-2.6.26.6/kernel/posix-cpu-timers.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/posix-cpu-timers.c	2008-10-11 21:55:52.000000000 -0400
@@ -33639 +33102 @@
-@@ -1173,6 +1174,7 @@ static void check_process_timers(struct task_struct *tsk,
+@@ -1173,6 +1174,7 @@ static void check_process_timers(struct 
@@ -33647 +33110 @@
-@@ -1367,17 +1369,17 @@ void run_posix_cpu_timers(struct task_struct *tsk)
+@@ -1367,17 +1369,17 @@ void run_posix_cpu_timers(struct task_st
@@ -33668,5 +33131,4 @@
-diff --git a/kernel/power/poweroff.c b/kernel/power/poweroff.c
-index 678ec736076b1395b4a16949cb5f595b72bdd616..52e2ef1eaa526a41abf68e667e104b510568998c 100644
---- a/kernel/power/poweroff.c
-+++ b/kernel/power/poweroff.c
-@@ -35,7 +35,7 @@ static struct sysrq_key_op	sysrq_poweroff_op = {
+diff -urNp linux-2.6.26.6/kernel/power/poweroff.c linux-2.6.26.6/kernel/power/poweroff.c
+--- linux-2.6.26.6/kernel/power/poweroff.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/power/poweroff.c	2008-10-11 21:54:20.000000000 -0400
+@@ -35,7 +35,7 @@ static struct sysrq_key_op	sysrq_powerof
@@ -33681,4 +33143,3 @@
-diff --git a/kernel/printk.c b/kernel/printk.c
-index e2129e83fd75b8d0c708a7c410005015e0cba564..c8c086337c258329bd9a08801d7781081ab9ab61 100644
---- a/kernel/printk.c
-+++ b/kernel/printk.c
+diff -urNp linux-2.6.26.6/kernel/printk.c linux-2.6.26.6/kernel/printk.c
+--- linux-2.6.26.6/kernel/printk.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/printk.c	2008-10-11 21:54:20.000000000 -0400
@@ -33693 +33154 @@
-@@ -302,6 +303,11 @@ int do_syslog(int type, char __user *buf, int len)
+@@ -302,6 +303,11 @@ int do_syslog(int type, char __user *buf
@@ -33705,4 +33166,3 @@
-diff --git a/kernel/ptrace.c b/kernel/ptrace.c
-index 6c19e94fd0a5482786e432599a0fb4840a5c66cb..8a46e4595b8ad26b6dcaf3776e73bab69cbdf258 100644
---- a/kernel/ptrace.c
-+++ b/kernel/ptrace.c
+diff -urNp linux-2.6.26.6/kernel/ptrace.c linux-2.6.26.6/kernel/ptrace.c
+--- linux-2.6.26.6/kernel/ptrace.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/ptrace.c	2008-10-11 21:54:20.000000000 -0400
@@ -33717 +33177 @@
-@@ -140,12 +141,12 @@ int __ptrace_may_attach(struct task_struct *task)
+@@ -140,12 +141,12 @@ int __ptrace_may_attach(struct task_stru
@@ -33741 +33201 @@
-@@ -571,6 +572,11 @@ asmlinkage long sys_ptrace(long request, long pid, long addr, long data)
+@@ -571,6 +572,11 @@ asmlinkage long sys_ptrace(long request,
@@ -33753,5 +33213,4 @@
-diff --git a/kernel/relay.c b/kernel/relay.c
-index f5a5a960e95d624d03f819c611abd13b45fc269c..b2f5195ca525879c3382b9d3245c0cd6e96b2440 100644
---- a/kernel/relay.c
-+++ b/kernel/relay.c
-@@ -1179,7 +1179,7 @@ static int subbuf_splice_actor(struct file *in,
+diff -urNp linux-2.6.26.6/kernel/relay.c linux-2.6.26.6/kernel/relay.c
+--- linux-2.6.26.6/kernel/relay.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/relay.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1179,7 +1179,7 @@ static int subbuf_splice_actor(struct fi
@@ -33766,5 +33225,4 @@
-diff --git a/kernel/resource.c b/kernel/resource.c
-index 74af2d7cb5a135ffa1da4c52ce9af026c527044d..a05e30a0d2a6ce9517768409bdbde49b4cc67bc9 100644
---- a/kernel/resource.c
-+++ b/kernel/resource.c
-@@ -131,8 +131,18 @@ static const struct file_operations proc_iomem_operations = {
+diff -urNp linux-2.6.26.6/kernel/resource.c linux-2.6.26.6/kernel/resource.c
+--- linux-2.6.26.6/kernel/resource.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/resource.c	2008-10-11 21:54:20.000000000 -0400
+@@ -131,8 +131,18 @@ static const struct file_operations proc
@@ -33789,4 +33247,3 @@
-diff --git a/kernel/sched.c b/kernel/sched.c
-index 0a50ee4664864175ff4437fca375af1080c2ea5b..f2d91c3f0691a988cbdac5d9dc16bae2094fbdaf 100644
---- a/kernel/sched.c
-+++ b/kernel/sched.c
+diff -urNp linux-2.6.26.6/kernel/sched.c linux-2.6.26.6/kernel/sched.c
+--- linux-2.6.26.6/kernel/sched.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/sched.c	2008-10-11 21:54:20.000000000 -0400
@@ -33820 +33277 @@
-@@ -5971,7 +5973,7 @@ static struct ctl_table sd_ctl_root[] = {
+@@ -5971,7 +5973,7 @@ static struct ctl_table sd_ctl_root[] = 
@@ -33829,4 +33286,3 @@
-diff --git a/kernel/signal.c b/kernel/signal.c
-index c5bf0c0df658b69c493ab7de922832e89cc991fa..aceca5ca950836c4ed0d29a2c88b0fc572db7271 100644
---- a/kernel/signal.c
-+++ b/kernel/signal.c
+diff -urNp linux-2.6.26.6/kernel/signal.c linux-2.6.26.6/kernel/signal.c
+--- linux-2.6.26.6/kernel/signal.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/signal.c	2008-10-11 21:55:52.000000000 -0400
@@ -33841 +33297 @@
-@@ -597,6 +598,9 @@ static int check_kill_permission(int sig, struct siginfo *info,
+@@ -597,6 +598,9 @@ static int check_kill_permission(int sig
@@ -33851 +33307 @@
-@@ -888,8 +892,8 @@ static void print_fatal_signal(struct pt_regs *regs, int signr)
+@@ -888,8 +892,8 @@ static void print_fatal_signal(struct pt
@@ -33862 +33318 @@
-@@ -912,7 +916,7 @@ __group_send_sig_info(int sig, struct siginfo *info, struct task_struct *p)
+@@ -912,7 +916,7 @@ __group_send_sig_info(int sig, struct si
@@ -33871 +33327 @@
-@@ -950,8 +954,12 @@ force_sig_info(int sig, struct siginfo *info, struct task_struct *t)
+@@ -950,8 +954,12 @@ force_sig_info(int sig, struct siginfo *
@@ -33884 +33340 @@
-@@ -1022,6 +1030,8 @@ int group_send_sig_info(int sig, struct siginfo *info, struct task_struct *p)
+@@ -1022,6 +1030,8 @@ int group_send_sig_info(int sig, struct 
@@ -33893,5 +33349,4 @@
-diff --git a/kernel/softirq.c b/kernel/softirq.c
-index 36e0617400470f398700376c7fa3359d768e7e58..51f2587b79c3d8ff1f593f7a7e274a6bf67ecd32 100644
---- a/kernel/softirq.c
-+++ b/kernel/softirq.c
-@@ -482,9 +482,9 @@ void tasklet_kill(struct tasklet_struct *t)
+diff -urNp linux-2.6.26.6/kernel/softirq.c linux-2.6.26.6/kernel/softirq.c
+--- linux-2.6.26.6/kernel/softirq.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/softirq.c	2008-10-11 21:54:20.000000000 -0400
+@@ -482,9 +482,9 @@ void tasklet_kill(struct tasklet_struct 
@@ -33909,4 +33364,3 @@
-diff --git a/kernel/sys.c b/kernel/sys.c
-index 14e97282eb6c941605913dc68c2d4e2778cbe3b6..d9ca3ba0bed52735bda954010706b3a0d1caf0a4 100644
---- a/kernel/sys.c
-+++ b/kernel/sys.c
+diff -urNp linux-2.6.26.6/kernel/sys.c linux-2.6.26.6/kernel/sys.c
+--- linux-2.6.26.6/kernel/sys.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/sys.c	2008-10-11 21:54:20.000000000 -0400
@@ -33921 +33375 @@
-@@ -125,6 +126,12 @@ static int set_one_prio(struct task_struct *p, int niceval, int error)
+@@ -125,6 +126,12 @@ static int set_one_prio(struct task_stru
@@ -33934 +33388 @@
-@@ -181,10 +188,10 @@ asmlinkage long sys_setpriority(int which, int who, int niceval)
+@@ -181,10 +188,10 @@ asmlinkage long sys_setpriority(int whic
@@ -33947 +33401 @@
-@@ -243,13 +250,13 @@ asmlinkage long sys_getpriority(int which, int who)
+@@ -243,13 +250,13 @@ asmlinkage long sys_getpriority(int whic
@@ -33963 +33417 @@
-@@ -514,6 +521,10 @@ asmlinkage long sys_setregid(gid_t rgid, gid_t egid)
+@@ -514,6 +521,10 @@ asmlinkage long sys_setregid(gid_t rgid,
@@ -33974 +33428 @@
-@@ -521,6 +532,9 @@ asmlinkage long sys_setregid(gid_t rgid, gid_t egid)
+@@ -521,6 +532,9 @@ asmlinkage long sys_setregid(gid_t rgid,
@@ -34002 +33456 @@
-@@ -585,6 +605,9 @@ static int set_user(uid_t new_ruid, int dumpclear)
+@@ -585,6 +605,9 @@ static int set_user(uid_t new_ruid, int 
@@ -34012 +33466 @@
-@@ -634,6 +657,9 @@ asmlinkage long sys_setreuid(uid_t ruid, uid_t euid)
+@@ -634,6 +657,9 @@ asmlinkage long sys_setreuid(uid_t ruid,
@@ -34035 +33489 @@
-@@ -727,6 +759,10 @@ asmlinkage long sys_setresuid(uid_t ruid, uid_t euid, uid_t suid)
+@@ -727,6 +759,10 @@ asmlinkage long sys_setresuid(uid_t ruid
@@ -34046 +33500 @@
-@@ -781,6 +817,10 @@ asmlinkage long sys_setresgid(gid_t rgid, gid_t egid, gid_t sgid)
+@@ -781,6 +817,10 @@ asmlinkage long sys_setresgid(gid_t rgid
@@ -34057 +33511 @@
-@@ -789,8 +829,10 @@ asmlinkage long sys_setresgid(gid_t rgid, gid_t egid, gid_t sgid)
+@@ -789,8 +829,10 @@ asmlinkage long sys_setresgid(gid_t rgid
@@ -34089 +33543 @@
-@@ -938,7 +986,10 @@ asmlinkage long sys_setpgid(pid_t pid, pid_t pgid)
+@@ -938,7 +986,10 @@ asmlinkage long sys_setpgid(pid_t pid, p
@@ -34101 +33555 @@
-@@ -1672,7 +1723,7 @@ asmlinkage long sys_prctl(int option, unsigned long arg2, unsigned long arg3,
+@@ -1672,7 +1723,7 @@ asmlinkage long sys_prctl(int option, un
@@ -34110,4 +33564,3 @@
-diff --git a/kernel/sysctl.c b/kernel/sysctl.c
-index 29116652dca825943ed7cb8e70350108542ce641..07c04cde7b9e49c6bf353bd42d6b4144ed11c2fb 100644
---- a/kernel/sysctl.c
-+++ b/kernel/sysctl.c
+diff -urNp linux-2.6.26.6/kernel/sysctl.c linux-2.6.26.6/kernel/sysctl.c
+--- linux-2.6.26.6/kernel/sysctl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/sysctl.c	2008-10-11 21:54:20.000000000 -0400
@@ -34128 +33581 @@
-@@ -152,6 +159,7 @@ static int proc_do_cad_pid(struct ctl_table *table, int write, struct file *filp
+@@ -152,6 +159,7 @@ static int proc_do_cad_pid(struct ctl_ta
@@ -34200 +33653 @@
-@@ -1472,6 +1516,8 @@ static int do_sysctl_strategy(struct ctl_table_root *root,
+@@ -1472,6 +1516,8 @@ static int do_sysctl_strategy(struct ctl
@@ -34218 +33671 @@
-@@ -1575,6 +1621,33 @@ int sysctl_perm(struct ctl_table_root *root, struct ctl_table *table, int op)
+@@ -1575,6 +1621,33 @@ int sysctl_perm(struct ctl_table_root *r
@@ -34252,4 +33705,15 @@
-diff --git a/kernel/time.c b/kernel/time.c
-index 6a08660b4fac30f97ea573b9cd017941401046ff..7af6230537db257b00563af769764deb430f3ea8 100644
---- a/kernel/time.c
-+++ b/kernel/time.c
+diff -urNp linux-2.6.26.6/kernel/time/tick-broadcast.c linux-2.6.26.6/kernel/time/tick-broadcast.c
+--- linux-2.6.26.6/kernel/time/tick-broadcast.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/time/tick-broadcast.c	2008-10-11 21:55:52.000000000 -0400
+@@ -113,7 +113,7 @@ int tick_device_uses_broadcast(struct cl
+ 		 * then clear the broadcast bit.
+ 		 */
+ 		if (!(dev->features & CLOCK_EVT_FEAT_C3STOP)) {
+-			int cpu = smp_processor_id();
++			cpu = smp_processor_id();
+ 
+ 			cpu_clear(cpu, tick_broadcast_mask);
+ 			tick_broadcast_clear_oneshot(cpu);
+diff -urNp linux-2.6.26.6/kernel/time.c linux-2.6.26.6/kernel/time.c
+--- linux-2.6.26.6/kernel/time.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/time.c	2008-10-11 21:54:20.000000000 -0400
@@ -34264 +33728 @@
-@@ -92,6 +93,9 @@ asmlinkage long sys_stime(time_t __user *tptr)
+@@ -92,6 +93,9 @@ asmlinkage long sys_stime(time_t __user 
@@ -34274 +33738 @@
-@@ -200,6 +204,8 @@ asmlinkage long sys_settimeofday(struct timeval __user *tv,
+@@ -200,6 +204,8 @@ asmlinkage long sys_settimeofday(struct 
@@ -34292 +33756 @@
-@@ -254,7 +260,7 @@ unsigned int inline jiffies_to_msecs(const unsigned long j)
+@@ -254,7 +260,7 @@ unsigned int inline jiffies_to_msecs(con
@@ -34301,18 +33765,4 @@
-diff --git a/kernel/time/tick-broadcast.c b/kernel/time/tick-broadcast.c
-index e20a365cad2fdc7db15bb7c1d34302b66e64a3a7..e71fb150a226951b84d64413c637ae66d3a94f71 100644
---- a/kernel/time/tick-broadcast.c
-+++ b/kernel/time/tick-broadcast.c
-@@ -113,7 +113,7 @@ int tick_device_uses_broadcast(struct clock_event_device *dev, int cpu)
- 		 * then clear the broadcast bit.
- 		 */
- 		if (!(dev->features & CLOCK_EVT_FEAT_C3STOP)) {
--			int cpu = smp_processor_id();
-+			cpu = smp_processor_id();
- 
- 			cpu_clear(cpu, tick_broadcast_mask);
- 			tick_broadcast_clear_oneshot(cpu);
-diff --git a/kernel/utsname_sysctl.c b/kernel/utsname_sysctl.c
-index fe3a56c2256d7ee44e46813aeee597559ba29131..e4b72c2aff4e9d93e7f88ce3c47e50e0bba21b45 100644
---- a/kernel/utsname_sysctl.c
-+++ b/kernel/utsname_sysctl.c
-@@ -125,7 +125,7 @@ static struct ctl_table uts_kern_table[] = {
+diff -urNp linux-2.6.26.6/kernel/utsname_sysctl.c linux-2.6.26.6/kernel/utsname_sysctl.c
+--- linux-2.6.26.6/kernel/utsname_sysctl.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/kernel/utsname_sysctl.c	2008-10-11 21:54:20.000000000 -0400
+@@ -125,7 +125,7 @@ static struct ctl_table uts_kern_table[]
@@ -34327 +33777 @@
-@@ -135,7 +135,7 @@ static struct ctl_table uts_root_table[] = {
+@@ -135,7 +135,7 @@ static struct ctl_table uts_root_table[]
@@ -34336,4 +33786,3 @@
-diff --git a/lib/radix-tree.c b/lib/radix-tree.c
-index 56ec21a7f73dc09fb64dc395ee4297b04907d649..a73af59afa38e4a3a54dea82c104d543d8dc222f 100644
---- a/lib/radix-tree.c
-+++ b/lib/radix-tree.c
+diff -urNp linux-2.6.26.6/lib/radix-tree.c linux-2.6.26.6/lib/radix-tree.c
+--- linux-2.6.26.6/lib/radix-tree.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/lib/radix-tree.c	2008-10-11 21:54:20.000000000 -0400
@@ -34349,5 +33798,3 @@
-diff --git a/localversion-grsec b/localversion-grsec
-new file mode 100644
-index 0000000000000000000000000000000000000000..7cd6065beb8d6e5457afdf0c5f79c1ca740fcb7e
---- /dev/null
-+++ b/localversion-grsec
+diff -urNp linux-2.6.26.6/localversion-grsec linux-2.6.26.6/localversion-grsec
+--- linux-2.6.26.6/localversion-grsec	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/localversion-grsec	2008-10-11 21:54:20.000000000 -0400
@@ -34356,4 +33803,24 @@
-diff --git a/mm/filemap.c b/mm/filemap.c
-index afb991a79fc79f94703abc5f46257c235c97a330..3ceb9f36e5182abad4141cf1eeed2d032d588dcc 100644
---- a/mm/filemap.c
-+++ b/mm/filemap.c
+diff -urNp linux-2.6.26.6/Makefile linux-2.6.26.6/Makefile
+--- linux-2.6.26.6/Makefile	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/Makefile	2008-10-11 21:54:20.000000000 -0400
+@@ -214,7 +214,7 @@ CONFIG_SHELL := $(shell if [ -x "$$BASH"
+ 
+ HOSTCC       = gcc
+ HOSTCXX      = g++
+-HOSTCFLAGS   = -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer
++HOSTCFLAGS   = -Wall -W -Wno-unused -Wno-sign-compare -Wstrict-prototypes -O2 -fomit-frame-pointer
+ HOSTCXXFLAGS = -O2
+ 
+ # Decide whether to build built-in, modular, or both.
+@@ -607,7 +607,7 @@ export mod_strip_cmd
+ 
+ 
+ ifeq ($(KBUILD_EXTMOD),)
+-core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
++core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
+ 
+ vmlinux-dirs	:= $(patsubst %/,%,$(filter %/, $(init-y) $(init-m) \
+ 		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \
+diff -urNp linux-2.6.26.6/mm/filemap.c linux-2.6.26.6/mm/filemap.c
+--- linux-2.6.26.6/mm/filemap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/filemap.c	2008-10-11 21:54:20.000000000 -0400
@@ -34368 +33835 @@
-@@ -1488,7 +1489,7 @@ int generic_file_mmap(struct file * file, struct vm_area_struct * vma)
+@@ -1488,7 +1489,7 @@ int generic_file_mmap(struct file * file
@@ -34377 +33844 @@
-@@ -1848,6 +1849,7 @@ inline int generic_write_checks(struct file *file, loff_t *pos, size_t *count, i
+@@ -1848,6 +1849,7 @@ inline int generic_write_checks(struct f
@@ -34385,5 +33852,4 @@
-diff --git a/mm/fremap.c b/mm/fremap.c
-index 07a9c82ce1a3fa0e24da2f2da23e9416e3f1819c..63257e7c09a89b8baa8f9b69ff714f3e35ac6f61 100644
---- a/mm/fremap.c
-+++ b/mm/fremap.c
-@@ -150,6 +150,13 @@ asmlinkage long sys_remap_file_pages(unsigned long start, unsigned long size,
+diff -urNp linux-2.6.26.6/mm/fremap.c linux-2.6.26.6/mm/fremap.c
+--- linux-2.6.26.6/mm/fremap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/fremap.c	2008-10-11 21:54:20.000000000 -0400
+@@ -150,6 +150,13 @@ asmlinkage long sys_remap_file_pages(uns
@@ -34403,5 +33869,4 @@
-diff --git a/mm/hugetlb.c b/mm/hugetlb.c
-index ab171274ef217817291667bee226b45bebe259e3..c644d135abb9a344edcf4608e40262d4ed3a9930 100644
---- a/mm/hugetlb.c
-+++ b/mm/hugetlb.c
-@@ -603,7 +603,6 @@ static unsigned long set_max_huge_pages(unsigned long count)
+diff -urNp linux-2.6.26.6/mm/hugetlb.c linux-2.6.26.6/mm/hugetlb.c
+--- linux-2.6.26.6/mm/hugetlb.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/hugetlb.c	2008-10-11 21:55:52.000000000 -0400
+@@ -603,7 +603,6 @@ static unsigned long set_max_huge_pages(
@@ -34415 +33880 @@
-@@ -867,6 +866,26 @@ void unmap_hugepage_range(struct vm_area_struct *vma, unsigned long start,
+@@ -867,6 +866,26 @@ void unmap_hugepage_range(struct vm_area
@@ -34442 +33907 @@
-@@ -902,6 +921,11 @@ static int hugetlb_cow(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -902,6 +921,11 @@ static int hugetlb_cow(struct mm_struct 
@@ -34465 +33930 @@
-@@ -999,6 +1027,27 @@ int hugetlb_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -999,6 +1027,27 @@ int hugetlb_fault(struct mm_struct *mm, 
@@ -34493,5 +33958,4 @@
-diff --git a/mm/madvise.c b/mm/madvise.c
-index 23a0ec3e0ea07bb0f37a001bc1f7e5a683172c22..cca62b473be6f5674b2167866cc46fb152eb4a12 100644
---- a/mm/madvise.c
-+++ b/mm/madvise.c
-@@ -43,6 +43,10 @@ static long madvise_behavior(struct vm_area_struct * vma,
+diff -urNp linux-2.6.26.6/mm/madvise.c linux-2.6.26.6/mm/madvise.c
+--- linux-2.6.26.6/mm/madvise.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/madvise.c	2008-10-11 21:54:20.000000000 -0400
+@@ -43,6 +43,10 @@ static long madvise_behavior(struct vm_a
@@ -34522 +33986 @@
-@@ -236,6 +247,17 @@ madvise_vma(struct vm_area_struct *vma, struct vm_area_struct **prev,
+@@ -236,6 +247,17 @@ madvise_vma(struct vm_area_struct *vma, 
@@ -34540 +34004 @@
-@@ -308,6 +330,16 @@ asmlinkage long sys_madvise(unsigned long start, size_t len_in, int behavior)
+@@ -308,6 +330,16 @@ asmlinkage long sys_madvise(unsigned lon
@@ -34557,4 +34021,3 @@
-diff --git a/mm/memory.c b/mm/memory.c
-index 0755c52a817725f675c453ac507c260b1b35288f..65d15eb4be4cac7f4bf26fbde41b0a15a83e6763 100644
---- a/mm/memory.c
-+++ b/mm/memory.c
+diff -urNp linux-2.6.26.6/mm/memory.c linux-2.6.26.6/mm/memory.c
+--- linux-2.6.26.6/mm/memory.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/memory.c	2008-10-11 21:54:20.000000000 -0400
@@ -34569 +34032 @@
-@@ -1082,11 +1083,11 @@ int get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
+@@ -1082,11 +1083,11 @@ int get_user_pages(struct task_struct *t
@@ -34583 +34046 @@
-@@ -1126,7 +1127,7 @@ int get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
+@@ -1126,7 +1127,7 @@ int get_user_pages(struct task_struct *t
@@ -34592 +34055 @@
-@@ -1199,7 +1200,7 @@ int get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
+@@ -1199,7 +1200,7 @@ int get_user_pages(struct task_struct *t
@@ -34601 +34064 @@
-@@ -1668,6 +1669,186 @@ static inline void cow_user_page(struct page *dst, struct page *src, unsigned lo
+@@ -1668,6 +1669,186 @@ static inline void cow_user_page(struct 
@@ -34812 +34275 @@
-@@ -2103,6 +2294,7 @@ int vmtruncate(struct inode * inode, loff_t offset)
+@@ -2103,6 +2294,7 @@ int vmtruncate(struct inode * inode, lof
@@ -34820 +34283 @@
-@@ -2253,6 +2445,11 @@ static int do_swap_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2253,6 +2445,11 @@ static int do_swap_page(struct mm_struct
@@ -34832 +34295 @@
-@@ -2264,6 +2461,11 @@ static int do_swap_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2264,6 +2461,11 @@ static int do_swap_page(struct mm_struct
@@ -34844 +34307 @@
-@@ -2308,6 +2510,12 @@ static int do_anonymous_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2308,6 +2510,12 @@ static int do_anonymous_page(struct mm_s
@@ -34857 +34320 @@
-@@ -2315,6 +2523,11 @@ static int do_anonymous_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2315,6 +2523,11 @@ static int do_anonymous_page(struct mm_s
@@ -34869 +34332 @@
-@@ -2443,6 +2656,12 @@ static int __do_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2443,6 +2656,12 @@ static int __do_fault(struct mm_struct *
@@ -34882 +34345 @@
-@@ -2463,6 +2682,14 @@ static int __do_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2463,6 +2682,14 @@ static int __do_fault(struct mm_struct *
@@ -34897 +34360 @@
-@@ -2549,6 +2776,11 @@ static noinline int do_no_pfn(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2549,6 +2776,11 @@ static noinline int do_no_pfn(struct mm_
@@ -34909 +34372 @@
-@@ -2651,6 +2883,12 @@ static inline int handle_pte_fault(struct mm_struct *mm,
+@@ -2651,6 +2883,12 @@ static inline int handle_pte_fault(struc
@@ -34922 +34385 @@
-@@ -2667,6 +2905,10 @@ int handle_mm_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2667,6 +2905,10 @@ int handle_mm_fault(struct mm_struct *mm
@@ -34933 +34396 @@
-@@ -2674,6 +2916,34 @@ int handle_mm_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2674,6 +2916,34 @@ int handle_mm_fault(struct mm_struct *mm
@@ -34977,5 +34440,4 @@
-diff --git a/mm/mempolicy.c b/mm/mempolicy.c
-index c94e58b192c3c9913f4f4ab57860b6ac9469f839..905e3dbbc4f9384b75d6b78a48c2de44abedc4b1 100644
---- a/mm/mempolicy.c
-+++ b/mm/mempolicy.c
-@@ -555,6 +555,10 @@ static int mbind_range(struct vm_area_struct *vma, unsigned long start,
+diff -urNp linux-2.6.26.6/mm/mempolicy.c linux-2.6.26.6/mm/mempolicy.c
+--- linux-2.6.26.6/mm/mempolicy.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/mempolicy.c	2008-10-11 21:54:20.000000000 -0400
+@@ -555,6 +555,10 @@ static int mbind_range(struct vm_area_st
@@ -34992 +34454 @@
-@@ -566,6 +570,16 @@ static int mbind_range(struct vm_area_struct *vma, unsigned long start,
+@@ -566,6 +570,16 @@ static int mbind_range(struct vm_area_st
@@ -35009 +34471 @@
-@@ -952,6 +966,17 @@ static long do_mbind(unsigned long start, unsigned long len,
+@@ -952,6 +966,17 @@ static long do_mbind(unsigned long start
@@ -35027,4 +34489,3 @@
-diff --git a/mm/mlock.c b/mm/mlock.c
-index 01fbe93eff5ca25f1143b1295da6ce7115e00bde..16068cbba3a5b79bf8c5d0c42a0b414a33606a5c 100644
---- a/mm/mlock.c
-+++ b/mm/mlock.c
+diff -urNp linux-2.6.26.6/mm/mlock.c linux-2.6.26.6/mm/mlock.c
+--- linux-2.6.26.6/mm/mlock.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/mlock.c	2008-10-11 21:54:20.000000000 -0400
@@ -35039 +34500 @@
-@@ -93,6 +94,17 @@ static int do_mlock(unsigned long start, size_t len, int on)
+@@ -93,6 +94,17 @@ static int do_mlock(unsigned long start,
@@ -35057 +34518 @@
-@@ -150,6 +162,7 @@ asmlinkage long sys_mlock(unsigned long start, size_t len)
+@@ -150,6 +162,7 @@ asmlinkage long sys_mlock(unsigned long 
@@ -35065 +34526 @@
-@@ -171,10 +184,10 @@ asmlinkage long sys_munlock(unsigned long start, size_t len)
+@@ -171,10 +184,10 @@ asmlinkage long sys_munlock(unsigned lon
@@ -35099,4 +34560,3 @@
-diff --git a/mm/mmap.c b/mm/mmap.c
-index 3354fdd83d4bde726d7bb2d2a0951debd4cbc51b..77787dc644f4f5608f2f69c239cf1261cb5008cb 100644
---- a/mm/mmap.c
-+++ b/mm/mmap.c
+diff -urNp linux-2.6.26.6/mm/mmap.c linux-2.6.26.6/mm/mmap.c
+--- linux-2.6.26.6/mm/mmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/mmap.c	2008-10-11 21:54:20.000000000 -0400
@@ -35128 +34588 @@
-@@ -65,15 +76,23 @@ static void unmap_region(struct mm_struct *mm,
+@@ -65,15 +76,23 @@ static void unmap_region(struct mm_struc
@@ -35155 +34615 @@
-@@ -228,6 +247,7 @@ static struct vm_area_struct *remove_vma(struct vm_area_struct *vma)
+@@ -228,6 +247,7 @@ static struct vm_area_struct *remove_vma
@@ -35163 +34623 @@
-@@ -264,6 +284,7 @@ asmlinkage unsigned long sys_brk(unsigned long brk)
+@@ -264,6 +284,7 @@ asmlinkage unsigned long sys_brk(unsigne
@@ -35171 +34631 @@
-@@ -365,8 +386,12 @@ find_vma_prepare(struct mm_struct *mm, unsigned long addr,
+@@ -365,8 +386,12 @@ find_vma_prepare(struct mm_struct *mm, u
@@ -35212 +34672 @@
-@@ -754,12 +791,19 @@ can_vma_merge_after(struct vm_area_struct *vma, unsigned long vm_flags,
+@@ -754,12 +791,19 @@ can_vma_merge_after(struct vm_area_struc
@@ -35233 +34693 @@
-@@ -775,6 +819,15 @@ struct vm_area_struct *vma_merge(struct mm_struct *mm,
+@@ -775,6 +819,15 @@ struct vm_area_struct *vma_merge(struct 
@@ -35249 +34709 @@
-@@ -794,9 +847,24 @@ struct vm_area_struct *vma_merge(struct mm_struct *mm,
+@@ -794,9 +847,24 @@ struct vm_area_struct *vma_merge(struct 
@@ -35275 +34735 @@
-@@ -807,12 +875,27 @@ struct vm_area_struct *vma_merge(struct mm_struct *mm,
+@@ -807,12 +875,27 @@ struct vm_area_struct *vma_merge(struct 
@@ -35321 +34781 @@
-@@ -922,7 +1002,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -922,7 +1002,7 @@ unsigned long do_mmap_pgoff(struct file 
@@ -35330 +34790 @@
-@@ -932,15 +1012,15 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -932,15 +1012,15 @@ unsigned long do_mmap_pgoff(struct file 
@@ -35350 +34810 @@
-@@ -952,7 +1032,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -952,7 +1032,7 @@ unsigned long do_mmap_pgoff(struct file 
@@ -35359 +34819 @@
-@@ -963,6 +1043,26 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -963,6 +1043,26 @@ unsigned long do_mmap_pgoff(struct file 
@@ -35386 +34846 @@
-@@ -975,6 +1075,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -975,6 +1075,7 @@ unsigned long do_mmap_pgoff(struct file 
@@ -35394 +34854 @@
-@@ -1043,6 +1144,9 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -1043,6 +1144,9 @@ unsigned long do_mmap_pgoff(struct file 
@@ -35417 +34877 @@
-@@ -1093,14 +1197,24 @@ unsigned long mmap_region(struct file *file, unsigned long addr,
+@@ -1093,14 +1197,24 @@ unsigned long mmap_region(struct file *f
@@ -35532 +34992 @@
-@@ -1263,6 +1424,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -1263,6 +1424,10 @@ arch_get_unmapped_area(struct file *filp
@@ -35543 +35003 @@
-@@ -1271,10 +1436,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -1271,10 +1436,10 @@ arch_get_unmapped_area(struct file *filp
@@ -35587 +35047 @@
-@@ -1330,7 +1500,7 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -1330,7 +1500,7 @@ arch_get_unmapped_area_topdown(struct fi
@@ -35596 +35056 @@
-@@ -1339,6 +1509,10 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -1339,6 +1509,10 @@ arch_get_unmapped_area_topdown(struct fi
@@ -35644 +35104 @@
-@@ -1418,8 +1606,10 @@ void arch_unmap_area_topdown(struct mm_struct *mm, unsigned long addr)
+@@ -1418,8 +1606,10 @@ void arch_unmap_area_topdown(struct mm_s
@@ -35690 +35150 @@
-@@ -1535,6 +1752,7 @@ static int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, un
+@@ -1535,6 +1752,7 @@ static int acct_stack_growth(struct vm_a
@@ -35698 +35158 @@
-@@ -1544,6 +1762,7 @@ static int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, un
+@@ -1544,6 +1762,7 @@ static int acct_stack_growth(struct vm_a
@@ -35706 +35166 @@
-@@ -1558,7 +1777,7 @@ static int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, un
+@@ -1558,7 +1777,7 @@ static int acct_stack_growth(struct vm_a
@@ -35766 +35226 @@
-@@ -1617,6 +1841,8 @@ int expand_upwards(struct vm_area_struct *vma, unsigned long address)
+@@ -1617,6 +1841,8 @@ int expand_upwards(struct vm_area_struct
@@ -35775 +35235 @@
-@@ -1628,7 +1854,8 @@ int expand_upwards(struct vm_area_struct *vma, unsigned long address)
+@@ -1628,7 +1854,8 @@ int expand_upwards(struct vm_area_struct
@@ -35785 +35245 @@
-@@ -1642,6 +1869,15 @@ static inline int expand_downwards(struct vm_area_struct *vma,
+@@ -1642,6 +1869,15 @@ static inline int expand_downwards(struc
@@ -35801 +35261 @@
-@@ -1651,9 +1887,15 @@ static inline int expand_downwards(struct vm_area_struct *vma,
+@@ -1651,9 +1887,15 @@ static inline int expand_downwards(struc
@@ -35818 +35278 @@
-@@ -1661,9 +1903,20 @@ static inline int expand_downwards(struct vm_area_struct *vma,
+@@ -1661,9 +1903,20 @@ static inline int expand_downwards(struc
@@ -35839 +35299 @@
-@@ -1735,6 +1988,13 @@ static void remove_vma_list(struct mm_struct *mm, struct vm_area_struct *vma)
+@@ -1735,6 +1988,13 @@ static void remove_vma_list(struct mm_st
@@ -35853 +35313 @@
-@@ -1781,6 +2041,16 @@ detach_vmas_to_be_unmapped(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -1781,6 +2041,16 @@ detach_vmas_to_be_unmapped(struct mm_str
@@ -35870 +35330 @@
-@@ -1800,6 +2070,108 @@ detach_vmas_to_be_unmapped(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -1800,6 +2070,108 @@ detach_vmas_to_be_unmapped(struct mm_str
@@ -35979 +35439 @@
-@@ -1850,17 +2222,37 @@ int split_vma(struct mm_struct * mm, struct vm_area_struct * vma,
+@@ -1850,17 +2222,37 @@ int split_vma(struct mm_struct * mm, str
@@ -35991,2 +35451,2 @@
- int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
- {
++int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
++{
@@ -36002 +35462 @@
-+int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
+ int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
@@ -36004 +35464 @@
-+{
+ {
@@ -36017 +35477 @@
-@@ -1910,6 +2302,8 @@ int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
+@@ -1910,6 +2302,8 @@ int do_munmap(struct mm_struct *mm, unsi
@@ -36026 +35486 @@
-@@ -1922,22 +2316,18 @@ asmlinkage long sys_munmap(unsigned long addr, size_t len)
+@@ -1922,22 +2316,18 @@ asmlinkage long sys_munmap(unsigned long
@@ -36055 +35515 @@
-@@ -1951,6 +2341,11 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -1951,6 +2341,11 @@ unsigned long do_brk(unsigned long addr,
@@ -36067 +35527 @@
-@@ -1968,19 +2363,34 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -1968,19 +2363,34 @@ unsigned long do_brk(unsigned long addr,
@@ -36103 +35563 @@
-@@ -1994,22 +2404,22 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -1994,22 +2404,22 @@ unsigned long do_brk(unsigned long addr,
@@ -36130 +35590 @@
-@@ -2022,10 +2432,21 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -2022,10 +2432,21 @@ unsigned long do_brk(unsigned long addr,
@@ -36153 +35613 @@
-@@ -2033,12 +2454,19 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -2033,12 +2454,19 @@ unsigned long do_brk(unsigned long addr,
@@ -36187 +35647 @@
-@@ -2084,6 +2514,10 @@ int insert_vm_struct(struct mm_struct * mm, struct vm_area_struct * vma)
+@@ -2084,6 +2514,10 @@ int insert_vm_struct(struct mm_struct * 
@@ -36198 +35658 @@
-@@ -2106,7 +2540,22 @@ int insert_vm_struct(struct mm_struct * mm, struct vm_area_struct * vma)
+@@ -2106,7 +2540,22 @@ int insert_vm_struct(struct mm_struct * 
@@ -36221 +35681 @@
-@@ -2124,6 +2573,8 @@ struct vm_area_struct *copy_vma(struct vm_area_struct **vmap,
+@@ -2124,6 +2573,8 @@ struct vm_area_struct *copy_vma(struct v
@@ -36230 +35690 @@
-@@ -2167,6 +2618,35 @@ struct vm_area_struct *copy_vma(struct vm_area_struct **vmap,
+@@ -2167,6 +2618,35 @@ struct vm_area_struct *copy_vma(struct v
@@ -36266 +35726 @@
-@@ -2177,7 +2657,7 @@ int may_expand_vm(struct mm_struct *mm, unsigned long npages)
+@@ -2177,7 +2657,7 @@ int may_expand_vm(struct mm_struct *mm, 
@@ -36275 +35735 @@
-@@ -2246,6 +2726,15 @@ int install_special_mapping(struct mm_struct *mm,
+@@ -2246,6 +2726,15 @@ int install_special_mapping(struct mm_st
@@ -36291,4 +35751,3 @@
-diff --git a/mm/mprotect.c b/mm/mprotect.c
-index a5bf31c273757848ae7614bd9fc3c8595c493705..7a57defa62d0468481a332e56bce0c74645ac794 100644
---- a/mm/mprotect.c
-+++ b/mm/mprotect.c
+diff -urNp linux-2.6.26.6/mm/mprotect.c linux-2.6.26.6/mm/mprotect.c
+--- linux-2.6.26.6/mm/mprotect.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/mprotect.c	2008-10-11 21:54:20.000000000 -0400
@@ -36313 +35772 @@
-@@ -134,6 +141,48 @@ static void change_protection(struct vm_area_struct *vma,
+@@ -134,6 +141,48 @@ static void change_protection(struct vm_
@@ -36362 +35821 @@
-@@ -146,6 +195,14 @@ mprotect_fixup(struct vm_area_struct *vma, struct vm_area_struct **pprev,
+@@ -146,6 +195,14 @@ mprotect_fixup(struct vm_area_struct *vm
@@ -36377 +35836 @@
-@@ -168,6 +225,38 @@ mprotect_fixup(struct vm_area_struct *vma, struct vm_area_struct **pprev,
+@@ -168,6 +225,38 @@ mprotect_fixup(struct vm_area_struct *vm
@@ -36487 +35946 @@
-@@ -239,6 +392,17 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -239,6 +392,17 @@ sys_mprotect(unsigned long start, size_t
@@ -36505 +35964 @@
-@@ -246,7 +410,7 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -246,7 +410,7 @@ sys_mprotect(unsigned long start, size_t
@@ -36514 +35973 @@
-@@ -278,6 +442,16 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -278,6 +442,16 @@ sys_mprotect(unsigned long start, size_t
@@ -36531 +35990 @@
-@@ -291,6 +465,12 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -291,6 +465,12 @@ sys_mprotect(unsigned long start, size_t
@@ -36544 +36003 @@
-@@ -301,6 +481,9 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -301,6 +481,9 @@ sys_mprotect(unsigned long start, size_t
@@ -36554,5 +36013,4 @@
-diff --git a/mm/mremap.c b/mm/mremap.c
-index 08e3c7f2bd15a1b2e502aeb3e9f509148cb5dfa8..e75d87beae910d94591018b3f813e817399344e9 100644
---- a/mm/mremap.c
-+++ b/mm/mremap.c
-@@ -106,6 +106,12 @@ static void move_ptes(struct vm_area_struct *vma, pmd_t *old_pmd,
+diff -urNp linux-2.6.26.6/mm/mremap.c linux-2.6.26.6/mm/mremap.c
+--- linux-2.6.26.6/mm/mremap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/mremap.c	2008-10-11 21:54:20.000000000 -0400
+@@ -106,6 +106,12 @@ static void move_ptes(struct vm_area_str
@@ -36571 +36029 @@
-@@ -254,6 +260,7 @@ unsigned long do_mremap(unsigned long addr,
+@@ -254,6 +260,7 @@ unsigned long do_mremap(unsigned long ad
@@ -36579 +36037 @@
-@@ -272,6 +279,15 @@ unsigned long do_mremap(unsigned long addr,
+@@ -272,6 +279,15 @@ unsigned long do_mremap(unsigned long ad
@@ -36595 +36053 @@
-@@ -279,16 +295,13 @@ unsigned long do_mremap(unsigned long addr,
+@@ -279,16 +295,13 @@ unsigned long do_mremap(unsigned long ad
@@ -36614 +36072 @@
-@@ -326,6 +339,14 @@ unsigned long do_mremap(unsigned long addr,
+@@ -326,6 +339,14 @@ unsigned long do_mremap(unsigned long ad
@@ -36629 +36087 @@
-@@ -359,7 +380,7 @@ unsigned long do_mremap(unsigned long addr,
+@@ -359,7 +380,7 @@ unsigned long do_mremap(unsigned long ad
@@ -36638 +36096 @@
-@@ -377,6 +398,7 @@ unsigned long do_mremap(unsigned long addr,
+@@ -377,6 +398,7 @@ unsigned long do_mremap(unsigned long ad
@@ -36646 +36104 @@
-@@ -387,8 +409,8 @@ unsigned long do_mremap(unsigned long addr,
+@@ -387,8 +409,8 @@ unsigned long do_mremap(unsigned long ad
@@ -36656 +36114 @@
-@@ -403,7 +425,12 @@ unsigned long do_mremap(unsigned long addr,
+@@ -403,7 +425,12 @@ unsigned long do_mremap(unsigned long ad
@@ -36669,5 +36127,4 @@
-diff --git a/mm/nommu.c b/mm/nommu.c
-index 4462b6a3fcb984e9bd37a69ef7d377f0b5dd2367..41420f71efb7f994f7698dab51402d9c1f4d4afb 100644
---- a/mm/nommu.c
-+++ b/mm/nommu.c
-@@ -416,15 +416,6 @@ struct vm_area_struct *find_vma(struct mm_struct *mm, unsigned long addr)
+diff -urNp linux-2.6.26.6/mm/nommu.c linux-2.6.26.6/mm/nommu.c
+--- linux-2.6.26.6/mm/nommu.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/nommu.c	2008-10-11 21:54:20.000000000 -0400
+@@ -416,15 +416,6 @@ struct vm_area_struct *find_vma(struct m
@@ -36689,5 +36146,4 @@
-diff --git a/mm/page_alloc.c b/mm/page_alloc.c
-index 0d520dce6aeaca13c1c9456c3bbe89770468dc3d..59732bf90b40b6a62586fbbc910543fba97a4941 100644
---- a/mm/page_alloc.c
-+++ b/mm/page_alloc.c
-@@ -497,9 +497,20 @@ static void free_pages_bulk(struct zone *zone, int count,
+diff -urNp linux-2.6.26.6/mm/page_alloc.c linux-2.6.26.6/mm/page_alloc.c
+--- linux-2.6.26.6/mm/page_alloc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/page_alloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -497,9 +497,20 @@ static void free_pages_bulk(struct zone 
@@ -36714 +36170 @@
-@@ -617,8 +628,10 @@ static int prep_new_page(struct page *page, int order, gfp_t gfp_flags)
+@@ -617,8 +628,10 @@ static int prep_new_page(struct page *pa
@@ -36725 +36181 @@
-@@ -990,6 +1003,11 @@ static void free_hot_cold_page(struct page *page, int cold)
+@@ -990,6 +1003,11 @@ static void free_hot_cold_page(struct pa
@@ -36737,5 +36193,4 @@
-diff --git a/mm/rmap.c b/mm/rmap.c
-index ded8f9ed246eac8550ffe59890393159ed391022..901ed74a5df6e09a21ff84256208d6140f096f46 100644
---- a/mm/rmap.c
-+++ b/mm/rmap.c
-@@ -64,6 +64,10 @@ int anon_vma_prepare(struct vm_area_struct *vma)
+diff -urNp linux-2.6.26.6/mm/rmap.c linux-2.6.26.6/mm/rmap.c
+--- linux-2.6.26.6/mm/rmap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/rmap.c	2008-10-11 21:54:20.000000000 -0400
+@@ -64,6 +64,10 @@ int anon_vma_prepare(struct vm_area_stru
@@ -36752 +36207 @@
-@@ -80,6 +84,15 @@ int anon_vma_prepare(struct vm_area_struct *vma)
+@@ -80,6 +84,15 @@ int anon_vma_prepare(struct vm_area_stru
@@ -36768,5 +36223,4 @@
-diff --git a/mm/shmem.c b/mm/shmem.c
-index 8f8412bab0fb9161451170152e4da333f104d359..7df67d52db8e3901dea92a8ea69ef2bf26ff89b8 100644
---- a/mm/shmem.c
-+++ b/mm/shmem.c
-@@ -2460,7 +2460,7 @@ static struct file_system_type tmpfs_fs_type = {
+diff -urNp linux-2.6.26.6/mm/shmem.c linux-2.6.26.6/mm/shmem.c
+--- linux-2.6.26.6/mm/shmem.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/shmem.c	2008-10-11 21:54:20.000000000 -0400
+@@ -2460,7 +2460,7 @@ static struct file_system_type tmpfs_fs_
@@ -36781,4 +36235,3 @@
-diff --git a/mm/slab.c b/mm/slab.c
-index 046607f05f3eb16414538201836c6e605135b0e8..ee492acfb15a9c64cf3eb1e2b68cdeacffdfaecd 100644
---- a/mm/slab.c
-+++ b/mm/slab.c
+diff -urNp linux-2.6.26.6/mm/slab.c linux-2.6.26.6/mm/slab.c
+--- linux-2.6.26.6/mm/slab.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/slab.c	2008-10-11 21:54:20.000000000 -0400
@@ -36821,4 +36274,3 @@
-diff --git a/mm/swap.c b/mm/swap.c
-index 45c9f25a8a3be7e2dccc6a6f807e0eaeade1e697..28ab96b88be9d93c294a2916aa225be2f567a65b 100644
---- a/mm/swap.c
-+++ b/mm/swap.c
+diff -urNp linux-2.6.26.6/mm/swap.c linux-2.6.26.6/mm/swap.c
+--- linux-2.6.26.6/mm/swap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/swap.c	2008-10-11 21:54:20.000000000 -0400
@@ -36838,5 +36290,4 @@
-diff --git a/mm/tiny-shmem.c b/mm/tiny-shmem.c
-index ae532f50194319ce83b813a88b6a25aa5a4e85e5..d0eb17eabd97029f54a55c479ed282e2aee61396 100644
---- a/mm/tiny-shmem.c
-+++ b/mm/tiny-shmem.c
-@@ -26,7 +26,7 @@ static struct file_system_type tmpfs_fs_type = {
+diff -urNp linux-2.6.26.6/mm/tiny-shmem.c linux-2.6.26.6/mm/tiny-shmem.c
+--- linux-2.6.26.6/mm/tiny-shmem.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/tiny-shmem.c	2008-10-11 21:54:20.000000000 -0400
+@@ -26,7 +26,7 @@ static struct file_system_type tmpfs_fs_
@@ -36851,5 +36302,4 @@
-diff --git a/mm/vmalloc.c b/mm/vmalloc.c
-index 6e45b0f3d1256e0bdc3a3caffa74597cf96a5138..151102568276a4ebab4f8b0c3f5f62489e6b3e85 100644
---- a/mm/vmalloc.c
-+++ b/mm/vmalloc.c
-@@ -248,20 +248,15 @@ __get_vm_area_node(unsigned long size, unsigned long flags, unsigned long start,
+diff -urNp linux-2.6.26.6/mm/vmalloc.c linux-2.6.26.6/mm/vmalloc.c
+--- linux-2.6.26.6/mm/vmalloc.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/mm/vmalloc.c	2008-10-11 21:54:20.000000000 -0400
+@@ -248,20 +248,15 @@ __get_vm_area_node(unsigned long size, u
@@ -36886,5 +36336,4 @@
-diff --git a/net/bridge/br_stp_if.c b/net/bridge/br_stp_if.c
-index 1a430eccec9b8a25aef64971e812f4ec3483b242..55089bec07cf2575da5f5234cd9138e6275d75c1 100644
---- a/net/bridge/br_stp_if.c
-+++ b/net/bridge/br_stp_if.c
-@@ -148,7 +148,7 @@ static void br_stp_stop(struct net_bridge *br)
+diff -urNp linux-2.6.26.6/net/bridge/br_stp_if.c linux-2.6.26.6/net/bridge/br_stp_if.c
+--- linux-2.6.26.6/net/bridge/br_stp_if.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/bridge/br_stp_if.c	2008-10-11 21:54:20.000000000 -0400
+@@ -148,7 +148,7 @@ static void br_stp_stop(struct net_bridg
@@ -36899,5 +36348,4 @@
-diff --git a/net/core/flow.c b/net/core/flow.c
-index 19991175fdeb4bca0f2e357ae7dfa5545dc72371..9375bb93958d4a1d568df4abd99afe68be7db897 100644
---- a/net/core/flow.c
-+++ b/net/core/flow.c
-@@ -39,7 +39,7 @@ atomic_t flow_cache_genid = ATOMIC_INIT(0);
+diff -urNp linux-2.6.26.6/net/core/flow.c linux-2.6.26.6/net/core/flow.c
+--- linux-2.6.26.6/net/core/flow.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/core/flow.c	2008-10-11 21:54:20.000000000 -0400
+@@ -39,7 +39,7 @@ atomic_t flow_cache_genid = ATOMIC_INIT(
@@ -36930,4 +36378,3 @@
-diff --git a/net/dccp/ccids/ccid3.c b/net/dccp/ccids/ccid3.c
-index a1929f33d7030a2ac91fe51c99b16a104070eeb7..db5fcf003e2cd23f4c381c19c16caad56dfbc6a3 100644
---- a/net/dccp/ccids/ccid3.c
-+++ b/net/dccp/ccids/ccid3.c
+diff -urNp linux-2.6.26.6/net/dccp/ccids/ccid3.c linux-2.6.26.6/net/dccp/ccids/ccid3.c
+--- linux-2.6.26.6/net/dccp/ccids/ccid3.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/dccp/ccids/ccid3.c	2008-10-11 21:54:20.000000000 -0400
@@ -36943,4 +36390,3 @@
-diff --git a/net/dccp/dccp.h b/net/dccp/dccp.h
-index f44d492d3b7491d5dbce8dec8cd6a49749bb068d..540e2ac446a1820a085dea13055ec2f198b1598b 100644
---- a/net/dccp/dccp.h
-+++ b/net/dccp/dccp.h
+diff -urNp linux-2.6.26.6/net/dccp/dccp.h linux-2.6.26.6/net/dccp/dccp.h
+--- linux-2.6.26.6/net/dccp/dccp.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/dccp/dccp.h	2008-10-11 21:54:20.000000000 -0400
@@ -36958,4 +36404,3 @@
-diff --git a/net/ipv4/inet_connection_sock.c b/net/ipv4/inet_connection_sock.c
-index ec834480abe727c3cfee6100824cf87a2f7284fa..6485ebb0dd832059a3ff8f8ccd862ed59a3a4a15 100644
---- a/net/ipv4/inet_connection_sock.c
-+++ b/net/ipv4/inet_connection_sock.c
+diff -urNp linux-2.6.26.6/net/ipv4/inet_connection_sock.c linux-2.6.26.6/net/ipv4/inet_connection_sock.c
+--- linux-2.6.26.6/net/ipv4/inet_connection_sock.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv4/inet_connection_sock.c	2008-10-11 21:54:20.000000000 -0400
@@ -36970,4 +36415,3 @@
-diff --git a/net/ipv4/inet_hashtables.c b/net/ipv4/inet_hashtables.c
-index 2023d37b2708ea12ea5e5a4cb6ae010697b8d386..de33fa69553ec9a9f77d1f0e8461259d0b008206 100644
---- a/net/ipv4/inet_hashtables.c
-+++ b/net/ipv4/inet_hashtables.c
+diff -urNp linux-2.6.26.6/net/ipv4/inet_hashtables.c linux-2.6.26.6/net/ipv4/inet_hashtables.c
+--- linux-2.6.26.6/net/ipv4/inet_hashtables.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv4/inet_hashtables.c	2008-10-11 21:54:20.000000000 -0400
@@ -36998,48 +36442,3 @@
-diff --git a/net/ipv4/netfilter/Kconfig b/net/ipv4/netfilter/Kconfig
-index 2767841a8cefc19377a96506e2f2c4e1c2db7586..65971f1ba58104e7ef320e714d6ef5691bd891e7 100644
---- a/net/ipv4/netfilter/Kconfig
-+++ b/net/ipv4/netfilter/Kconfig
-@@ -111,6 +111,21 @@ config IP_NF_MATCH_ADDRTYPE
- 	  If you want to compile it as a module, say M here and read
- 	  <file:Documentation/kbuild/modules.txt>.  If unsure, say `N'.
- 
-+config IP_NF_MATCH_STEALTH
-+	tristate "stealth match support"
-+	depends on IP_NF_IPTABLES
-+	help
-+	  Enabling this option will drop all syn packets coming to unserved tcp
-+	  ports as well as all packets coming to unserved udp ports.  If you
-+	  are using your system to route any type of packets (ie. via NAT)
-+	  you should put this module at the end of your ruleset, since it will
-+	  drop packets that aren't going to ports that are listening on your
-+	  machine itself, it doesn't take into account that the packet might be
-+	  destined for someone on your internal network if you're using NAT for
-+	  instance.
-+
-+	  To compile it as a module, choose M here.  If unsure, say N.
-+
- # `filter', generic and specific targets
- config IP_NF_FILTER
- 	tristate "Packet filtering"
-@@ -396,4 +411,3 @@ config IP_NF_ARP_MANGLE
- 	  hardware and network addresses.
- 
- endmenu
--
-diff --git a/net/ipv4/netfilter/Makefile b/net/ipv4/netfilter/Makefile
-index d9b92fbf5579583918a7d5f01a1ea3ce0184b60a..f5c827ab65659578ab29e94391e5f81201b7600b 100644
---- a/net/ipv4/netfilter/Makefile
-+++ b/net/ipv4/netfilter/Makefile
-@@ -58,6 +58,7 @@ obj-$(CONFIG_IP_NF_TARGET_MASQUERADE) += ipt_MASQUERADE.o
- obj-$(CONFIG_IP_NF_TARGET_NETMAP) += ipt_NETMAP.o
- obj-$(CONFIG_IP_NF_TARGET_REDIRECT) += ipt_REDIRECT.o
- obj-$(CONFIG_IP_NF_TARGET_REJECT) += ipt_REJECT.o
-+obj-$(CONFIG_IP_NF_MATCH_STEALTH) += ipt_stealth.o
- obj-$(CONFIG_IP_NF_TARGET_TTL) += ipt_TTL.o
- obj-$(CONFIG_IP_NF_TARGET_ULOG) += ipt_ULOG.o
- 
-diff --git a/net/ipv4/netfilter/ipt_stealth.c b/net/ipv4/netfilter/ipt_stealth.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..6141a8207c2ac0cc1d009a54eec35b944d57e48f
---- /dev/null
-+++ b/net/ipv4/netfilter/ipt_stealth.c
+diff -urNp linux-2.6.26.6/net/ipv4/netfilter/ipt_stealth.c linux-2.6.26.6/net/ipv4/netfilter/ipt_stealth.c
+--- linux-2.6.26.6/net/ipv4/netfilter/ipt_stealth.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.6/net/ipv4/netfilter/ipt_stealth.c	2008-10-11 21:54:20.000000000 -0400
@@ -37161,4 +36560,44 @@
-diff --git a/net/ipv4/tcp_ipv4.c b/net/ipv4/tcp_ipv4.c
-index ffe869ac1bcf15b51abd801b3b3b4533da0b530e..cd188dce4e890c30dec2b82ddf45e88b628311ae 100644
---- a/net/ipv4/tcp_ipv4.c
-+++ b/net/ipv4/tcp_ipv4.c
+diff -urNp linux-2.6.26.6/net/ipv4/netfilter/Kconfig linux-2.6.26.6/net/ipv4/netfilter/Kconfig
+--- linux-2.6.26.6/net/ipv4/netfilter/Kconfig	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv4/netfilter/Kconfig	2008-10-11 21:54:20.000000000 -0400
+@@ -111,6 +111,21 @@ config IP_NF_MATCH_ADDRTYPE
+ 	  If you want to compile it as a module, say M here and read
+ 	  <file:Documentation/kbuild/modules.txt>.  If unsure, say `N'.
+ 
++config IP_NF_MATCH_STEALTH
++	tristate "stealth match support"
++	depends on IP_NF_IPTABLES
++	help
++	  Enabling this option will drop all syn packets coming to unserved tcp
++	  ports as well as all packets coming to unserved udp ports.  If you
++	  are using your system to route any type of packets (ie. via NAT)
++	  you should put this module at the end of your ruleset, since it will
++	  drop packets that aren't going to ports that are listening on your
++	  machine itself, it doesn't take into account that the packet might be
++	  destined for someone on your internal network if you're using NAT for
++	  instance.
++
++	  To compile it as a module, choose M here.  If unsure, say N.
++
+ # `filter', generic and specific targets
+ config IP_NF_FILTER
+ 	tristate "Packet filtering"
+@@ -396,4 +411,3 @@ config IP_NF_ARP_MANGLE
+ 	  hardware and network addresses.
+ 
+ endmenu
+-
+diff -urNp linux-2.6.26.6/net/ipv4/netfilter/Makefile linux-2.6.26.6/net/ipv4/netfilter/Makefile
+--- linux-2.6.26.6/net/ipv4/netfilter/Makefile	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv4/netfilter/Makefile	2008-10-11 21:54:20.000000000 -0400
+@@ -58,6 +58,7 @@ obj-$(CONFIG_IP_NF_TARGET_MASQUERADE) +=
+ obj-$(CONFIG_IP_NF_TARGET_NETMAP) += ipt_NETMAP.o
+ obj-$(CONFIG_IP_NF_TARGET_REDIRECT) += ipt_REDIRECT.o
+ obj-$(CONFIG_IP_NF_TARGET_REJECT) += ipt_REJECT.o
++obj-$(CONFIG_IP_NF_MATCH_STEALTH) += ipt_stealth.o
+ obj-$(CONFIG_IP_NF_TARGET_TTL) += ipt_TTL.o
+ obj-$(CONFIG_IP_NF_TARGET_ULOG) += ipt_ULOG.o
+ 
+diff -urNp linux-2.6.26.6/net/ipv4/tcp_ipv4.c linux-2.6.26.6/net/ipv4/tcp_ipv4.c
+--- linux-2.6.26.6/net/ipv4/tcp_ipv4.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv4/tcp_ipv4.c	2008-10-11 21:54:20.000000000 -0400
@@ -37173,4 +36612,3 @@
-diff --git a/net/ipv4/udp.c b/net/ipv4/udp.c
-index 9ca32e63f2635cd305a0ccb6651477ade276dd00..e2fb694b496a26a3e54ef577ddd8113c6487458d 100644
---- a/net/ipv4/udp.c
-+++ b/net/ipv4/udp.c
+diff -urNp linux-2.6.26.6/net/ipv4/udp.c linux-2.6.26.6/net/ipv4/udp.c
+--- linux-2.6.26.6/net/ipv4/udp.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv4/udp.c	2008-10-11 21:54:20.000000000 -0400
@@ -37197 +36635 @@
-@@ -307,6 +313,13 @@ static struct sock *__udp4_lib_lookup(struct net *net, __be32 saddr,
+@@ -307,6 +313,13 @@ static struct sock *__udp4_lib_lookup(st
@@ -37211 +36649 @@
-@@ -594,9 +607,16 @@ int udp_sendmsg(struct kiocb *iocb, struct sock *sk, struct msghdr *msg,
+@@ -594,9 +607,16 @@ int udp_sendmsg(struct kiocb *iocb, stru
@@ -37240,5 +36678,4 @@
-diff --git a/net/ipv6/exthdrs.c b/net/ipv6/exthdrs.c
-index dcf94fdfb863889bf1a9729010f4ffa3a6c3696a..cecfd27a47270f2a13c60a7e4432070277490112 100644
---- a/net/ipv6/exthdrs.c
-+++ b/net/ipv6/exthdrs.c
-@@ -626,7 +626,7 @@ static struct tlvtype_proc tlvprochopopt_lst[] = {
+diff -urNp linux-2.6.26.6/net/ipv6/exthdrs.c linux-2.6.26.6/net/ipv6/exthdrs.c
+--- linux-2.6.26.6/net/ipv6/exthdrs.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv6/exthdrs.c	2008-10-11 21:54:20.000000000 -0400
+@@ -626,7 +626,7 @@ static struct tlvtype_proc tlvprochopopt
@@ -37253,4 +36690,3 @@
-diff --git a/net/ipv6/raw.c b/net/ipv6/raw.c
-index 3aee12310d946e8bb882b929c89c991791ff1d85..06d503235c0df22104e5c51768d3f8634388b981 100644
---- a/net/ipv6/raw.c
-+++ b/net/ipv6/raw.c
+diff -urNp linux-2.6.26.6/net/ipv6/raw.c linux-2.6.26.6/net/ipv6/raw.c
+--- linux-2.6.26.6/net/ipv6/raw.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/ipv6/raw.c	2008-10-11 21:54:20.000000000 -0400
@@ -37266,5 +36702,4 @@
-diff --git a/net/irda/ircomm/ircomm_tty.c b/net/irda/ircomm/ircomm_tty.c
-index 76c3057d01790c23ae1e1055e6927cf6c2d2a6a0..0b92324ed1c0d3d62ed5d155231ebefa69a075fc 100644
---- a/net/irda/ircomm/ircomm_tty.c
-+++ b/net/irda/ircomm/ircomm_tty.c
-@@ -371,7 +371,7 @@ static int ircomm_tty_open(struct tty_struct *tty, struct file *filp)
+diff -urNp linux-2.6.26.6/net/irda/ircomm/ircomm_tty.c linux-2.6.26.6/net/irda/ircomm/ircomm_tty.c
+--- linux-2.6.26.6/net/irda/ircomm/ircomm_tty.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/irda/ircomm/ircomm_tty.c	2008-10-11 21:54:20.000000000 -0400
+@@ -371,7 +371,7 @@ static int ircomm_tty_open(struct tty_st
@@ -37279,5 +36714,4 @@
-diff --git a/net/sctp/socket.c b/net/sctp/socket.c
-index 700d27d447ba8a7fa4935c3d06ec82f5be8ee4d1..e8773ad1fd30a91d2559acd45c6561e82bfaf6a4 100644
---- a/net/sctp/socket.c
-+++ b/net/sctp/socket.c
-@@ -1386,7 +1386,7 @@ SCTP_STATIC int sctp_sendmsg(struct kiocb *iocb, struct sock *sk,
+diff -urNp linux-2.6.26.6/net/sctp/socket.c linux-2.6.26.6/net/sctp/socket.c
+--- linux-2.6.26.6/net/sctp/socket.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/sctp/socket.c	2008-10-11 21:55:52.000000000 -0400
+@@ -1386,7 +1386,7 @@ SCTP_STATIC int sctp_sendmsg(struct kioc
@@ -37300,4 +36734,3 @@
-diff --git a/net/socket.c b/net/socket.c
-index 66c4a8cf6db9d2d2886e013cf3904d5527c7438d..3ffbf1b32026f897845bb139769a2b8dc2c305be 100644
---- a/net/socket.c
-+++ b/net/socket.c
+diff -urNp linux-2.6.26.6/net/socket.c linux-2.6.26.6/net/socket.c
+--- linux-2.6.26.6/net/socket.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/socket.c	2008-10-11 21:54:20.000000000 -0400
@@ -37334 +36767 @@
-@@ -297,7 +313,7 @@ static int sockfs_get_sb(struct file_system_type *fs_type,
+@@ -297,7 +313,7 @@ static int sockfs_get_sb(struct file_sys
@@ -37343 +36776 @@
-@@ -1218,6 +1234,16 @@ asmlinkage long sys_socket(int family, int type, int protocol)
+@@ -1218,6 +1234,16 @@ asmlinkage long sys_socket(int family, i
@@ -37360 +36793 @@
-@@ -1348,6 +1374,12 @@ asmlinkage long sys_bind(int fd, struct sockaddr __user *umyaddr, int addrlen)
+@@ -1348,6 +1374,12 @@ asmlinkage long sys_bind(int fd, struct 
@@ -37373 +36806 @@
-@@ -1356,6 +1388,7 @@ asmlinkage long sys_bind(int fd, struct sockaddr __user *umyaddr, int addrlen)
+@@ -1356,6 +1388,7 @@ asmlinkage long sys_bind(int fd, struct 
@@ -37381 +36814 @@
-@@ -1379,10 +1412,17 @@ asmlinkage long sys_listen(int fd, int backlog)
+@@ -1379,10 +1412,17 @@ asmlinkage long sys_listen(int fd, int b
@@ -37399 +36832 @@
-@@ -1419,6 +1459,13 @@ asmlinkage long sys_accept(int fd, struct sockaddr __user *upeer_sockaddr,
+@@ -1419,6 +1459,13 @@ asmlinkage long sys_accept(int fd, struc
@@ -37413 +36846 @@
-@@ -1462,6 +1509,7 @@ asmlinkage long sys_accept(int fd, struct sockaddr __user *upeer_sockaddr,
+@@ -1462,6 +1509,7 @@ asmlinkage long sys_accept(int fd, struc
@@ -37421 +36854 @@
-@@ -1495,6 +1543,7 @@ asmlinkage long sys_connect(int fd, struct sockaddr __user *uservaddr,
+@@ -1495,6 +1543,7 @@ asmlinkage long sys_connect(int fd, stru
@@ -37429 +36862 @@
-@@ -1504,6 +1553,13 @@ asmlinkage long sys_connect(int fd, struct sockaddr __user *uservaddr,
+@@ -1504,6 +1553,13 @@ asmlinkage long sys_connect(int fd, stru
@@ -37443 +36876 @@
-@@ -1770,6 +1826,7 @@ asmlinkage long sys_shutdown(int fd, int how)
+@@ -1770,6 +1826,7 @@ asmlinkage long sys_shutdown(int fd, int
@@ -37451,4 +36884,3 @@
-diff --git a/net/unix/af_unix.c b/net/unix/af_unix.c
-index 783317dacd3090f7d602b3c56e82859f3cc22a46..783d94dac0eb2054cc19c81813b67cd56248e3fa 100644
---- a/net/unix/af_unix.c
-+++ b/net/unix/af_unix.c
+diff -urNp linux-2.6.26.6/net/unix/af_unix.c linux-2.6.26.6/net/unix/af_unix.c
+--- linux-2.6.26.6/net/unix/af_unix.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/net/unix/af_unix.c	2008-10-11 21:54:20.000000000 -0400
@@ -37463 +36895 @@
-@@ -727,6 +728,12 @@ static struct sock *unix_find_other(struct net *net,
+@@ -727,6 +728,12 @@ static struct sock *unix_find_other(stru
@@ -37476 +36908 @@
-@@ -747,6 +754,13 @@ static struct sock *unix_find_other(struct net *net,
+@@ -747,6 +754,13 @@ static struct sock *unix_find_other(stru
@@ -37490 +36922 @@
-@@ -829,10 +843,20 @@ static int unix_bind(struct socket *sock, struct sockaddr *uaddr, int addr_len)
+@@ -829,10 +843,20 @@ static int unix_bind(struct socket *sock
@@ -37511 +36943 @@
-@@ -850,6 +874,10 @@ static int unix_bind(struct socket *sock, struct sockaddr *uaddr, int addr_len)
+@@ -850,6 +874,10 @@ static int unix_bind(struct socket *sock
@@ -37522,4 +36954,3 @@
-diff --git a/scripts/pnmtologo.c b/scripts/pnmtologo.c
-index 6aa2a2483f8df04abe75421f28d8deca7cff42c3..c45c7ba03dd534ae91234a2c03be4c5d028eb843 100644
---- a/scripts/pnmtologo.c
-+++ b/scripts/pnmtologo.c
+diff -urNp linux-2.6.26.6/scripts/pnmtologo.c linux-2.6.26.6/scripts/pnmtologo.c
+--- linux-2.6.26.6/scripts/pnmtologo.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/scripts/pnmtologo.c	2008-10-11 21:54:20.000000000 -0400
@@ -37552,4 +36983,95 @@
-diff --git a/security/Kconfig b/security/Kconfig
-index 49b51f964897dcb7133be9b58f1b936462bb6309..d63f76a9d9694d287d2fed4c70bd8cb69504e17e 100644
---- a/security/Kconfig
-+++ b/security/Kconfig
+diff -urNp linux-2.6.26.6/security/commoncap.c linux-2.6.26.6/security/commoncap.c
+--- linux-2.6.26.6/security/commoncap.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/security/commoncap.c	2008-10-11 21:54:20.000000000 -0400
+@@ -26,10 +26,13 @@
+ #include <linux/sched.h>
+ #include <linux/prctl.h>
+ #include <linux/securebits.h>
++#include <linux/grsecurity.h>
++
++extern kernel_cap_t gr_cap_rtnetlink(struct sock *sk);
+ 
+ int cap_netlink_send(struct sock *sk, struct sk_buff *skb)
+ {
+-	NETLINK_CB(skb).eff_cap = current->cap_effective;
++	NETLINK_CB(skb).eff_cap = gr_cap_rtnetlink(sk);
+ 	return 0;
+ }
+ 
+@@ -51,7 +54,15 @@ EXPORT_SYMBOL(cap_netlink_recv);
+ int cap_capable (struct task_struct *tsk, int cap)
+ {
+ 	/* Derived from include/linux/sched.h:capable. */
+-	if (cap_raised(tsk->cap_effective, cap))
++	if (cap_raised (tsk->cap_effective, cap))
++		return 0;
++	return -EPERM;
++}
++
++int cap_capable_nolog (struct task_struct *tsk, int cap)
++{
++	/* tsk = current for all callers */
++	if (cap_raised(tsk->cap_effective, cap) && gr_is_capable_nolog(cap))
+ 		return 0;
+ 	return -EPERM;
+ }
+@@ -356,8 +367,11 @@ void cap_bprm_apply_creds (struct linux_
+ 		}
+ 	}
+ 
+-	current->suid = current->euid = current->fsuid = bprm->e_uid;
+-	current->sgid = current->egid = current->fsgid = bprm->e_gid;
++	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
++		current->suid = current->euid = current->fsuid = bprm->e_uid;
++
++	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
++		current->sgid = current->egid = current->fsgid = bprm->e_gid;
+ 
+ 	/* For init, we want to retain the capabilities set
+ 	 * in the init_task struct. Thus we skip the usual
+@@ -370,6 +384,8 @@ void cap_bprm_apply_creds (struct linux_
+ 			cap_clear(current->cap_effective);
+ 	}
+ 
++	gr_handle_chroot_caps(current);
++
+ 	/* AUD: Audit candidate if current->cap_effective is set */
+ 
+ 	current->securebits &= ~issecure_mask(SECURE_KEEP_CAPS);
+@@ -684,7 +700,7 @@ int cap_vm_enough_memory(struct mm_struc
+ {
+ 	int cap_sys_admin = 0;
+ 
+-	if (cap_capable(current, CAP_SYS_ADMIN) == 0)
++	if (cap_capable_nolog(current, CAP_SYS_ADMIN) == 0)
+ 		cap_sys_admin = 1;
+ 	return __vm_enough_memory(mm, pages, cap_sys_admin);
+ }
+diff -urNp linux-2.6.26.6/security/dummy.c linux-2.6.26.6/security/dummy.c
+--- linux-2.6.26.6/security/dummy.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/security/dummy.c	2008-10-11 21:54:20.000000000 -0400
+@@ -29,6 +29,7 @@
+ #include <linux/file.h>
+ #include <linux/prctl.h>
+ #include <linux/securebits.h>
++#include <linux/grsecurity.h>
+ 
+ static int dummy_ptrace (struct task_struct *parent, struct task_struct *child)
+ {
+@@ -142,8 +143,11 @@ static void dummy_bprm_apply_creds (stru
+ 		}
+ 	}
+ 
+-	current->suid = current->euid = current->fsuid = bprm->e_uid;
+-	current->sgid = current->egid = current->fsgid = bprm->e_gid;
++	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
++		current->suid = current->euid = current->fsuid = bprm->e_uid;
++
++	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
++		current->sgid = current->egid = current->fsgid = bprm->e_gid;
+ 
+ 	dummy_capget(current, &current->cap_effective, &current->cap_inheritable, &current->cap_permitted);
+ }
+diff -urNp linux-2.6.26.6/security/Kconfig linux-2.6.26.6/security/Kconfig
+--- linux-2.6.26.6/security/Kconfig	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/security/Kconfig	2008-10-11 21:56:26.000000000 -0400
@@ -38004,99 +37526,4 @@
-diff --git a/security/commoncap.c b/security/commoncap.c
-index 33d34330841344f7329e1b1f313cc531c65aa7a9..5f4f145aaf1a93903749117dd076d44412ec65ca 100644
---- a/security/commoncap.c
-+++ b/security/commoncap.c
-@@ -26,10 +26,13 @@
- #include <linux/sched.h>
- #include <linux/prctl.h>
- #include <linux/securebits.h>
-+#include <linux/grsecurity.h>
-+
-+extern kernel_cap_t gr_cap_rtnetlink(struct sock *sk);
- 
- int cap_netlink_send(struct sock *sk, struct sk_buff *skb)
- {
--	NETLINK_CB(skb).eff_cap = current->cap_effective;
-+	NETLINK_CB(skb).eff_cap = gr_cap_rtnetlink(sk);
- 	return 0;
- }
- 
-@@ -51,7 +54,15 @@ EXPORT_SYMBOL(cap_netlink_recv);
- int cap_capable (struct task_struct *tsk, int cap)
- {
- 	/* Derived from include/linux/sched.h:capable. */
--	if (cap_raised(tsk->cap_effective, cap))
-+	if (cap_raised (tsk->cap_effective, cap))
-+		return 0;
-+	return -EPERM;
-+}
-+
-+int cap_capable_nolog (struct task_struct *tsk, int cap)
-+{
-+	/* tsk = current for all callers */
-+	if (cap_raised(tsk->cap_effective, cap) && gr_is_capable_nolog(cap))
- 		return 0;
- 	return -EPERM;
- }
-@@ -356,8 +367,11 @@ void cap_bprm_apply_creds (struct linux_binprm *bprm, int unsafe)
- 		}
- 	}
- 
--	current->suid = current->euid = current->fsuid = bprm->e_uid;
--	current->sgid = current->egid = current->fsgid = bprm->e_gid;
-+	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
-+		current->suid = current->euid = current->fsuid = bprm->e_uid;
-+
-+	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
-+		current->sgid = current->egid = current->fsgid = bprm->e_gid;
- 
- 	/* For init, we want to retain the capabilities set
- 	 * in the init_task struct. Thus we skip the usual
-@@ -370,6 +384,8 @@ void cap_bprm_apply_creds (struct linux_binprm *bprm, int unsafe)
- 			cap_clear(current->cap_effective);
- 	}
- 
-+	gr_handle_chroot_caps(current);
-+
- 	/* AUD: Audit candidate if current->cap_effective is set */
- 
- 	current->securebits &= ~issecure_mask(SECURE_KEEP_CAPS);
-@@ -684,7 +700,7 @@ int cap_vm_enough_memory(struct mm_struct *mm, long pages)
- {
- 	int cap_sys_admin = 0;
- 
--	if (cap_capable(current, CAP_SYS_ADMIN) == 0)
-+	if (cap_capable_nolog(current, CAP_SYS_ADMIN) == 0)
- 		cap_sys_admin = 1;
- 	return __vm_enough_memory(mm, pages, cap_sys_admin);
- }
-diff --git a/security/dummy.c b/security/dummy.c
-index b8916883b77f0c0cdc495e979edcf5775818272d..84342a8ff79e303e398e15f7c4ec9138e0d9915c 100644
---- a/security/dummy.c
-+++ b/security/dummy.c
-@@ -29,6 +29,7 @@
- #include <linux/file.h>
- #include <linux/prctl.h>
- #include <linux/securebits.h>
-+#include <linux/grsecurity.h>
- 
- static int dummy_ptrace (struct task_struct *parent, struct task_struct *child)
- {
-@@ -142,8 +143,11 @@ static void dummy_bprm_apply_creds (struct linux_binprm *bprm, int unsafe)
- 		}
- 	}
- 
--	current->suid = current->euid = current->fsuid = bprm->e_uid;
--	current->sgid = current->egid = current->fsgid = bprm->e_gid;
-+	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
-+		current->suid = current->euid = current->fsuid = bprm->e_uid;
-+
-+	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
-+		current->sgid = current->egid = current->fsgid = bprm->e_gid;
- 
- 	dummy_capget(current, &current->cap_effective, &current->cap_inheritable, &current->cap_permitted);
- }
-diff --git a/sound/core/oss/pcm_oss.c b/sound/core/oss/pcm_oss.c
-index 4c601b192ddf3feb4117186d230a73f4538f1723..f5975895e162a85e9cd65c29109dae3cf3c7b6a0 100644
---- a/sound/core/oss/pcm_oss.c
-+++ b/sound/core/oss/pcm_oss.c
-@@ -2911,8 +2911,8 @@ static void snd_pcm_oss_proc_done(struct snd_pcm *pcm)
+diff -urNp linux-2.6.26.6/sound/core/oss/pcm_oss.c linux-2.6.26.6/sound/core/oss/pcm_oss.c
+--- linux-2.6.26.6/sound/core/oss/pcm_oss.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/sound/core/oss/pcm_oss.c	2008-10-11 21:54:20.000000000 -0400
+@@ -2911,8 +2911,8 @@ static void snd_pcm_oss_proc_done(struct
@@ -38113,5 +37540,4 @@
-diff --git a/sound/core/seq/seq_lock.h b/sound/core/seq/seq_lock.h
-index 54044bc2c9ef24892a7e6747dcd67e92fb01b0f1..75df3ef63512290c8cd8028c6b0d9b6117e0e97b 100644
---- a/sound/core/seq/seq_lock.h
-+++ b/sound/core/seq/seq_lock.h
-@@ -23,10 +23,10 @@ void snd_use_lock_sync_helper(snd_use_lock_t *lock, const char *file, int line);
+diff -urNp linux-2.6.26.6/sound/core/seq/seq_lock.h linux-2.6.26.6/sound/core/seq/seq_lock.h
+--- linux-2.6.26.6/sound/core/seq/seq_lock.h	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/sound/core/seq/seq_lock.h	2008-10-11 21:54:20.000000000 -0400
+@@ -23,10 +23,10 @@ void snd_use_lock_sync_helper(snd_use_lo
@@ -38132,5 +37558,4 @@
-diff --git a/sound/pci/ac97/ac97_patch.c b/sound/pci/ac97/ac97_patch.c
-index 1292dcee072df21b34aa39daecaee841a429dfe0..4997be3c55d52354481e4f48579b04d8c0aa617a 100644
---- a/sound/pci/ac97/ac97_patch.c
-+++ b/sound/pci/ac97/ac97_patch.c
-@@ -1497,7 +1497,7 @@ static const struct snd_ac97_res_table ad1819_restbl[] = {
+diff -urNp linux-2.6.26.6/sound/pci/ac97/ac97_patch.c linux-2.6.26.6/sound/pci/ac97/ac97_patch.c
+--- linux-2.6.26.6/sound/pci/ac97/ac97_patch.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/sound/pci/ac97/ac97_patch.c	2008-10-11 21:54:20.000000000 -0400
+@@ -1497,7 +1497,7 @@ static const struct snd_ac97_res_table a
@@ -38145 +37570 @@
-@@ -3591,7 +3591,7 @@ static struct snd_ac97_res_table lm4550_restbl[] = {
+@@ -3591,7 +3591,7 @@ static struct snd_ac97_res_table lm4550_
@@ -38154,5 +37579,4 @@
-diff --git a/sound/pci/ens1370.c b/sound/pci/ens1370.c
-index fbf1124f7c79d1609f594fdb786e0ec0e0b676ac..35335238a3b12a8e25bf269dac78d3345adc270b 100644
---- a/sound/pci/ens1370.c
-+++ b/sound/pci/ens1370.c
-@@ -452,7 +452,7 @@ static struct pci_device_id snd_audiopci_ids[] = {
+diff -urNp linux-2.6.26.6/sound/pci/ens1370.c linux-2.6.26.6/sound/pci/ens1370.c
+--- linux-2.6.26.6/sound/pci/ens1370.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/sound/pci/ens1370.c	2008-10-11 21:54:20.000000000 -0400
+@@ -452,7 +452,7 @@ static struct pci_device_id snd_audiopci
@@ -38167,5 +37591,4 @@
-diff --git a/sound/pci/intel8x0.c b/sound/pci/intel8x0.c
-index 048d99e25ab0f0010ea1f4c7a7a06b553e1449d6..0b42d0f08d7b71d7b95973d45396b2e1e48d7cec 100644
---- a/sound/pci/intel8x0.c
-+++ b/sound/pci/intel8x0.c
-@@ -437,7 +437,7 @@ static struct pci_device_id snd_intel8x0_ids[] = {
+diff -urNp linux-2.6.26.6/sound/pci/intel8x0.c linux-2.6.26.6/sound/pci/intel8x0.c
+--- linux-2.6.26.6/sound/pci/intel8x0.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/sound/pci/intel8x0.c	2008-10-11 21:54:20.000000000 -0400
+@@ -437,7 +437,7 @@ static struct pci_device_id snd_intel8x0
@@ -38180 +37603 @@
-@@ -2076,7 +2076,7 @@ static struct ac97_quirk ac97_quirks[] __devinitdata = {
+@@ -2076,7 +2076,7 @@ static struct ac97_quirk ac97_quirks[] _
@@ -38189,5 +37612,4 @@
-diff --git a/sound/pci/intel8x0m.c b/sound/pci/intel8x0m.c
-index faf674e671aca3c1432cf4d04860bb69f210d5df..e84fd5d8a27f11d0417873f4c22e6bf6c831be8a 100644
---- a/sound/pci/intel8x0m.c
-+++ b/sound/pci/intel8x0m.c
-@@ -239,7 +239,7 @@ static struct pci_device_id snd_intel8x0m_ids[] = {
+diff -urNp linux-2.6.26.6/sound/pci/intel8x0m.c linux-2.6.26.6/sound/pci/intel8x0m.c
+--- linux-2.6.26.6/sound/pci/intel8x0m.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/sound/pci/intel8x0m.c	2008-10-11 21:54:20.000000000 -0400
+@@ -239,7 +239,7 @@ static struct pci_device_id snd_intel8x0
@@ -38211,4 +37633,3 @@
-diff --git a/virt/kvm/kvm_main.c b/virt/kvm/kvm_main.c
-index 02628471365b95645fc8ae9cb656b3d99f8c1648..682c21265a6af9a122695487a016edd2f43b6128 100644
---- a/virt/kvm/kvm_main.c
-+++ b/virt/kvm/kvm_main.c
+diff -urNp linux-2.6.26.6/virt/kvm/kvm_main.c linux-2.6.26.6/virt/kvm/kvm_main.c
+--- linux-2.6.26.6/virt/kvm/kvm_main.c	2008-10-08 23:24:05.000000000 -0400
++++ linux-2.6.26.6/virt/kvm/kvm_main.c	2008-10-11 21:55:52.000000000 -0400
@@ -38223 +37644 @@
-@@ -1199,7 +1198,7 @@ static long kvm_dev_ioctl(struct file *filp,
+@@ -1199,7 +1198,7 @@ static long kvm_dev_ioctl(struct file *f
