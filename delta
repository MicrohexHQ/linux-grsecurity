--- a/grsecurity-2.1.12-2.6.26.3-200808241848.patch
+++ b/grsecurity-2.1.12-2.6.26.3-200808241848.patch
@@ -1,102 +1,4 @@
-diff --git a/Documentation/dontdiff b/Documentation/dontdiff
-index 881e6dd03aea411bb9a1b0b11aa3b4fb3a90761e..5165eb5a1c433bde9f8399c76e29f3f75eb7f304 100644
---- a/Documentation/dontdiff
-+++ b/Documentation/dontdiff
-@@ -3,6 +3,7 @@
- *.bin
- *.cpio
- *.css
-+*.dbg
- *.dvi
- *.eps
- *.gif
-@@ -51,9 +52,14 @@ COPYING
- CREDITS
- CVS
- ChangeSet
-+GPATH
-+GRTAGS
-+GSYMS
-+GTAGS
- Image
- Kerntypes
- MODS.txt
-+Module.markers
- Module.symvers
- PENDING
- SCCS
-@@ -72,6 +78,7 @@ bbootsect
- bin2c
- binkernel.spec
- bootsect
-+bounds.h
- bsetup
- btfixupprep
- build
-@@ -88,6 +95,7 @@ config_data.gz*
- conmakehash
- consolemap_deftbl.c*
- crc32table.h*
-+cpustr.h
- cscope.*
- defkeymap.c*
- devlist.h*
-@@ -136,6 +144,7 @@ miboot*
- mk_elfconfig
- mkboot
- mkbugboot
-+mkcpustr
- mkdep
- mkprep
- mktables
-@@ -177,16 +186,20 @@ times.h*
- tkparse
- trix_boot.h
- utsrelease.h*
--vdso.lds
-+vdso*.lds
- version.h*
- vmlinux
- vmlinux-*
- vmlinux.aout
--vmlinux*.lds*
-+vmlinux.bin.all
-+vmlinux*.lds
-+vmlinux.relocs
- vmlinux*.scr
--vsyscall.lds
-+vsyscall*.lds
-+wakeup.lds
- wanxlfw.inc
- uImage
- unifdef
-+utsrelease.h
- zImage*
- zconf.hash.c
-diff --git a/Makefile b/Makefile
-index e537896984bb6a8cc2af3c34db24092032fed7dd..69ef42fd8ca42b06fb989776a4a130fcea479b8c 100644
---- a/Makefile
-+++ b/Makefile
-@@ -214,7 +214,7 @@ CONFIG_SHELL := $(shell if [ -x "$$BASH" ]; then echo $$BASH; \
- 
- HOSTCC       = gcc
- HOSTCXX      = g++
--HOSTCFLAGS   = -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer
-+HOSTCFLAGS   = -Wall -W -Wno-unused -Wno-sign-compare -Wstrict-prototypes -O2 -fomit-frame-pointer
- HOSTCXXFLAGS = -O2
- 
- # Decide whether to build built-in, modular, or both.
-@@ -607,7 +607,7 @@ export mod_strip_cmd
- 
- 
- ifeq ($(KBUILD_EXTMOD),)
--core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
-+core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
- 
- vmlinux-dirs	:= $(patsubst %/,%,$(filter %/, $(init-y) $(init-m) \
- 		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \
-diff --git a/arch/alpha/kernel/module.c b/arch/alpha/kernel/module.c
-index ebc3c894b5a2cc0d5a871e0e30ac99249d599bd7..20cfa6366fe0fe79b43b6b453c6bae364ece7deb 100644
---- a/arch/alpha/kernel/module.c
-+++ b/arch/alpha/kernel/module.c
-@@ -182,7 +182,7 @@ apply_relocate_add(Elf64_Shdr *sechdrs, const char *strtab,
+diff -urNp linux-2.6.26.3/arch/alpha/kernel/module.c linux-2.6.26.3/arch/alpha/kernel/module.c
+--- linux-2.6.26.3/arch/alpha/kernel/module.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/alpha/kernel/module.c	2008-08-09 12:03:28.000000000 -0400
+@@ -182,7 +182,7 @@ apply_relocate_add(Elf64_Shdr *sechdrs, 
@@ -111,5 +13,4 @@
-diff --git a/arch/alpha/kernel/osf_sys.c b/arch/alpha/kernel/osf_sys.c
-index 32ca1b9273078d7025466075e677a59e34938b33..36408c7a415b6924a307e7d01fd4e9890196e7d5 100644
---- a/arch/alpha/kernel/osf_sys.c
-+++ b/arch/alpha/kernel/osf_sys.c
-@@ -1227,6 +1227,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.3/arch/alpha/kernel/osf_sys.c linux-2.6.26.3/arch/alpha/kernel/osf_sys.c
+--- linux-2.6.26.3/arch/alpha/kernel/osf_sys.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/alpha/kernel/osf_sys.c	2008-08-09 12:03:28.000000000 -0400
+@@ -1227,6 +1227,10 @@ arch_get_unmapped_area(struct file *filp
@@ -126 +27 @@
-@@ -1234,8 +1238,8 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -1234,8 +1238,8 @@ arch_get_unmapped_area(struct file *filp
@@ -137,4 +38,3 @@
-diff --git a/arch/alpha/kernel/ptrace.c b/arch/alpha/kernel/ptrace.c
-index 1e9ad52c460ec293aa70f9cbc5bb3094adc08d74..a2323ed1317248952f8831b2b3043a3b6a79a3cc 100644
---- a/arch/alpha/kernel/ptrace.c
-+++ b/arch/alpha/kernel/ptrace.c
+diff -urNp linux-2.6.26.3/arch/alpha/kernel/ptrace.c linux-2.6.26.3/arch/alpha/kernel/ptrace.c
+--- linux-2.6.26.3/arch/alpha/kernel/ptrace.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/alpha/kernel/ptrace.c	2008-08-09 12:03:28.000000000 -0400
@@ -149 +49 @@
-@@ -266,6 +267,9 @@ long arch_ptrace(struct task_struct *child, long request, long addr, long data)
+@@ -266,6 +267,9 @@ long arch_ptrace(struct task_struct *chi
@@ -159,5 +59,4 @@
-diff --git a/arch/alpha/mm/fault.c b/arch/alpha/mm/fault.c
-index 4829f96585b15a1fd59f0409750df4ed59d99d35..d5887030bae361b5559aa22fcfd3329a875204d2 100644
---- a/arch/alpha/mm/fault.c
-+++ b/arch/alpha/mm/fault.c
-@@ -54,6 +54,124 @@ __load_new_mm_context(struct mm_struct *next_mm)
+diff -urNp linux-2.6.26.3/arch/alpha/mm/fault.c linux-2.6.26.3/arch/alpha/mm/fault.c
+--- linux-2.6.26.3/arch/alpha/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/alpha/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
+@@ -54,6 +54,124 @@ __load_new_mm_context(struct mm_struct *
@@ -288 +187 @@
-@@ -131,8 +249,29 @@ do_page_fault(unsigned long address, unsigned long mmcsr,
+@@ -131,8 +249,29 @@ do_page_fault(unsigned long address, uns
@@ -319,5 +218,4 @@
-diff --git a/arch/arm/mm/mmap.c b/arch/arm/mm/mmap.c
-index 3f6dc40b835321fd469a23ce8ffa49089377e74b..994c15d2e153eb25003a4efa40588661443b9a97 100644
---- a/arch/arm/mm/mmap.c
-+++ b/arch/arm/mm/mmap.c
-@@ -60,6 +60,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.3/arch/arm/mm/mmap.c linux-2.6.26.3/arch/arm/mm/mmap.c
+--- linux-2.6.26.3/arch/arm/mm/mmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/arm/mm/mmap.c	2008-08-09 12:03:28.000000000 -0400
+@@ -60,6 +60,10 @@ arch_get_unmapped_area(struct file *filp
@@ -334 +232 @@
-@@ -72,10 +76,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -72,10 +76,10 @@ arch_get_unmapped_area(struct file *filp
@@ -359,5 +257,4 @@
-diff --git a/arch/avr32/mm/fault.c b/arch/avr32/mm/fault.c
-index ce4e4296b95467f3e0b715a9ec953398917be8f7..ef6aa1cff4d308699b64596cefc86d0119a3eed1 100644
---- a/arch/avr32/mm/fault.c
-+++ b/arch/avr32/mm/fault.c
-@@ -41,6 +41,23 @@ static inline int notify_page_fault(struct pt_regs *regs, int trap)
+diff -urNp linux-2.6.26.3/arch/avr32/mm/fault.c linux-2.6.26.3/arch/avr32/mm/fault.c
+--- linux-2.6.26.3/arch/avr32/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/avr32/mm/fault.c	2008-08-09 12:03:28.000000000 -0400
+@@ -41,6 +41,23 @@ static inline int notify_page_fault(stru
@@ -404,5 +301,4 @@
-diff --git a/arch/ia64/ia32/binfmt_elf32.c b/arch/ia64/ia32/binfmt_elf32.c
-index 4f0c30c38e994c1ea188f811232ecc27f7b81be1..04175b44ceec080f0ad942dd270c53335426685b 100644
---- a/arch/ia64/ia32/binfmt_elf32.c
-+++ b/arch/ia64/ia32/binfmt_elf32.c
-@@ -45,6 +45,13 @@ randomize_stack_top(unsigned long stack_top);
+diff -urNp linux-2.6.26.3/arch/ia64/ia32/binfmt_elf32.c linux-2.6.26.3/arch/ia64/ia32/binfmt_elf32.c
+--- linux-2.6.26.3/arch/ia64/ia32/binfmt_elf32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ia64/ia32/binfmt_elf32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -45,6 +45,13 @@ randomize_stack_top(unsigned long stack_
@@ -422,4 +318,3 @@
-diff --git a/arch/ia64/ia32/ia32priv.h b/arch/ia64/ia32/ia32priv.h
-index c5c872b250da5e420a661fb25223115fe2c7b424..04d89df37768ea6dadd07d59fef5bf1f7528abe1 100644
---- a/arch/ia64/ia32/ia32priv.h
-+++ b/arch/ia64/ia32/ia32priv.h
+diff -urNp linux-2.6.26.3/arch/ia64/ia32/ia32priv.h linux-2.6.26.3/arch/ia64/ia32/ia32priv.h
+--- linux-2.6.26.3/arch/ia64/ia32/ia32priv.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ia64/ia32/ia32priv.h	2008-08-09 12:03:28.000000000 -0400
@@ -442,4 +337,3 @@
-diff --git a/arch/ia64/kernel/module.c b/arch/ia64/kernel/module.c
-index e83e2ea3b3e0787ea673ae7451ae2855196f1c38..30baec96ed72ee6c4225eec5e310836097e9fbbe 100644
---- a/arch/ia64/kernel/module.c
-+++ b/arch/ia64/kernel/module.c
+diff -urNp linux-2.6.26.3/arch/ia64/kernel/module.c linux-2.6.26.3/arch/ia64/kernel/module.c
+--- linux-2.6.26.3/arch/ia64/kernel/module.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ia64/kernel/module.c	2008-08-09 12:03:28.000000000 -0400
@@ -455 +349 @@
-@@ -499,15 +499,39 @@ module_frob_arch_sections (Elf_Ehdr *ehdr, Elf_Shdr *sechdrs, char *secstrings,
+@@ -499,15 +499,39 @@ module_frob_arch_sections (Elf_Ehdr *ehd
@@ -497 +391 @@
-@@ -691,7 +715,14 @@ do_reloc (struct module *mod, uint8_t r_type, Elf64_Sym *sym, uint64_t addend,
+@@ -691,7 +715,14 @@ do_reloc (struct module *mod, uint8_t r_
@@ -513 +407 @@
-@@ -825,15 +856,15 @@ apply_relocate_add (Elf64_Shdr *sechdrs, const char *strtab, unsigned int symind
+@@ -825,15 +856,15 @@ apply_relocate_add (Elf64_Shdr *sechdrs,
@@ -533,5 +427,4 @@
-diff --git a/arch/ia64/kernel/sys_ia64.c b/arch/ia64/kernel/sys_ia64.c
-index 1eda194b95595110497adb009e457f8fe5c9d116..234545fae698b039477a6cba397c7f80101afada 100644
---- a/arch/ia64/kernel/sys_ia64.c
-+++ b/arch/ia64/kernel/sys_ia64.c
-@@ -43,6 +43,13 @@ arch_get_unmapped_area (struct file *filp, unsigned long addr, unsigned long len
+diff -urNp linux-2.6.26.3/arch/ia64/kernel/sys_ia64.c linux-2.6.26.3/arch/ia64/kernel/sys_ia64.c
+--- linux-2.6.26.3/arch/ia64/kernel/sys_ia64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ia64/kernel/sys_ia64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -43,6 +43,13 @@ arch_get_unmapped_area (struct file *fil
@@ -551 +444 @@
-@@ -61,9 +68,9 @@ arch_get_unmapped_area (struct file *filp, unsigned long addr, unsigned long len
+@@ -61,9 +68,9 @@ arch_get_unmapped_area (struct file *fil
@@ -563,5 +456,4 @@
-diff --git a/arch/ia64/mm/fault.c b/arch/ia64/mm/fault.c
-index 23088bed111ec229c4df3b1315da0e0fce7411a3..63326c8e5d45a09d58a30ebc594e98b2cfb1111d 100644
---- a/arch/ia64/mm/fault.c
-+++ b/arch/ia64/mm/fault.c
-@@ -72,6 +72,23 @@ mapped_kernel_page_is_present (unsigned long address)
+diff -urNp linux-2.6.26.3/arch/ia64/mm/fault.c linux-2.6.26.3/arch/ia64/mm/fault.c
+--- linux-2.6.26.3/arch/ia64/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ia64/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
+@@ -72,6 +72,23 @@ mapped_kernel_page_is_present (unsigned 
@@ -591 +483 @@
-@@ -145,9 +162,23 @@ ia64_do_page_fault (unsigned long address, unsigned long isr, struct pt_regs *re
+@@ -145,9 +162,23 @@ ia64_do_page_fault (unsigned long addres
@@ -616,4 +508,3 @@
-diff --git a/arch/ia64/mm/init.c b/arch/ia64/mm/init.c
-index 200100ea7610883ae8fc90768a64ba185aa68d3c..c046c61b22106b3174e71d34ffb74c8e89b66aac 100644
---- a/arch/ia64/mm/init.c
-+++ b/arch/ia64/mm/init.c
+diff -urNp linux-2.6.26.3/arch/ia64/mm/init.c linux-2.6.26.3/arch/ia64/mm/init.c
+--- linux-2.6.26.3/arch/ia64/mm/init.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ia64/mm/init.c	2008-08-09 12:03:28.000000000 -0400
@@ -640,5 +531,4 @@
-diff --git a/arch/mips/kernel/binfmt_elfn32.c b/arch/mips/kernel/binfmt_elfn32.c
-index 9fdd8bcdd21ef1785c90cc40b0579b6acb4dc1a0..ddb854ac30b55aad356d8fd2940ef83eb0d42623 100644
---- a/arch/mips/kernel/binfmt_elfn32.c
-+++ b/arch/mips/kernel/binfmt_elfn32.c
-@@ -50,6 +50,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_NFPREG];
+diff -urNp linux-2.6.26.3/arch/mips/kernel/binfmt_elfn32.c linux-2.6.26.3/arch/mips/kernel/binfmt_elfn32.c
+--- linux-2.6.26.3/arch/mips/kernel/binfmt_elfn32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/mips/kernel/binfmt_elfn32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -50,6 +50,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_N
@@ -658,5 +548,4 @@
-diff --git a/arch/mips/kernel/binfmt_elfo32.c b/arch/mips/kernel/binfmt_elfo32.c
-index e1333d7319e275a065546490baa8401b87c9bf47..563c82cd5e79e69ca3b7d5eaace767c01f74ed79 100644
---- a/arch/mips/kernel/binfmt_elfo32.c
-+++ b/arch/mips/kernel/binfmt_elfo32.c
-@@ -52,6 +52,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_NFPREG];
+diff -urNp linux-2.6.26.3/arch/mips/kernel/binfmt_elfo32.c linux-2.6.26.3/arch/mips/kernel/binfmt_elfo32.c
+--- linux-2.6.26.3/arch/mips/kernel/binfmt_elfo32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/mips/kernel/binfmt_elfo32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -52,6 +52,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_N
@@ -676,5 +565,4 @@
-diff --git a/arch/mips/kernel/syscall.c b/arch/mips/kernel/syscall.c
-index af1bdc897488acf4d71f65bc69579f58b03183ce..fd128c068c183ee5dc0e4e8cc92bac96fa3b5abf 100644
---- a/arch/mips/kernel/syscall.c
-+++ b/arch/mips/kernel/syscall.c
-@@ -93,6 +93,11 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.3/arch/mips/kernel/syscall.c linux-2.6.26.3/arch/mips/kernel/syscall.c
+--- linux-2.6.26.3/arch/mips/kernel/syscall.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/mips/kernel/syscall.c	2008-08-09 12:03:28.000000000 -0400
+@@ -93,6 +93,11 @@ unsigned long arch_get_unmapped_area(str
@@ -692 +580 @@
-@@ -103,7 +108,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -103,7 +108,7 @@ unsigned long arch_get_unmapped_area(str
@@ -701,4 +589,3 @@
-diff --git a/arch/mips/mm/fault.c b/arch/mips/mm/fault.c
-index fa636fc6b7b90403a2a8771ef3c5f023a1a82cd4..d0f020b4e4c3c3fcfefdb7cb61ac95d3b1566471 100644
---- a/arch/mips/mm/fault.c
-+++ b/arch/mips/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/mips/mm/fault.c linux-2.6.26.3/arch/mips/mm/fault.c
+--- linux-2.6.26.3/arch/mips/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/mips/mm/fault.c	2008-08-09 12:03:28.000000000 -0400
@@ -729,4 +616,3 @@
-diff --git a/arch/parisc/kernel/module.c b/arch/parisc/kernel/module.c
-index fdacdd4341c9f3ccf3189afe683b7179ead823d4..35faae68a32fb421743a6fda2041dba957761bf5 100644
---- a/arch/parisc/kernel/module.c
-+++ b/arch/parisc/kernel/module.c
+diff -urNp linux-2.6.26.3/arch/parisc/kernel/module.c linux-2.6.26.3/arch/parisc/kernel/module.c
+--- linux-2.6.26.3/arch/parisc/kernel/module.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/parisc/kernel/module.c	2008-08-09 12:03:28.000000000 -0400
@@ -776 +662 @@
-@@ -296,21 +318,21 @@ int module_frob_arch_sections(CONST Elf_Ehdr *hdr,
+@@ -296,21 +318,21 @@ int module_frob_arch_sections(CONST Elf_
@@ -783,4 +669 @@
-+	me->core_size_rw = ALIGN(me->core_size_rw, 16);
-+	me->arch.got_offset = me->core_size_rw;
-+	me->core_size_rw += gots * sizeof(struct got_entry);
- 
+-
@@ -790,4 +673 @@
-+	me->core_size_rw = ALIGN(me->core_size_rw, 16);
-+	me->arch.fdesc_offset = me->core_size_rw;
-+	me->core_size_rw += fdescs * sizeof(Elf_Fdesc);
- 
+-
@@ -797,4 +677 @@
-+	me->core_size_rx = ALIGN(me->core_size_rx, 16);
-+	me->arch.stub_offset = me->core_size_rx;
-+	me->core_size_rx += stubs * sizeof(struct stub_entry);
- 
+-
@@ -803,0 +681,12 @@
++	me->core_size_rw = ALIGN(me->core_size_rw, 16);
++	me->arch.got_offset = me->core_size_rw;
++	me->core_size_rw += gots * sizeof(struct got_entry);
++
++	me->core_size_rw = ALIGN(me->core_size_rw, 16);
++	me->arch.fdesc_offset = me->core_size_rw;
++	me->core_size_rw += fdescs * sizeof(Elf_Fdesc);
++
++	me->core_size_rx = ALIGN(me->core_size_rx, 16);
++	me->arch.stub_offset = me->core_size_rx;
++	me->core_size_rx += stubs * sizeof(struct stub_entry);
++
@@ -810 +699 @@
-@@ -330,7 +352,7 @@ static Elf64_Word get_got(struct module *me, unsigned long value, long addend)
+@@ -330,7 +352,7 @@ static Elf64_Word get_got(struct module 
@@ -819 +708 @@
-@@ -348,7 +370,7 @@ static Elf64_Word get_got(struct module *me, unsigned long value, long addend)
+@@ -348,7 +370,7 @@ static Elf64_Word get_got(struct module 
@@ -828 +717 @@
-@@ -366,7 +388,7 @@ static Elf_Addr get_fdesc(struct module *me, unsigned long value)
+@@ -366,7 +388,7 @@ static Elf_Addr get_fdesc(struct module 
@@ -837 +726 @@
-@@ -386,12 +408,12 @@ static Elf_Addr get_stub(struct module *me, unsigned long value, long addend,
+@@ -386,12 +408,12 @@ static Elf_Addr get_stub(struct module *
@@ -861,5 +750,4 @@
-diff --git a/arch/parisc/kernel/sys_parisc.c b/arch/parisc/kernel/sys_parisc.c
-index 71b31957c8f13805c5a8da1c93c6061bf562f2a7..e15efcf0431812a6b10ca6bb47227f3d4e0e5661 100644
---- a/arch/parisc/kernel/sys_parisc.c
-+++ b/arch/parisc/kernel/sys_parisc.c
-@@ -98,7 +98,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
+diff -urNp linux-2.6.26.3/arch/parisc/kernel/sys_parisc.c linux-2.6.26.3/arch/parisc/kernel/sys_parisc.c
+--- linux-2.6.26.3/arch/parisc/kernel/sys_parisc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/parisc/kernel/sys_parisc.c	2008-08-09 12:03:28.000000000 -0400
+@@ -98,7 +98,7 @@ unsigned long arch_get_unmapped_area(str
@@ -874,5 +762,4 @@
-diff --git a/arch/parisc/kernel/traps.c b/arch/parisc/kernel/traps.c
-index 675f1d098f05d2f6ec29ab8c5be3d55005627a03..2d603e5c4596480042d2b5d12ece1038b9a6a851 100644
---- a/arch/parisc/kernel/traps.c
-+++ b/arch/parisc/kernel/traps.c
-@@ -732,9 +732,7 @@ void handle_interruption(int code, struct pt_regs *regs)
+diff -urNp linux-2.6.26.3/arch/parisc/kernel/traps.c linux-2.6.26.3/arch/parisc/kernel/traps.c
+--- linux-2.6.26.3/arch/parisc/kernel/traps.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/parisc/kernel/traps.c	2008-08-09 12:03:28.000000000 -0400
+@@ -732,9 +732,7 @@ void handle_interruption(int code, struc
@@ -889,4 +776,3 @@
-diff --git a/arch/parisc/mm/fault.c b/arch/parisc/mm/fault.c
-index b2e3e9a8cecefce049d43ef1a5d36d61403cc9b9..3352cc553863cb5b8dd976ae3a98613b03f37608 100644
---- a/arch/parisc/mm/fault.c
-+++ b/arch/parisc/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/parisc/mm/fault.c linux-2.6.26.3/arch/parisc/mm/fault.c
+--- linux-2.6.26.3/arch/parisc/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/parisc/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
@@ -901 +787 @@
-@@ -53,7 +54,7 @@ DEFINE_PER_CPU(struct exception_data, exception_data);
+@@ -53,7 +54,7 @@ DEFINE_PER_CPU(struct exception_data, ex
@@ -910 +796 @@
-@@ -139,6 +140,116 @@ parisc_acctyp(unsigned long code, unsigned int inst)
+@@ -139,6 +140,116 @@ parisc_acctyp(unsigned long code, unsign
@@ -1062,5 +948,4 @@
-diff --git a/arch/powerpc/kernel/module_32.c b/arch/powerpc/kernel/module_32.c
-index eab313858315ef991b5efc0d6886433105e1ac89..a0d0e7ec6beea5df9b164fcf2d321462670b0733 100644
---- a/arch/powerpc/kernel/module_32.c
-+++ b/arch/powerpc/kernel/module_32.c
-@@ -175,7 +175,7 @@ int module_frob_arch_sections(Elf32_Ehdr *hdr,
+diff -urNp linux-2.6.26.3/arch/powerpc/kernel/module_32.c linux-2.6.26.3/arch/powerpc/kernel/module_32.c
+--- linux-2.6.26.3/arch/powerpc/kernel/module_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/powerpc/kernel/module_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -175,7 +175,7 @@ int module_frob_arch_sections(Elf32_Ehdr
@@ -1075 +960 @@
-@@ -216,11 +216,16 @@ static uint32_t do_plt_call(void *location,
+@@ -216,11 +216,16 @@ static uint32_t do_plt_call(void *locati
@@ -1095,5 +980,4 @@
-diff --git a/arch/powerpc/kernel/signal_32.c b/arch/powerpc/kernel/signal_32.c
-index ad6943468ee9f25aee853a3ded8f99271f1c3d72..1e44d2e644c80e1ba0e1005d43f8dd3f10b1996d 100644
---- a/arch/powerpc/kernel/signal_32.c
-+++ b/arch/powerpc/kernel/signal_32.c
-@@ -743,7 +743,7 @@ int handle_rt_signal32(unsigned long sig, struct k_sigaction *ka,
+diff -urNp linux-2.6.26.3/arch/powerpc/kernel/signal_32.c linux-2.6.26.3/arch/powerpc/kernel/signal_32.c
+--- linux-2.6.26.3/arch/powerpc/kernel/signal_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/powerpc/kernel/signal_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -743,7 +743,7 @@ int handle_rt_signal32(unsigned long sig
@@ -1108,5 +992,4 @@
-diff --git a/arch/powerpc/kernel/signal_64.c b/arch/powerpc/kernel/signal_64.c
-index da7c058e3731ffc712367f7f2f4e01e572d0055d..a79f4f061f0baa6bdfc8a72eed465cc8ac01b8a5 100644
---- a/arch/powerpc/kernel/signal_64.c
-+++ b/arch/powerpc/kernel/signal_64.c
-@@ -371,7 +371,7 @@ int handle_rt_signal64(int signr, struct k_sigaction *ka, siginfo_t *info,
+diff -urNp linux-2.6.26.3/arch/powerpc/kernel/signal_64.c linux-2.6.26.3/arch/powerpc/kernel/signal_64.c
+--- linux-2.6.26.3/arch/powerpc/kernel/signal_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/powerpc/kernel/signal_64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -371,7 +371,7 @@ int handle_rt_signal64(int signr, struct
@@ -1121,5 +1004,4 @@
-diff --git a/arch/powerpc/kernel/vdso.c b/arch/powerpc/kernel/vdso.c
-index ce245a850db2b8d90d0d35dcd98a2e1fa39d97b7..6ace7ccb94963a387625e2a319b4f0c13b2e4231 100644
---- a/arch/powerpc/kernel/vdso.c
-+++ b/arch/powerpc/kernel/vdso.c
-@@ -212,7 +212,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm,
+diff -urNp linux-2.6.26.3/arch/powerpc/kernel/vdso.c linux-2.6.26.3/arch/powerpc/kernel/vdso.c
+--- linux-2.6.26.3/arch/powerpc/kernel/vdso.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/powerpc/kernel/vdso.c	2008-08-09 12:03:28.000000000 -0400
+@@ -212,7 +212,7 @@ int arch_setup_additional_pages(struct l
@@ -1134 +1016 @@
-@@ -229,7 +229,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm,
+@@ -229,7 +229,7 @@ int arch_setup_additional_pages(struct l
@@ -1143,4 +1025,3 @@
-diff --git a/arch/powerpc/mm/fault.c b/arch/powerpc/mm/fault.c
-index 7b2510799266654e4fb8ec1283adfbbbfb159158..fcf840ea958afc5a5c7b9ed2da5e2776755c40de 100644
---- a/arch/powerpc/mm/fault.c
-+++ b/arch/powerpc/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/powerpc/mm/fault.c linux-2.6.26.3/arch/powerpc/mm/fault.c
+--- linux-2.6.26.3/arch/powerpc/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/powerpc/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
@@ -1158 +1039 @@
-@@ -62,6 +66,363 @@ static inline int notify_page_fault(struct pt_regs *regs)
+@@ -62,6 +66,363 @@ static inline int notify_page_fault(stru
@@ -1522 +1403 @@
-@@ -157,7 +518,7 @@ int __kprobes do_page_fault(struct pt_regs *regs, unsigned long address,
+@@ -157,7 +518,7 @@ int __kprobes do_page_fault(struct pt_re
@@ -1569,5 +1450,4 @@
-diff --git a/arch/powerpc/mm/mmap.c b/arch/powerpc/mm/mmap.c
-index 86010fc7d3b17accc427c12f00606a0d1f4bbc70..782ac3f8efb476573c115f1aeea8c8848c098cde 100644
---- a/arch/powerpc/mm/mmap.c
-+++ b/arch/powerpc/mm/mmap.c
-@@ -75,10 +75,22 @@ void arch_pick_mmap_layout(struct mm_struct *mm)
+diff -urNp linux-2.6.26.3/arch/powerpc/mm/mmap.c linux-2.6.26.3/arch/powerpc/mm/mmap.c
+--- linux-2.6.26.3/arch/powerpc/mm/mmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/powerpc/mm/mmap.c	2008-08-09 12:03:28.000000000 -0400
+@@ -75,10 +75,22 @@ void arch_pick_mmap_layout(struct mm_str
@@ -1596,4 +1476,3 @@
-diff --git a/arch/ppc/mm/fault.c b/arch/ppc/mm/fault.c
-index 36c0e7529edbc89f1e7c7dc8d3c000024a2f433d..7d604edf73b65fe7b970891c680085f76bda509d 100644
---- a/arch/ppc/mm/fault.c
-+++ b/arch/ppc/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/ppc/mm/fault.c linux-2.6.26.3/arch/ppc/mm/fault.c
+--- linux-2.6.26.3/arch/ppc/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/ppc/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
@@ -1611 +1490 @@
-@@ -48,6 +52,363 @@ unsigned long pte_misses;	/* updated by do_page_fault() */
+@@ -48,6 +52,363 @@ unsigned long pte_misses;	/* updated by 
@@ -1975 +1854 @@
-@@ -109,7 +470,7 @@ int do_page_fault(struct pt_regs *regs, unsigned long address,
+@@ -109,7 +470,7 @@ int do_page_fault(struct pt_regs *regs, 
@@ -2044,5 +1923,4 @@
-diff --git a/arch/s390/kernel/module.c b/arch/s390/kernel/module.c
-index 59b4e796680af3e3f376285b7fbaa5500092d602..958196a03ac624a203f6b8c24e55cf23b8b8b3fb 100644
---- a/arch/s390/kernel/module.c
-+++ b/arch/s390/kernel/module.c
-@@ -166,11 +166,11 @@ module_frob_arch_sections(Elf_Ehdr *hdr, Elf_Shdr *sechdrs,
+diff -urNp linux-2.6.26.3/arch/s390/kernel/module.c linux-2.6.26.3/arch/s390/kernel/module.c
+--- linux-2.6.26.3/arch/s390/kernel/module.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/s390/kernel/module.c	2008-08-09 12:03:28.000000000 -0400
+@@ -166,11 +166,11 @@ module_frob_arch_sections(Elf_Ehdr *hdr,
@@ -2065 +1943 @@
-@@ -256,7 +256,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -256,7 +256,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2074 +1952 @@
-@@ -280,7 +280,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -280,7 +280,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2083 +1961 @@
-@@ -294,7 +294,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -294,7 +294,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2092 +1970 @@
-@@ -316,7 +316,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -316,7 +316,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2101 +1979 @@
-@@ -336,7 +336,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -336,7 +336,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2110 +1988 @@
-@@ -346,7 +346,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base, Elf_Sym *symtab,
+@@ -346,7 +346,7 @@ apply_rela(Elf_Rela *rela, Elf_Addr base
@@ -2119,18 +1997,4 @@
-diff --git a/arch/sparc/Makefile b/arch/sparc/Makefile
-index fef28e267a52fc1e2943d85c7bf3daea8603170e..002f9f05260e5a24f910d27d506d4ec46ebd48c3 100644
---- a/arch/sparc/Makefile
-+++ b/arch/sparc/Makefile
-@@ -36,7 +36,7 @@ drivers-$(CONFIG_OPROFILE)	+= arch/sparc/oprofile/
- # Renaming is done to avoid confusing pattern matching rules in 2.5.45 (multy-)
- INIT_Y		:= $(patsubst %/, %/built-in.o, $(init-y))
- CORE_Y		:= $(core-y)
--CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
-+CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
- CORE_Y		:= $(patsubst %/, %/built-in.o, $(CORE_Y))
- DRIVERS_Y	:= $(patsubst %/, %/built-in.o, $(drivers-y))
- NET_Y		:= $(patsubst %/, %/built-in.o, $(net-y))
-diff --git a/arch/sparc/kernel/sys_sparc.c b/arch/sparc/kernel/sys_sparc.c
-index 3c6b49a53ae82f8e7a77dc67b4445eb753591f6f..fe00ee38a21753dfa566a7afa8f8269461902b81 100644
---- a/arch/sparc/kernel/sys_sparc.c
-+++ b/arch/sparc/kernel/sys_sparc.c
-@@ -56,7 +56,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+diff -urNp linux-2.6.26.3/arch/sparc/kernel/sys_sparc.c linux-2.6.26.3/arch/sparc/kernel/sys_sparc.c
+--- linux-2.6.26.3/arch/sparc/kernel/sys_sparc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc/kernel/sys_sparc.c	2008-08-09 12:03:28.000000000 -0400
+@@ -56,7 +56,7 @@ unsigned long arch_get_unmapped_area(str
@@ -2145,4 +2009,15 @@
-diff --git a/arch/sparc/mm/fault.c b/arch/sparc/mm/fault.c
-index 0a3cd8f6cfe4690d43817152ce8e4f67b1ea2e82..149c18e5e444fc558a9cc34a1f8d82ee892430de 100644
---- a/arch/sparc/mm/fault.c
-+++ b/arch/sparc/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/sparc/Makefile linux-2.6.26.3/arch/sparc/Makefile
+--- linux-2.6.26.3/arch/sparc/Makefile	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc/Makefile	2008-08-09 12:03:28.000000000 -0400
+@@ -36,7 +36,7 @@ drivers-$(CONFIG_OPROFILE)	+= arch/sparc
+ # Renaming is done to avoid confusing pattern matching rules in 2.5.45 (multy-)
+ INIT_Y		:= $(patsubst %/, %/built-in.o, $(init-y))
+ CORE_Y		:= $(core-y)
+-CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
++CORE_Y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
+ CORE_Y		:= $(patsubst %/, %/built-in.o, $(CORE_Y))
+ DRIVERS_Y	:= $(patsubst %/, %/built-in.o, $(drivers-y))
+ NET_Y		:= $(patsubst %/, %/built-in.o, $(net-y))
+diff -urNp linux-2.6.26.3/arch/sparc/mm/fault.c linux-2.6.26.3/arch/sparc/mm/fault.c
+--- linux-2.6.26.3/arch/sparc/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
@@ -2159 +2034 @@
-@@ -167,6 +170,249 @@ static unsigned long compute_si_addr(struct pt_regs *regs, int text_fault)
+@@ -167,6 +170,249 @@ static unsigned long compute_si_addr(str
@@ -2434,4 +2309,3 @@
-diff --git a/arch/sparc/mm/init.c b/arch/sparc/mm/init.c
-index 7794ecb896e32284c8c1d3225faa285e87d088fd..66c33a3a7354e1e5d5af9139185e20ca6f2cbb5d 100644
---- a/arch/sparc/mm/init.c
-+++ b/arch/sparc/mm/init.c
+diff -urNp linux-2.6.26.3/arch/sparc/mm/init.c linux-2.6.26.3/arch/sparc/mm/init.c
+--- linux-2.6.26.3/arch/sparc/mm/init.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc/mm/init.c	2008-08-09 12:03:28.000000000 -0400
@@ -2472,4 +2346,3 @@
-diff --git a/arch/sparc/mm/srmmu.c b/arch/sparc/mm/srmmu.c
-index 23d3291a3e81e65736c862e03e3b24e3047ffa22..4186ca900e43ea193b04cea65ff5bf294464d3e1 100644
---- a/arch/sparc/mm/srmmu.c
-+++ b/arch/sparc/mm/srmmu.c
+diff -urNp linux-2.6.26.3/arch/sparc/mm/srmmu.c linux-2.6.26.3/arch/sparc/mm/srmmu.c
+--- linux-2.6.26.3/arch/sparc/mm/srmmu.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc/mm/srmmu.c	2008-08-09 12:03:28.000000000 -0400
@@ -2490,4 +2363,3 @@
-diff --git a/arch/sparc64/kernel/Makefile b/arch/sparc64/kernel/Makefile
-index ec4f5ebb1ca669e72048317fe623c12d30b281d2..fe83258e434a37acfcfc72702430e7ff7caec601 100644
---- a/arch/sparc64/kernel/Makefile
-+++ b/arch/sparc64/kernel/Makefile
+diff -urNp linux-2.6.26.3/arch/sparc64/kernel/Makefile linux-2.6.26.3/arch/sparc64/kernel/Makefile
+--- linux-2.6.26.3/arch/sparc64/kernel/Makefile	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc64/kernel/Makefile	2008-08-09 12:03:28.000000000 -0400
@@ -2503,5 +2375,4 @@
-diff --git a/arch/sparc64/kernel/sys_sparc.c b/arch/sparc64/kernel/sys_sparc.c
-index ac1bff58c1ac8319eb0178e0980eeda35dfb1a32..9ba14a4f1500d2896052f45cc864cbb3dfec2530 100644
---- a/arch/sparc64/kernel/sys_sparc.c
-+++ b/arch/sparc64/kernel/sys_sparc.c
-@@ -124,7 +124,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+diff -urNp linux-2.6.26.3/arch/sparc64/kernel/sys_sparc.c linux-2.6.26.3/arch/sparc64/kernel/sys_sparc.c
+--- linux-2.6.26.3/arch/sparc64/kernel/sys_sparc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc64/kernel/sys_sparc.c	2008-08-09 12:03:28.000000000 -0400
+@@ -124,7 +124,7 @@ unsigned long arch_get_unmapped_area(str
@@ -2516 +2387 @@
-@@ -139,6 +139,10 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+@@ -139,6 +139,10 @@ unsigned long arch_get_unmapped_area(str
@@ -2527 +2398 @@
-@@ -152,9 +156,9 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr, unsi
+@@ -152,9 +156,9 @@ unsigned long arch_get_unmapped_area(str
@@ -2550 +2421 @@
-@@ -215,7 +219,7 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -215,7 +219,7 @@ arch_get_unmapped_area_topdown(struct fi
@@ -2559 +2430 @@
-@@ -378,6 +382,12 @@ void arch_pick_mmap_layout(struct mm_struct *mm)
+@@ -378,6 +382,12 @@ void arch_pick_mmap_layout(struct mm_str
@@ -2572 +2443 @@
-@@ -392,6 +402,12 @@ void arch_pick_mmap_layout(struct mm_struct *mm)
+@@ -392,6 +402,12 @@ void arch_pick_mmap_layout(struct mm_str
@@ -2585,17 +2456,3 @@
-diff --git a/arch/sparc64/mm/Makefile b/arch/sparc64/mm/Makefile
-index 68d04c0370f420cb152ace47834f7c7cd61d98d4..386018430b53a72f04967032d300382cd5f34784 100644
---- a/arch/sparc64/mm/Makefile
-+++ b/arch/sparc64/mm/Makefile
-@@ -2,7 +2,7 @@
- #
- 
- EXTRA_AFLAGS := -ansi
--EXTRA_CFLAGS := -Werror
-+#EXTRA_CFLAGS := -Werror
- 
- obj-y    := ultra.o tlb.o tsb.o fault.o init.o generic.o
- 
-diff --git a/arch/sparc64/mm/fault.c b/arch/sparc64/mm/fault.c
-index 236f4d228d2bc962908af77a37b012ce9d1e8bc5..abe22a4bfafb268ac18a4648c4a2a5be25e884bf 100644
---- a/arch/sparc64/mm/fault.c
-+++ b/arch/sparc64/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/sparc64/mm/fault.c linux-2.6.26.3/arch/sparc64/mm/fault.c
+--- linux-2.6.26.3/arch/sparc64/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc64/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
@@ -2980 +2837 @@
-@@ -303,8 +667,10 @@ asmlinkage void __kprobes do_sparc64_fault(struct pt_regs *regs)
+@@ -303,8 +667,10 @@ asmlinkage void __kprobes do_sparc64_fau
@@ -2992 +2849 @@
-@@ -321,6 +687,29 @@ asmlinkage void __kprobes do_sparc64_fault(struct pt_regs *regs)
+@@ -321,6 +687,29 @@ asmlinkage void __kprobes do_sparc64_fau
@@ -3022,5 +2879,16 @@
-diff --git a/arch/v850/kernel/module.c b/arch/v850/kernel/module.c
-index 64aeb3e37c52716c1687eecbd46a509c2db27309..50cf7f13a56023b8bd364f20fdd729fe6f1d90fa 100644
---- a/arch/v850/kernel/module.c
-+++ b/arch/v850/kernel/module.c
-@@ -150,8 +150,8 @@ static uint32_t do_plt_call (void *location, Elf32_Addr val,
+diff -urNp linux-2.6.26.3/arch/sparc64/mm/Makefile linux-2.6.26.3/arch/sparc64/mm/Makefile
+--- linux-2.6.26.3/arch/sparc64/mm/Makefile	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/sparc64/mm/Makefile	2008-08-09 12:03:28.000000000 -0400
+@@ -2,7 +2,7 @@
+ #
+ 
+ EXTRA_AFLAGS := -ansi
+-EXTRA_CFLAGS := -Werror
++#EXTRA_CFLAGS := -Werror
+ 
+ obj-y    := ultra.o tlb.o tsb.o fault.o init.o generic.o
+ 
+diff -urNp linux-2.6.26.3/arch/v850/kernel/module.c linux-2.6.26.3/arch/v850/kernel/module.c
+--- linux-2.6.26.3/arch/v850/kernel/module.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/v850/kernel/module.c	2008-08-09 12:03:28.000000000 -0400
+@@ -150,8 +150,8 @@ static uint32_t do_plt_call (void *locat
@@ -3037,93 +2905,4 @@
-diff --git a/arch/x86/Kconfig b/arch/x86/Kconfig
-index bf07b6f50fa178268f9d81388a615a7a8abff32b..de786f7fd230077a2aeec365492cbef0806845ef 100644
---- a/arch/x86/Kconfig
-+++ b/arch/x86/Kconfig
-@@ -887,7 +887,7 @@ config PAGE_OFFSET
- 	hex
- 	default 0xB0000000 if VMSPLIT_3G_OPT
- 	default 0x80000000 if VMSPLIT_2G
--	default 0x78000000 if VMSPLIT_2G_OPT
-+	default 0x70000000 if VMSPLIT_2G_OPT
- 	default 0x40000000 if VMSPLIT_1G
- 	default 0xC0000000
- 	depends on X86_32
-@@ -1206,8 +1206,7 @@ config CRASH_DUMP
- config PHYSICAL_START
- 	hex "Physical address where the kernel is loaded" if (EMBEDDED || CRASH_DUMP)
- 	default "0x1000000" if X86_NUMAQ
--	default "0x200000" if X86_64
--	default "0x100000"
-+	default "0x200000"
- 	help
- 	  This gives the physical address where the kernel is loaded.
- 
-@@ -1299,9 +1298,9 @@ config HOTPLUG_CPU
- 	  suspend.
- 
- config COMPAT_VDSO
--	def_bool y
-+	def_bool n
- 	prompt "Compat VDSO support"
--	depends on X86_32 || IA32_EMULATION
-+	depends on (X86_32 || IA32_EMULATION) && !PAX_NOEXEC
- 	help
- 	  Map the 32-bit VDSO to the predictable old-style address too.
- 	---help---
-@@ -1488,7 +1487,7 @@ config PCI
- choice
- 	prompt "PCI access mode"
- 	depends on X86_32 && PCI && !X86_VISWS
--	default PCI_GOANY
-+	default PCI_GODIRECT
- 	---help---
- 	  On PCI systems, the BIOS can be used to detect the PCI devices and
- 	  determine their configuration. However, some old PCI motherboards
-diff --git a/arch/x86/Kconfig.cpu b/arch/x86/Kconfig.cpu
-index dd138a29d8db3658302ceefd838e19889b5b5d18..5502942d576709c68020aa0b21b04087cabf8f79 100644
---- a/arch/x86/Kconfig.cpu
-+++ b/arch/x86/Kconfig.cpu
-@@ -340,7 +340,7 @@ config X86_PPRO_FENCE
- 
- config X86_F00F_BUG
- 	def_bool y
--	depends on M586MMX || M586TSC || M586 || M486 || M386
-+	depends on (M586MMX || M586TSC || M586 || M486 || M386) && !PAX_KERNEXEC
- 
- config X86_WP_WORKS_OK
- 	def_bool y
-@@ -360,7 +360,7 @@ config X86_POPAD_OK
- 
- config X86_ALIGNMENT_16
- 	def_bool y
--	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK6 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
-+	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK8 || MK7 || MK6 || MCORE2 || MPENTIUM4 || MPENTIUMIII || MPENTIUMII || M686 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
- 
- config X86_GOOD_APIC
- 	def_bool y
-@@ -403,7 +403,7 @@ config X86_TSC
- # generates cmov.
- config X86_CMOV
- 	def_bool y
--	depends on (MK7 || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
-+	depends on (MK8 || MK7 || MCORE2 || MPSC || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
- 
- config X86_MINIMUM_CPU_FAMILY
- 	int
-diff --git a/arch/x86/Kconfig.debug b/arch/x86/Kconfig.debug
-index 18363374d51a9a57b39b6fb8d3f87a054b4b4aa5..4b3854ba52c4e65949a33fd2d5548e8567f4ce92 100644
---- a/arch/x86/Kconfig.debug
-+++ b/arch/x86/Kconfig.debug
-@@ -84,7 +84,7 @@ config X86_PTDUMP
- config DEBUG_RODATA
- 	bool "Write protect kernel read-only data structures"
- 	default y
--	depends on DEBUG_KERNEL
-+	depends on DEBUG_KERNEL && BROKEN
- 	help
- 	  Mark the kernel read-only data as write-protected in the pagetables,
- 	  in order to catch accidental (and incorrect) writes to such const
-diff --git a/arch/x86/boot/bitops.h b/arch/x86/boot/bitops.h
-index 878e4b9940d9212ce581c5bea0ac518ae6bbf85f..20537abb34141442d8e3cdf755c0bbcb716adc35 100644
---- a/arch/x86/boot/bitops.h
-+++ b/arch/x86/boot/bitops.h
-@@ -26,7 +26,7 @@ static inline int variable_test_bit(int nr, const void *addr)
+diff -urNp linux-2.6.26.3/arch/x86/boot/bitops.h linux-2.6.26.3/arch/x86/boot/bitops.h
+--- linux-2.6.26.3/arch/x86/boot/bitops.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/bitops.h	2008-08-09 12:03:28.000000000 -0400
+@@ -26,7 +26,7 @@ static inline int variable_test_bit(int 
@@ -3138 +2917 @@
-@@ -37,7 +37,7 @@ static inline int variable_test_bit(int nr, const void *addr)
+@@ -37,7 +37,7 @@ static inline int variable_test_bit(int 
@@ -3147,4 +2926,3 @@
-diff --git a/arch/x86/boot/boot.h b/arch/x86/boot/boot.h
-index 9d4b4b43d97af59f6ed45d8680b8d58a04469c5c..a3c07c0734a00c5d190ac5ff210c62d70a6eb2fd 100644
---- a/arch/x86/boot/boot.h
-+++ b/arch/x86/boot/boot.h
+diff -urNp linux-2.6.26.3/arch/x86/boot/boot.h linux-2.6.26.3/arch/x86/boot/boot.h
+--- linux-2.6.26.3/arch/x86/boot/boot.h	2008-08-09 13:05:25.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/boot.h	2008-08-09 13:05:37.000000000 -0400
@@ -3160 +2938 @@
-@@ -174,7 +174,7 @@ static inline void wrgs32(u32 v, addr_t addr)
+@@ -174,7 +174,7 @@ static inline void wrgs32(u32 v, addr_t 
@@ -3169,4 +2947,3 @@
-diff --git a/arch/x86/boot/compressed/head_32.S b/arch/x86/boot/compressed/head_32.S
-index ba7736cf2ec73e8977e447a8ab852d083f079c42..18ddfb231551497f327b631866053f1f8c0f75aa 100644
---- a/arch/x86/boot/compressed/head_32.S
-+++ b/arch/x86/boot/compressed/head_32.S
+diff -urNp linux-2.6.26.3/arch/x86/boot/compressed/head_32.S linux-2.6.26.3/arch/x86/boot/compressed/head_32.S
+--- linux-2.6.26.3/arch/x86/boot/compressed/head_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/compressed/head_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -3211,4 +2988,3 @@
-diff --git a/arch/x86/boot/compressed/misc.c b/arch/x86/boot/compressed/misc.c
-index 90456cee47c337b226a8874582440377c428a91e..7f32263fb4523996a2bac41aa5f2ccb6b7cba57f 100644
---- a/arch/x86/boot/compressed/misc.c
-+++ b/arch/x86/boot/compressed/misc.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/compressed/misc.c linux-2.6.26.3/arch/x86/boot/compressed/misc.c
+--- linux-2.6.26.3/arch/x86/boot/compressed/misc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/compressed/misc.c	2008-08-09 12:03:28.000000000 -0400
@@ -3224 +3000 @@
-@@ -459,7 +459,7 @@ asmlinkage void decompress_kernel(void *rmode, memptr heap,
+@@ -459,7 +459,7 @@ asmlinkage void decompress_kernel(void *
@@ -3233,4 +3009,3 @@
-diff --git a/arch/x86/boot/compressed/relocs.c b/arch/x86/boot/compressed/relocs.c
-index edaadea90aafcf9876256bcac9db5d68823874ea..1406b3d0dd092fa0117d7c096f9e04f290e8eaab 100644
---- a/arch/x86/boot/compressed/relocs.c
-+++ b/arch/x86/boot/compressed/relocs.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/compressed/relocs.c linux-2.6.26.3/arch/x86/boot/compressed/relocs.c
+--- linux-2.6.26.3/arch/x86/boot/compressed/relocs.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/compressed/relocs.c	2008-08-09 12:03:28.000000000 -0400
@@ -3314 +3089 @@
-@@ -482,6 +525,23 @@ static void walk_relocs(void (*visit)(Elf32_Rel *rel, Elf32_Sym *sym))
+@@ -482,6 +525,23 @@ static void walk_relocs(void (*visit)(El
@@ -3346,4 +3121,3 @@
-diff --git a/arch/x86/boot/cpucheck.c b/arch/x86/boot/cpucheck.c
-index c1ce0303d994206faa386226dcba435dbba2aa97..515852e44b9fb4ec80fca33db88fccf6ecd53043 100644
---- a/arch/x86/boot/cpucheck.c
-+++ b/arch/x86/boot/cpucheck.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/cpucheck.c linux-2.6.26.3/arch/x86/boot/cpucheck.c
+--- linux-2.6.26.3/arch/x86/boot/cpucheck.c	2008-08-09 13:05:25.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/cpucheck.c	2008-08-09 13:05:37.000000000 -0400
@@ -3404 +3178 @@
-@@ -205,9 +205,9 @@ int check_cpu(int *cpu_level_ptr, int *req_level_ptr, u32 **err_flags_ptr)
+@@ -205,9 +205,9 @@ int check_cpu(int *cpu_level_ptr, int *r
@@ -3416 +3190 @@
-@@ -220,9 +220,9 @@ int check_cpu(int *cpu_level_ptr, int *req_level_ptr, u32 **err_flags_ptr)
+@@ -220,9 +220,9 @@ int check_cpu(int *cpu_level_ptr, int *r
@@ -3428 +3202 @@
-@@ -233,12 +233,12 @@ int check_cpu(int *cpu_level_ptr, int *req_level_ptr, u32 **err_flags_ptr)
+@@ -233,12 +233,12 @@ int check_cpu(int *cpu_level_ptr, int *r
@@ -3445,5 +3219,4 @@
-diff --git a/arch/x86/boot/edd.c b/arch/x86/boot/edd.c
-index 03399d64013b21459f63942c06bc6c33b803f425..c0762cf318c8c993dd2b6ba24128c0fc3d25b8ea 100644
---- a/arch/x86/boot/edd.c
-+++ b/arch/x86/boot/edd.c
-@@ -76,7 +76,7 @@ static int get_edd_info(u8 devno, struct edd_info *ei)
+diff -urNp linux-2.6.26.3/arch/x86/boot/edd.c linux-2.6.26.3/arch/x86/boot/edd.c
+--- linux-2.6.26.3/arch/x86/boot/edd.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/edd.c	2008-08-09 12:03:28.000000000 -0400
+@@ -76,7 +76,7 @@ static int get_edd_info(u8 devno, struct
@@ -3458 +3231 @@
-@@ -95,7 +95,7 @@ static int get_edd_info(u8 devno, struct edd_info *ei)
+@@ -95,7 +95,7 @@ static int get_edd_info(u8 devno, struct
@@ -3467 +3240 @@
-@@ -106,7 +106,7 @@ static int get_edd_info(u8 devno, struct edd_info *ei)
+@@ -106,7 +106,7 @@ static int get_edd_info(u8 devno, struct
@@ -3476,4 +3249,3 @@
-diff --git a/arch/x86/boot/main.c b/arch/x86/boot/main.c
-index 1b92cb66a90e1a61985cf7cf44aac0b9b1bd2df1..9a3e6e746dd49ed3ab8b80589deee22e91740657 100644
---- a/arch/x86/boot/main.c
-+++ b/arch/x86/boot/main.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/main.c linux-2.6.26.3/arch/x86/boot/main.c
+--- linux-2.6.26.3/arch/x86/boot/main.c	2008-08-09 13:05:25.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/main.c	2008-08-09 13:07:00.000000000 -0400
@@ -3489,4 +3261,3 @@
-diff --git a/arch/x86/boot/mca.c b/arch/x86/boot/mca.c
-index 911eaae5d696427c98fdad7f344a14bdc0340efc..ea2c2b2ef2f4a7ec0a117bbe8a55c872e770a139 100644
---- a/arch/x86/boot/mca.c
-+++ b/arch/x86/boot/mca.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/mca.c linux-2.6.26.3/arch/x86/boot/mca.c
+--- linux-2.6.26.3/arch/x86/boot/mca.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/mca.c	2008-08-09 12:03:28.000000000 -0400
@@ -3502,4 +3273,3 @@
-diff --git a/arch/x86/boot/memory.c b/arch/x86/boot/memory.c
-index acad32eb4290861b1539553c1e8eb49f7ec82e92..1318c870932b1d007bc77700293d39f688587243 100644
---- a/arch/x86/boot/memory.c
-+++ b/arch/x86/boot/memory.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/memory.c linux-2.6.26.3/arch/x86/boot/memory.c
+--- linux-2.6.26.3/arch/x86/boot/memory.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/memory.c	2008-08-09 12:03:28.000000000 -0400
@@ -3533,4 +3303,24 @@
-diff --git a/arch/x86/boot/video-vesa.c b/arch/x86/boot/video-vesa.c
-index 401ad998ad08d7cd63943a5b7a7ae893264b5e3f..56e521e8467742713c198d430658f8a6745c62c2 100644
---- a/arch/x86/boot/video-vesa.c
-+++ b/arch/x86/boot/video-vesa.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/video.c linux-2.6.26.3/arch/x86/boot/video.c
+--- linux-2.6.26.3/arch/x86/boot/video.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/video.c	2008-08-09 12:03:28.000000000 -0400
+@@ -23,7 +23,7 @@ static void store_cursor_position(void)
+ 
+ 	ax = 0x0300;
+ 	bx = 0;
+-	asm(INT10
++	asm volatile(INT10
+ 	    : "=d" (curpos), "+a" (ax), "+b" (bx)
+ 	    : : "ecx", "esi", "edi");
+ 
+@@ -38,7 +38,7 @@ static void store_video_mode(void)
+ 	/* N.B.: the saving of the video page here is a bit silly,
+ 	   since we pretty much assume page 0 everywhere. */
+ 	ax = 0x0f00;
+-	asm(INT10
++	asm volatile(INT10
+ 	    : "+a" (ax), "=b" (page)
+ 	    : : "ecx", "edx", "esi", "edi");
+ 
+diff -urNp linux-2.6.26.3/arch/x86/boot/video-vesa.c linux-2.6.26.3/arch/x86/boot/video-vesa.c
+--- linux-2.6.26.3/arch/x86/boot/video-vesa.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/video-vesa.c	2008-08-09 12:03:28.000000000 -0400
@@ -3555 +3345 @@
-@@ -123,7 +123,7 @@ static int vesa_set_mode(struct mode_info *mode)
+@@ -123,7 +123,7 @@ static int vesa_set_mode(struct mode_inf
@@ -3608,4 +3398,3 @@
-diff --git a/arch/x86/boot/video-vga.c b/arch/x86/boot/video-vga.c
-index 40ecb8d7688c3d5c8a7587aa8fce8bb7ea06d76b..9aedbbe304d3a4d2a708a0c63172f7cc432e7e08 100644
---- a/arch/x86/boot/video-vga.c
-+++ b/arch/x86/boot/video-vga.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/video-vga.c linux-2.6.26.3/arch/x86/boot/video-vga.c
+--- linux-2.6.26.3/arch/x86/boot/video-vga.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/video-vga.c	2008-08-09 12:03:28.000000000 -0400
@@ -3630,26 +3419,3 @@
-diff --git a/arch/x86/boot/video.c b/arch/x86/boot/video.c
-index 83598b23093aa31398db2d1c9a5f89eb30733357..8b7722794e64fdb6df4ca9476cc22cfef3e0a3e5 100644
---- a/arch/x86/boot/video.c
-+++ b/arch/x86/boot/video.c
-@@ -23,7 +23,7 @@ static void store_cursor_position(void)
- 
- 	ax = 0x0300;
- 	bx = 0;
--	asm(INT10
-+	asm volatile(INT10
- 	    : "=d" (curpos), "+a" (ax), "+b" (bx)
- 	    : : "ecx", "esi", "edi");
- 
-@@ -38,7 +38,7 @@ static void store_video_mode(void)
- 	/* N.B.: the saving of the video page here is a bit silly,
- 	   since we pretty much assume page 0 everywhere. */
- 	ax = 0x0f00;
--	asm(INT10
-+	asm volatile(INT10
- 	    : "+a" (ax), "=b" (page)
- 	    : : "ecx", "edx", "esi", "edi");
- 
-diff --git a/arch/x86/boot/voyager.c b/arch/x86/boot/voyager.c
-index 433909d61e5cb2ef7a20f7386c0ad87c362b47c1..edc601df302886f9c6b014f064ebba23306b1eb8 100644
---- a/arch/x86/boot/voyager.c
-+++ b/arch/x86/boot/voyager.c
+diff -urNp linux-2.6.26.3/arch/x86/boot/voyager.c linux-2.6.26.3/arch/x86/boot/voyager.c
+--- linux-2.6.26.3/arch/x86/boot/voyager.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/boot/voyager.c	2008-08-09 12:03:28.000000000 -0400
@@ -3665,5 +3431,4 @@
-diff --git a/arch/x86/ia32/ia32_signal.c b/arch/x86/ia32/ia32_signal.c
-index cb3856a18c8544e1ffe722d33a7713439043829d..e995822bed508d009b558fcd4fc329abe601a710 100644
---- a/arch/x86/ia32/ia32_signal.c
-+++ b/arch/x86/ia32/ia32_signal.c
-@@ -531,6 +531,7 @@ int ia32_setup_rt_frame(int sig, struct k_sigaction *ka, siginfo_t *info,
+diff -urNp linux-2.6.26.3/arch/x86/ia32/ia32_signal.c linux-2.6.26.3/arch/x86/ia32/ia32_signal.c
+--- linux-2.6.26.3/arch/x86/ia32/ia32_signal.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/ia32/ia32_signal.c	2008-08-09 12:03:28.000000000 -0400
+@@ -531,6 +531,7 @@ int ia32_setup_rt_frame(int sig, struct 
@@ -3677,5 +3442,89 @@
-diff --git a/arch/x86/kernel/acpi/boot.c b/arch/x86/kernel/acpi/boot.c
-index 33c5216fd3e1f5137b0b8c52fa8178ac328d630a..c5407343cd3ce24a6b9a69a94bbcf48dc2697dc1 100644
---- a/arch/x86/kernel/acpi/boot.c
-+++ b/arch/x86/kernel/acpi/boot.c
-@@ -1227,7 +1227,7 @@ static struct dmi_system_id __initdata acpi_dmi_table[] = {
+diff -urNp linux-2.6.26.3/arch/x86/Kconfig linux-2.6.26.3/arch/x86/Kconfig
+--- linux-2.6.26.3/arch/x86/Kconfig	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/Kconfig	2008-08-09 12:03:28.000000000 -0400
+@@ -887,7 +887,7 @@ config PAGE_OFFSET
+ 	hex
+ 	default 0xB0000000 if VMSPLIT_3G_OPT
+ 	default 0x80000000 if VMSPLIT_2G
+-	default 0x78000000 if VMSPLIT_2G_OPT
++	default 0x70000000 if VMSPLIT_2G_OPT
+ 	default 0x40000000 if VMSPLIT_1G
+ 	default 0xC0000000
+ 	depends on X86_32
+@@ -1206,8 +1206,7 @@ config CRASH_DUMP
+ config PHYSICAL_START
+ 	hex "Physical address where the kernel is loaded" if (EMBEDDED || CRASH_DUMP)
+ 	default "0x1000000" if X86_NUMAQ
+-	default "0x200000" if X86_64
+-	default "0x100000"
++	default "0x200000"
+ 	help
+ 	  This gives the physical address where the kernel is loaded.
+ 
+@@ -1299,9 +1298,9 @@ config HOTPLUG_CPU
+ 	  suspend.
+ 
+ config COMPAT_VDSO
+-	def_bool y
++	def_bool n
+ 	prompt "Compat VDSO support"
+-	depends on X86_32 || IA32_EMULATION
++	depends on (X86_32 || IA32_EMULATION) && !PAX_NOEXEC
+ 	help
+ 	  Map the 32-bit VDSO to the predictable old-style address too.
+ 	---help---
+@@ -1488,7 +1487,7 @@ config PCI
+ choice
+ 	prompt "PCI access mode"
+ 	depends on X86_32 && PCI && !X86_VISWS
+-	default PCI_GOANY
++	default PCI_GODIRECT
+ 	---help---
+ 	  On PCI systems, the BIOS can be used to detect the PCI devices and
+ 	  determine their configuration. However, some old PCI motherboards
+diff -urNp linux-2.6.26.3/arch/x86/Kconfig.cpu linux-2.6.26.3/arch/x86/Kconfig.cpu
+--- linux-2.6.26.3/arch/x86/Kconfig.cpu	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/Kconfig.cpu	2008-08-09 12:03:28.000000000 -0400
+@@ -340,7 +340,7 @@ config X86_PPRO_FENCE
+ 
+ config X86_F00F_BUG
+ 	def_bool y
+-	depends on M586MMX || M586TSC || M586 || M486 || M386
++	depends on (M586MMX || M586TSC || M586 || M486 || M386) && !PAX_KERNEXEC
+ 
+ config X86_WP_WORKS_OK
+ 	def_bool y
+@@ -360,7 +360,7 @@ config X86_POPAD_OK
+ 
+ config X86_ALIGNMENT_16
+ 	def_bool y
+-	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK6 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
++	depends on MWINCHIP3D || MWINCHIP2 || MWINCHIPC6 || MCYRIXIII || X86_ELAN || MK8 || MK7 || MK6 || MCORE2 || MPENTIUM4 || MPENTIUMIII || MPENTIUMII || M686 || M586MMX || M586TSC || M586 || M486 || MVIAC3_2 || MGEODEGX1
+ 
+ config X86_GOOD_APIC
+ 	def_bool y
+@@ -403,7 +403,7 @@ config X86_TSC
+ # generates cmov.
+ config X86_CMOV
+ 	def_bool y
+-	depends on (MK7 || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
++	depends on (MK8 || MK7 || MCORE2 || MPSC || MPENTIUM4 || MPENTIUMM || MPENTIUMIII || MPENTIUMII || M686 || MVIAC3_2 || MVIAC7 || X86_64)
+ 
+ config X86_MINIMUM_CPU_FAMILY
+ 	int
+diff -urNp linux-2.6.26.3/arch/x86/Kconfig.debug linux-2.6.26.3/arch/x86/Kconfig.debug
+--- linux-2.6.26.3/arch/x86/Kconfig.debug	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/Kconfig.debug	2008-08-09 12:03:28.000000000 -0400
+@@ -84,7 +84,7 @@ config X86_PTDUMP
+ config DEBUG_RODATA
+ 	bool "Write protect kernel read-only data structures"
+ 	default y
+-	depends on DEBUG_KERNEL
++	depends on DEBUG_KERNEL && BROKEN
+ 	help
+ 	  Mark the kernel read-only data as write-protected in the pagetables,
+ 	  in order to catch accidental (and incorrect) writes to such const
+diff -urNp linux-2.6.26.3/arch/x86/kernel/acpi/boot.c linux-2.6.26.3/arch/x86/kernel/acpi/boot.c
+--- linux-2.6.26.3/arch/x86/kernel/acpi/boot.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/acpi/boot.c	2008-08-09 12:03:28.000000000 -0400
+@@ -1227,7 +1227,7 @@ static struct dmi_system_id __initdata a
@@ -3690,4 +3539,3 @@
-diff --git a/arch/x86/kernel/acpi/realmode/wakeup.S b/arch/x86/kernel/acpi/realmode/wakeup.S
-index 3355973b12ac6f8ca11ea0f5486a6643373d8042..7f073d69e35451a41b13400405b6281bb54bad3c 100644
---- a/arch/x86/kernel/acpi/realmode/wakeup.S
-+++ b/arch/x86/kernel/acpi/realmode/wakeup.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/acpi/realmode/wakeup.S linux-2.6.26.3/arch/x86/kernel/acpi/realmode/wakeup.S
+--- linux-2.6.26.3/arch/x86/kernel/acpi/realmode/wakeup.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/acpi/realmode/wakeup.S	2008-08-09 12:03:28.000000000 -0400
@@ -3703,4 +3551,3 @@
-diff --git a/arch/x86/kernel/acpi/wakeup_32.S b/arch/x86/kernel/acpi/wakeup_32.S
-index a12e6a9fb65963f12ad7697b0f830a85cb69ff64..8e41c246b01c2f12c90341bd393260bab87da140 100644
---- a/arch/x86/kernel/acpi/wakeup_32.S
-+++ b/arch/x86/kernel/acpi/wakeup_32.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/acpi/wakeup_32.S linux-2.6.26.3/arch/x86/kernel/acpi/wakeup_32.S
+--- linux-2.6.26.3/arch/x86/kernel/acpi/wakeup_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/acpi/wakeup_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -3723,5 +3570,4 @@
-diff --git a/arch/x86/kernel/alternative.c b/arch/x86/kernel/alternative.c
-index 65c7857a90ddfc6ff084c6817baba045ced0ad71..a12beacd7398f56371274a3f10b61bee338d7813 100644
---- a/arch/x86/kernel/alternative.c
-+++ b/arch/x86/kernel/alternative.c
-@@ -403,7 +403,7 @@ void apply_paravirt(struct paravirt_patch_site *start,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/alternative.c linux-2.6.26.3/arch/x86/kernel/alternative.c
+--- linux-2.6.26.3/arch/x86/kernel/alternative.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/alternative.c	2008-08-09 12:03:28.000000000 -0400
+@@ -403,7 +403,7 @@ void apply_paravirt(struct paravirt_patc
@@ -3736 +3582 @@
-@@ -483,11 +483,26 @@ void __init alternative_instructions(void)
+@@ -483,11 +483,26 @@ void __init alternative_instructions(voi
@@ -3765 +3611 @@
-@@ -508,33 +523,21 @@ void *text_poke_early(void *addr, const void *opcode, size_t len)
+@@ -508,33 +523,21 @@ void *text_poke_early(void *addr, const 
@@ -3807,5 +3653,4 @@
-diff --git a/arch/x86/kernel/apm_32.c b/arch/x86/kernel/apm_32.c
-index bf9290e290136a36d6006d032c1ca4fe392f84bd..12784aa917135ebee6b471d534eb05390ff8a514 100644
---- a/arch/x86/kernel/apm_32.c
-+++ b/arch/x86/kernel/apm_32.c
-@@ -406,7 +406,7 @@ static DECLARE_WAIT_QUEUE_HEAD(apm_waitqueue);
+diff -urNp linux-2.6.26.3/arch/x86/kernel/apm_32.c linux-2.6.26.3/arch/x86/kernel/apm_32.c
+--- linux-2.6.26.3/arch/x86/kernel/apm_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/apm_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -406,7 +406,7 @@ static DECLARE_WAIT_QUEUE_HEAD(apm_waitq
@@ -3820 +3665 @@
-@@ -601,19 +601,42 @@ static u8 apm_bios_call(u32 func, u32 ebx_in, u32 ecx_in,
+@@ -601,19 +601,42 @@ static u8 apm_bios_call(u32 func, u32 eb
@@ -3863 +3708 @@
-@@ -644,19 +667,42 @@ static u8 apm_bios_call_simple(u32 func, u32 ebx_in, u32 ecx_in, u32 *eax)
+@@ -644,19 +667,42 @@ static u8 apm_bios_call_simple(u32 func,
@@ -3915 +3760 @@
-@@ -1868,7 +1914,10 @@ static const struct file_operations apm_bios_fops = {
+@@ -1868,7 +1914,10 @@ static const struct file_operations apm_
@@ -3927 +3772 @@
-@@ -2189,7 +2238,7 @@ static struct dmi_system_id __initdata apm_dmi_table[] = {
+@@ -2189,7 +2238,7 @@ static struct dmi_system_id __initdata a
@@ -3989,4 +3834,3 @@
-diff --git a/arch/x86/kernel/asm-offsets_32.c b/arch/x86/kernel/asm-offsets_32.c
-index 92588083950f8106bd08aafb081ebe46ce3023fd..c67715ccc4579a50dc61258d897254a2791d59b9 100644
---- a/arch/x86/kernel/asm-offsets_32.c
-+++ b/arch/x86/kernel/asm-offsets_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/asm-offsets_32.c linux-2.6.26.3/arch/x86/kernel/asm-offsets_32.c
+--- linux-2.6.26.3/arch/x86/kernel/asm-offsets_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/asm-offsets_32.c	2008-08-09 12:03:28.000000000 -0400
@@ -4009,4 +3853,3 @@
-diff --git a/arch/x86/kernel/asm-offsets_64.c b/arch/x86/kernel/asm-offsets_64.c
-index f126c05d6170a17e8fdd880b5973324eb8ebb7d0..23282b86238c7c4a831c511e2795a8d26d89d988 100644
---- a/arch/x86/kernel/asm-offsets_64.c
-+++ b/arch/x86/kernel/asm-offsets_64.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/asm-offsets_64.c linux-2.6.26.3/arch/x86/kernel/asm-offsets_64.c
+--- linux-2.6.26.3/arch/x86/kernel/asm-offsets_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/asm-offsets_64.c	2008-08-09 12:03:28.000000000 -0400
@@ -4021,4 +3864,3 @@
-diff --git a/arch/x86/kernel/cpu/common.c b/arch/x86/kernel/cpu/common.c
-index d0463a9462477716bd065b5c822cd34e96812282..37ff4cca6e503f87d950571c06823cb49a67b2ad 100644
---- a/arch/x86/kernel/cpu/common.c
-+++ b/arch/x86/kernel/cpu/common.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/cpu/common.c linux-2.6.26.3/arch/x86/kernel/cpu/common.c
+--- linux-2.6.26.3/arch/x86/kernel/cpu/common.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/cpu/common.c	2008-08-09 12:03:28.000000000 -0400
@@ -4076 +3918 @@
-@@ -479,6 +442,10 @@ void __cpuinit identify_cpu(struct cpuinfo_x86 *c)
+@@ -479,6 +442,10 @@ void __cpuinit identify_cpu(struct cpuin
@@ -4087 +3929 @@
-@@ -615,7 +582,7 @@ static __init int setup_disablecpuid(char *arg)
+@@ -615,7 +582,7 @@ static __init int setup_disablecpuid(cha
@@ -4123,5 +3965,4 @@
-diff --git a/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c b/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
-index b0c8208df9fa17363b5a3ed5ce35bdec8c52ad25..242a75d98feee6845146b9c4b2f2d50d22f6d658 100644
---- a/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
-+++ b/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
-@@ -560,7 +560,7 @@ static const struct dmi_system_id sw_any_bug_dmi_table[] = {
+diff -urNp linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c
+--- linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/acpi-cpufreq.c	2008-08-09 12:03:28.000000000 -0400
+@@ -560,7 +560,7 @@ static const struct dmi_system_id sw_any
@@ -4136,4 +3977,3 @@
-diff --git a/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c b/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
-index 908dd347c67ec3dc29aa5ab8b3dcbae9a12e5e37..d2dd06eefc6e0ceece433b114bd0df534342bb9a 100644
---- a/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
-+++ b/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c
+--- linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/cpu/cpufreq/speedstep-centrino.c	2008-08-09 12:03:28.000000000 -0400
@@ -4149,5 +3989,4 @@
-diff --git a/arch/x86/kernel/cpu/intel.c b/arch/x86/kernel/cpu/intel.c
-index fe9224c51d37ee1ca4cd36d6e7265e8124059012..37b7a882e53a8b5c2d4ceebc9266c9cc486fb060 100644
---- a/arch/x86/kernel/cpu/intel.c
-+++ b/arch/x86/kernel/cpu/intel.c
-@@ -107,7 +107,7 @@ static void __cpuinit trap_init_f00f_bug(void)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/cpu/intel.c linux-2.6.26.3/arch/x86/kernel/cpu/intel.c
+--- linux-2.6.26.3/arch/x86/kernel/cpu/intel.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/cpu/intel.c	2008-08-09 12:03:28.000000000 -0400
+@@ -107,7 +107,7 @@ static void __cpuinit trap_init_f00f_bug
@@ -4162,5 +4001,4 @@
-diff --git a/arch/x86/kernel/cpu/mcheck/mce_64.c b/arch/x86/kernel/cpu/mcheck/mce_64.c
-index e07e8c068ae00c464cdbf828cfbc8c67aaf76202..1df6badc4d7e5450b790d46bb2d449a6c703b9af 100644
---- a/arch/x86/kernel/cpu/mcheck/mce_64.c
-+++ b/arch/x86/kernel/cpu/mcheck/mce_64.c
-@@ -672,6 +672,7 @@ static struct miscdevice mce_log_device = {
+diff -urNp linux-2.6.26.3/arch/x86/kernel/cpu/mcheck/mce_64.c linux-2.6.26.3/arch/x86/kernel/cpu/mcheck/mce_64.c
+--- linux-2.6.26.3/arch/x86/kernel/cpu/mcheck/mce_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/cpu/mcheck/mce_64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -672,6 +672,7 @@ static struct miscdevice mce_log_device 
@@ -4174,5 +4012,4 @@
-diff --git a/arch/x86/kernel/cpu/mtrr/generic.c b/arch/x86/kernel/cpu/mtrr/generic.c
-index 75b14b12d48cdf382eb8bdc1aa6579f9bed89596..6b57a8038cfb1e1c206c178df95493dbbb40bfcf 100644
---- a/arch/x86/kernel/cpu/mtrr/generic.c
-+++ b/arch/x86/kernel/cpu/mtrr/generic.c
-@@ -31,11 +31,11 @@ static struct fixed_range_block fixed_range_blocks[] = {
+diff -urNp linux-2.6.26.3/arch/x86/kernel/cpu/mtrr/generic.c linux-2.6.26.3/arch/x86/kernel/cpu/mtrr/generic.c
+--- linux-2.6.26.3/arch/x86/kernel/cpu/mtrr/generic.c	2008-08-09 13:05:25.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/cpu/mtrr/generic.c	2008-08-09 13:05:37.000000000 -0400
+@@ -31,11 +31,11 @@ static struct fixed_range_block fixed_ra
@@ -4192,5 +4029,4 @@
-diff --git a/arch/x86/kernel/crash.c b/arch/x86/kernel/crash.c
-index 2685538179097a1e8e073ebf07cd49e898ef4f6e..42c856769fcdc420d8a95ef3e33c6d9e782c103e 100644
---- a/arch/x86/kernel/crash.c
-+++ b/arch/x86/kernel/crash.c
-@@ -59,7 +59,7 @@ static int crash_nmi_callback(struct notifier_block *self,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/crash.c linux-2.6.26.3/arch/x86/kernel/crash.c
+--- linux-2.6.26.3/arch/x86/kernel/crash.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/crash.c	2008-08-09 12:03:28.000000000 -0400
+@@ -59,7 +59,7 @@ static int crash_nmi_callback(struct not
@@ -4205,4 +4041,3 @@
-diff --git a/arch/x86/kernel/doublefault_32.c b/arch/x86/kernel/doublefault_32.c
-index a47798b59f07e82205cc6f24d2e4ccc5f0cb6db7..c4bae0eef29d3bbfde57dd872118fb553e70f930 100644
---- a/arch/x86/kernel/doublefault_32.c
-+++ b/arch/x86/kernel/doublefault_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/doublefault_32.c linux-2.6.26.3/arch/x86/kernel/doublefault_32.c
+--- linux-2.6.26.3/arch/x86/kernel/doublefault_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/doublefault_32.c	2008-08-09 12:03:28.000000000 -0400
@@ -4227 +4062 @@
-@@ -60,10 +60,10 @@ struct tss_struct doublefault_tss __cacheline_aligned = {
+@@ -60,10 +60,10 @@ struct tss_struct doublefault_tss __cach
@@ -4240,4 +4075,3 @@
-diff --git a/arch/x86/kernel/efi_32.c b/arch/x86/kernel/efi_32.c
-index 4b63c8e1f13b1b078a42dc113403c1952c52f3cc..5f7dfd0811208c22e94fdc15d1885a34a47ea561 100644
---- a/arch/x86/kernel/efi_32.c
-+++ b/arch/x86/kernel/efi_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/efi_32.c linux-2.6.26.3/arch/x86/kernel/efi_32.c
+--- linux-2.6.26.3/arch/x86/kernel/efi_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/efi_32.c	2008-08-09 12:03:28.000000000 -0400
@@ -4324,4 +4158,3 @@
-diff --git a/arch/x86/kernel/efi_stub_32.S b/arch/x86/kernel/efi_stub_32.S
-index ef00bb77d7e480d058ce21e2b66a20be730c7896..c902bdceeb8ed51f7ae4b1dbc205b698642e7eaf 100644
---- a/arch/x86/kernel/efi_stub_32.S
-+++ b/arch/x86/kernel/efi_stub_32.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/efi_stub_32.S linux-2.6.26.3/arch/x86/kernel/efi_stub_32.S
+--- linux-2.6.26.3/arch/x86/kernel/efi_stub_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/efi_stub_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -4425,4 +4258,3 @@
-diff --git a/arch/x86/kernel/entry_32.S b/arch/x86/kernel/entry_32.S
-index c778e4fa55a2eacc79d34954c2fdcef1367d5732..e3fbb5e3746ae6c513904457bf459360caf35baf 100644
---- a/arch/x86/kernel/entry_32.S
-+++ b/arch/x86/kernel/entry_32.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/entry_32.S linux-2.6.26.3/arch/x86/kernel/entry_32.S
+--- linux-2.6.26.3/arch/x86/kernel/entry_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/entry_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -4710,4 +4542,3 @@
-diff --git a/arch/x86/kernel/entry_64.S b/arch/x86/kernel/entry_64.S
-index 556a8df522a7adcf9583164be4cad60e29b00a97..3f04e6e21ecb673fb55deb76b1faf424d33e08c8 100644
---- a/arch/x86/kernel/entry_64.S
-+++ b/arch/x86/kernel/entry_64.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/entry_64.S linux-2.6.26.3/arch/x86/kernel/entry_64.S
+--- linux-2.6.26.3/arch/x86/kernel/entry_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/entry_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -4736,31 +4567,3 @@
-diff --git a/arch/x86/kernel/head64.c b/arch/x86/kernel/head64.c
-index e25c57b8aa844937742f246288e9ffa2e2be5229..1d3beaee554d88ce214a0e161c5daf2362e8e7f9 100644
---- a/arch/x86/kernel/head64.c
-+++ b/arch/x86/kernel/head64.c
-@@ -142,6 +142,11 @@ void __init x86_64_start_kernel(char * real_mode_data)
- 	/* Make NULL pointers segfault */
- 	zap_identity_mappings();
- 
-+	for (i = 0; i < NR_CPUS; i++)
-+		cpu_pda(i) = &boot_cpu_pda[i];
-+
-+	pda_init(0);
-+
- 	/* Cleanup the over mapped high alias */
- 	cleanup_highmap();
- 
-@@ -156,10 +161,6 @@ void __init x86_64_start_kernel(char * real_mode_data)
- 
- 	early_printk("Kernel alive\n");
- 
-- 	for (i = 0; i < NR_CPUS; i++)
-- 		cpu_pda(i) = &boot_cpu_pda[i];
--
--	pda_init(0);
- 	copy_bootdata(__va(real_mode_data));
- 
- 	reserve_early(__pa_symbol(&_text), __pa_symbol(&_end), "TEXT DATA BSS");
-diff --git a/arch/x86/kernel/head_32.S b/arch/x86/kernel/head_32.S
-index f7357cc0162c2f1c4786b3208e8524b51837fef8..c789cebc924301cd3ab9b192e49e64649864d2b8 100644
---- a/arch/x86/kernel/head_32.S
-+++ b/arch/x86/kernel/head_32.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/head_32.S linux-2.6.26.3/arch/x86/kernel/head_32.S
+--- linux-2.6.26.3/arch/x86/kernel/head_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/head_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -4803 +4606 @@
-@@ -82,6 +88,12 @@ INIT_MAP_BEYOND_END = BOOTBITMAP_SIZE + (PAGE_TABLE_SIZE + ALLOCATOR_SLOP)*PAGE_
+@@ -82,6 +88,12 @@ INIT_MAP_BEYOND_END = BOOTBITMAP_SIZE + 
@@ -4884 +4687 @@
-@@ -172,7 +219,7 @@ num_subarch_entries = (. - subarch_entries) / 4
+@@ -172,7 +219,7 @@ num_subarch_entries = (. - subarch_entri
@@ -5165,4 +4968,29 @@
-diff --git a/arch/x86/kernel/head_64.S b/arch/x86/kernel/head_64.S
-index b817974ef9420bba5702327a1089156dcb5d72c3..c7bbe94dd79c32f580233862b9ca578a686107cd 100644
---- a/arch/x86/kernel/head_64.S
-+++ b/arch/x86/kernel/head_64.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/head64.c linux-2.6.26.3/arch/x86/kernel/head64.c
+--- linux-2.6.26.3/arch/x86/kernel/head64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/head64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -142,6 +142,11 @@ void __init x86_64_start_kernel(char * r
+ 	/* Make NULL pointers segfault */
+ 	zap_identity_mappings();
+ 
++	for (i = 0; i < NR_CPUS; i++)
++		cpu_pda(i) = &boot_cpu_pda[i];
++
++	pda_init(0);
++
+ 	/* Cleanup the over mapped high alias */
+ 	cleanup_highmap();
+ 
+@@ -156,10 +161,6 @@ void __init x86_64_start_kernel(char * r
+ 
+ 	early_printk("Kernel alive\n");
+ 
+- 	for (i = 0; i < NR_CPUS; i++)
+- 		cpu_pda(i) = &boot_cpu_pda[i];
+-
+-	pda_init(0);
+ 	copy_bootdata(__va(real_mode_data));
+ 
+ 	reserve_early(__pa_symbol(&_text), __pa_symbol(&_end), "TEXT DATA BSS");
+diff -urNp linux-2.6.26.3/arch/x86/kernel/head_64.S linux-2.6.26.3/arch/x86/kernel/head_64.S
+--- linux-2.6.26.3/arch/x86/kernel/head_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/head_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -5220,3 +5048,3 @@
-+	.previous
- #endif /* CONFIG_EARLY_PRINTK */
--	.previous
+-#endif /* CONFIG_EARLY_PRINTK */
+ 	.previous
++#endif /* CONFIG_EARLY_PRINTK */
@@ -5304,4 +5132,3 @@
-diff --git a/arch/x86/kernel/i386_ksyms_32.c b/arch/x86/kernel/i386_ksyms_32.c
-index deb43785e923d09a8ba7215222e84363ad682742..f9f39f4a5de6ccdc3a961f4a77b1dcf1d596e93c 100644
---- a/arch/x86/kernel/i386_ksyms_32.c
-+++ b/arch/x86/kernel/i386_ksyms_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/i386_ksyms_32.c linux-2.6.26.3/arch/x86/kernel/i386_ksyms_32.c
+--- linux-2.6.26.3/arch/x86/kernel/i386_ksyms_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/i386_ksyms_32.c	2008-08-09 12:03:28.000000000 -0400
@@ -5329,4 +5156,3 @@
-diff --git a/arch/x86/kernel/init_task.c b/arch/x86/kernel/init_task.c
-index a4f93b4120c155c20889947942d7bdb5c286908d..ec3d4c4d707c80c5f6ffc8f6efc2372cb33b0684 100644
---- a/arch/x86/kernel/init_task.c
-+++ b/arch/x86/kernel/init_task.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/init_task.c linux-2.6.26.3/arch/x86/kernel/init_task.c
+--- linux-2.6.26.3/arch/x86/kernel/init_task.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/init_task.c	2008-08-09 12:03:28.000000000 -0400
@@ -5341,4 +5167,3 @@
-diff --git a/arch/x86/kernel/ioport.c b/arch/x86/kernel/ioport.c
-index 50e5e4a31c8500e94b277378b2d3860d673fc225..147ea7bc716d2c1f13c9261d218e98d87cbdd2d4 100644
---- a/arch/x86/kernel/ioport.c
-+++ b/arch/x86/kernel/ioport.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/ioport.c linux-2.6.26.3/arch/x86/kernel/ioport.c
+--- linux-2.6.26.3/arch/x86/kernel/ioport.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/ioport.c	2008-08-09 12:03:28.000000000 -0400
@@ -5353 +5178 @@
-@@ -40,6 +41,12 @@ asmlinkage long sys_ioperm(unsigned long from, unsigned long num, int turn_on)
+@@ -40,6 +41,12 @@ asmlinkage long sys_ioperm(unsigned long
@@ -5366 +5191 @@
-@@ -66,7 +73,7 @@ asmlinkage long sys_ioperm(unsigned long from, unsigned long num, int turn_on)
+@@ -66,7 +73,7 @@ asmlinkage long sys_ioperm(unsigned long
@@ -5375 +5200 @@
-@@ -121,8 +128,13 @@ static int do_iopl(unsigned int level, struct pt_regs *regs)
+@@ -121,8 +128,13 @@ static int do_iopl(unsigned int level, s
@@ -5389,5 +5214,4 @@
-diff --git a/arch/x86/kernel/irq_32.c b/arch/x86/kernel/irq_32.c
-index 147352df28b9c74146a102f6c8b22b17e2b11d6d..6d223d9316479d023c1ab1ecf86c29f4f26e9dd4 100644
---- a/arch/x86/kernel/irq_32.c
-+++ b/arch/x86/kernel/irq_32.c
-@@ -115,7 +115,7 @@ unsigned int do_IRQ(struct pt_regs *regs)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/irq_32.c linux-2.6.26.3/arch/x86/kernel/irq_32.c
+--- linux-2.6.26.3/arch/x86/kernel/irq_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/irq_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -115,7 +115,7 @@ unsigned int do_IRQ(struct pt_regs *regs
@@ -5411,5 +5235,4 @@
-diff --git a/arch/x86/kernel/kprobes.c b/arch/x86/kernel/kprobes.c
-index 43c019f85f0db749425e451957bd2279cee47b80..0b7ec722350dca9047a3c0ddcf3cffc563a662f7 100644
---- a/arch/x86/kernel/kprobes.c
-+++ b/arch/x86/kernel/kprobes.c
-@@ -166,9 +166,24 @@ static void __kprobes set_jmp_op(void *from, void *to)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/kprobes.c linux-2.6.26.3/arch/x86/kernel/kprobes.c
+--- linux-2.6.26.3/arch/x86/kernel/kprobes.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/kprobes.c	2008-08-09 12:03:28.000000000 -0400
+@@ -166,9 +166,24 @@ static void __kprobes set_jmp_op(void *f
@@ -5441 +5264 @@
-@@ -342,16 +357,29 @@ static void __kprobes fix_riprel(struct kprobe *p)
+@@ -342,16 +357,29 @@ static void __kprobes fix_riprel(struct 
@@ -5474 +5297 @@
-@@ -428,7 +456,7 @@ static void __kprobes prepare_singlestep(struct kprobe *p, struct pt_regs *regs)
+@@ -428,7 +456,7 @@ static void __kprobes prepare_singlestep
@@ -5483 +5306 @@
-@@ -450,7 +478,7 @@ static void __kprobes setup_singlestep(struct kprobe *p, struct pt_regs *regs,
+@@ -450,7 +478,7 @@ static void __kprobes setup_singlestep(s
@@ -5492 +5315 @@
-@@ -772,7 +800,7 @@ static void __kprobes resume_execution(struct kprobe *p,
+@@ -772,7 +800,7 @@ static void __kprobes resume_execution(s
@@ -5501 +5324 @@
-@@ -955,7 +983,7 @@ int __kprobes kprobe_exceptions_notify(struct notifier_block *self,
+@@ -955,7 +983,7 @@ int __kprobes kprobe_exceptions_notify(s
@@ -5510,5 +5333,4 @@
-diff --git a/arch/x86/kernel/ldt.c b/arch/x86/kernel/ldt.c
-index 0224c3637c73e68b4566124dd5d825034bc8c07a..449f9d7299316b161c3d8ce162dae73c3ea6dafb 100644
---- a/arch/x86/kernel/ldt.c
-+++ b/arch/x86/kernel/ldt.c
-@@ -65,7 +65,7 @@ static int alloc_ldt(mm_context_t *pc, int mincount, int reload)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/ldt.c linux-2.6.26.3/arch/x86/kernel/ldt.c
+--- linux-2.6.26.3/arch/x86/kernel/ldt.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/ldt.c	2008-08-09 12:03:28.000000000 -0400
+@@ -65,7 +65,7 @@ static int alloc_ldt(mm_context_t *pc, i
@@ -5523 +5345 @@
-@@ -110,6 +110,24 @@ int init_new_context(struct task_struct *tsk, struct mm_struct *mm)
+@@ -110,6 +110,24 @@ int init_new_context(struct task_struct 
@@ -5548 +5370 @@
-@@ -223,6 +241,13 @@ static int write_ldt(void __user *ptr, unsigned long bytecount, int oldmode)
+@@ -223,6 +241,13 @@ static int write_ldt(void __user *ptr, u
@@ -5562,5 +5384,4 @@
-diff --git a/arch/x86/kernel/machine_kexec_32.c b/arch/x86/kernel/machine_kexec_32.c
-index d0b234c9fc318ac0f11a127f9aac87ce7de55dc6..5f9be2f34d04e1406bdf3e980d12df25727fca1d 100644
---- a/arch/x86/kernel/machine_kexec_32.c
-+++ b/arch/x86/kernel/machine_kexec_32.c
-@@ -30,7 +30,7 @@ static u32 kexec_pmd1[1024] PAGE_ALIGNED;
+diff -urNp linux-2.6.26.3/arch/x86/kernel/machine_kexec_32.c linux-2.6.26.3/arch/x86/kernel/machine_kexec_32.c
+--- linux-2.6.26.3/arch/x86/kernel/machine_kexec_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/machine_kexec_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -30,7 +30,7 @@ static u32 kexec_pmd1[1024] PAGE_ALIGNED
@@ -5575 +5396 @@
-@@ -42,7 +42,7 @@ static void set_idt(void *newidt, __u16 limit)
+@@ -42,7 +42,7 @@ static void set_idt(void *newidt, __u16 
@@ -5584 +5405 @@
-@@ -111,10 +111,10 @@ NORET_TYPE void machine_kexec(struct kimage *image)
+@@ -111,10 +111,10 @@ NORET_TYPE void machine_kexec(struct kim
@@ -5597,4 +5418,3 @@
-diff --git a/arch/x86/kernel/module_32.c b/arch/x86/kernel/module_32.c
-index 3db0a5442eb1bab48d9bbdfa93a0a9ccd5b74fa0..9f9c24318f18e272bca800bb88706b065b7bbb04 100644
---- a/arch/x86/kernel/module_32.c
-+++ b/arch/x86/kernel/module_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/module_32.c linux-2.6.26.3/arch/x86/kernel/module_32.c
+--- linux-2.6.26.3/arch/x86/kernel/module_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/module_32.c	2008-08-09 12:54:30.000000000 -0400
@@ -5643 +5463 @@
-@@ -45,6 +70,45 @@ void module_free(struct module *mod, void *module_region)
+@@ -45,6 +70,45 @@ void module_free(struct module *mod, voi
@@ -5748,5 +5568,4 @@
-diff --git a/arch/x86/kernel/module_64.c b/arch/x86/kernel/module_64.c
-index a888e67f5874dad3415220cc9fd0c9f962c4661c..241d7434e9803d486432296e7a98917a68f1c615 100644
---- a/arch/x86/kernel/module_64.c
-+++ b/arch/x86/kernel/module_64.c
-@@ -39,7 +39,7 @@ void module_free(struct module *mod, void *module_region)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/module_64.c linux-2.6.26.3/arch/x86/kernel/module_64.c
+--- linux-2.6.26.3/arch/x86/kernel/module_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/module_64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -39,7 +39,7 @@ void module_free(struct module *mod, voi
@@ -5767 +5586 @@
- }
++}
@@ -5783 +5602 @@
-+}
+ }
@@ -5794 +5613 @@
-@@ -76,7 +99,11 @@ int apply_relocate_add(Elf64_Shdr *sechdrs,
+@@ -76,7 +99,11 @@ int apply_relocate_add(Elf64_Shdr *sechd
@@ -5807 +5626 @@
-@@ -100,21 +127,61 @@ int apply_relocate_add(Elf64_Shdr *sechdrs,
+@@ -100,21 +127,61 @@ int apply_relocate_add(Elf64_Shdr *sechd
@@ -5869,4 +5688,3 @@
-diff --git a/arch/x86/kernel/paravirt.c b/arch/x86/kernel/paravirt.c
-index 74f0c5ea2a0388af848faa058804cd9df86f4391..238d37eedf612beadb1d5858588d479840eb02cf 100644
---- a/arch/x86/kernel/paravirt.c
-+++ b/arch/x86/kernel/paravirt.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/paravirt.c linux-2.6.26.3/arch/x86/kernel/paravirt.c
+--- linux-2.6.26.3/arch/x86/kernel/paravirt.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/paravirt.c	2008-08-09 12:03:28.000000000 -0400
@@ -5882 +5700 @@
-@@ -159,7 +159,7 @@ unsigned paravirt_patch_insns(void *insnbuf, unsigned len,
+@@ -159,7 +159,7 @@ unsigned paravirt_patch_insns(void *insn
@@ -5891 +5709 @@
-@@ -261,21 +261,21 @@ enum paravirt_lazy_mode paravirt_get_lazy_mode(void)
+@@ -261,21 +261,21 @@ enum paravirt_lazy_mode paravirt_get_laz
@@ -5952,5 +5770,4 @@
-diff --git a/arch/x86/kernel/process_32.c b/arch/x86/kernel/process_32.c
-index e2db9ac5c61c2b6d6de1f0b13f71b6d834eaeca2..bb61b0042de82bbefbdd0ad65a078b5a27a7fc86 100644
---- a/arch/x86/kernel/process_32.c
-+++ b/arch/x86/kernel/process_32.c
-@@ -66,8 +66,10 @@ EXPORT_SYMBOL(boot_option_idle_override);
+diff -urNp linux-2.6.26.3/arch/x86/kernel/process_32.c linux-2.6.26.3/arch/x86/kernel/process_32.c
+--- linux-2.6.26.3/arch/x86/kernel/process_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/process_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -66,8 +66,10 @@ EXPORT_SYMBOL(boot_option_idle_override)
@@ -5975 +5792 @@
-@@ -201,7 +204,7 @@ void __show_registers(struct pt_regs *regs, int all)
+@@ -201,7 +204,7 @@ void __show_registers(struct pt_regs *re
@@ -5984 +5801 @@
-@@ -278,8 +281,8 @@ int kernel_thread(int (*fn)(void *), void * arg, unsigned long flags)
+@@ -278,8 +281,8 @@ int kernel_thread(int (*fn)(void *), voi
@@ -6012 +5829 @@
-@@ -361,7 +365,7 @@ int copy_thread(int nr, unsigned long clone_flags, unsigned long sp,
+@@ -361,7 +365,7 @@ int copy_thread(int nr, unsigned long cl
@@ -6021 +5838 @@
-@@ -390,6 +394,7 @@ int copy_thread(int nr, unsigned long clone_flags, unsigned long sp,
+@@ -390,6 +394,7 @@ int copy_thread(int nr, unsigned long cl
@@ -6029 +5846 @@
-@@ -589,7 +594,7 @@ struct task_struct * __switch_to(struct task_struct *prev_p, struct task_struct
+@@ -589,7 +594,7 @@ struct task_struct * __switch_to(struct 
@@ -6038 +5855 @@
-@@ -617,6 +622,11 @@ struct task_struct * __switch_to(struct task_struct *prev_p, struct task_struct
+@@ -617,6 +622,11 @@ struct task_struct * __switch_to(struct 
@@ -6050 +5867 @@
-@@ -755,15 +765,27 @@ unsigned long get_wchan(struct task_struct *p)
+@@ -755,15 +765,27 @@ unsigned long get_wchan(struct task_stru
@@ -6087,4 +5904,3 @@
-diff --git a/arch/x86/kernel/process_64.c b/arch/x86/kernel/process_64.c
-index c6eb5c91e5f607f7fb70758ed65eee667c7d1401..a671641e4a4a01fd8b1f31b0b843d62ed8a660b0 100644
---- a/arch/x86/kernel/process_64.c
-+++ b/arch/x86/kernel/process_64.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/process_64.c linux-2.6.26.3/arch/x86/kernel/process_64.c
+--- linux-2.6.26.3/arch/x86/kernel/process_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/process_64.c	2008-08-09 12:03:28.000000000 -0400
@@ -6109 +5925 @@
-@@ -566,7 +568,7 @@ __switch_to(struct task_struct *prev_p, struct task_struct *next_p)
+@@ -566,7 +568,7 @@ __switch_to(struct task_struct *prev_p, 
@@ -6118 +5934 @@
-@@ -641,7 +643,6 @@ __switch_to(struct task_struct *prev_p, struct task_struct *next_p)
+@@ -641,7 +643,6 @@ __switch_to(struct task_struct *prev_p, 
@@ -6126 +5942 @@
-@@ -855,16 +856,3 @@ long sys_arch_prctl(int code, unsigned long addr)
+@@ -855,16 +856,3 @@ long sys_arch_prctl(int code, unsigned l
@@ -6143,5 +5959,4 @@
-diff --git a/arch/x86/kernel/ptrace.c b/arch/x86/kernel/ptrace.c
-index 77040b6070e18c00ce71f788efa0d40d5a156229..4afe11493d48cce8558e974e700ef23313b6b3d1 100644
---- a/arch/x86/kernel/ptrace.c
-+++ b/arch/x86/kernel/ptrace.c
-@@ -1371,7 +1371,7 @@ void send_sigtrap(struct task_struct *tsk, struct pt_regs *regs, int error_code)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/ptrace.c linux-2.6.26.3/arch/x86/kernel/ptrace.c
+--- linux-2.6.26.3/arch/x86/kernel/ptrace.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/ptrace.c	2008-08-09 12:03:28.000000000 -0400
+@@ -1371,7 +1371,7 @@ void send_sigtrap(struct task_struct *ts
@@ -6156,4 +5971,3 @@
-diff --git a/arch/x86/kernel/reboot.c b/arch/x86/kernel/reboot.c
-index d834b36b0ce19cfc9cdc289c8cc72f360770f13a..b11e4141b802f583e785bfdd1cf697f522907c36 100644
---- a/arch/x86/kernel/reboot.c
-+++ b/arch/x86/kernel/reboot.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/reboot.c linux-2.6.26.3/arch/x86/kernel/reboot.c
+--- linux-2.6.26.3/arch/x86/kernel/reboot.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/reboot.c	2008-08-09 12:03:28.000000000 -0400
@@ -6169 +5983 @@
-@@ -193,7 +193,7 @@ static struct dmi_system_id __initdata reboot_dmi_table[] = {
+@@ -193,7 +193,7 @@ static struct dmi_system_id __initdata r
@@ -6209 +6023 @@
-@@ -253,7 +253,7 @@ static unsigned char real_mode_switch [] =
+@@ -253,7 +253,7 @@ static unsigned char real_mode_switch []
@@ -6227 +6041 @@
-@@ -283,8 +283,8 @@ void machine_real_restart(unsigned char *code, int length)
+@@ -283,8 +283,8 @@ void machine_real_restart(unsigned char 
@@ -6238 +6052 @@
-@@ -296,16 +296,15 @@ void machine_real_restart(unsigned char *code, int length)
+@@ -296,16 +296,15 @@ void machine_real_restart(unsigned char 
@@ -6258,5 +6072,46 @@
-diff --git a/arch/x86/kernel/setup64.c b/arch/x86/kernel/setup64.c
-index aee0e8200777057699f8cd580c1add23684d780d..4833c80fa7b6d71d05ffe5bfdfac61ac8de47b9d 100644
---- a/arch/x86/kernel/setup64.c
-+++ b/arch/x86/kernel/setup64.c
-@@ -38,15 +38,13 @@ struct x8664_pda *_cpu_pda[NR_CPUS] __read_mostly;
+diff -urNp linux-2.6.26.3/arch/x86/kernel/setup_32.c linux-2.6.26.3/arch/x86/kernel/setup_32.c
+--- linux-2.6.26.3/arch/x86/kernel/setup_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/setup_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -67,6 +67,7 @@
+ #include <asm/bios_ebda.h>
+ #include <asm/cacheflush.h>
+ #include <asm/processor.h>
++#include <asm/boot.h>
+ 
+ /* This value is set up by the early boot code to point to the value
+    immediately after the boot time page tables.  It contains a *physical*
+@@ -662,8 +663,8 @@ void __init setup_bootmem_allocator(void
+ 	 * the (very unlikely) case of us accidentally initializing the
+ 	 * bootmem allocator with an invalid RAM area.
+ 	 */
+-	reserve_bootmem(__pa_symbol(_text), (PFN_PHYS(min_low_pfn) +
+-			 bootmap_size + PAGE_SIZE-1) - __pa_symbol(_text),
++	reserve_bootmem(LOAD_PHYSICAL_ADDR, (PFN_PHYS(min_low_pfn) +
++			 bootmap_size + PAGE_SIZE-1) - LOAD_PHYSICAL_ADDR,
+ 			 BOOTMEM_DEFAULT);
+ 
+ 	/*
+@@ -799,14 +800,14 @@ void __init setup_arch(char **cmdline_p)
+ 
+ 	if (!boot_params.hdr.root_flags)
+ 		root_mountflags &= ~MS_RDONLY;
+-	init_mm.start_code = (unsigned long) _text;
+-	init_mm.end_code = (unsigned long) _etext;
++	init_mm.start_code = ktla_ktva((unsigned long) _text);
++	init_mm.end_code = ktla_ktva((unsigned long) _etext);
+ 	init_mm.end_data = (unsigned long) _edata;
+ 	init_mm.brk = init_pg_tables_end + PAGE_OFFSET;
+ 
+-	code_resource.start = virt_to_phys(_text);
+-	code_resource.end = virt_to_phys(_etext)-1;
+-	data_resource.start = virt_to_phys(_etext);
++	code_resource.start = virt_to_phys(ktla_ktva(_text));
++	code_resource.end = virt_to_phys(ktla_ktva(_etext))-1;
++	data_resource.start = virt_to_phys(_data);
+ 	data_resource.end = virt_to_phys(_edata)-1;
+ 	bss_resource.start = virt_to_phys(&__bss_start);
+ 	bss_resource.end = virt_to_phys(&__bss_stop)-1;
+diff -urNp linux-2.6.26.3/arch/x86/kernel/setup64.c linux-2.6.26.3/arch/x86/kernel/setup64.c
+--- linux-2.6.26.3/arch/x86/kernel/setup64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/setup64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -38,15 +38,13 @@ struct x8664_pda *_cpu_pda[NR_CPUS] __re
@@ -6306 +6161 @@
-@@ -174,12 +170,13 @@ DEFINE_PER_CPU(struct orig_ist, orig_ist);
+@@ -174,12 +170,13 @@ DEFINE_PER_CPU(struct orig_ist, orig_ist
@@ -6339,48 +6194,4 @@
-diff --git a/arch/x86/kernel/setup_32.c b/arch/x86/kernel/setup_32.c
-index 5a2f8e0638875a348fcf415bef070fbece342fa5..2a7307b38699064e7884833901bb824da568c0e5 100644
---- a/arch/x86/kernel/setup_32.c
-+++ b/arch/x86/kernel/setup_32.c
-@@ -67,6 +67,7 @@
- #include <asm/bios_ebda.h>
- #include <asm/cacheflush.h>
- #include <asm/processor.h>
-+#include <asm/boot.h>
- 
- /* This value is set up by the early boot code to point to the value
-    immediately after the boot time page tables.  It contains a *physical*
-@@ -662,8 +663,8 @@ void __init setup_bootmem_allocator(void)
- 	 * the (very unlikely) case of us accidentally initializing the
- 	 * bootmem allocator with an invalid RAM area.
- 	 */
--	reserve_bootmem(__pa_symbol(_text), (PFN_PHYS(min_low_pfn) +
--			 bootmap_size + PAGE_SIZE-1) - __pa_symbol(_text),
-+	reserve_bootmem(LOAD_PHYSICAL_ADDR, (PFN_PHYS(min_low_pfn) +
-+			 bootmap_size + PAGE_SIZE-1) - LOAD_PHYSICAL_ADDR,
- 			 BOOTMEM_DEFAULT);
- 
- 	/*
-@@ -799,14 +800,14 @@ void __init setup_arch(char **cmdline_p)
- 
- 	if (!boot_params.hdr.root_flags)
- 		root_mountflags &= ~MS_RDONLY;
--	init_mm.start_code = (unsigned long) _text;
--	init_mm.end_code = (unsigned long) _etext;
-+	init_mm.start_code = ktla_ktva((unsigned long) _text);
-+	init_mm.end_code = ktla_ktva((unsigned long) _etext);
- 	init_mm.end_data = (unsigned long) _edata;
- 	init_mm.brk = init_pg_tables_end + PAGE_OFFSET;
- 
--	code_resource.start = virt_to_phys(_text);
--	code_resource.end = virt_to_phys(_etext)-1;
--	data_resource.start = virt_to_phys(_etext);
-+	code_resource.start = virt_to_phys(ktla_ktva(_text));
-+	code_resource.end = virt_to_phys(ktla_ktva(_etext))-1;
-+	data_resource.start = virt_to_phys(_data);
- 	data_resource.end = virt_to_phys(_edata)-1;
- 	bss_resource.start = virt_to_phys(&__bss_start);
- 	bss_resource.end = virt_to_phys(&__bss_stop)-1;
-diff --git a/arch/x86/kernel/signal_32.c b/arch/x86/kernel/signal_32.c
-index d92373630963f980fb5471a0d96d903b5d4b18bf..a46b1718dd32a3dc51e97f3b22415318424db2e1 100644
---- a/arch/x86/kernel/signal_32.c
-+++ b/arch/x86/kernel/signal_32.c
-@@ -378,9 +378,9 @@ setup_frame(int sig, struct k_sigaction *ka, sigset_t *set,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/signal_32.c linux-2.6.26.3/arch/x86/kernel/signal_32.c
+--- linux-2.6.26.3/arch/x86/kernel/signal_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/signal_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -378,9 +378,9 @@ setup_frame(int sig, struct k_sigaction 
@@ -6398 +6209 @@
-@@ -460,7 +460,7 @@ static int setup_rt_frame(int sig, struct k_sigaction *ka, siginfo_t *info,
+@@ -460,7 +460,7 @@ static int setup_rt_frame(int sig, struc
@@ -6407 +6218 @@
-@@ -590,7 +590,7 @@ static void do_signal(struct pt_regs *regs)
+@@ -590,7 +590,7 @@ static void do_signal(struct pt_regs *re
@@ -6416,5 +6227,4 @@
-diff --git a/arch/x86/kernel/signal_64.c b/arch/x86/kernel/signal_64.c
-index e53b267662e712681d99b4b5ae6014af9bf790c1..1e53224a8586c4626ecc776f2ede813d82b785d9 100644
---- a/arch/x86/kernel/signal_64.c
-+++ b/arch/x86/kernel/signal_64.c
-@@ -250,8 +250,8 @@ static int setup_rt_frame(int sig, struct k_sigaction *ka, siginfo_t *info,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/signal_64.c linux-2.6.26.3/arch/x86/kernel/signal_64.c
+--- linux-2.6.26.3/arch/x86/kernel/signal_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/signal_64.c	2008-08-09 12:03:28.000000000 -0400
+@@ -250,8 +250,8 @@ static int setup_rt_frame(int sig, struc
@@ -6431,5 +6241,4 @@
-diff --git a/arch/x86/kernel/smpboot.c b/arch/x86/kernel/smpboot.c
-index 3e1cecedde42747261c94053a53191ffa7291107..a5a570802ef0d89dde13eabcfc6e0229468b6945 100644
---- a/arch/x86/kernel/smpboot.c
-+++ b/arch/x86/kernel/smpboot.c
-@@ -847,15 +847,13 @@ static int __cpuinit do_boot_cpu(int apicid, int cpu)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/smpboot.c linux-2.6.26.3/arch/x86/kernel/smpboot.c
+--- linux-2.6.26.3/arch/x86/kernel/smpboot.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/smpboot.c	2008-08-09 12:03:28.000000000 -0400
+@@ -847,15 +847,13 @@ static int __cpuinit do_boot_cpu(int api
@@ -6483,4 +6292,3 @@
-diff --git a/arch/x86/kernel/smpcommon.c b/arch/x86/kernel/smpcommon.c
-index 3449064d141a5010d69ea5702f1b2198a7548e73..a93434b624b0886ab6dc0ab1b9ca875a9582e414 100644
---- a/arch/x86/kernel/smpcommon.c
-+++ b/arch/x86/kernel/smpcommon.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/smpcommon.c linux-2.6.26.3/arch/x86/kernel/smpcommon.c
+--- linux-2.6.26.3/arch/x86/kernel/smpcommon.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/smpcommon.c	2008-08-09 12:03:28.000000000 -0400
@@ -6515,2 +6323 @@
- 
--	gdt[GDT_ENTRY_PERCPU].s = 1;
++
@@ -6519,2 +6326 @@
- 
--	per_cpu(this_cpu_off, cpu) = __per_cpu_offset[cpu];
++
@@ -6531 +6337,2 @@
-+
+ 
+-	gdt[GDT_ENTRY_PERCPU].s = 1;
@@ -6533 +6340,2 @@
-+
+ 
+-	per_cpu(this_cpu_off, cpu) = __per_cpu_offset[cpu];
@@ -6538,5 +6346,4 @@
-diff --git a/arch/x86/kernel/step.c b/arch/x86/kernel/step.c
-index 92c20fee6781b5f5d419335e68eee8361b7f960d..a18073b7bf34b70d35baf3c18f195a71effad335 100644
---- a/arch/x86/kernel/step.c
-+++ b/arch/x86/kernel/step.c
-@@ -23,22 +23,20 @@ unsigned long convert_ip_to_linear(struct task_struct *child, struct pt_regs *re
+diff -urNp linux-2.6.26.3/arch/x86/kernel/step.c linux-2.6.26.3/arch/x86/kernel/step.c
+--- linux-2.6.26.3/arch/x86/kernel/step.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/step.c	2008-08-09 12:03:28.000000000 -0400
+@@ -23,22 +23,20 @@ unsigned long convert_ip_to_linear(struc
@@ -6572 +6379 @@
-@@ -54,6 +52,9 @@ static int is_setting_trap_flag(struct task_struct *child, struct pt_regs *regs)
+@@ -54,6 +52,9 @@ static int is_setting_trap_flag(struct t
@@ -6582,4 +6389,11 @@
-diff --git a/arch/x86/kernel/sys_i386_32.c b/arch/x86/kernel/sys_i386_32.c
-index d2ab52cc1d6b17fa5ff72ef4e5b6111acc6903f5..df547dde3c92aea076eda795588d35690c99db5c 100644
---- a/arch/x86/kernel/sys_i386_32.c
-+++ b/arch/x86/kernel/sys_i386_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/syscall_table_32.S linux-2.6.26.3/arch/x86/kernel/syscall_table_32.S
+--- linux-2.6.26.3/arch/x86/kernel/syscall_table_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/syscall_table_32.S	2008-08-09 12:03:28.000000000 -0400
+@@ -1,3 +1,4 @@
++.section .rodata,"a",@progbits
+ ENTRY(sys_call_table)
+ 	.long sys_restart_syscall	/* 0 - old "setup()" system call, used for restarting */
+ 	.long sys_exit
+diff -urNp linux-2.6.26.3/arch/x86/kernel/sys_i386_32.c linux-2.6.26.3/arch/x86/kernel/sys_i386_32.c
+--- linux-2.6.26.3/arch/x86/kernel/sys_i386_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/sys_i386_32.c	2008-08-09 12:03:28.000000000 -0400
@@ -6814,4 +6628,3 @@
-diff --git a/arch/x86/kernel/sys_x86_64.c b/arch/x86/kernel/sys_x86_64.c
-index 3b360ef33817c9b618e661f452e682a43dfe91bc..00b873a83e3f67f64d4dd15d4d844c2ab165d9c7 100644
---- a/arch/x86/kernel/sys_x86_64.c
-+++ b/arch/x86/kernel/sys_x86_64.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/sys_x86_64.c linux-2.6.26.3/arch/x86/kernel/sys_x86_64.c
+--- linux-2.6.26.3/arch/x86/kernel/sys_x86_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/sys_x86_64.c	2008-08-09 12:03:28.000000000 -0400
@@ -6829 +6642 @@
-@@ -65,7 +65,7 @@ static void find_start_end(unsigned long flags, unsigned long *begin,
+@@ -65,7 +65,7 @@ static void find_start_end(unsigned long
@@ -6838 +6651 @@
-@@ -82,11 +82,15 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -82,11 +82,15 @@ arch_get_unmapped_area(struct file *filp
@@ -6855 +6668 @@
-@@ -141,7 +145,7 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -141,7 +145,7 @@ arch_get_unmapped_area_topdown(struct fi
@@ -6864 +6677 @@
-@@ -154,6 +158,10 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -154,6 +158,10 @@ arch_get_unmapped_area_topdown(struct fi
@@ -6899,14 +6712,4 @@
-diff --git a/arch/x86/kernel/syscall_table_32.S b/arch/x86/kernel/syscall_table_32.S
-index adff5562f5fd4bbc40965ba8eb5f33d433f9f776..53bfb6cbf9aec58ddca2697c857f16b7402964ed 100644
---- a/arch/x86/kernel/syscall_table_32.S
-+++ b/arch/x86/kernel/syscall_table_32.S
-@@ -1,3 +1,4 @@
-+.section .rodata,"a",@progbits
- ENTRY(sys_call_table)
- 	.long sys_restart_syscall	/* 0 - old "setup()" system call, used for restarting */
- 	.long sys_exit
-diff --git a/arch/x86/kernel/time_32.c b/arch/x86/kernel/time_32.c
-index 2ff21f398934b049975a427e463b046e9226d079..5bf79853f0a3fcc30fc8a33cf425451466004d40 100644
---- a/arch/x86/kernel/time_32.c
-+++ b/arch/x86/kernel/time_32.c
-@@ -52,20 +52,30 @@ unsigned long profile_pc(struct pt_regs *regs)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/time_32.c linux-2.6.26.3/arch/x86/kernel/time_32.c
+--- linux-2.6.26.3/arch/x86/kernel/time_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/time_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -52,20 +52,30 @@ unsigned long profile_pc(struct pt_regs 
@@ -6944,4 +6747,3 @@
-diff --git a/arch/x86/kernel/tlb_32.c b/arch/x86/kernel/tlb_32.c
-index 9bb2363851af3e37d91045f5970f3d6316d0f9d9..73c8f4f1fc0260885031fae4bd8545a9ba79ddee 100644
---- a/arch/x86/kernel/tlb_32.c
-+++ b/arch/x86/kernel/tlb_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/tlb_32.c linux-2.6.26.3/arch/x86/kernel/tlb_32.c
+--- linux-2.6.26.3/arch/x86/kernel/tlb_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/tlb_32.c	2008-08-09 12:03:28.000000000 -0400
@@ -6957,5 +6759,4 @@
-diff --git a/arch/x86/kernel/tls.c b/arch/x86/kernel/tls.c
-index ab6bf375a3077e0e6052f07bff9c5c6a93742e45..30bc6ba7b7981fb312b2005d27eb4688910386b6 100644
---- a/arch/x86/kernel/tls.c
-+++ b/arch/x86/kernel/tls.c
-@@ -84,6 +84,11 @@ int do_set_thread_area(struct task_struct *p, int idx,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/tls.c linux-2.6.26.3/arch/x86/kernel/tls.c
+--- linux-2.6.26.3/arch/x86/kernel/tls.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/tls.c	2008-08-09 12:03:28.000000000 -0400
+@@ -84,6 +84,11 @@ int do_set_thread_area(struct task_struc
@@ -6973,4 +6774,3 @@
-diff --git a/arch/x86/kernel/traps_32.c b/arch/x86/kernel/traps_32.c
-index 08d752de4eee307779ba20b31c3b1e7c006daa62..81c1da6fb8d777491592b708216eaba56106dcc9 100644
---- a/arch/x86/kernel/traps_32.c
-+++ b/arch/x86/kernel/traps_32.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/traps_32.c linux-2.6.26.3/arch/x86/kernel/traps_32.c
+--- linux-2.6.26.3/arch/x86/kernel/traps_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/traps_32.c	2008-08-09 13:07:51.000000000 -0400
@@ -6992 +6792 @@
-@@ -339,22 +331,23 @@ void show_registers(struct pt_regs *regs)
+@@ -339,22 +331,23 @@ void show_registers(struct pt_regs *regs
@@ -7019 +6819 @@
-@@ -363,7 +356,7 @@ void show_registers(struct pt_regs *regs)
+@@ -363,7 +356,7 @@ void show_registers(struct pt_regs *regs
@@ -7036 +6836 @@
-@@ -488,7 +482,7 @@ void die(const char *str, struct pt_regs *regs, long err)
+@@ -488,7 +482,7 @@ void die(const char *str, struct pt_regs
@@ -7058 +6858 @@
-@@ -612,7 +612,7 @@ void __kprobes do_general_protection(struct pt_regs *regs, long error_code)
+@@ -612,7 +612,7 @@ void __kprobes do_general_protection(str
@@ -7067 +6867 @@
-@@ -647,9 +647,25 @@ void __kprobes do_general_protection(struct pt_regs *regs, long error_code)
+@@ -647,9 +647,25 @@ void __kprobes do_general_protection(str
@@ -7108 +6908 @@
-@@ -779,7 +802,7 @@ void notrace __kprobes die_nmi(struct pt_regs *regs, const char *msg)
+@@ -779,7 +802,7 @@ void notrace __kprobes die_nmi(struct pt
@@ -7117 +6917 @@
-@@ -941,7 +964,7 @@ void __kprobes do_debug(struct pt_regs *regs, long error_code)
+@@ -941,7 +964,7 @@ void __kprobes do_debug(struct pt_regs *
@@ -7126 +6926 @@
-@@ -1117,19 +1140,14 @@ void do_spurious_interrupt_bug(struct pt_regs *regs, long error_code)
+@@ -1117,19 +1140,14 @@ void do_spurious_interrupt_bug(struct pt
@@ -7149,5 +6949,4 @@
-diff --git a/arch/x86/kernel/traps_64.c b/arch/x86/kernel/traps_64.c
-index adff76ea97c4732de4b7766272c8b6ad26ace478..ae49e675cc65f8a9fa96825ddca619b952fb367a 100644
---- a/arch/x86/kernel/traps_64.c
-+++ b/arch/x86/kernel/traps_64.c
-@@ -669,6 +669,12 @@ static void __kprobes do_trap(int trapnr, int signr, char *str,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/traps_64.c linux-2.6.26.3/arch/x86/kernel/traps_64.c
+--- linux-2.6.26.3/arch/x86/kernel/traps_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/traps_64.c	2008-08-09 12:54:30.000000000 -0400
+@@ -669,6 +669,12 @@ static void __kprobes do_trap(int trapnr
@@ -7166,5 +6965,4 @@
-diff --git a/arch/x86/kernel/tsc_32.c b/arch/x86/kernel/tsc_32.c
-index 65b70637ad9796d8256b9305c4dfd4ed3c378e6d..73caa1d9d21e3cab00c28d8a8f8a40cd77cae7d3 100644
---- a/arch/x86/kernel/tsc_32.c
-+++ b/arch/x86/kernel/tsc_32.c
-@@ -353,7 +353,7 @@ static struct dmi_system_id __initdata bad_tsc_dmi_table[] = {
+diff -urNp linux-2.6.26.3/arch/x86/kernel/tsc_32.c linux-2.6.26.3/arch/x86/kernel/tsc_32.c
+--- linux-2.6.26.3/arch/x86/kernel/tsc_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/tsc_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -353,7 +353,7 @@ static struct dmi_system_id __initdata b
@@ -7179,5 +6977,4 @@
-diff --git a/arch/x86/kernel/vm86_32.c b/arch/x86/kernel/vm86_32.c
-index 38f566fa27d2b35c0e3b95382a38537745cbe53d..cd2a6c5a3e0dc101abe46b4d3d31c7128d1ffc67 100644
---- a/arch/x86/kernel/vm86_32.c
-+++ b/arch/x86/kernel/vm86_32.c
-@@ -147,7 +147,7 @@ struct pt_regs *save_v86_state(struct kernel_vm86_regs *regs)
+diff -urNp linux-2.6.26.3/arch/x86/kernel/vm86_32.c linux-2.6.26.3/arch/x86/kernel/vm86_32.c
+--- linux-2.6.26.3/arch/x86/kernel/vm86_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/vm86_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -147,7 +147,7 @@ struct pt_regs *save_v86_state(struct ke
@@ -7192 +6989 @@
-@@ -324,7 +324,7 @@ static void do_sys_vm86(struct kernel_vm86_struct *info, struct task_struct *tsk
+@@ -324,7 +324,7 @@ static void do_sys_vm86(struct kernel_vm
@@ -7201,5 +6998,4 @@
-diff --git a/arch/x86/kernel/vmi_32.c b/arch/x86/kernel/vmi_32.c
-index 956f38927aa7c5533cc41fd3c2ba0ea807ccb6dd..4efa1ad582820c481fee4d50902f41ad15fba039 100644
---- a/arch/x86/kernel/vmi_32.c
-+++ b/arch/x86/kernel/vmi_32.c
-@@ -101,18 +101,43 @@ static unsigned patch_internal(int call, unsigned len, void *insnbuf,
+diff -urNp linux-2.6.26.3/arch/x86/kernel/vmi_32.c linux-2.6.26.3/arch/x86/kernel/vmi_32.c
+--- linux-2.6.26.3/arch/x86/kernel/vmi_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/vmi_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -101,18 +101,43 @@ static unsigned patch_internal(int call,
@@ -7249 +7045 @@
-@@ -515,14 +540,14 @@ static void vmi_set_pud(pud_t *pudp, pud_t pudval)
+@@ -515,14 +540,14 @@ static void vmi_set_pud(pud_t *pudp, pud
@@ -7266 +7062 @@
-@@ -551,8 +576,8 @@ vmi_startup_ipi_hook(int phys_apicid, unsigned long start_eip,
+@@ -551,8 +576,8 @@ vmi_startup_ipi_hook(int phys_apicid, un
@@ -7277 +7073 @@
-@@ -747,12 +772,20 @@ static inline int __init activate_vmi(void)
+@@ -747,12 +772,20 @@ static inline int __init activate_vmi(vo
@@ -7298 +7094 @@
-@@ -943,6 +976,10 @@ static inline int __init activate_vmi(void)
+@@ -943,6 +976,10 @@ static inline int __init activate_vmi(vo
@@ -7309,4 +7105,3 @@
-diff --git a/arch/x86/kernel/vmlinux_32.lds.S b/arch/x86/kernel/vmlinux_32.lds.S
-index ce5ed083a1e905e463486e8f05e9125d2f41d157..6116eb449c1845b54faf1a19bdfcc9b20a457329 100644
---- a/arch/x86/kernel/vmlinux_32.lds.S
-+++ b/arch/x86/kernel/vmlinux_32.lds.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/vmlinux_32.lds.S linux-2.6.26.3/arch/x86/kernel/vmlinux_32.lds.S
+--- linux-2.6.26.3/arch/x86/kernel/vmlinux_32.lds.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/vmlinux_32.lds.S	2008-08-09 12:03:28.000000000 -0400
@@ -7353,2 +7148 @@
-+  . = LOAD_OFFSET + ____LOAD_PHYSICAL_ADDR;
- 
+-
@@ -7390 +7184,2 @@
--
++  . = LOAD_OFFSET + ____LOAD_PHYSICAL_ADDR;
+ 
@@ -7616,4 +7411,3 @@
-diff --git a/arch/x86/kernel/vmlinux_64.lds.S b/arch/x86/kernel/vmlinux_64.lds.S
-index fad3674b06a58f990cabab44bd61910f975a6682..ab6ecee95b296eec64ce211bd8465bc25cff3384 100644
---- a/arch/x86/kernel/vmlinux_64.lds.S
-+++ b/arch/x86/kernel/vmlinux_64.lds.S
+diff -urNp linux-2.6.26.3/arch/x86/kernel/vmlinux_64.lds.S linux-2.6.26.3/arch/x86/kernel/vmlinux_64.lds.S
+--- linux-2.6.26.3/arch/x86/kernel/vmlinux_64.lds.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/vmlinux_64.lds.S	2008-08-09 12:03:28.000000000 -0400
@@ -7737,4 +7531,3 @@
-diff --git a/arch/x86/kernel/vsyscall_64.c b/arch/x86/kernel/vsyscall_64.c
-index 61efa2f7d5645c804bba44bf524661133bc15374..e57fbf0b5700989d856b6b3d08f4413bc889c07d 100644
---- a/arch/x86/kernel/vsyscall_64.c
-+++ b/arch/x86/kernel/vsyscall_64.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/vsyscall_64.c linux-2.6.26.3/arch/x86/kernel/vsyscall_64.c
+--- linux-2.6.26.3/arch/x86/kernel/vsyscall_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/vsyscall_64.c	2008-08-09 12:03:28.000000000 -0400
@@ -7757 +7550 @@
-@@ -251,6 +251,11 @@ static void __cpuinit vsyscall_set_cpu(int cpu)
+@@ -251,6 +251,11 @@ static void __cpuinit vsyscall_set_cpu(i
@@ -7769 +7562 @@
-@@ -261,10 +266,20 @@ static void __cpuinit vsyscall_set_cpu(int cpu)
+@@ -261,10 +266,20 @@ static void __cpuinit vsyscall_set_cpu(i
@@ -7790,4 +7583,3 @@
-diff --git a/arch/x86/kernel/x8664_ksyms_64.c b/arch/x86/kernel/x8664_ksyms_64.c
-index f6c05d0410fb08717fe7f736320225bc476f0533..2f306a8268973bb531402dc7b8aa8cb14ebbd22a 100644
---- a/arch/x86/kernel/x8664_ksyms_64.c
-+++ b/arch/x86/kernel/x8664_ksyms_64.c
+diff -urNp linux-2.6.26.3/arch/x86/kernel/x8664_ksyms_64.c linux-2.6.26.3/arch/x86/kernel/x8664_ksyms_64.c
+--- linux-2.6.26.3/arch/x86/kernel/x8664_ksyms_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kernel/x8664_ksyms_64.c	2008-08-09 12:03:34.000000000 -0400
@@ -7803,5 +7595,4 @@
-diff --git a/arch/x86/kvm/svm.c b/arch/x86/kvm/svm.c
-index 7d6071d11eb89c8ee310024d907711e4c2038a38..59c06af194359f879705c55e1a4e219e82c0e92e 100644
---- a/arch/x86/kvm/svm.c
-+++ b/arch/x86/kvm/svm.c
-@@ -1464,7 +1464,19 @@ static void reload_tss(struct kvm_vcpu *vcpu)
+diff -urNp linux-2.6.26.3/arch/x86/kvm/svm.c linux-2.6.26.3/arch/x86/kvm/svm.c
+--- linux-2.6.26.3/arch/x86/kvm/svm.c	2008-08-09 13:05:25.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kvm/svm.c	2008-08-09 13:05:37.000000000 -0400
+@@ -1464,7 +1464,19 @@ static void reload_tss(struct kvm_vcpu *
@@ -7827,4 +7618,3 @@
-diff --git a/arch/x86/kvm/vmx.c b/arch/x86/kvm/vmx.c
-index 3ff39c1f9b034453c7330e4fbf2f39a097d3c9d4..9a4cdccd7a5717c51132266841366d78c5202a71 100644
---- a/arch/x86/kvm/vmx.c
-+++ b/arch/x86/kvm/vmx.c
+diff -urNp linux-2.6.26.3/arch/x86/kvm/vmx.c linux-2.6.26.3/arch/x86/kvm/vmx.c
+--- linux-2.6.26.3/arch/x86/kvm/vmx.c	2008-08-09 13:05:26.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kvm/vmx.c	2008-08-09 13:05:37.000000000 -0400
@@ -7855 +7645 @@
-@@ -2956,7 +2970,7 @@ static void vmx_vcpu_run(struct kvm_vcpu *vcpu, struct kvm_run *kvm_run)
+@@ -2956,7 +2970,7 @@ static void vmx_vcpu_run(struct kvm_vcpu
@@ -7864,5 +7654,4 @@
-diff --git a/arch/x86/kvm/x86.c b/arch/x86/kvm/x86.c
-index 8ab14ab105f0b0992ad9ac1b9a688489e617fc04..91a5d91ecffc24ef92a5e43fdf26d3759ed9fb04 100644
---- a/arch/x86/kvm/x86.c
-+++ b/arch/x86/kvm/x86.c
-@@ -63,34 +63,34 @@ static int kvm_dev_ioctl_get_supported_cpuid(struct kvm_cpuid2 *cpuid,
+diff -urNp linux-2.6.26.3/arch/x86/kvm/x86.c linux-2.6.26.3/arch/x86/kvm/x86.c
+--- linux-2.6.26.3/arch/x86/kvm/x86.c	2008-08-09 13:05:26.000000000 -0400
++++ linux-2.6.26.3/arch/x86/kvm/x86.c	2008-08-09 13:05:37.000000000 -0400
+@@ -63,34 +63,34 @@ static int kvm_dev_ioctl_get_supported_c
@@ -7931 +7720 @@
-@@ -1254,7 +1254,7 @@ static int kvm_vcpu_ioctl_set_lapic(struct kvm_vcpu *vcpu,
+@@ -1254,7 +1254,7 @@ static int kvm_vcpu_ioctl_set_lapic(stru
@@ -7940,4 +7729,3 @@
-diff --git a/arch/x86/lib/checksum_32.S b/arch/x86/lib/checksum_32.S
-index adbccd0bbb78a1b4905be30ce7ddea89fad4038f..d9f12e3ce0d09918703cea93ce0703692fca9923 100644
---- a/arch/x86/lib/checksum_32.S
-+++ b/arch/x86/lib/checksum_32.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/checksum_32.S linux-2.6.26.3/arch/x86/lib/checksum_32.S
+--- linux-2.6.26.3/arch/x86/lib/checksum_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/checksum_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -7954 +7742 @@
-@@ -304,9 +305,22 @@ unsigned int csum_partial_copy_generic (const char *src, char *dst,
+@@ -304,9 +305,22 @@ unsigned int csum_partial_copy_generic (
@@ -8189,4 +7977,3 @@
-diff --git a/arch/x86/lib/clear_page_64.S b/arch/x86/lib/clear_page_64.S
-index 9a10a78bb4a414867fa68099996c6cfb66f26d2e..5fd976d7799fd7e1878751fc43e76a327f6d1317 100644
---- a/arch/x86/lib/clear_page_64.S
-+++ b/arch/x86/lib/clear_page_64.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/clear_page_64.S linux-2.6.26.3/arch/x86/lib/clear_page_64.S
+--- linux-2.6.26.3/arch/x86/lib/clear_page_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/clear_page_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -8202,4 +7989,3 @@
-diff --git a/arch/x86/lib/copy_page_64.S b/arch/x86/lib/copy_page_64.S
-index 727a5d46d2fc0cfb6888053a698841fb6e9732f9..fd61ff497d6f315928c61173f48836f268585015 100644
---- a/arch/x86/lib/copy_page_64.S
-+++ b/arch/x86/lib/copy_page_64.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/copy_page_64.S linux-2.6.26.3/arch/x86/lib/copy_page_64.S
+--- linux-2.6.26.3/arch/x86/lib/copy_page_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/copy_page_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -8215,4 +8001,3 @@
-diff --git a/arch/x86/lib/copy_user_64.S b/arch/x86/lib/copy_user_64.S
-index ee1c3f635157b397e4fd70c0060b81e3ff3f34b1..4a7af99e0e67ab5a9a28b9701a1f12de8eb0a631 100644
---- a/arch/x86/lib/copy_user_64.S
-+++ b/arch/x86/lib/copy_user_64.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/copy_user_64.S linux-2.6.26.3/arch/x86/lib/copy_user_64.S
+--- linux-2.6.26.3/arch/x86/lib/copy_user_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/copy_user_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -8237,4 +8022,3 @@
-diff --git a/arch/x86/lib/getuser_32.S b/arch/x86/lib/getuser_32.S
-index 6d84b53f12a2f6a010eb6dfb78158daa3914695f..2f058d699200eea10b8357e27e052c0ee5897626 100644
---- a/arch/x86/lib/getuser_32.S
-+++ b/arch/x86/lib/getuser_32.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/getuser_32.S linux-2.6.26.3/arch/x86/lib/getuser_32.S
+--- linux-2.6.26.3/arch/x86/lib/getuser_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/getuser_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -8295,4 +8079,3 @@
-diff --git a/arch/x86/lib/memcpy_64.S b/arch/x86/lib/memcpy_64.S
-index c22981fa2f3a95240f3a4c99d00da41d1b7392ec..281e8b6f7c0a905ddd7a12cf33da085a40632dfc 100644
---- a/arch/x86/lib/memcpy_64.S
-+++ b/arch/x86/lib/memcpy_64.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/memcpy_64.S linux-2.6.26.3/arch/x86/lib/memcpy_64.S
+--- linux-2.6.26.3/arch/x86/lib/memcpy_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/memcpy_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -8308,4 +8091,3 @@
-diff --git a/arch/x86/lib/memset_64.S b/arch/x86/lib/memset_64.S
-index 2c5948116bd21731d4a85712fddd00d3943fd728..822cb0a78868a9441b2bef1f958e5db35052d5fa 100644
---- a/arch/x86/lib/memset_64.S
-+++ b/arch/x86/lib/memset_64.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/memset_64.S linux-2.6.26.3/arch/x86/lib/memset_64.S
+--- linux-2.6.26.3/arch/x86/lib/memset_64.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/memset_64.S	2008-08-09 12:03:28.000000000 -0400
@@ -8321,5 +8103,4 @@
-diff --git a/arch/x86/lib/mmx_32.c b/arch/x86/lib/mmx_32.c
-index c9f2d9ba8dd8c2da54b0bbd07c37be1d38aa49c4..e7fd2c0616b4032d359108d8b5559d5463a5447d 100644
---- a/arch/x86/lib/mmx_32.c
-+++ b/arch/x86/lib/mmx_32.c
-@@ -29,6 +29,7 @@ void *_mmx_memcpy(void *to, const void *from, size_t len)
+diff -urNp linux-2.6.26.3/arch/x86/lib/mmx_32.c linux-2.6.26.3/arch/x86/lib/mmx_32.c
+--- linux-2.6.26.3/arch/x86/lib/mmx_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/mmx_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -29,6 +29,7 @@ void *_mmx_memcpy(void *to, const void *
@@ -8333 +8114 @@
-@@ -39,44 +40,72 @@ void *_mmx_memcpy(void *to, const void *from, size_t len)
+@@ -39,44 +40,72 @@ void *_mmx_memcpy(void *to, const void *
@@ -8440 +8221 @@
-@@ -166,42 +196,70 @@ static void fast_copy_page(void *to, void *from)
+@@ -166,42 +196,70 @@ static void fast_copy_page(void *to, voi
@@ -8640,4 +8421,3 @@
-diff --git a/arch/x86/lib/putuser_32.S b/arch/x86/lib/putuser_32.S
-index f58fba109d188a2a19d4d18255df9f1e1b52271f..8351a0f5568401d3023f1b406ed4f4baef8fc3f2 100644
---- a/arch/x86/lib/putuser_32.S
-+++ b/arch/x86/lib/putuser_32.S
+diff -urNp linux-2.6.26.3/arch/x86/lib/putuser_32.S linux-2.6.26.3/arch/x86/lib/putuser_32.S
+--- linux-2.6.26.3/arch/x86/lib/putuser_32.S	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/putuser_32.S	2008-08-09 12:03:28.000000000 -0400
@@ -8713,5 +8493,4 @@
-diff --git a/arch/x86/lib/usercopy_32.c b/arch/x86/lib/usercopy_32.c
-index 24e60944971a60522d615bf9dc912851beb32b86..1e7c935dec8bef4b18a71b5eabfdf69b8eb57382 100644
---- a/arch/x86/lib/usercopy_32.c
-+++ b/arch/x86/lib/usercopy_32.c
-@@ -29,31 +29,38 @@ static inline int __movsl_is_ok(unsigned long a1, unsigned long a2, unsigned lon
+diff -urNp linux-2.6.26.3/arch/x86/lib/usercopy_32.c linux-2.6.26.3/arch/x86/lib/usercopy_32.c
+--- linux-2.6.26.3/arch/x86/lib/usercopy_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/lib/usercopy_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -29,31 +29,38 @@ static inline int __movsl_is_ok(unsigned
@@ -8792 +8571 @@
-@@ -107,7 +112,7 @@ strncpy_from_user(char *dst, const char __user *src, long count)
+@@ -107,7 +112,7 @@ strncpy_from_user(char *dst, const char 
@@ -8850 +8629 @@
-@@ -150,7 +161,7 @@ clear_user(void __user *to, unsigned long n)
+@@ -150,7 +161,7 @@ clear_user(void __user *to, unsigned lon
@@ -8869 +8648 @@
-@@ -193,14 +203,17 @@ long strnlen_user(const char __user *s, long n)
+@@ -193,14 +203,17 @@ long strnlen_user(const char __user *s, 
@@ -8888 +8667 @@
-@@ -212,7 +225,7 @@ long strnlen_user(const char __user *s, long n)
+@@ -212,7 +225,7 @@ long strnlen_user(const char __user *s, 
@@ -8910 +8689 @@
-@@ -232,36 +246,36 @@ __copy_user_intel(void __user *to, const void *from, unsigned long size)
+@@ -232,36 +246,36 @@ __copy_user_intel(void __user *to, const
@@ -8963 +8742 @@
-@@ -275,6 +289,8 @@ __copy_user_intel(void __user *to, const void *from, unsigned long size)
+@@ -275,6 +289,8 @@ __copy_user_intel(void __user *to, const
@@ -8972 +8751 @@
-@@ -321,7 +337,117 @@ __copy_user_intel(void __user *to, const void *from, unsigned long size)
+@@ -321,7 +337,117 @@ __copy_user_intel(void __user *to, const
@@ -9091 +8870 @@
-@@ -331,6 +457,7 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -331,6 +457,7 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9099 +8878 @@
-@@ -339,36 +466,36 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -339,36 +466,36 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9152 +8931 @@
-@@ -382,6 +509,8 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -382,6 +509,8 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9161 +8940 @@
-@@ -416,7 +545,7 @@ __copy_user_zeroing_intel(void *to, const void __user *from, unsigned long size)
+@@ -416,7 +545,7 @@ __copy_user_zeroing_intel(void *to, cons
@@ -9170 +8949 @@
-@@ -432,6 +561,7 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -432,6 +561,7 @@ static unsigned long __copy_user_zeroing
@@ -9178 +8957 @@
-@@ -440,36 +570,36 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -440,36 +570,36 @@ static unsigned long __copy_user_zeroing
@@ -9231 +9010 @@
-@@ -484,6 +614,8 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -484,6 +614,8 @@ static unsigned long __copy_user_zeroing
@@ -9240 +9019 @@
-@@ -518,7 +650,7 @@ static unsigned long __copy_user_zeroing_intel_nocache(void *to,
+@@ -518,7 +650,7 @@ static unsigned long __copy_user_zeroing
@@ -9249 +9028 @@
-@@ -529,6 +661,7 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -529,6 +661,7 @@ static unsigned long __copy_user_intel_n
@@ -9257 +9036 @@
-@@ -537,36 +670,36 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -537,36 +670,36 @@ static unsigned long __copy_user_intel_n
@@ -9310 +9089 @@
-@@ -581,6 +714,8 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -581,6 +714,8 @@ static unsigned long __copy_user_intel_n
@@ -9319 +9098 @@
-@@ -609,7 +744,7 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -609,7 +744,7 @@ static unsigned long __copy_user_intel_n
@@ -9328 +9107 @@
-@@ -622,90 +757,146 @@ static unsigned long __copy_user_intel_nocache(void *to,
+@@ -622,90 +757,146 @@ static unsigned long __copy_user_intel_n
@@ -9377,5 +9156 @@
-+static unsigned long
-+__generic_copy_to_user(void __user *to, const void *from, unsigned long size)
-+{
-+	int __d0, __d1, __d2;
- 
+-
@@ -9422,0 +9198,5 @@
++static unsigned long
++__generic_copy_to_user(void __user *to, const void *from, unsigned long size)
++{
++	int __d0, __d1, __d2;
++
@@ -9564 +9344 @@
-@@ -779,7 +970,7 @@ unsigned long __copy_from_user_ll(void *to, const void __user *from,
+@@ -779,7 +970,7 @@ unsigned long __copy_from_user_ll(void *
@@ -9573 +9353 @@
-@@ -790,9 +981,9 @@ unsigned long __copy_from_user_ll_nozero(void *to, const void __user *from,
+@@ -790,9 +981,9 @@ unsigned long __copy_from_user_ll_nozero
@@ -9585 +9365 @@
-@@ -802,12 +993,12 @@ unsigned long __copy_from_user_ll_nocache(void *to, const void __user *from,
+@@ -802,12 +993,12 @@ unsigned long __copy_from_user_ll_nocach
@@ -9601 +9381 @@
-@@ -817,12 +1008,12 @@ unsigned long __copy_from_user_ll_nocache_nozero(void *to, const void __user *fr
+@@ -817,12 +1008,12 @@ unsigned long __copy_from_user_ll_nocach
@@ -9617 +9397 @@
-@@ -871,8 +1062,35 @@ copy_from_user(void *to, const void __user *from, unsigned long n)
+@@ -871,8 +1062,35 @@ copy_from_user(void *to, const void __us
@@ -9654,5 +9434,4 @@
-diff --git a/arch/x86/mach-voyager/voyager_basic.c b/arch/x86/mach-voyager/voyager_basic.c
-index 46d6f8067690d9f37610718c9af1b924a3233e98..8486e085fed2981d4d87a767f02916a802e0f54d 100644
---- a/arch/x86/mach-voyager/voyager_basic.c
-+++ b/arch/x86/mach-voyager/voyager_basic.c
-@@ -123,7 +123,7 @@ int __init voyager_memory_detect(int region, __u32 * start, __u32 * length)
+diff -urNp linux-2.6.26.3/arch/x86/mach-voyager/voyager_basic.c linux-2.6.26.3/arch/x86/mach-voyager/voyager_basic.c
+--- linux-2.6.26.3/arch/x86/mach-voyager/voyager_basic.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mach-voyager/voyager_basic.c	2008-08-09 12:03:28.000000000 -0400
+@@ -123,7 +123,7 @@ int __init voyager_memory_detect(int reg
@@ -9667 +9446 @@
-@@ -138,7 +138,7 @@ int __init voyager_memory_detect(int region, __u32 * start, __u32 * length)
+@@ -138,7 +138,7 @@ int __init voyager_memory_detect(int reg
@@ -9676,4 +9455,3 @@
-diff --git a/arch/x86/mach-voyager/voyager_smp.c b/arch/x86/mach-voyager/voyager_smp.c
-index 8acbf0cdf1a5fb8eb4d75e1d57905104b23cce14..9b6c9bcfa3437506114413da4dca2213da351b8a 100644
---- a/arch/x86/mach-voyager/voyager_smp.c
-+++ b/arch/x86/mach-voyager/voyager_smp.c
+diff -urNp linux-2.6.26.3/arch/x86/mach-voyager/voyager_smp.c linux-2.6.26.3/arch/x86/mach-voyager/voyager_smp.c
+--- linux-2.6.26.3/arch/x86/mach-voyager/voyager_smp.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mach-voyager/voyager_smp.c	2008-08-09 12:03:28.000000000 -0400
@@ -9719,4 +9497,3 @@
-diff --git a/arch/x86/mm/extable.c b/arch/x86/mm/extable.c
-index 7e8db53528a7618820bd338ccaaf1039a14f241f..852a44c74162202627f28b4f797b34a3ea7edc34 100644
---- a/arch/x86/mm/extable.c
-+++ b/arch/x86/mm/extable.c
+diff -urNp linux-2.6.26.3/arch/x86/mm/extable.c linux-2.6.26.3/arch/x86/mm/extable.c
+--- linux-2.6.26.3/arch/x86/mm/extable.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/extable.c	2008-08-09 12:03:28.000000000 -0400
@@ -9787,4 +9564,3 @@
-diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
-index 8bcb6f40ccb6c61b762fac7def5c26a8eb01ba4b..2b5ff2ab5790aabbc5488d0da432539111d9c164 100644
---- a/arch/x86/mm/fault.c
-+++ b/arch/x86/mm/fault.c
+diff -urNp linux-2.6.26.3/arch/x86/mm/fault.c linux-2.6.26.3/arch/x86/mm/fault.c
+--- linux-2.6.26.3/arch/x86/mm/fault.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/fault.c	2008-08-09 13:07:51.000000000 -0400
@@ -9808 +9584 @@
-@@ -55,11 +58,7 @@ static inline int notify_page_fault(struct pt_regs *regs)
+@@ -55,11 +58,7 @@ static inline int notify_page_fault(stru
@@ -9851 +9627 @@
-@@ -343,7 +366,7 @@ static int is_errata93(struct pt_regs *regs, unsigned long address)
+@@ -343,7 +366,7 @@ static int is_errata93(struct pt_regs *r
@@ -9860 +9636 @@
-@@ -380,17 +403,32 @@ static void show_fault_oops(struct pt_regs *regs, unsigned long error_code,
+@@ -380,17 +403,32 @@ static void show_fault_oops(struct pt_re
@@ -9895 +9671 @@
-@@ -583,13 +621,22 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -583,13 +621,22 @@ void __kprobes do_page_fault(struct pt_r
@@ -9919 +9695 @@
-@@ -599,9 +646,6 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -599,9 +646,6 @@ void __kprobes do_page_fault(struct pt_r
@@ -9929 +9705 @@
-@@ -652,7 +696,7 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -652,7 +696,7 @@ void __kprobes do_page_fault(struct pt_r
@@ -9938 +9714 @@
-@@ -665,13 +709,13 @@ void __kprobes do_page_fault(struct pt_regs *regs, unsigned long error_code)
+@@ -665,13 +709,13 @@ void __kprobes do_page_fault(struct pt_r
@@ -10336,5 +10112,4 @@
-diff --git a/arch/x86/mm/highmem_32.c b/arch/x86/mm/highmem_32.c
-index 165c871ba9af0211e0c939e0bc2212750d4bf39f..5c44ca0366b1616aaee88d4a1fc15bc2f7df519a 100644
---- a/arch/x86/mm/highmem_32.c
-+++ b/arch/x86/mm/highmem_32.c
-@@ -74,6 +74,10 @@ void *kmap_atomic_prot(struct page *page, enum km_type type, pgprot_t prot)
+diff -urNp linux-2.6.26.3/arch/x86/mm/highmem_32.c linux-2.6.26.3/arch/x86/mm/highmem_32.c
+--- linux-2.6.26.3/arch/x86/mm/highmem_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/highmem_32.c	2008-08-09 12:03:28.000000000 -0400
+@@ -74,6 +74,10 @@ void *kmap_atomic_prot(struct page *page
@@ -10351 +10126 @@
-@@ -85,7 +89,17 @@ void *kmap_atomic_prot(struct page *page, enum km_type type, pgprot_t prot)
+@@ -85,7 +89,17 @@ void *kmap_atomic_prot(struct page *page
@@ -10369 +10144 @@
-@@ -101,15 +115,29 @@ void kunmap_atomic(void *kvaddr, enum km_type type)
+@@ -101,15 +115,29 @@ void kunmap_atomic(void *kvaddr, enum km
@@ -10401 +10176 @@
-@@ -128,11 +156,25 @@ void *kmap_atomic_pfn(unsigned long pfn, enum km_type type)
+@@ -128,11 +156,25 @@ void *kmap_atomic_pfn(unsigned long pfn,
@@ -10427,5 +10202,4 @@
-diff --git a/arch/x86/mm/hugetlbpage.c b/arch/x86/mm/hugetlbpage.c
-index 0b3d567e686df15c1b042deb388091ab78a6ae25..1ea737e22a158b3ec19e4b7d1a8d7fcee6deb9cb 100644
---- a/arch/x86/mm/hugetlbpage.c
-+++ b/arch/x86/mm/hugetlbpage.c
-@@ -230,13 +230,18 @@ static unsigned long hugetlb_get_unmapped_area_bottomup(struct file *file,
+diff -urNp linux-2.6.26.3/arch/x86/mm/hugetlbpage.c linux-2.6.26.3/arch/x86/mm/hugetlbpage.c
+--- linux-2.6.26.3/arch/x86/mm/hugetlbpage.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/hugetlbpage.c	2008-08-09 12:03:28.000000000 -0400
+@@ -230,13 +230,18 @@ static unsigned long hugetlb_get_unmappe
@@ -10471 +10245 @@
-@@ -272,9 +277,8 @@ static unsigned long hugetlb_get_unmapped_area_topdown(struct file *file,
+@@ -272,9 +277,8 @@ static unsigned long hugetlb_get_unmappe
@@ -10482 +10256 @@
-@@ -284,7 +288,7 @@ static unsigned long hugetlb_get_unmapped_area_topdown(struct file *file,
+@@ -284,7 +288,7 @@ static unsigned long hugetlb_get_unmappe
@@ -10537 +10311 @@
-@@ -361,10 +370,17 @@ hugetlb_get_unmapped_area(struct file *file, unsigned long addr,
+@@ -361,10 +370,17 @@ hugetlb_get_unmapped_area(struct file *f
@@ -10556 +10330 @@
-@@ -376,7 +392,7 @@ hugetlb_get_unmapped_area(struct file *file, unsigned long addr,
+@@ -376,7 +392,7 @@ hugetlb_get_unmapped_area(struct file *f
@@ -10565,4 +10339,3 @@
-diff --git a/arch/x86/mm/init_32.c b/arch/x86/mm/init_32.c
-index ec30d10154b657a63ab07b5e25b4298c10f4aabe..facaac85b53dfc1613d0a69c76969aea5f90e436 100644
---- a/arch/x86/mm/init_32.c
-+++ b/arch/x86/mm/init_32.c
+diff -urNp linux-2.6.26.3/arch/x86/mm/init_32.c linux-2.6.26.3/arch/x86/mm/init_32.c
+--- linux-2.6.26.3/arch/x86/mm/init_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/init_32.c	2008-08-09 12:54:30.000000000 -0400
@@ -10577 +10350 @@
-@@ -58,32 +59,6 @@ unsigned long highstart_pfn, highend_pfn;
+@@ -58,32 +59,6 @@ unsigned long highstart_pfn, highend_pfn
@@ -10610 +10383 @@
-@@ -101,7 +76,11 @@ static pte_t * __init one_page_table_init(pmd_t *pmd)
+@@ -101,7 +76,11 @@ static pte_t * __init one_page_table_ini
@@ -10622 +10395 @@
-@@ -123,6 +102,7 @@ page_table_range_init(unsigned long start, unsigned long end, pgd_t *pgd_base)
+@@ -123,6 +102,7 @@ page_table_range_init(unsigned long star
@@ -10630 +10403 @@
-@@ -131,8 +111,13 @@ page_table_range_init(unsigned long start, unsigned long end, pgd_t *pgd_base)
+@@ -131,8 +111,13 @@ page_table_range_init(unsigned long star
@@ -10646 +10419 @@
-@@ -143,11 +128,23 @@ page_table_range_init(unsigned long start, unsigned long end, pgd_t *pgd_base)
+@@ -143,11 +128,23 @@ page_table_range_init(unsigned long star
@@ -10674 +10447 @@
-@@ -157,9 +154,10 @@ static inline int is_kernel_text(unsigned long addr)
+@@ -157,9 +154,10 @@ static inline int is_kernel_text(unsigne
@@ -10686 +10459 @@
-@@ -167,15 +165,18 @@ static void __init kernel_physical_mapping_init(pgd_t *pgd_base)
+@@ -167,15 +165,18 @@ static void __init kernel_physical_mappi
@@ -10710 +10483 @@
-@@ -187,14 +188,9 @@ static void __init kernel_physical_mapping_init(pgd_t *pgd_base)
+@@ -187,14 +188,9 @@ static void __init kernel_physical_mappi
@@ -10726 +10499 @@
-@@ -207,10 +203,10 @@ static void __init kernel_physical_mapping_init(pgd_t *pgd_base)
+@@ -207,10 +203,10 @@ static void __init kernel_physical_mappi
@@ -10739 +10512 @@
-@@ -239,7 +235,9 @@ static inline int page_kills_ppro(unsigned long pagenr)
+@@ -239,7 +235,9 @@ static inline int page_kills_ppro(unsign
@@ -10750 +10523 @@
-@@ -320,10 +318,10 @@ static void __init set_highmem_pages_init(int bad_ppro)
+@@ -320,10 +318,10 @@ static void __init set_highmem_pages_ini
@@ -10763 +10536 @@
-@@ -345,7 +343,7 @@ void __init native_pagetable_setup_start(pgd_t *base)
+@@ -345,7 +343,7 @@ void __init native_pagetable_setup_start
@@ -10835,0 +10609,3 @@
+-
+-	if (cpu_has_pae && (cpuid_eax(0x80000000) > 0x80000001)) {
+-		cpuid(0x80000001, &v[0], &v[1], &v[2], &v[3]);
@@ -10839,3 +10614,0 @@
--	if (cpu_has_pae && (cpuid_eax(0x80000000) > 0x80000001)) {
--		cpuid(0x80000001, &v[0], &v[1], &v[2], &v[3]);
--
@@ -10879 +10652 @@
-@@ -773,6 +762,46 @@ void free_init_pages(char *what, unsigned long begin, unsigned long end)
+@@ -773,6 +762,46 @@ void free_init_pages(char *what, unsigne
@@ -10926,5 +10699,4 @@
-diff --git a/arch/x86/mm/init_64.c b/arch/x86/mm/init_64.c
-index 7b27710ce3b70aa6f39c9d7c60e75ac90cd2c43d..e4e83b4870f9daabbb158adefc35fb3912a356d3 100644
---- a/arch/x86/mm/init_64.c
-+++ b/arch/x86/mm/init_64.c
-@@ -143,6 +143,10 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+diff -urNp linux-2.6.26.3/arch/x86/mm/init_64.c linux-2.6.26.3/arch/x86/mm/init_64.c
+--- linux-2.6.26.3/arch/x86/mm/init_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/init_64.c	2008-08-09 12:54:30.000000000 -0400
+@@ -143,6 +143,10 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -10941 +10713 @@
-@@ -154,7 +158,7 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+@@ -154,7 +158,7 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -10950 +10722 @@
-@@ -164,7 +168,7 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+@@ -164,7 +168,7 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -10959 +10731 @@
-@@ -176,8 +180,17 @@ set_pte_phys(unsigned long vaddr, unsigned long phys, pgprot_t prot)
+@@ -176,8 +180,17 @@ set_pte_phys(unsigned long vaddr, unsign
@@ -10977 +10749 @@
-@@ -667,7 +680,9 @@ EXPORT_SYMBOL_GPL(memory_add_physaddr_to_nid);
+@@ -667,7 +680,9 @@ EXPORT_SYMBOL_GPL(memory_add_physaddr_to
@@ -10988 +10760 @@
-@@ -755,6 +770,39 @@ void free_init_pages(char *what, unsigned long begin, unsigned long end)
+@@ -755,6 +770,39 @@ void free_init_pages(char *what, unsigne
@@ -11028 +10800 @@
-@@ -913,7 +961,7 @@ int in_gate_area_no_task(unsigned long addr)
+@@ -913,7 +961,7 @@ int in_gate_area_no_task(unsigned long a
@@ -11037,5 +10809,4 @@
-diff --git a/arch/x86/mm/ioremap.c b/arch/x86/mm/ioremap.c
-index d1b867101e5f01e74d296e52cdbd0d4801dd43e5..65e07515b9a707fa92d577049f82ebc8f677109c 100644
---- a/arch/x86/mm/ioremap.c
-+++ b/arch/x86/mm/ioremap.c
-@@ -213,6 +213,8 @@ static void __iomem *__ioremap_caller(resource_size_t phys_addr,
+diff -urNp linux-2.6.26.3/arch/x86/mm/ioremap.c linux-2.6.26.3/arch/x86/mm/ioremap.c
+--- linux-2.6.26.3/arch/x86/mm/ioremap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/ioremap.c	2008-08-09 12:03:29.000000000 -0400
+@@ -213,6 +213,8 @@ static void __iomem *__ioremap_caller(re
@@ -11050,4 +10821,3 @@
-diff --git a/arch/x86/mm/mmap.c b/arch/x86/mm/mmap.c
-index 56fe7124fbec932c0b14f8d9dbe9b448fcdd88b7..b2e24541e1cfbb3b535e3d9f80c28eb98febe262 100644
---- a/arch/x86/mm/mmap.c
-+++ b/arch/x86/mm/mmap.c
+diff -urNp linux-2.6.26.3/arch/x86/mm/mmap.c linux-2.6.26.3/arch/x86/mm/mmap.c
+--- linux-2.6.26.3/arch/x86/mm/mmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/mmap.c	2008-08-09 12:03:29.000000000 -0400
@@ -11109 +10879 @@
-@@ -112,11 +125,23 @@ static unsigned long mmap_legacy_base(void)
+@@ -112,11 +125,23 @@ static unsigned long mmap_legacy_base(vo
@@ -11135,4 +10905,3 @@
-diff --git a/arch/x86/mm/numa_64.c b/arch/x86/mm/numa_64.c
-index c5066d519e5de4cf73dec673f6d51c2ca131075b..190ad34052f0abe4cc5cb760acb6e3593ac18dc7 100644
---- a/arch/x86/mm/numa_64.c
-+++ b/arch/x86/mm/numa_64.c
+diff -urNp linux-2.6.26.3/arch/x86/mm/numa_64.c linux-2.6.26.3/arch/x86/mm/numa_64.c
+--- linux-2.6.26.3/arch/x86/mm/numa_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/numa_64.c	2008-08-09 12:03:29.000000000 -0400
@@ -11148,4 +10917,3 @@
-diff --git a/arch/x86/mm/pageattr.c b/arch/x86/mm/pageattr.c
-index 60bcb5b6a37ef0130fb08da8ef38db58fd37910a..ba371d41cc9848b39ede968088f69064e4f0c617 100644
---- a/arch/x86/mm/pageattr.c
-+++ b/arch/x86/mm/pageattr.c
+diff -urNp linux-2.6.26.3/arch/x86/mm/pageattr.c linux-2.6.26.3/arch/x86/mm/pageattr.c
+--- linux-2.6.26.3/arch/x86/mm/pageattr.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/pageattr.c	2008-08-09 12:03:29.000000000 -0400
@@ -11160 +10928 @@
-@@ -172,7 +173,7 @@ static inline pgprot_t static_protections(pgprot_t prot, unsigned long address,
+@@ -172,7 +173,7 @@ static inline pgprot_t static_protection
@@ -11169 +10937 @@
-@@ -233,8 +234,20 @@ pte_t *lookup_address(unsigned long address, unsigned int *level)
+@@ -233,8 +234,20 @@ pte_t *lookup_address(unsigned long addr
@@ -11190,5 +10958,4 @@
-diff --git a/arch/x86/mm/pat.c b/arch/x86/mm/pat.c
-index 06b7a1c90fb89e43eadd396592cbf6625080020b..22e5c01260f02675062e65286f9a37a86e6928c0 100644
---- a/arch/x86/mm/pat.c
-+++ b/arch/x86/mm/pat.c
-@@ -471,7 +471,7 @@ pgprot_t phys_mem_access_prot(struct file *file, unsigned long pfn,
+diff -urNp linux-2.6.26.3/arch/x86/mm/pat.c linux-2.6.26.3/arch/x86/mm/pat.c
+--- linux-2.6.26.3/arch/x86/mm/pat.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/pat.c	2008-08-09 12:03:29.000000000 -0400
+@@ -471,7 +471,7 @@ pgprot_t phys_mem_access_prot(struct fil
@@ -11203,5 +10970,4 @@
-diff --git a/arch/x86/mm/pgtable_32.c b/arch/x86/mm/pgtable_32.c
-index 369cf065b6a48f78f9870ddaf9f27e59b6980c0c..7c26b730ddd47478d155f97cb13c3aa5dbdeaffe 100644
---- a/arch/x86/mm/pgtable_32.c
-+++ b/arch/x86/mm/pgtable_32.c
-@@ -78,6 +78,10 @@ static void set_pte_pfn(unsigned long vaddr, unsigned long pfn, pgprot_t flags)
+diff -urNp linux-2.6.26.3/arch/x86/mm/pgtable_32.c linux-2.6.26.3/arch/x86/mm/pgtable_32.c
+--- linux-2.6.26.3/arch/x86/mm/pgtable_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/mm/pgtable_32.c	2008-08-09 12:03:29.000000000 -0400
+@@ -78,6 +78,10 @@ static void set_pte_pfn(unsigned long va
@@ -11218 +10984 @@
-@@ -94,11 +98,20 @@ static void set_pte_pfn(unsigned long vaddr, unsigned long pfn, pgprot_t flags)
+@@ -94,11 +98,20 @@ static void set_pte_pfn(unsigned long va
@@ -11239,5 +11005,4 @@
-diff --git a/arch/x86/oprofile/backtrace.c b/arch/x86/oprofile/backtrace.c
-index e2095cba409f200b5b25e9b5bcdbce0ed6288492..0c30e6b5f6d8e178dc2f3dd3c5f3a04c10ae3e5a 100644
---- a/arch/x86/oprofile/backtrace.c
-+++ b/arch/x86/oprofile/backtrace.c
-@@ -37,7 +37,7 @@ static void backtrace_address(void *data, unsigned long addr, int reliable)
+diff -urNp linux-2.6.26.3/arch/x86/oprofile/backtrace.c linux-2.6.26.3/arch/x86/oprofile/backtrace.c
+--- linux-2.6.26.3/arch/x86/oprofile/backtrace.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/oprofile/backtrace.c	2008-08-09 12:03:29.000000000 -0400
+@@ -37,7 +37,7 @@ static void backtrace_address(void *data
@@ -11252 +11017 @@
-@@ -79,7 +79,7 @@ x86_backtrace(struct pt_regs * const regs, unsigned int depth)
+@@ -79,7 +79,7 @@ x86_backtrace(struct pt_regs * const reg
@@ -11261,5 +11026,4 @@
-diff --git a/arch/x86/oprofile/op_model_p4.c b/arch/x86/oprofile/op_model_p4.c
-index 56b4757a1f4706cef329fac43c38e71fcd491bd6..8b22622e94ca9e96d47dd16b743bccdc7902e424 100644
---- a/arch/x86/oprofile/op_model_p4.c
-+++ b/arch/x86/oprofile/op_model_p4.c
-@@ -47,7 +47,7 @@ static inline void setup_num_counters(void)
+diff -urNp linux-2.6.26.3/arch/x86/oprofile/op_model_p4.c linux-2.6.26.3/arch/x86/oprofile/op_model_p4.c
+--- linux-2.6.26.3/arch/x86/oprofile/op_model_p4.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/oprofile/op_model_p4.c	2008-08-09 12:03:29.000000000 -0400
+@@ -47,7 +47,7 @@ static inline void setup_num_counters(vo
@@ -11274,5 +11038,4 @@
-diff --git a/arch/x86/pci/common.c b/arch/x86/pci/common.c
-index 6e64aaf00d1dd9473fff8cfd0e6e09074a31443c..c674a1b0a9451c11d2aa9bb0581271fa6bf9234b 100644
---- a/arch/x86/pci/common.c
-+++ b/arch/x86/pci/common.c
-@@ -342,7 +342,7 @@ static struct dmi_system_id __devinitdata pciprobe_dmi_table[] = {
+diff -urNp linux-2.6.26.3/arch/x86/pci/common.c linux-2.6.26.3/arch/x86/pci/common.c
+--- linux-2.6.26.3/arch/x86/pci/common.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/pci/common.c	2008-08-09 12:03:29.000000000 -0400
+@@ -342,7 +342,7 @@ static struct dmi_system_id __devinitdat
@@ -11287,4 +11050,3 @@
-diff --git a/arch/x86/pci/early.c b/arch/x86/pci/early.c
-index 42df4b6606dfdbc6f21d2cce0cbb6e8ae3e3ea42..af209b0b2463f0e366242d0b253fd92a1f649ca3 100644
---- a/arch/x86/pci/early.c
-+++ b/arch/x86/pci/early.c
+diff -urNp linux-2.6.26.3/arch/x86/pci/early.c linux-2.6.26.3/arch/x86/pci/early.c
+--- linux-2.6.26.3/arch/x86/pci/early.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/pci/early.c	2008-08-09 12:03:29.000000000 -0400
@@ -11300,5 +11062,4 @@
-diff --git a/arch/x86/pci/fixup.c b/arch/x86/pci/fixup.c
-index ff3a6a33634231514c945a66f15328a6a8ce534a..9b0414be63d5dedd6fd838f55bf904131626a56a 100644
---- a/arch/x86/pci/fixup.c
-+++ b/arch/x86/pci/fixup.c
-@@ -364,7 +364,7 @@ static struct dmi_system_id __devinitdata msi_k8t_dmi_table[] = {
+diff -urNp linux-2.6.26.3/arch/x86/pci/fixup.c linux-2.6.26.3/arch/x86/pci/fixup.c
+--- linux-2.6.26.3/arch/x86/pci/fixup.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/pci/fixup.c	2008-08-09 12:03:29.000000000 -0400
+@@ -364,7 +364,7 @@ static struct dmi_system_id __devinitdat
@@ -11313 +11074 @@
-@@ -435,7 +435,7 @@ static struct dmi_system_id __devinitdata toshiba_ohci1394_dmi_table[] = {
+@@ -435,7 +435,7 @@ static struct dmi_system_id __devinitdat
@@ -11322,5 +11083,4 @@
-diff --git a/arch/x86/pci/irq.c b/arch/x86/pci/irq.c
-index ca8df9c260bc0d9093b37f4a5f3b679a6259dcc9..c36c52f109400b33fb267fedaa4dff5e31fa4b4f 100644
---- a/arch/x86/pci/irq.c
-+++ b/arch/x86/pci/irq.c
-@@ -542,7 +542,7 @@ static __init int intel_router_probe(struct irq_router *r, struct pci_dev *route
+diff -urNp linux-2.6.26.3/arch/x86/pci/irq.c linux-2.6.26.3/arch/x86/pci/irq.c
+--- linux-2.6.26.3/arch/x86/pci/irq.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/pci/irq.c	2008-08-09 12:03:29.000000000 -0400
+@@ -542,7 +542,7 @@ static __init int intel_router_probe(str
@@ -11335 +11095 @@
-@@ -1115,7 +1115,7 @@ static struct dmi_system_id __initdata pciirq_dmi_table[] = {
+@@ -1115,7 +1115,7 @@ static struct dmi_system_id __initdata p
@@ -11344,4 +11104,3 @@
-diff --git a/arch/x86/pci/pcbios.c b/arch/x86/pci/pcbios.c
-index 37472fc6f72949b2d54910702962f7361e12bed6..de5375a461b452538923b9713cd222240da7727d 100644
---- a/arch/x86/pci/pcbios.c
-+++ b/arch/x86/pci/pcbios.c
+diff -urNp linux-2.6.26.3/arch/x86/pci/pcbios.c linux-2.6.26.3/arch/x86/pci/pcbios.c
+--- linux-2.6.26.3/arch/x86/pci/pcbios.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/pci/pcbios.c	2008-08-09 12:03:29.000000000 -0400
@@ -11510 +11269 @@
-@@ -166,7 +239,10 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -166,7 +239,10 @@ static int pci_bios_read(unsigned int se
@@ -11522 +11281 @@
-@@ -175,7 +251,8 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -175,7 +251,8 @@ static int pci_bios_read(unsigned int se
@@ -11532 +11291 @@
-@@ -183,7 +260,10 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -183,7 +260,10 @@ static int pci_bios_read(unsigned int se
@@ -11544 +11303 @@
-@@ -192,7 +272,8 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -192,7 +272,8 @@ static int pci_bios_read(unsigned int se
@@ -11554 +11313 @@
-@@ -200,7 +281,10 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -200,7 +281,10 @@ static int pci_bios_read(unsigned int se
@@ -11566 +11325 @@
-@@ -209,7 +293,8 @@ static int pci_bios_read(unsigned int seg, unsigned int bus,
+@@ -209,7 +293,8 @@ static int pci_bios_read(unsigned int se
@@ -11576 +11335 @@
-@@ -232,7 +317,10 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -232,7 +317,10 @@ static int pci_bios_write(unsigned int s
@@ -11588 +11347 @@
-@@ -241,10 +329,14 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -241,10 +329,14 @@ static int pci_bios_write(unsigned int s
@@ -11605 +11364 @@
-@@ -253,10 +345,14 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -253,10 +345,14 @@ static int pci_bios_write(unsigned int s
@@ -11622 +11381 @@
-@@ -265,7 +361,8 @@ static int pci_bios_write(unsigned int seg, unsigned int bus,
+@@ -265,7 +361,8 @@ static int pci_bios_write(unsigned int s
@@ -11632 +11391 @@
-@@ -369,10 +466,13 @@ struct irq_routing_table * pcibios_get_irq_routing_table(void)
+@@ -369,10 +466,13 @@ struct irq_routing_table * pcibios_get_i
@@ -11647 +11406 @@
-@@ -383,7 +483,8 @@ struct irq_routing_table * pcibios_get_irq_routing_table(void)
+@@ -383,7 +483,8 @@ struct irq_routing_table * pcibios_get_i
@@ -11657 +11416 @@
-@@ -407,7 +508,10 @@ int pcibios_set_irq_routing(struct pci_dev *dev, int pin, int irq)
+@@ -407,7 +508,10 @@ int pcibios_set_irq_routing(struct pci_d
@@ -11669 +11428 @@
-@@ -415,7 +519,8 @@ int pcibios_set_irq_routing(struct pci_dev *dev, int pin, int irq)
+@@ -415,7 +519,8 @@ int pcibios_set_irq_routing(struct pci_d
@@ -11679,4 +11438,3 @@
-diff --git a/arch/x86/power/cpu_32.c b/arch/x86/power/cpu_32.c
-index 7dc5d5cf50a2c85c2cad15c84f5e455abd42a34e..fd1c6b53404f639cdaae31a08bdd61a97aa24a1f 100644
---- a/arch/x86/power/cpu_32.c
-+++ b/arch/x86/power/cpu_32.c
+diff -urNp linux-2.6.26.3/arch/x86/power/cpu_32.c linux-2.6.26.3/arch/x86/power/cpu_32.c
+--- linux-2.6.26.3/arch/x86/power/cpu_32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/power/cpu_32.c	2008-08-09 12:03:29.000000000 -0400
@@ -11692,4 +11450,3 @@
-diff --git a/arch/x86/power/cpu_64.c b/arch/x86/power/cpu_64.c
-index 66bdfb591fd8b0adcc1d8181d3d1fcfb14f71808..c6a494a41d6e6637d683ef67fdc457380110b69f 100644
---- a/arch/x86/power/cpu_64.c
-+++ b/arch/x86/power/cpu_64.c
+diff -urNp linux-2.6.26.3/arch/x86/power/cpu_64.c linux-2.6.26.3/arch/x86/power/cpu_64.c
+--- linux-2.6.26.3/arch/x86/power/cpu_64.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/power/cpu_64.c	2008-08-09 12:03:29.000000000 -0400
@@ -11726,5 +11483,4 @@
-diff --git a/arch/x86/vdso/vdso32-setup.c b/arch/x86/vdso/vdso32-setup.c
-index cf058fecfceec989354ec17a3d681cae65315935..c08cb997c168d1cff5cefa0835e60385c149074f 100644
---- a/arch/x86/vdso/vdso32-setup.c
-+++ b/arch/x86/vdso/vdso32-setup.c
-@@ -239,7 +239,7 @@ static inline void map_compat_vdso(int map)
+diff -urNp linux-2.6.26.3/arch/x86/vdso/vdso32-setup.c linux-2.6.26.3/arch/x86/vdso/vdso32-setup.c
+--- linux-2.6.26.3/arch/x86/vdso/vdso32-setup.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/vdso/vdso32-setup.c	2008-08-09 12:03:29.000000000 -0400
+@@ -239,7 +239,7 @@ static inline void map_compat_vdso(int m
@@ -11748 +11504 @@
-@@ -341,7 +341,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm, int exstack)
+@@ -341,7 +341,7 @@ int arch_setup_additional_pages(struct l
@@ -11757 +11513 @@
-@@ -368,7 +368,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm, int exstack)
+@@ -368,7 +368,7 @@ int arch_setup_additional_pages(struct l
@@ -11800 +11556 @@
-@@ -429,7 +435,7 @@ struct vm_area_struct *get_gate_vma(struct task_struct *tsk)
+@@ -429,7 +435,7 @@ struct vm_area_struct *get_gate_vma(stru
@@ -11809,5 +11565,4 @@
-diff --git a/arch/x86/vdso/vma.c b/arch/x86/vdso/vma.c
-index 3fdd51497a838b801cc69dbd8408ea849da75546..f5398f223a794cc39627652740a92caaeb18f165 100644
---- a/arch/x86/vdso/vma.c
-+++ b/arch/x86/vdso/vma.c
-@@ -122,7 +122,7 @@ int arch_setup_additional_pages(struct linux_binprm *bprm, int exstack)
+diff -urNp linux-2.6.26.3/arch/x86/vdso/vma.c linux-2.6.26.3/arch/x86/vdso/vma.c
+--- linux-2.6.26.3/arch/x86/vdso/vma.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/vdso/vma.c	2008-08-09 12:03:29.000000000 -0400
+@@ -122,7 +122,7 @@ int arch_setup_additional_pages(struct l
@@ -11822,5 +11577,4 @@
-diff --git a/arch/x86/xen/enlighten.c b/arch/x86/xen/enlighten.c
-index f09c1c69c37a1498da07524c477e98bfc397ebe6..1288637ecda50eed2cea0c4c2ac1eb69ed965368 100644
---- a/arch/x86/xen/enlighten.c
-+++ b/arch/x86/xen/enlighten.c
-@@ -295,7 +295,7 @@ static void xen_set_ldt(const void *addr, unsigned entries)
+diff -urNp linux-2.6.26.3/arch/x86/xen/enlighten.c linux-2.6.26.3/arch/x86/xen/enlighten.c
+--- linux-2.6.26.3/arch/x86/xen/enlighten.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/xen/enlighten.c	2008-08-09 12:03:29.000000000 -0400
+@@ -295,7 +295,7 @@ static void xen_set_ldt(const void *addr
@@ -11835 +11589 @@
-@@ -310,7 +310,7 @@ static void xen_load_gdt(const struct desc_ptr *dtr)
+@@ -310,7 +310,7 @@ static void xen_load_gdt(const struct de
@@ -11844 +11598 @@
-@@ -403,7 +403,7 @@ static void xen_write_idt_entry(gate_desc *dt, int entrynum, const gate_desc *g)
+@@ -403,7 +403,7 @@ static void xen_write_idt_entry(gate_des
@@ -11853,5 +11607,4 @@
-diff --git a/arch/x86/xen/smp.c b/arch/x86/xen/smp.c
-index 94e69000f9826e80da488a694477ee329998d230..5f3de785eaa2a6be7a2e0c318699fc0c20a466be 100644
---- a/arch/x86/xen/smp.c
-+++ b/arch/x86/xen/smp.c
-@@ -154,7 +154,7 @@ void __init xen_smp_prepare_boot_cpu(void)
+diff -urNp linux-2.6.26.3/arch/x86/xen/smp.c linux-2.6.26.3/arch/x86/xen/smp.c
+--- linux-2.6.26.3/arch/x86/xen/smp.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/arch/x86/xen/smp.c	2008-08-09 12:03:29.000000000 -0400
+@@ -154,7 +154,7 @@ void __init xen_smp_prepare_boot_cpu(voi
@@ -11875 +11628 @@
-@@ -228,8 +228,8 @@ cpu_initialize_context(unsigned int cpu, struct task_struct *idle)
+@@ -228,8 +228,8 @@ cpu_initialize_context(unsigned int cpu,
@@ -11886 +11639 @@
-@@ -242,11 +242,11 @@ cpu_initialize_context(unsigned int cpu, struct task_struct *idle)
+@@ -242,11 +242,11 @@ cpu_initialize_context(unsigned int cpu,
@@ -11902,4 +11655,3 @@
-diff --git a/crypto/async_tx/async_tx.c b/crypto/async_tx/async_tx.c
-index c6e772fc5ccd93cd5caa9b3f63df5142b8002924..7635d540f5936d02de1cc4f6fb910452d5f56c83 100644
---- a/crypto/async_tx/async_tx.c
-+++ b/crypto/async_tx/async_tx.c
+diff -urNp linux-2.6.26.3/crypto/async_tx/async_tx.c linux-2.6.26.3/crypto/async_tx/async_tx.c
+--- linux-2.6.26.3/crypto/async_tx/async_tx.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/crypto/async_tx/async_tx.c	2008-08-09 12:03:29.000000000 -0400
@@ -11917,5 +11669,4 @@
-diff --git a/crypto/lrw.c b/crypto/lrw.c
-index 8ef664e3bcd9a90c93a5436e551549e72df1ff82..3fca060728ed1e82e267261d0582cb95c4cf18c3 100644
---- a/crypto/lrw.c
-+++ b/crypto/lrw.c
-@@ -54,7 +54,7 @@ static int setkey(struct crypto_tfm *parent, const u8 *key,
+diff -urNp linux-2.6.26.3/crypto/lrw.c linux-2.6.26.3/crypto/lrw.c
+--- linux-2.6.26.3/crypto/lrw.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/crypto/lrw.c	2008-08-09 12:03:29.000000000 -0400
+@@ -54,7 +54,7 @@ static int setkey(struct crypto_tfm *par
@@ -11930,11 +11681,84 @@
-diff --git a/drivers/acpi/blacklist.c b/drivers/acpi/blacklist.c
-index ea92bac42c53dd438fae0c82b2e310b8098f7dff..1d5a3bc511df70873079956154b14ba25efe709b 100644
---- a/drivers/acpi/blacklist.c
-+++ b/drivers/acpi/blacklist.c
-@@ -71,7 +71,7 @@ static struct acpi_blacklist_item acpi_blacklist[] __initdata = {
- 	{"IBM   ", "TP600E  ", 0x00000105, ACPI_SIG_DSDT, less_than_or_equal,
- 	 "Incorrect _ADR", 1},
- 
--	{""}
-+	{"", "", 0, 0, 0, all_versions, 0}
- };
+diff -urNp linux-2.6.26.3/Documentation/dontdiff linux-2.6.26.3/Documentation/dontdiff
+--- linux-2.6.26.3/Documentation/dontdiff	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/Documentation/dontdiff	2008-08-09 12:03:29.000000000 -0400
+@@ -3,6 +3,7 @@
+ *.bin
+ *.cpio
+ *.css
++*.dbg
+ *.dvi
+ *.eps
+ *.gif
+@@ -51,9 +52,14 @@ COPYING
+ CREDITS
+ CVS
+ ChangeSet
++GPATH
++GRTAGS
++GSYMS
++GTAGS
+ Image
+ Kerntypes
+ MODS.txt
++Module.markers
+ Module.symvers
+ PENDING
+ SCCS
+@@ -72,6 +78,7 @@ bbootsect
+ bin2c
+ binkernel.spec
+ bootsect
++bounds.h
+ bsetup
+ btfixupprep
+ build
+@@ -88,6 +95,7 @@ config_data.gz*
+ conmakehash
+ consolemap_deftbl.c*
+ crc32table.h*
++cpustr.h
+ cscope.*
+ defkeymap.c*
+ devlist.h*
+@@ -136,6 +144,7 @@ miboot*
+ mk_elfconfig
+ mkboot
+ mkbugboot
++mkcpustr
+ mkdep
+ mkprep
+ mktables
+@@ -177,16 +186,20 @@ times.h*
+ tkparse
+ trix_boot.h
+ utsrelease.h*
+-vdso.lds
++vdso*.lds
+ version.h*
+ vmlinux
+ vmlinux-*
+ vmlinux.aout
+-vmlinux*.lds*
++vmlinux.bin.all
++vmlinux*.lds
++vmlinux.relocs
+ vmlinux*.scr
+-vsyscall.lds
++vsyscall*.lds
++wakeup.lds
+ wanxlfw.inc
+ uImage
+ unifdef
++utsrelease.h
+ zImage*
+ zconf.hash.c
+diff -urNp linux-2.6.26.3/drivers/acpi/blacklist.c linux-2.6.26.3/drivers/acpi/blacklist.c
+--- linux-2.6.26.3/drivers/acpi/blacklist.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/acpi/blacklist.c	2008-08-09 12:03:29.000000000 -0400
+@@ -71,7 +71,7 @@ static struct acpi_blacklist_item acpi_b
+ 	{"IBM   ", "TP600E  ", 0x00000105, ACPI_SIG_DSDT, less_than_or_equal,
+ 	 "Incorrect _ADR", 1},
+ 
+-	{""}
++	{"", "", 0, 0, 0, all_versions, 0}
+ };
@@ -11943,5 +11767,4 @@
-diff --git a/drivers/acpi/osl.c b/drivers/acpi/osl.c
-index 235a1386888a42fb19c59f6080155a6e774071b3..78928f7eb4bbb86f8bdd468d4fae6e2c9b6eb54e 100644
---- a/drivers/acpi/osl.c
-+++ b/drivers/acpi/osl.c
-@@ -494,6 +494,8 @@ acpi_os_read_memory(acpi_physical_address phys_addr, u32 * value, u32 width)
+diff -urNp linux-2.6.26.3/drivers/acpi/osl.c linux-2.6.26.3/drivers/acpi/osl.c
+--- linux-2.6.26.3/drivers/acpi/osl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/acpi/osl.c	2008-08-09 12:03:29.000000000 -0400
+@@ -494,6 +494,8 @@ acpi_os_read_memory(acpi_physical_addres
@@ -11956 +11779 @@
-@@ -522,6 +524,8 @@ acpi_os_write_memory(acpi_physical_address phys_addr, u32 value, u32 width)
+@@ -522,6 +524,8 @@ acpi_os_write_memory(acpi_physical_addre
@@ -11965,5 +11788,4 @@
-diff --git a/drivers/acpi/processor_core.c b/drivers/acpi/processor_core.c
-index 9dd0fa93b9e1c1e2a9bd459638918ba47c25125e..bc9eea402366e2a07382afb0f55ad56744bc4860 100644
---- a/drivers/acpi/processor_core.c
-+++ b/drivers/acpi/processor_core.c
-@@ -631,7 +631,7 @@ static int __cpuinit acpi_processor_start(struct acpi_device *device)
+diff -urNp linux-2.6.26.3/drivers/acpi/processor_core.c linux-2.6.26.3/drivers/acpi/processor_core.c
+--- linux-2.6.26.3/drivers/acpi/processor_core.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/acpi/processor_core.c	2008-08-09 12:03:29.000000000 -0400
+@@ -631,7 +631,7 @@ static int __cpuinit acpi_processor_star
@@ -11978,5 +11800,4 @@
-diff --git a/drivers/acpi/processor_idle.c b/drivers/acpi/processor_idle.c
-index 556ee1585192e10c0f35d79630d6d3a934cbcf8d..161cbb828360ed59524fef0a94a59ae737bd838f 100644
---- a/drivers/acpi/processor_idle.c
-+++ b/drivers/acpi/processor_idle.c
-@@ -181,7 +181,7 @@ static struct dmi_system_id __cpuinitdata processor_power_dmi_table[] = {
+diff -urNp linux-2.6.26.3/drivers/acpi/processor_idle.c linux-2.6.26.3/drivers/acpi/processor_idle.c
+--- linux-2.6.26.3/drivers/acpi/processor_idle.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/acpi/processor_idle.c	2008-08-09 12:03:29.000000000 -0400
+@@ -181,7 +181,7 @@ static struct dmi_system_id __cpuinitdat
@@ -11991,5 +11812,4 @@
-diff --git a/drivers/acpi/sleep/main.c b/drivers/acpi/sleep/main.c
-index 495c63a3e0afb1fce2e4fcb6801020ad2f8413ad..7adaf2d8165ad47b0586018ee4e88c7f3f126bb5 100644
---- a/drivers/acpi/sleep/main.c
-+++ b/drivers/acpi/sleep/main.c
-@@ -249,7 +249,7 @@ static struct dmi_system_id __initdata acpisleep_dmi_table[] = {
+diff -urNp linux-2.6.26.3/drivers/acpi/sleep/main.c linux-2.6.26.3/drivers/acpi/sleep/main.c
+--- linux-2.6.26.3/drivers/acpi/sleep/main.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/acpi/sleep/main.c	2008-08-09 12:03:29.000000000 -0400
+@@ -249,7 +249,7 @@ static struct dmi_system_id __initdata a
@@ -12004,4 +11824,3 @@
-diff --git a/drivers/acpi/tables/tbfadt.c b/drivers/acpi/tables/tbfadt.c
-index 949d4114eb9feb92ae17ff7183d4cc4b314d0d45..86d1caade234d8d6c7b8effc35efeb09e190ca08 100644
---- a/drivers/acpi/tables/tbfadt.c
-+++ b/drivers/acpi/tables/tbfadt.c
+diff -urNp linux-2.6.26.3/drivers/acpi/tables/tbfadt.c linux-2.6.26.3/drivers/acpi/tables/tbfadt.c
+--- linux-2.6.26.3/drivers/acpi/tables/tbfadt.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/acpi/tables/tbfadt.c	2008-08-09 12:03:29.000000000 -0400
@@ -12017 +11836 @@
-@@ -122,7 +122,7 @@ static struct acpi_fadt_info fadt_info_table[] = {
+@@ -122,7 +122,7 @@ static struct acpi_fadt_info fadt_info_t
@@ -12026,5 +11845,4 @@
-diff --git a/drivers/ata/ahci.c b/drivers/ata/ahci.c
-index 5e6468a7ca4bd2a051b6ee9244297933a3ee7a60..adb293294caf24737fc4053e5577ef261d95de45 100644
---- a/drivers/ata/ahci.c
-+++ b/drivers/ata/ahci.c
-@@ -546,7 +546,7 @@ static const struct pci_device_id ahci_pci_tbl[] = {
+diff -urNp linux-2.6.26.3/drivers/ata/ahci.c linux-2.6.26.3/drivers/ata/ahci.c
+--- linux-2.6.26.3/drivers/ata/ahci.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ata/ahci.c	2008-08-09 12:03:29.000000000 -0400
+@@ -546,7 +546,7 @@ static const struct pci_device_id ahci_p
@@ -12039,5 +11857,4 @@
-diff --git a/drivers/ata/ata_piix.c b/drivers/ata/ata_piix.c
-index a90ae03f56b2e1f09793a8ddc63aca41a281b9f8..eb6a44b2cb623e90f964d69dd0c9c9ad783c97b4 100644
---- a/drivers/ata/ata_piix.c
-+++ b/drivers/ata/ata_piix.c
-@@ -275,7 +275,7 @@ static const struct pci_device_id piix_pci_tbl[] = {
+diff -urNp linux-2.6.26.3/drivers/ata/ata_piix.c linux-2.6.26.3/drivers/ata/ata_piix.c
+--- linux-2.6.26.3/drivers/ata/ata_piix.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ata/ata_piix.c	2008-08-09 12:03:29.000000000 -0400
+@@ -275,7 +275,7 @@ static const struct pci_device_id piix_p
@@ -12052 +11869 @@
-@@ -578,7 +578,7 @@ static const struct ich_laptop ich_laptop[] = {
+@@ -578,7 +578,7 @@ static const struct ich_laptop ich_lapto
@@ -12070,4 +11887,3 @@
-diff --git a/drivers/ata/libata-core.c b/drivers/ata/libata-core.c
-index 303fc0d2b978464dbf6d927a370f4cf743862b6b..794e3b1cb7e7389bb3a83dc476df2ddc592f5a1c 100644
---- a/drivers/ata/libata-core.c
-+++ b/drivers/ata/libata-core.c
+diff -urNp linux-2.6.26.3/drivers/ata/libata-core.c linux-2.6.26.3/drivers/ata/libata-core.c
+--- linux-2.6.26.3/drivers/ata/libata-core.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ata/libata-core.c	2008-08-09 12:03:29.000000000 -0400
@@ -12083 +11899 @@
-@@ -2860,7 +2860,7 @@ static const struct ata_timing ata_timing[] = {
+@@ -2860,7 +2860,7 @@ static const struct ata_timing ata_timin
@@ -12092 +11908 @@
-@@ -3947,7 +3947,7 @@ static const struct ata_blacklist_entry ata_device_blacklist [] = {
+@@ -3947,7 +3947,7 @@ static const struct ata_blacklist_entry 
@@ -12101,5 +11917,4 @@
-diff --git a/drivers/char/agp/frontend.c b/drivers/char/agp/frontend.c
-index e6cb1ab03e06fb115d532de211d584eff2b539f5..d237d82be4be0ab9040508e0165759845dc289c9 100644
---- a/drivers/char/agp/frontend.c
-+++ b/drivers/char/agp/frontend.c
-@@ -820,7 +820,7 @@ static int agpioc_reserve_wrap(struct agp_file_private *priv, void __user *arg)
+diff -urNp linux-2.6.26.3/drivers/char/agp/frontend.c linux-2.6.26.3/drivers/char/agp/frontend.c
+--- linux-2.6.26.3/drivers/char/agp/frontend.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/agp/frontend.c	2008-08-09 12:03:29.000000000 -0400
+@@ -820,7 +820,7 @@ static int agpioc_reserve_wrap(struct ag
@@ -12114,5 +11929,4 @@
-diff --git a/drivers/char/agp/intel-agp.c b/drivers/char/agp/intel-agp.c
-index df702642ab8fb49334ae46c0f0125df4a735376c..5d2e93d29918b463163fed786ca890dba31302cc 100644
---- a/drivers/char/agp/intel-agp.c
-+++ b/drivers/char/agp/intel-agp.c
-@@ -2319,7 +2319,7 @@ static struct pci_device_id agp_intel_pci_table[] = {
+diff -urNp linux-2.6.26.3/drivers/char/agp/intel-agp.c linux-2.6.26.3/drivers/char/agp/intel-agp.c
+--- linux-2.6.26.3/drivers/char/agp/intel-agp.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/agp/intel-agp.c	2008-08-09 12:03:29.000000000 -0400
+@@ -2319,7 +2319,7 @@ static struct pci_device_id agp_intel_pc
@@ -12127,4 +11941,3 @@
-diff --git a/drivers/char/drm/drm_pciids.h b/drivers/char/drm/drm_pciids.h
-index 135bd19499fcc82f8d41e9b6216f9e70205ab814..8427484b880589ff2f0c636a43dad4ea06d784ea 100644
---- a/drivers/char/drm/drm_pciids.h
-+++ b/drivers/char/drm/drm_pciids.h
+diff -urNp linux-2.6.26.3/drivers/char/drm/drm_pciids.h linux-2.6.26.3/drivers/char/drm/drm_pciids.h
+--- linux-2.6.26.3/drivers/char/drm/drm_pciids.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/drm/drm_pciids.h	2008-08-09 12:03:29.000000000 -0400
@@ -12140,5 +11953,4 @@
-diff --git a/drivers/char/hpet.c b/drivers/char/hpet.c
-index e7fb0bca3667670f27ae781893bab44b6f51d006..ff850990076fc6f1415cd0e69692cb7cda77274c 100644
---- a/drivers/char/hpet.c
-+++ b/drivers/char/hpet.c
-@@ -953,7 +953,7 @@ static struct acpi_driver hpet_acpi_driver = {
+diff -urNp linux-2.6.26.3/drivers/char/hpet.c linux-2.6.26.3/drivers/char/hpet.c
+--- linux-2.6.26.3/drivers/char/hpet.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/hpet.c	2008-08-09 12:03:29.000000000 -0400
+@@ -953,7 +953,7 @@ static struct acpi_driver hpet_acpi_driv
@@ -12153,5 +11965,4 @@
-diff --git a/drivers/char/keyboard.c b/drivers/char/keyboard.c
-index d9a0a53c842d2f35632a069591d148bfc843c2d9..e641c472e37ed56059279100c53e65d832690426 100644
---- a/drivers/char/keyboard.c
-+++ b/drivers/char/keyboard.c
-@@ -633,6 +633,16 @@ static void k_spec(struct vc_data *vc, unsigned char value, char up_flag)
+diff -urNp linux-2.6.26.3/drivers/char/keyboard.c linux-2.6.26.3/drivers/char/keyboard.c
+--- linux-2.6.26.3/drivers/char/keyboard.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/keyboard.c	2008-08-09 12:03:29.000000000 -0400
+@@ -633,6 +633,16 @@ static void k_spec(struct vc_data *vc, u
@@ -12174 +11985 @@
-@@ -1386,7 +1396,7 @@ static const struct input_device_id kbd_ids[] = {
+@@ -1386,7 +1396,7 @@ static const struct input_device_id kbd_
@@ -12183,4 +11994,3 @@
-diff --git a/drivers/char/mem.c b/drivers/char/mem.c
-index 934ffafedaea207131f7d193bed9e75c929f4db9..91bad45d1f7e16c2f6e8fef7f150f0678c033752 100644
---- a/drivers/char/mem.c
-+++ b/drivers/char/mem.c
+diff -urNp linux-2.6.26.3/drivers/char/mem.c linux-2.6.26.3/drivers/char/mem.c
+--- linux-2.6.26.3/drivers/char/mem.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/mem.c	2008-08-09 12:03:29.000000000 -0400
@@ -12206 +12016 @@
-@@ -191,6 +196,11 @@ static ssize_t write_mem(struct file * file, const char __user * buf,
+@@ -191,6 +196,11 @@ static ssize_t write_mem(struct file * f
@@ -12218 +12028 @@
-@@ -346,6 +356,11 @@ static int mmap_mem(struct file * file, struct vm_area_struct * vma)
+@@ -346,6 +356,11 @@ static int mmap_mem(struct file * file, 
@@ -12230 +12040 @@
-@@ -584,6 +599,11 @@ static ssize_t write_kmem(struct file * file, const char __user * buf,
+@@ -584,6 +599,11 @@ static ssize_t write_kmem(struct file * 
@@ -12242 +12052 @@
-@@ -787,6 +807,16 @@ static loff_t memory_lseek(struct file * file, loff_t offset, int orig)
+@@ -787,6 +807,16 @@ static loff_t memory_lseek(struct file *
@@ -12259 +12069 @@
-@@ -794,7 +824,6 @@ static int open_port(struct inode * inode, struct file * filp)
+@@ -794,7 +824,6 @@ static int open_port(struct inode * inod
@@ -12267 +12077 @@
-@@ -931,6 +960,11 @@ static int memory_open(struct inode * inode, struct file * filp)
+@@ -931,6 +960,11 @@ static int memory_open(struct inode * in
@@ -12289,5 +12099,4 @@
-diff --git a/drivers/char/nvram.c b/drivers/char/nvram.c
-index 98dec380af495607a0ce360720134234671347e4..d62701ec29fe76ae93016dd5f7b951cdc32e5b98 100644
---- a/drivers/char/nvram.c
-+++ b/drivers/char/nvram.c
-@@ -430,7 +430,10 @@ static const struct file_operations nvram_fops = {
+diff -urNp linux-2.6.26.3/drivers/char/nvram.c linux-2.6.26.3/drivers/char/nvram.c
+--- linux-2.6.26.3/drivers/char/nvram.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/nvram.c	2008-08-09 12:03:29.000000000 -0400
+@@ -430,7 +430,10 @@ static const struct file_operations nvra
@@ -12305,4 +12114,3 @@
-diff --git a/drivers/char/random.c b/drivers/char/random.c
-index 0cf98bd4f2d2438351357890a2cee00062b6c6da..bdfc9d0a8f7e91e18bb8ecd006ad8da34565cea4 100644
---- a/drivers/char/random.c
-+++ b/drivers/char/random.c
+diff -urNp linux-2.6.26.3/drivers/char/random.c linux-2.6.26.3/drivers/char/random.c
+--- linux-2.6.26.3/drivers/char/random.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/random.c	2008-08-09 12:03:29.000000000 -0400
@@ -12350,5 +12158,4 @@
-diff --git a/drivers/char/tpm/tpm.c b/drivers/char/tpm/tpm.c
-index a5d8bcb40000df912d43cb9ad4a8cc9c7453642c..bbb8c2d8845b38fb4fbbae6f005890d3304f114e 100644
---- a/drivers/char/tpm/tpm.c
-+++ b/drivers/char/tpm/tpm.c
-@@ -970,7 +970,7 @@ ssize_t tpm_write(struct file *file, const char __user *buf,
+diff -urNp linux-2.6.26.3/drivers/char/tpm/tpm.c linux-2.6.26.3/drivers/char/tpm/tpm.c
+--- linux-2.6.26.3/drivers/char/tpm/tpm.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/tpm/tpm.c	2008-08-09 12:03:29.000000000 -0400
+@@ -970,7 +970,7 @@ ssize_t tpm_write(struct file *file, con
@@ -12363,5 +12170,4 @@
-diff --git a/drivers/char/vt_ioctl.c b/drivers/char/vt_ioctl.c
-index 3211afd9d57e4080eb610c7bde54098a0c7bf117..c691ae0428b0aaf4648fb39da0102a30908aba04 100644
---- a/drivers/char/vt_ioctl.c
-+++ b/drivers/char/vt_ioctl.c
-@@ -96,6 +96,12 @@ do_kdsk_ioctl(int cmd, struct kbentry __user *user_kbe, int perm, struct kbd_str
+diff -urNp linux-2.6.26.3/drivers/char/vt_ioctl.c linux-2.6.26.3/drivers/char/vt_ioctl.c
+--- linux-2.6.26.3/drivers/char/vt_ioctl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/char/vt_ioctl.c	2008-08-09 12:03:29.000000000 -0400
+@@ -96,6 +96,12 @@ do_kdsk_ioctl(int cmd, struct kbentry __
@@ -12380 +12186 @@
-@@ -236,6 +242,13 @@ do_kdgkb_ioctl(int cmd, struct kbsentry __user *user_kdgkb, int perm)
+@@ -236,6 +242,13 @@ do_kdgkb_ioctl(int cmd, struct kbsentry 
@@ -12394,4 +12200,3 @@
-diff --git a/drivers/edac/edac_core.h b/drivers/edac/edac_core.h
-index b27b13c5eb5ad3871c88247887460a253d1a5276..381898731dce0990ea3d1393fa5b097f14925d10 100644
---- a/drivers/edac/edac_core.h
-+++ b/drivers/edac/edac_core.h
+diff -urNp linux-2.6.26.3/drivers/edac/edac_core.h linux-2.6.26.3/drivers/edac/edac_core.h
+--- linux-2.6.26.3/drivers/edac/edac_core.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/edac/edac_core.h	2008-08-09 12:03:29.000000000 -0400
@@ -12415,4 +12220,3 @@
-diff --git a/drivers/firmware/dmi_scan.c b/drivers/firmware/dmi_scan.c
-index c5e3ed7e903b3a14f405554f8c6163f2d62cb998..f8874a48ef6f9a6a5b04b8b829bd66d6ee148d82 100644
---- a/drivers/firmware/dmi_scan.c
-+++ b/drivers/firmware/dmi_scan.c
+diff -urNp linux-2.6.26.3/drivers/firmware/dmi_scan.c linux-2.6.26.3/drivers/firmware/dmi_scan.c
+--- linux-2.6.26.3/drivers/firmware/dmi_scan.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/firmware/dmi_scan.c	2008-08-09 12:03:29.000000000 -0400
@@ -12431,5 +12235,4 @@
-diff --git a/drivers/hwmon/fscpos.c b/drivers/hwmon/fscpos.c
-index 00f48484e54b6fdd1b120384b485de36d9de07a4..3f455a8880a8087e12166724e89a4f8d6b67613e 100644
---- a/drivers/hwmon/fscpos.c
-+++ b/drivers/hwmon/fscpos.c
-@@ -230,7 +230,6 @@ static ssize_t set_pwm(struct i2c_client *client, struct fscpos_data *data,
+diff -urNp linux-2.6.26.3/drivers/hwmon/fscpos.c linux-2.6.26.3/drivers/hwmon/fscpos.c
+--- linux-2.6.26.3/drivers/hwmon/fscpos.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/hwmon/fscpos.c	2008-08-09 12:03:29.000000000 -0400
+@@ -230,7 +230,6 @@ static ssize_t set_pwm(struct i2c_client
@@ -12443,5 +12246,4 @@
-diff --git a/drivers/hwmon/k8temp.c b/drivers/hwmon/k8temp.c
-index bd2bde0ef95e4c4b411bc1682c2c0243be55c22f..5198e6b5e9599155351b9fc58e71152bbb300ccb 100644
---- a/drivers/hwmon/k8temp.c
-+++ b/drivers/hwmon/k8temp.c
-@@ -130,7 +130,7 @@ static DEVICE_ATTR(name, S_IRUGO, show_name, NULL);
+diff -urNp linux-2.6.26.3/drivers/hwmon/k8temp.c linux-2.6.26.3/drivers/hwmon/k8temp.c
+--- linux-2.6.26.3/drivers/hwmon/k8temp.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/hwmon/k8temp.c	2008-08-09 12:03:29.000000000 -0400
+@@ -130,7 +130,7 @@ static DEVICE_ATTR(name, S_IRUGO, show_n
@@ -12456,5 +12258,4 @@
-diff --git a/drivers/hwmon/sis5595.c b/drivers/hwmon/sis5595.c
-index a276806f3d53cd8b9ab192f3283019b7550531c5..8f11eed6231e9623f073dc33ef56561178fb07f3 100644
---- a/drivers/hwmon/sis5595.c
-+++ b/drivers/hwmon/sis5595.c
-@@ -698,7 +698,7 @@ static struct sis5595_data *sis5595_update_device(struct device *dev)
+diff -urNp linux-2.6.26.3/drivers/hwmon/sis5595.c linux-2.6.26.3/drivers/hwmon/sis5595.c
+--- linux-2.6.26.3/drivers/hwmon/sis5595.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/hwmon/sis5595.c	2008-08-09 12:03:29.000000000 -0400
+@@ -698,7 +698,7 @@ static struct sis5595_data *sis5595_upda
@@ -12469,5 +12270,4 @@
-diff --git a/drivers/hwmon/via686a.c b/drivers/hwmon/via686a.c
-index f1ee5e731968d7e5edd0c2e3b0ab1cdd521bd2ba..6fed98236dcc2bd21b9e4e2a3c132c91a8be04df 100644
---- a/drivers/hwmon/via686a.c
-+++ b/drivers/hwmon/via686a.c
-@@ -768,7 +768,7 @@ static struct via686a_data *via686a_update_device(struct device *dev)
+diff -urNp linux-2.6.26.3/drivers/hwmon/via686a.c linux-2.6.26.3/drivers/hwmon/via686a.c
+--- linux-2.6.26.3/drivers/hwmon/via686a.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/hwmon/via686a.c	2008-08-09 12:03:29.000000000 -0400
+@@ -768,7 +768,7 @@ static struct via686a_data *via686a_upda
@@ -12482,5 +12282,4 @@
-diff --git a/drivers/hwmon/vt8231.c b/drivers/hwmon/vt8231.c
-index 5bc57275cae8e6e8a700373d1670510e442403e9..c0f2031c4b64c8a0e946f7b4cd19355e600f0d04 100644
---- a/drivers/hwmon/vt8231.c
-+++ b/drivers/hwmon/vt8231.c
-@@ -698,7 +698,7 @@ static struct platform_driver vt8231_driver = {
+diff -urNp linux-2.6.26.3/drivers/hwmon/vt8231.c linux-2.6.26.3/drivers/hwmon/vt8231.c
+--- linux-2.6.26.3/drivers/hwmon/vt8231.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/hwmon/vt8231.c	2008-08-09 12:03:29.000000000 -0400
+@@ -698,7 +698,7 @@ static struct platform_driver vt8231_dri
@@ -12495,5 +12294,4 @@
-diff --git a/drivers/hwmon/w83791d.c b/drivers/hwmon/w83791d.c
-index 85077c4c8039faba7499e51e6d03d5d0c6f2f0ec..1a5ad6139e8f848f21f6bf03c86c1e75f33834e3 100644
---- a/drivers/hwmon/w83791d.c
-+++ b/drivers/hwmon/w83791d.c
-@@ -290,8 +290,8 @@ static int w83791d_attach_adapter(struct i2c_adapter *adapter);
+diff -urNp linux-2.6.26.3/drivers/hwmon/w83791d.c linux-2.6.26.3/drivers/hwmon/w83791d.c
+--- linux-2.6.26.3/drivers/hwmon/w83791d.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/hwmon/w83791d.c	2008-08-09 12:03:29.000000000 -0400
+@@ -290,8 +290,8 @@ static int w83791d_attach_adapter(struct
@@ -12510,5 +12308,4 @@
-diff --git a/drivers/i2c/busses/i2c-i801.c b/drivers/i2c/busses/i2c-i801.c
-index b0f771fe43265df51f425593fc1f42ee47ba058e..be4859b4c26b71fd3bc2c904b9480ba9dabebe07 100644
---- a/drivers/i2c/busses/i2c-i801.c
-+++ b/drivers/i2c/busses/i2c-i801.c
-@@ -592,7 +592,7 @@ static struct pci_device_id i801_ids[] = {
+diff -urNp linux-2.6.26.3/drivers/i2c/busses/i2c-i801.c linux-2.6.26.3/drivers/i2c/busses/i2c-i801.c
+--- linux-2.6.26.3/drivers/i2c/busses/i2c-i801.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/i2c/busses/i2c-i801.c	2008-08-09 12:03:29.000000000 -0400
+@@ -592,7 +592,7 @@ static struct pci_device_id i801_ids[] =
@@ -12523,5 +12320,4 @@
-diff --git a/drivers/i2c/busses/i2c-i810.c b/drivers/i2c/busses/i2c-i810.c
-index 42e8d94c276fde7e278016aef70d6ffdf23e2baa..ed7f82b396b71df8b16c2a438c39935e2a57bfa7 100644
---- a/drivers/i2c/busses/i2c-i810.c
-+++ b/drivers/i2c/busses/i2c-i810.c
-@@ -198,7 +198,7 @@ static struct pci_device_id i810_ids[] __devinitdata = {
+diff -urNp linux-2.6.26.3/drivers/i2c/busses/i2c-i810.c linux-2.6.26.3/drivers/i2c/busses/i2c-i810.c
+--- linux-2.6.26.3/drivers/i2c/busses/i2c-i810.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/i2c/busses/i2c-i810.c	2008-08-09 12:03:29.000000000 -0400
+@@ -198,7 +198,7 @@ static struct pci_device_id i810_ids[] _
@@ -12536,5 +12332,4 @@
-diff --git a/drivers/i2c/busses/i2c-piix4.c b/drivers/i2c/busses/i2c-piix4.c
-index ac916596858764481f08afdde261b770be1a1b54..bc6760fcc64486ee3ec4a6241d84c6993951c878 100644
---- a/drivers/i2c/busses/i2c-piix4.c
-+++ b/drivers/i2c/busses/i2c-piix4.c
-@@ -133,7 +133,7 @@ static struct dmi_system_id __devinitdata piix4_dmi_ibm[] = {
+diff -urNp linux-2.6.26.3/drivers/i2c/busses/i2c-piix4.c linux-2.6.26.3/drivers/i2c/busses/i2c-piix4.c
+--- linux-2.6.26.3/drivers/i2c/busses/i2c-piix4.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/i2c/busses/i2c-piix4.c	2008-08-09 12:03:29.000000000 -0400
+@@ -133,7 +133,7 @@ static struct dmi_system_id __devinitdat
@@ -12549 +12344 @@
-@@ -431,7 +431,7 @@ static struct pci_device_id piix4_ids[] = {
+@@ -431,7 +431,7 @@ static struct pci_device_id piix4_ids[] 
@@ -12558,5 +12353,4 @@
-diff --git a/drivers/i2c/busses/i2c-sis630.c b/drivers/i2c/busses/i2c-sis630.c
-index 3765dd7f450f06e7c71f6623d67795c9e4cc056d..f135e4e9b4a21dbe7f40d57ab807ba671c597f60 100644
---- a/drivers/i2c/busses/i2c-sis630.c
-+++ b/drivers/i2c/busses/i2c-sis630.c
-@@ -465,7 +465,7 @@ static struct i2c_adapter sis630_adapter = {
+diff -urNp linux-2.6.26.3/drivers/i2c/busses/i2c-sis630.c linux-2.6.26.3/drivers/i2c/busses/i2c-sis630.c
+--- linux-2.6.26.3/drivers/i2c/busses/i2c-sis630.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/i2c/busses/i2c-sis630.c	2008-08-09 12:03:29.000000000 -0400
+@@ -465,7 +465,7 @@ static struct i2c_adapter sis630_adapter
@@ -12571,5 +12365,4 @@
-diff --git a/drivers/i2c/busses/i2c-sis96x.c b/drivers/i2c/busses/i2c-sis96x.c
-index dc235bb8e24d448ae5f815ff45314bdea789d740..f39c0f5e576486405a1330d20349d5f32462e7df 100644
---- a/drivers/i2c/busses/i2c-sis96x.c
-+++ b/drivers/i2c/busses/i2c-sis96x.c
-@@ -255,7 +255,7 @@ static struct i2c_adapter sis96x_adapter = {
+diff -urNp linux-2.6.26.3/drivers/i2c/busses/i2c-sis96x.c linux-2.6.26.3/drivers/i2c/busses/i2c-sis96x.c
+--- linux-2.6.26.3/drivers/i2c/busses/i2c-sis96x.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/i2c/busses/i2c-sis96x.c	2008-08-09 12:03:29.000000000 -0400
+@@ -255,7 +255,7 @@ static struct i2c_adapter sis96x_adapter
@@ -12584,5 +12377,4 @@
-diff --git a/drivers/ieee1394/dv1394.c b/drivers/ieee1394/dv1394.c
-index 9d19aec5820a303145d8b286e2d1ce2e72b4a586..9b57d2bacfe1909a730b89900454718b9277f131 100644
---- a/drivers/ieee1394/dv1394.c
-+++ b/drivers/ieee1394/dv1394.c
-@@ -739,7 +739,7 @@ static void frame_prepare(struct video_card *video, unsigned int this_frame)
+diff -urNp linux-2.6.26.3/drivers/ieee1394/dv1394.c linux-2.6.26.3/drivers/ieee1394/dv1394.c
+--- linux-2.6.26.3/drivers/ieee1394/dv1394.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/dv1394.c	2008-08-09 12:03:29.000000000 -0400
+@@ -739,7 +739,7 @@ static void frame_prepare(struct video_c
@@ -12597 +12389 @@
-@@ -918,7 +918,7 @@ static int do_dv1394_init(struct video_card *video, struct dv1394_init *init)
+@@ -918,7 +918,7 @@ static int do_dv1394_init(struct video_c
@@ -12606 +12398 @@
-@@ -2174,7 +2174,7 @@ static struct ieee1394_device_id dv1394_id_table[] = {
+@@ -2174,7 +2174,7 @@ static struct ieee1394_device_id dv1394_
@@ -12615,5 +12407,4 @@
-diff --git a/drivers/ieee1394/eth1394.c b/drivers/ieee1394/eth1394.c
-index b166b3575fa6d8904126e8a61ccaf604d5b9739f..53abcf89a28e005732b9fcf0c615039108e74f0c 100644
---- a/drivers/ieee1394/eth1394.c
-+++ b/drivers/ieee1394/eth1394.c
-@@ -451,7 +451,7 @@ static struct ieee1394_device_id eth1394_id_table[] = {
+diff -urNp linux-2.6.26.3/drivers/ieee1394/eth1394.c linux-2.6.26.3/drivers/ieee1394/eth1394.c
+--- linux-2.6.26.3/drivers/ieee1394/eth1394.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/eth1394.c	2008-08-09 12:03:29.000000000 -0400
+@@ -451,7 +451,7 @@ static struct ieee1394_device_id eth1394
@@ -12628,5 +12419,4 @@
-diff --git a/drivers/ieee1394/hosts.c b/drivers/ieee1394/hosts.c
-index 8dd09d8504196eecbe750887ec23f702667b105d..657d83eee4c64642f0901b71c08a10a234e51464 100644
---- a/drivers/ieee1394/hosts.c
-+++ b/drivers/ieee1394/hosts.c
-@@ -78,6 +78,7 @@ static int dummy_isoctl(struct hpsb_iso *iso, enum isoctl_cmd command,
+diff -urNp linux-2.6.26.3/drivers/ieee1394/hosts.c linux-2.6.26.3/drivers/ieee1394/hosts.c
+--- linux-2.6.26.3/drivers/ieee1394/hosts.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/hosts.c	2008-08-09 12:03:29.000000000 -0400
+@@ -78,6 +78,7 @@ static int dummy_isoctl(struct hpsb_iso 
@@ -12640,5 +12430,4 @@
-diff --git a/drivers/ieee1394/ohci1394.c b/drivers/ieee1394/ohci1394.c
-index e509e13cb7a7cdb4c2d154835dea19857082f418..1dee013ad76acaa2c6506867cfb2a789f809a736 100644
---- a/drivers/ieee1394/ohci1394.c
-+++ b/drivers/ieee1394/ohci1394.c
-@@ -147,9 +147,9 @@ printk(level "%s: " fmt "\n" , OHCI1394_DRIVER_NAME , ## args)
+diff -urNp linux-2.6.26.3/drivers/ieee1394/ohci1394.c linux-2.6.26.3/drivers/ieee1394/ohci1394.c
+--- linux-2.6.26.3/drivers/ieee1394/ohci1394.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/ohci1394.c	2008-08-09 12:03:29.000000000 -0400
+@@ -147,9 +147,9 @@ printk(level "%s: " fmt "\n" , OHCI1394_
@@ -12656 +12445 @@
-@@ -3437,7 +3437,7 @@ static struct pci_device_id ohci1394_pci_tbl[] = {
+@@ -3437,7 +3437,7 @@ static struct pci_device_id ohci1394_pci
@@ -12665,5 +12454,4 @@
-diff --git a/drivers/ieee1394/raw1394.c b/drivers/ieee1394/raw1394.c
-index ec2a0adbedb248f2a493b2ca716fc8d7971c98ed..75d2fa33771e11014e8ee7ff9c23a2054c7d4b76 100644
---- a/drivers/ieee1394/raw1394.c
-+++ b/drivers/ieee1394/raw1394.c
-@@ -2958,7 +2958,7 @@ static struct ieee1394_device_id raw1394_id_table[] = {
+diff -urNp linux-2.6.26.3/drivers/ieee1394/raw1394.c linux-2.6.26.3/drivers/ieee1394/raw1394.c
+--- linux-2.6.26.3/drivers/ieee1394/raw1394.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/raw1394.c	2008-08-09 12:03:29.000000000 -0400
+@@ -2958,7 +2958,7 @@ static struct ieee1394_device_id raw1394
@@ -12678,5 +12466,4 @@
-diff --git a/drivers/ieee1394/sbp2.c b/drivers/ieee1394/sbp2.c
-index a5ceff287a289f0346e3c1007abd2abc5e74ddc3..76c2773c4906fcfd06069fa17e23fcec60d447b9 100644
---- a/drivers/ieee1394/sbp2.c
-+++ b/drivers/ieee1394/sbp2.c
-@@ -283,7 +283,7 @@ static struct ieee1394_device_id sbp2_id_table[] = {
+diff -urNp linux-2.6.26.3/drivers/ieee1394/sbp2.c linux-2.6.26.3/drivers/ieee1394/sbp2.c
+--- linux-2.6.26.3/drivers/ieee1394/sbp2.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/sbp2.c	2008-08-09 12:03:29.000000000 -0400
+@@ -283,7 +283,7 @@ static struct ieee1394_device_id sbp2_id
@@ -12691 +12478 @@
-@@ -2101,7 +2101,7 @@ MODULE_DESCRIPTION("IEEE-1394 SBP-2 protocol driver");
+@@ -2101,7 +2101,7 @@ MODULE_DESCRIPTION("IEEE-1394 SBP-2 prot
@@ -12700,5 +12487,4 @@
-diff --git a/drivers/ieee1394/video1394.c b/drivers/ieee1394/video1394.c
-index e24772d336e1ae6c726d8e0a05ae5ea25a9207e0..5a94b1b00dca591c09e296228c67c0180367dc5b 100644
---- a/drivers/ieee1394/video1394.c
-+++ b/drivers/ieee1394/video1394.c
-@@ -893,7 +893,7 @@ static long video1394_ioctl(struct file *file,
+diff -urNp linux-2.6.26.3/drivers/ieee1394/video1394.c linux-2.6.26.3/drivers/ieee1394/video1394.c
+--- linux-2.6.26.3/drivers/ieee1394/video1394.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/ieee1394/video1394.c	2008-08-09 12:03:29.000000000 -0400
+@@ -893,7 +893,7 @@ static long video1394_ioctl(struct file 
@@ -12713 +12499 @@
-@@ -959,7 +959,7 @@ static long video1394_ioctl(struct file *file,
+@@ -959,7 +959,7 @@ static long video1394_ioctl(struct file 
@@ -12722 +12508 @@
-@@ -1030,7 +1030,7 @@ static long video1394_ioctl(struct file *file,
+@@ -1030,7 +1030,7 @@ static long video1394_ioctl(struct file 
@@ -12731 +12517 @@
-@@ -1137,7 +1137,7 @@ static long video1394_ioctl(struct file *file,
+@@ -1137,7 +1137,7 @@ static long video1394_ioctl(struct file 
@@ -12740 +12526 @@
-@@ -1310,7 +1310,7 @@ static struct ieee1394_device_id video1394_id_table[] = {
+@@ -1310,7 +1310,7 @@ static struct ieee1394_device_id video13
@@ -12749,5 +12535,4 @@
-diff --git a/drivers/input/keyboard/atkbd.c b/drivers/input/keyboard/atkbd.c
-index af58a6f1e898278b42bdd5980d51b10718fd807e..3f7906292c65aef2f71233b66af6a51b9834474a 100644
---- a/drivers/input/keyboard/atkbd.c
-+++ b/drivers/input/keyboard/atkbd.c
-@@ -1115,7 +1115,7 @@ static struct serio_device_id atkbd_serio_ids[] = {
+diff -urNp linux-2.6.26.3/drivers/input/keyboard/atkbd.c linux-2.6.26.3/drivers/input/keyboard/atkbd.c
+--- linux-2.6.26.3/drivers/input/keyboard/atkbd.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/keyboard/atkbd.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1115,7 +1115,7 @@ static struct serio_device_id atkbd_seri
@@ -12762,5 +12547,4 @@
-diff --git a/drivers/input/mouse/lifebook.c b/drivers/input/mouse/lifebook.c
-index df81b0aaa9f88911fa335d506f284161c5e24d70..c5f5a37865573e3d3b997d8b79d4be0ea59ad843 100644
---- a/drivers/input/mouse/lifebook.c
-+++ b/drivers/input/mouse/lifebook.c
-@@ -110,7 +110,7 @@ static const struct dmi_system_id lifebook_dmi_table[] = {
+diff -urNp linux-2.6.26.3/drivers/input/mouse/lifebook.c linux-2.6.26.3/drivers/input/mouse/lifebook.c
+--- linux-2.6.26.3/drivers/input/mouse/lifebook.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/mouse/lifebook.c	2008-08-09 12:03:29.000000000 -0400
+@@ -110,7 +110,7 @@ static const struct dmi_system_id lifebo
@@ -12775,5 +12559,4 @@
-diff --git a/drivers/input/mouse/psmouse-base.c b/drivers/input/mouse/psmouse-base.c
-index f5a6be1d3c46325b2173ff00e2588a9de9ca5d81..153762cda8e9ab2c76a607003f9cda037ef6d145 100644
---- a/drivers/input/mouse/psmouse-base.c
-+++ b/drivers/input/mouse/psmouse-base.c
-@@ -1328,7 +1328,7 @@ static struct serio_device_id psmouse_serio_ids[] = {
+diff -urNp linux-2.6.26.3/drivers/input/mouse/psmouse-base.c linux-2.6.26.3/drivers/input/mouse/psmouse-base.c
+--- linux-2.6.26.3/drivers/input/mouse/psmouse-base.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/mouse/psmouse-base.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1328,7 +1328,7 @@ static struct serio_device_id psmouse_se
@@ -12788,5 +12571,4 @@
-diff --git a/drivers/input/mouse/synaptics.c b/drivers/input/mouse/synaptics.c
-index d349c4a5e3e84488a4e812e33e6e547aac4d97e7..3a0266d8965bc6f58587a72ad818456521be3374 100644
---- a/drivers/input/mouse/synaptics.c
-+++ b/drivers/input/mouse/synaptics.c
-@@ -417,7 +417,7 @@ static void synaptics_process_packet(struct psmouse *psmouse)
+diff -urNp linux-2.6.26.3/drivers/input/mouse/synaptics.c linux-2.6.26.3/drivers/input/mouse/synaptics.c
+--- linux-2.6.26.3/drivers/input/mouse/synaptics.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/mouse/synaptics.c	2008-08-09 12:03:29.000000000 -0400
+@@ -417,7 +417,7 @@ static void synaptics_process_packet(str
@@ -12801 +12583 @@
-@@ -624,7 +624,7 @@ static const struct dmi_system_id toshiba_dmi_table[] = {
+@@ -624,7 +624,7 @@ static const struct dmi_system_id toshib
@@ -12810,5 +12592,4 @@
-diff --git a/drivers/input/mousedev.c b/drivers/input/mousedev.c
-index b989748598ae2191cc58f806eb11a19290b847fe..28f5437e3baaf0d0cffc8489b5c28ff036beef69 100644
---- a/drivers/input/mousedev.c
-+++ b/drivers/input/mousedev.c
-@@ -1056,7 +1056,7 @@ static struct input_handler mousedev_handler = {
+diff -urNp linux-2.6.26.3/drivers/input/mousedev.c linux-2.6.26.3/drivers/input/mousedev.c
+--- linux-2.6.26.3/drivers/input/mousedev.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/mousedev.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1056,7 +1056,7 @@ static struct input_handler mousedev_han
@@ -12823,5 +12604,4 @@
-diff --git a/drivers/input/serio/i8042-x86ia64io.h b/drivers/input/serio/i8042-x86ia64io.h
-index 7828ef2e07e497c25b9611b874ec8d9bbd19faab..69f660c478114b9c266925095dcbb691914eea05 100644
---- a/drivers/input/serio/i8042-x86ia64io.h
-+++ b/drivers/input/serio/i8042-x86ia64io.h
-@@ -118,7 +118,7 @@ static struct dmi_system_id __initdata i8042_dmi_noloop_table[] = {
+diff -urNp linux-2.6.26.3/drivers/input/serio/i8042-x86ia64io.h linux-2.6.26.3/drivers/input/serio/i8042-x86ia64io.h
+--- linux-2.6.26.3/drivers/input/serio/i8042-x86ia64io.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/serio/i8042-x86ia64io.h	2008-08-09 12:03:29.000000000 -0400
+@@ -118,7 +118,7 @@ static struct dmi_system_id __initdata i
@@ -12836 +12616 @@
-@@ -298,7 +298,7 @@ static struct dmi_system_id __initdata i8042_dmi_nomux_table[] = {
+@@ -298,7 +298,7 @@ static struct dmi_system_id __initdata i
@@ -12845,5 +12625,4 @@
-diff --git a/drivers/input/serio/serio_raw.c b/drivers/input/serio/serio_raw.c
-index 0403622ae26752976327823802861b321b521d69..9038ad6454b080bbb1c30b59fdc7840fd716e55a 100644
---- a/drivers/input/serio/serio_raw.c
-+++ b/drivers/input/serio/serio_raw.c
-@@ -369,7 +369,7 @@ static struct serio_device_id serio_raw_serio_ids[] = {
+diff -urNp linux-2.6.26.3/drivers/input/serio/serio_raw.c linux-2.6.26.3/drivers/input/serio/serio_raw.c
+--- linux-2.6.26.3/drivers/input/serio/serio_raw.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/input/serio/serio_raw.c	2008-08-09 12:03:29.000000000 -0400
+@@ -369,7 +369,7 @@ static struct serio_device_id serio_raw_
@@ -12858,4 +12637,3 @@
-diff --git a/drivers/md/bitmap.c b/drivers/md/bitmap.c
-index b26927ce889cead2717db3f4d3896bbd9bacc4e2..34f4e5e6707ab10574b29a5324ed92aae58b57f4 100644
---- a/drivers/md/bitmap.c
-+++ b/drivers/md/bitmap.c
+diff -urNp linux-2.6.26.3/drivers/md/bitmap.c linux-2.6.26.3/drivers/md/bitmap.c
+--- linux-2.6.26.3/drivers/md/bitmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/md/bitmap.c	2008-08-09 12:03:29.000000000 -0400
@@ -12871,5 +12649,4 @@
-diff --git a/drivers/mtd/devices/doc2000.c b/drivers/mtd/devices/doc2000.c
-index 846989f292e3f01a1992dd73f999583263b9ec7f..05c8b24119a54510bc47d1cc1675c10cb1c506cb 100644
---- a/drivers/mtd/devices/doc2000.c
-+++ b/drivers/mtd/devices/doc2000.c
-@@ -779,7 +779,7 @@ static int doc_write(struct mtd_info *mtd, loff_t to, size_t len,
+diff -urNp linux-2.6.26.3/drivers/mtd/devices/doc2000.c linux-2.6.26.3/drivers/mtd/devices/doc2000.c
+--- linux-2.6.26.3/drivers/mtd/devices/doc2000.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/mtd/devices/doc2000.c	2008-08-09 12:03:29.000000000 -0400
+@@ -779,7 +779,7 @@ static int doc_write(struct mtd_info *mt
@@ -12884,5 +12661,4 @@
-diff --git a/drivers/mtd/devices/doc2001.c b/drivers/mtd/devices/doc2001.c
-index 6413efc045e0c98e1e657229fdbdd55e67671b1d..e1765253a7ce0aafed99a24f65fb2157b6f3aa2b 100644
---- a/drivers/mtd/devices/doc2001.c
-+++ b/drivers/mtd/devices/doc2001.c
-@@ -398,6 +398,8 @@ static int doc_read (struct mtd_info *mtd, loff_t from, size_t len,
+diff -urNp linux-2.6.26.3/drivers/mtd/devices/doc2001.c linux-2.6.26.3/drivers/mtd/devices/doc2001.c
+--- linux-2.6.26.3/drivers/mtd/devices/doc2001.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/mtd/devices/doc2001.c	2008-08-09 12:03:29.000000000 -0400
+@@ -398,6 +398,8 @@ static int doc_read (struct mtd_info *mt
@@ -12897,5 +12673,4 @@
-diff --git a/drivers/mtd/devices/slram.c b/drivers/mtd/devices/slram.c
-index cb86db746f28c91f552462696b10d5c99f23c07d..5eb75200c0d3c7edd2ff99a561f82bde9e7ffbe8 100644
---- a/drivers/mtd/devices/slram.c
-+++ b/drivers/mtd/devices/slram.c
-@@ -275,7 +275,7 @@ static int parse_cmdline(char *devname, char *szstart, char *szlength)
+diff -urNp linux-2.6.26.3/drivers/mtd/devices/slram.c linux-2.6.26.3/drivers/mtd/devices/slram.c
+--- linux-2.6.26.3/drivers/mtd/devices/slram.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/mtd/devices/slram.c	2008-08-09 12:03:29.000000000 -0400
+@@ -275,7 +275,7 @@ static int parse_cmdline(char *devname, 
@@ -12910,5 +12685,4 @@
-diff --git a/drivers/mtd/ubi/build.c b/drivers/mtd/ubi/build.c
-index 961416ac06167350bf689c631a85b0ece7f067ec..309cc29a8070e68eefa1c7c6600a9b4252d4260d 100644
---- a/drivers/mtd/ubi/build.c
-+++ b/drivers/mtd/ubi/build.c
-@@ -1057,7 +1057,7 @@ static int __init bytes_str_to_int(const char *str)
+diff -urNp linux-2.6.26.3/drivers/mtd/ubi/build.c linux-2.6.26.3/drivers/mtd/ubi/build.c
+--- linux-2.6.26.3/drivers/mtd/ubi/build.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/mtd/ubi/build.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1057,7 +1057,7 @@ static int __init bytes_str_to_int(const
@@ -12923,4 +12697,3 @@
-diff --git a/drivers/net/eepro100.c b/drivers/net/eepro100.c
-index e3e26c595fa340b8de1a4c28d8152964c9b42d69..fba02289bdc9ec541952c2b1cb1b01cf3fa84435 100644
---- a/drivers/net/eepro100.c
-+++ b/drivers/net/eepro100.c
+diff -urNp linux-2.6.26.3/drivers/net/eepro100.c linux-2.6.26.3/drivers/net/eepro100.c
+--- linux-2.6.26.3/drivers/net/eepro100.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/net/eepro100.c	2008-08-09 12:03:29.000000000 -0400
@@ -12936 +12709 @@
-@@ -2334,33 +2334,33 @@ static void __devexit eepro100_remove_one (struct pci_dev *pdev)
+@@ -2334,33 +2334,33 @@ static void __devexit eepro100_remove_on
@@ -12997,5 +12770,4 @@
-diff --git a/drivers/net/irda/vlsi_ir.c b/drivers/net/irda/vlsi_ir.c
-index d15e00b8591e173aeb55a08623a773ced53b6d8f..0e3a6bc3eb02217456f1255741ead6b2a96a674d 100644
---- a/drivers/net/irda/vlsi_ir.c
-+++ b/drivers/net/irda/vlsi_ir.c
-@@ -906,13 +906,12 @@ static int vlsi_hard_start_xmit(struct sk_buff *skb, struct net_device *ndev)
+diff -urNp linux-2.6.26.3/drivers/net/irda/vlsi_ir.c linux-2.6.26.3/drivers/net/irda/vlsi_ir.c
+--- linux-2.6.26.3/drivers/net/irda/vlsi_ir.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/net/irda/vlsi_ir.c	2008-08-09 12:03:29.000000000 -0400
+@@ -906,13 +906,12 @@ static int vlsi_hard_start_xmit(struct s
@@ -13017,4 +12789,3 @@
-diff --git a/drivers/net/pcnet32.c b/drivers/net/pcnet32.c
-index 1c89b97f4e0931c02699bbac0efcaf26ec73c4cf..913762d76d6f8a12a3437f367e1207a00c0641ba 100644
---- a/drivers/net/pcnet32.c
-+++ b/drivers/net/pcnet32.c
+diff -urNp linux-2.6.26.3/drivers/net/pcnet32.c linux-2.6.26.3/drivers/net/pcnet32.c
+--- linux-2.6.26.3/drivers/net/pcnet32.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/net/pcnet32.c	2008-08-09 12:03:29.000000000 -0400
@@ -13030,4 +12801,3 @@
-diff --git a/drivers/net/tg3.h b/drivers/net/tg3.h
-index 0404f93baa290c77a7b39c55754ccd23ace126fa..8649d87bca34f724683290cc462e7260678f3fa2 100644
---- a/drivers/net/tg3.h
-+++ b/drivers/net/tg3.h
+diff -urNp linux-2.6.26.3/drivers/net/tg3.h linux-2.6.26.3/drivers/net/tg3.h
+--- linux-2.6.26.3/drivers/net/tg3.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/net/tg3.h	2008-08-09 12:03:29.000000000 -0400
@@ -13042,5 +12812,4 @@
-diff --git a/drivers/pci/hotplug/cpqphp_nvram.c b/drivers/pci/hotplug/cpqphp_nvram.c
-index cb174888002ba537ee2884a46fcac24513f1b1fe..29489db8653d7898832b2c5b06e78b83a7647fa9 100644
---- a/drivers/pci/hotplug/cpqphp_nvram.c
-+++ b/drivers/pci/hotplug/cpqphp_nvram.c
-@@ -425,9 +425,13 @@ static u32 store_HRT (void __iomem *rom_start)
+diff -urNp linux-2.6.26.3/drivers/pci/hotplug/cpqphp_nvram.c linux-2.6.26.3/drivers/pci/hotplug/cpqphp_nvram.c
+--- linux-2.6.26.3/drivers/pci/hotplug/cpqphp_nvram.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pci/hotplug/cpqphp_nvram.c	2008-08-09 12:03:29.000000000 -0400
+@@ -425,9 +425,13 @@ static u32 store_HRT (void __iomem *rom_
@@ -13060,5 +12829,4 @@
-diff --git a/drivers/pci/pcie/aer/aerdrv.c b/drivers/pci/pcie/aer/aerdrv.c
-index 07c3bdb6edc2ad5b261f3877eed725466f4d895a..c5098b446a8b0313e6f5cd21062a51f4c6727e15 100644
---- a/drivers/pci/pcie/aer/aerdrv.c
-+++ b/drivers/pci/pcie/aer/aerdrv.c
-@@ -58,7 +58,7 @@ static struct pcie_port_service_id aer_id[] = {
+diff -urNp linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv.c linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv.c
+--- linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv.c	2008-08-09 12:03:29.000000000 -0400
+@@ -58,7 +58,7 @@ static struct pcie_port_service_id aer_i
@@ -13073,5 +12841,4 @@
-diff --git a/drivers/pci/pcie/aer/aerdrv_core.c b/drivers/pci/pcie/aer/aerdrv_core.c
-index aaa82392d1dcc4c79e79b9432e68f66ab6b93be6..29ec6e376762b8837d5146584555bae16008bfed 100644
---- a/drivers/pci/pcie/aer/aerdrv_core.c
-+++ b/drivers/pci/pcie/aer/aerdrv_core.c
-@@ -663,7 +663,7 @@ static void aer_isr_one_error(struct pcie_device *p_device,
+diff -urNp linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv_core.c linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv_core.c
+--- linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv_core.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pci/pcie/aer/aerdrv_core.c	2008-08-09 12:03:29.000000000 -0400
+@@ -663,7 +663,7 @@ static void aer_isr_one_error(struct pci
@@ -13086,5 +12853,4 @@
-diff --git a/drivers/pci/pcie/portdrv_pci.c b/drivers/pci/pcie/portdrv_pci.c
-index 51d163238d93e63429bd6d04446c1563aaa8be64..14beb17792a9a079cecff2f546b889cbd53e290f 100644
---- a/drivers/pci/pcie/portdrv_pci.c
-+++ b/drivers/pci/pcie/portdrv_pci.c
-@@ -265,7 +265,7 @@ static void pcie_portdrv_err_resume(struct pci_dev *dev)
+diff -urNp linux-2.6.26.3/drivers/pci/pcie/portdrv_pci.c linux-2.6.26.3/drivers/pci/pcie/portdrv_pci.c
+--- linux-2.6.26.3/drivers/pci/pcie/portdrv_pci.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pci/pcie/portdrv_pci.c	2008-08-09 12:03:29.000000000 -0400
+@@ -265,7 +265,7 @@ static void pcie_portdrv_err_resume(stru
@@ -13099,5 +12865,4 @@
-diff --git a/drivers/pci/proc.c b/drivers/pci/proc.c
-index 963a97642ae9101a7454c7b0b3c0dbcc95f8240e..9f56c6ce1b5271c1cd54560832be20f3cff3cbb6 100644
---- a/drivers/pci/proc.c
-+++ b/drivers/pci/proc.c
-@@ -472,7 +472,16 @@ static const struct file_operations proc_bus_pci_dev_operations = {
+diff -urNp linux-2.6.26.3/drivers/pci/proc.c linux-2.6.26.3/drivers/pci/proc.c
+--- linux-2.6.26.3/drivers/pci/proc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pci/proc.c	2008-08-09 12:03:29.000000000 -0400
+@@ -472,7 +472,16 @@ static const struct file_operations proc
@@ -13120,5 +12885,4 @@
-diff --git a/drivers/pcmcia/ti113x.h b/drivers/pcmcia/ti113x.h
-index d29657bf1b40faecefd0598ad73cc60c42d292c1..6afdff3ad1d44a33a5c3d6d89ce465de3928aebd 100644
---- a/drivers/pcmcia/ti113x.h
-+++ b/drivers/pcmcia/ti113x.h
-@@ -897,7 +897,7 @@ static struct pci_device_id ene_tune_tbl[] = {
+diff -urNp linux-2.6.26.3/drivers/pcmcia/ti113x.h linux-2.6.26.3/drivers/pcmcia/ti113x.h
+--- linux-2.6.26.3/drivers/pcmcia/ti113x.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pcmcia/ti113x.h	2008-08-09 12:03:29.000000000 -0400
+@@ -897,7 +897,7 @@ static struct pci_device_id ene_tune_tbl
@@ -13133,5 +12897,4 @@
-diff --git a/drivers/pcmcia/yenta_socket.c b/drivers/pcmcia/yenta_socket.c
-index 0ab1fb65cdc335541ae9bb0da1668686badef607..cc82c08a0111942dc5edf1b0f52503f10cfdfe04 100644
---- a/drivers/pcmcia/yenta_socket.c
-+++ b/drivers/pcmcia/yenta_socket.c
-@@ -1358,7 +1358,7 @@ static struct pci_device_id yenta_table [] = {
+diff -urNp linux-2.6.26.3/drivers/pcmcia/yenta_socket.c linux-2.6.26.3/drivers/pcmcia/yenta_socket.c
+--- linux-2.6.26.3/drivers/pcmcia/yenta_socket.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pcmcia/yenta_socket.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1358,7 +1358,7 @@ static struct pci_device_id yenta_table 
@@ -13146,5 +12909,4 @@
-diff --git a/drivers/pnp/pnpbios/bioscalls.c b/drivers/pnp/pnpbios/bioscalls.c
-index 7ff824496b397b236eda67c1a39b178b6ea22024..a780801942354367bc625793a7f4c65a9117c293 100644
---- a/drivers/pnp/pnpbios/bioscalls.c
-+++ b/drivers/pnp/pnpbios/bioscalls.c
-@@ -60,7 +60,7 @@ set_base(gdt[(selname) >> 3], (u32)(address)); \
+diff -urNp linux-2.6.26.3/drivers/pnp/pnpbios/bioscalls.c linux-2.6.26.3/drivers/pnp/pnpbios/bioscalls.c
+--- linux-2.6.26.3/drivers/pnp/pnpbios/bioscalls.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pnp/pnpbios/bioscalls.c	2008-08-09 12:03:29.000000000 -0400
+@@ -60,7 +60,7 @@ set_base(gdt[(selname) >> 3], (u32)(addr
@@ -13159 +12921 @@
-@@ -87,6 +87,10 @@ static inline u16 call_pnp_bios(u16 func, u16 arg1, u16 arg2, u16 arg3,
+@@ -87,6 +87,10 @@ static inline u16 call_pnp_bios(u16 func
@@ -13170 +12932 @@
-@@ -96,8 +100,17 @@ static inline u16 call_pnp_bios(u16 func, u16 arg1, u16 arg2, u16 arg3,
+@@ -96,8 +100,17 @@ static inline u16 call_pnp_bios(u16 func
@@ -13188 +12950 @@
-@@ -134,7 +147,16 @@ static inline u16 call_pnp_bios(u16 func, u16 arg1, u16 arg2, u16 arg3,
+@@ -134,7 +147,16 @@ static inline u16 call_pnp_bios(u16 func
@@ -13205 +12967 @@
-@@ -468,16 +490,24 @@ int pnp_bios_read_escd(char *data, u32 nvram_base)
+@@ -468,16 +490,24 @@ int pnp_bios_read_escd(char *data, u32 n
@@ -13232 +12994 @@
-@@ -491,4 +521,9 @@ void pnpbios_calls_init(union pnp_bios_install_struct *header)
+@@ -491,4 +521,9 @@ void pnpbios_calls_init(union pnp_bios_i
@@ -13242,4 +13004,3 @@
-diff --git a/drivers/pnp/quirks.c b/drivers/pnp/quirks.c
-index 1ff3bb585ab2b0b5f0bb88f8477fe334c26c726a..be0045722edf3eba22a55805f9e8b4d1d4dc840d 100644
---- a/drivers/pnp/quirks.c
-+++ b/drivers/pnp/quirks.c
+diff -urNp linux-2.6.26.3/drivers/pnp/quirks.c linux-2.6.26.3/drivers/pnp/quirks.c
+--- linux-2.6.26.3/drivers/pnp/quirks.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pnp/quirks.c	2008-08-09 12:03:29.000000000 -0400
@@ -13255,5 +13016,4 @@
-diff --git a/drivers/pnp/resource.c b/drivers/pnp/resource.c
-index 390b50096e30890f57d6cf6f55dc730d18013b47..04ca8707105f74204558d29c25b7356d0ca68c85 100644
---- a/drivers/pnp/resource.c
-+++ b/drivers/pnp/resource.c
-@@ -378,7 +378,7 @@ int pnp_check_irq(struct pnp_dev *dev, struct resource *res)
+diff -urNp linux-2.6.26.3/drivers/pnp/resource.c linux-2.6.26.3/drivers/pnp/resource.c
+--- linux-2.6.26.3/drivers/pnp/resource.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/pnp/resource.c	2008-08-09 12:03:29.000000000 -0400
+@@ -378,7 +378,7 @@ int pnp_check_irq(struct pnp_dev *dev, s
@@ -13268 +13028 @@
-@@ -451,7 +451,7 @@ int pnp_check_dma(struct pnp_dev *dev, struct resource *res)
+@@ -451,7 +451,7 @@ int pnp_check_dma(struct pnp_dev *dev, s
@@ -13277,4 +13037,3 @@
-diff --git a/drivers/scsi/scsi_logging.h b/drivers/scsi/scsi_logging.h
-index 1f65139e14f8d3e9dc470c696c1e3aedabf344a8..eef6227c3666209791904a4b86e842726704fe9d 100644
---- a/drivers/scsi/scsi_logging.h
-+++ b/drivers/scsi/scsi_logging.h
+diff -urNp linux-2.6.26.3/drivers/scsi/scsi_logging.h linux-2.6.26.3/drivers/scsi/scsi_logging.h
+--- linux-2.6.26.3/drivers/scsi/scsi_logging.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/scsi/scsi_logging.h	2008-08-09 12:03:29.000000000 -0400
@@ -13290,5 +13049,4 @@
-diff --git a/drivers/serial/8250_pci.c b/drivers/serial/8250_pci.c
-index 788c3559522d05254ce769b7a92395635da8fabc..a1acc67f6a77634cd4a58c33fc36d3aa955ce641 100644
---- a/drivers/serial/8250_pci.c
-+++ b/drivers/serial/8250_pci.c
-@@ -2844,7 +2844,7 @@ static struct pci_device_id serial_pci_tbl[] = {
+diff -urNp linux-2.6.26.3/drivers/serial/8250_pci.c linux-2.6.26.3/drivers/serial/8250_pci.c
+--- linux-2.6.26.3/drivers/serial/8250_pci.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/serial/8250_pci.c	2008-08-09 12:03:29.000000000 -0400
+@@ -2844,7 +2844,7 @@ static struct pci_device_id serial_pci_t
@@ -13303,5 +13061,4 @@
-diff --git a/drivers/usb/class/cdc-acm.c b/drivers/usb/class/cdc-acm.c
-index c3201affa0b6f99c17ff6d28c71e3cd08adb58c6..16af7468142b9035e8cc28a9e321fa244b93c976 100644
---- a/drivers/usb/class/cdc-acm.c
-+++ b/drivers/usb/class/cdc-acm.c
-@@ -1264,7 +1264,7 @@ static struct usb_device_id acm_ids[] = {
+diff -urNp linux-2.6.26.3/drivers/usb/class/cdc-acm.c linux-2.6.26.3/drivers/usb/class/cdc-acm.c
+--- linux-2.6.26.3/drivers/usb/class/cdc-acm.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/class/cdc-acm.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1264,7 +1264,7 @@ static struct usb_device_id acm_ids[] = 
@@ -13316,5 +13073,4 @@
-diff --git a/drivers/usb/class/usblp.c b/drivers/usb/class/usblp.c
-index 0647164d36db562758cde201619d98e5ed9327a1..6a710ba2983c73fa0cfc2a8412618f34af4090d9 100644
---- a/drivers/usb/class/usblp.c
-+++ b/drivers/usb/class/usblp.c
-@@ -227,7 +227,7 @@ static const struct quirk_printer_struct quirk_printers[] = {
+diff -urNp linux-2.6.26.3/drivers/usb/class/usblp.c linux-2.6.26.3/drivers/usb/class/usblp.c
+--- linux-2.6.26.3/drivers/usb/class/usblp.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/class/usblp.c	2008-08-09 12:03:29.000000000 -0400
+@@ -227,7 +227,7 @@ static const struct quirk_printer_struct
@@ -13329 +13085 @@
-@@ -1401,7 +1401,7 @@ static struct usb_device_id usblp_ids [] = {
+@@ -1401,7 +1401,7 @@ static struct usb_device_id usblp_ids []
@@ -13338,5 +13094,4 @@
-diff --git a/drivers/usb/core/hub.c b/drivers/usb/core/hub.c
-index 4cfe32a16c37fb689e8bab4796b6918a36728382..05a1f66076c73a0a9efe29bbe4c672fbfd35e871 100644
---- a/drivers/usb/core/hub.c
-+++ b/drivers/usb/core/hub.c
-@@ -3045,7 +3045,7 @@ static struct usb_device_id hub_id_table [] = {
+diff -urNp linux-2.6.26.3/drivers/usb/core/hub.c linux-2.6.26.3/drivers/usb/core/hub.c
+--- linux-2.6.26.3/drivers/usb/core/hub.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/core/hub.c	2008-08-09 12:03:29.000000000 -0400
+@@ -3045,7 +3045,7 @@ static struct usb_device_id hub_id_table
@@ -13351,5 +13106,4 @@
-diff --git a/drivers/usb/host/ehci-pci.c b/drivers/usb/host/ehci-pci.c
-index c46a58f9181ded00f97627f076277fd32db9ff79..85abafeaa0ad6d1ac3dc47bb9a4be4b02856ea24 100644
---- a/drivers/usb/host/ehci-pci.c
-+++ b/drivers/usb/host/ehci-pci.c
-@@ -390,7 +390,7 @@ static const struct pci_device_id pci_ids [] = { {
+diff -urNp linux-2.6.26.3/drivers/usb/host/ehci-pci.c linux-2.6.26.3/drivers/usb/host/ehci-pci.c
+--- linux-2.6.26.3/drivers/usb/host/ehci-pci.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/host/ehci-pci.c	2008-08-09 12:03:29.000000000 -0400
+@@ -390,7 +390,7 @@ static const struct pci_device_id pci_id
@@ -13364,5 +13118,4 @@
-diff --git a/drivers/usb/host/uhci-hcd.c b/drivers/usb/host/uhci-hcd.c
-index 3a7bfe7a8874c321990bb802910ea4a902671c9a..6f1d8c8d4f86354eafbf9aa4f54e52dd9d678645 100644
---- a/drivers/usb/host/uhci-hcd.c
-+++ b/drivers/usb/host/uhci-hcd.c
-@@ -928,7 +928,7 @@ static const struct pci_device_id uhci_pci_ids[] = { {
+diff -urNp linux-2.6.26.3/drivers/usb/host/uhci-hcd.c linux-2.6.26.3/drivers/usb/host/uhci-hcd.c
+--- linux-2.6.26.3/drivers/usb/host/uhci-hcd.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/host/uhci-hcd.c	2008-08-09 12:03:29.000000000 -0400
+@@ -928,7 +928,7 @@ static const struct pci_device_id uhci_p
@@ -13377,5 +13130,4 @@
-diff --git a/drivers/usb/storage/debug.h b/drivers/usb/storage/debug.h
-index 77e244a8c37662c8db8773acc7c52802e7d224c8..4da40ab2aefed16223274c0ec1ba9b19b75ea324 100644
---- a/drivers/usb/storage/debug.h
-+++ b/drivers/usb/storage/debug.h
-@@ -56,9 +56,9 @@ void usb_stor_show_sense( unsigned char key,
+diff -urNp linux-2.6.26.3/drivers/usb/storage/debug.h linux-2.6.26.3/drivers/usb/storage/debug.h
+--- linux-2.6.26.3/drivers/usb/storage/debug.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/storage/debug.h	2008-08-09 12:03:29.000000000 -0400
+@@ -56,9 +56,9 @@ void usb_stor_show_sense( unsigned char 
@@ -13394,5 +13146,4 @@
-diff --git a/drivers/usb/storage/usb.c b/drivers/usb/storage/usb.c
-index e268aacb773a57e5041aac509389543b853614a0..777a569aebea9e1ac25302ec4b5c43f1b661484b 100644
---- a/drivers/usb/storage/usb.c
-+++ b/drivers/usb/storage/usb.c
-@@ -137,7 +137,7 @@ static struct usb_device_id storage_usb_ids [] = {
+diff -urNp linux-2.6.26.3/drivers/usb/storage/usb.c linux-2.6.26.3/drivers/usb/storage/usb.c
+--- linux-2.6.26.3/drivers/usb/storage/usb.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/usb/storage/usb.c	2008-08-09 12:03:29.000000000 -0400
+@@ -137,7 +137,7 @@ static struct usb_device_id storage_usb_
@@ -13407 +13158 @@
-@@ -177,7 +177,7 @@ static struct us_unusual_dev us_unusual_dev_list[] = {
+@@ -177,7 +177,7 @@ static struct us_unusual_dev us_unusual_
@@ -13416,5 +13167,4 @@
-diff --git a/drivers/video/fbcmap.c b/drivers/video/fbcmap.c
-index 91b78e691505d715b67de8c990f48ea8a1b420ea..c0e75fb72bdd0c5deab843ca7aead0cdf5c77a05 100644
---- a/drivers/video/fbcmap.c
-+++ b/drivers/video/fbcmap.c
-@@ -250,8 +250,7 @@ int fb_set_user_cmap(struct fb_cmap_user *cmap, struct fb_info *info)
+diff -urNp linux-2.6.26.3/drivers/video/fbcmap.c linux-2.6.26.3/drivers/video/fbcmap.c
+--- linux-2.6.26.3/drivers/video/fbcmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/fbcmap.c	2008-08-09 12:03:29.000000000 -0400
+@@ -250,8 +250,7 @@ int fb_set_user_cmap(struct fb_cmap_user
@@ -13430,5 +13180,4 @@
-diff --git a/drivers/video/fbmem.c b/drivers/video/fbmem.c
-index 776f7fcd2fbf4f508a0bb72398391aeb8f5a32d0..13751a73fd1c8ca0ff3086813e800b25d8257f08 100644
---- a/drivers/video/fbmem.c
-+++ b/drivers/video/fbmem.c
-@@ -395,7 +395,7 @@ static void fb_do_show_logo(struct fb_info *info, struct fb_image *image,
+diff -urNp linux-2.6.26.3/drivers/video/fbmem.c linux-2.6.26.3/drivers/video/fbmem.c
+--- linux-2.6.26.3/drivers/video/fbmem.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/fbmem.c	2008-08-09 12:03:29.000000000 -0400
+@@ -395,7 +395,7 @@ static void fb_do_show_logo(struct fb_in
@@ -13443 +13192 @@
-@@ -407,7 +407,7 @@ static void fb_do_show_logo(struct fb_info *info, struct fb_image *image,
+@@ -407,7 +407,7 @@ static void fb_do_show_logo(struct fb_in
@@ -13452 +13201 @@
-@@ -1084,7 +1084,7 @@ fb_ioctl(struct inode *inode, struct file *file, unsigned int cmd,
+@@ -1084,7 +1084,7 @@ fb_ioctl(struct inode *inode, struct fil
@@ -13461,4 +13210,3 @@
-diff --git a/drivers/video/fbmon.c b/drivers/video/fbmon.c
-index 052e180584987260a19a96a2e253b768af71f11e..d87bedb1c6a24712a440065d289b6e02ae71c1d0 100644
---- a/drivers/video/fbmon.c
-+++ b/drivers/video/fbmon.c
+diff -urNp linux-2.6.26.3/drivers/video/fbmon.c linux-2.6.26.3/drivers/video/fbmon.c
+--- linux-2.6.26.3/drivers/video/fbmon.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/fbmon.c	2008-08-09 12:03:29.000000000 -0400
@@ -13474,5 +13222,4 @@
-diff --git a/drivers/video/i810/i810_accel.c b/drivers/video/i810/i810_accel.c
-index 76764ea3486a7d31a77e0887548ea17696819672..9f3143dd72542c0a10d32582ba3de59d97765554 100644
---- a/drivers/video/i810/i810_accel.c
-+++ b/drivers/video/i810/i810_accel.c
-@@ -73,6 +73,7 @@ static inline int wait_for_space(struct fb_info *info, u32 space)
+diff -urNp linux-2.6.26.3/drivers/video/i810/i810_accel.c linux-2.6.26.3/drivers/video/i810/i810_accel.c
+--- linux-2.6.26.3/drivers/video/i810/i810_accel.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/i810/i810_accel.c	2008-08-09 12:03:29.000000000 -0400
+@@ -73,6 +73,7 @@ static inline int wait_for_space(struct 
@@ -13486,5 +13233,4 @@
-diff --git a/drivers/video/i810/i810_main.c b/drivers/video/i810/i810_main.c
-index a24e680d2b9c0f90e3a82f443583b5a03951171d..43072ac15ef9cda272601bf930eee99c0c3aae32 100644
---- a/drivers/video/i810/i810_main.c
-+++ b/drivers/video/i810/i810_main.c
-@@ -120,7 +120,7 @@ static struct pci_device_id i810fb_pci_tbl[] = {
+diff -urNp linux-2.6.26.3/drivers/video/i810/i810_main.c linux-2.6.26.3/drivers/video/i810/i810_main.c
+--- linux-2.6.26.3/drivers/video/i810/i810_main.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/i810/i810_main.c	2008-08-09 12:03:29.000000000 -0400
+@@ -120,7 +120,7 @@ static struct pci_device_id i810fb_pci_t
@@ -13499 +13245 @@
-@@ -1509,7 +1509,7 @@ static int i810fb_cursor(struct fb_info *info, struct fb_cursor *cursor)
+@@ -1509,7 +1509,7 @@ static int i810fb_cursor(struct fb_info 
@@ -13508,5 +13254,4 @@
-diff --git a/drivers/video/modedb.c b/drivers/video/modedb.c
-index d3c3af53a2905940c77dc4983f01e6a7caf03b16..2f13f034ba6a81c382559b90549f119557172f53 100644
---- a/drivers/video/modedb.c
-+++ b/drivers/video/modedb.c
-@@ -38,232 +38,232 @@ static const struct fb_videomode modedb[] = {
+diff -urNp linux-2.6.26.3/drivers/video/modedb.c linux-2.6.26.3/drivers/video/modedb.c
+--- linux-2.6.26.3/drivers/video/modedb.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/modedb.c	2008-08-09 12:03:29.000000000 -0400
+@@ -38,232 +38,232 @@ static const struct fb_videomode modedb[
@@ -13802,4 +13547,3 @@
-diff --git a/drivers/video/uvesafb.c b/drivers/video/uvesafb.c
-index cdbb56edb6cbdde9b34231b5e985c70c3e39efb4..79b9206b037b328ccefe0535b5d14de357873bbe 100644
---- a/drivers/video/uvesafb.c
-+++ b/drivers/video/uvesafb.c
+diff -urNp linux-2.6.26.3/drivers/video/uvesafb.c linux-2.6.26.3/drivers/video/uvesafb.c
+--- linux-2.6.26.3/drivers/video/uvesafb.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/uvesafb.c	2008-08-09 12:03:29.000000000 -0400
@@ -13823 +13567 @@
-@@ -569,10 +570,34 @@ static int __devinit uvesafb_vbe_getpmi(struct uvesafb_ktask *task,
+@@ -569,10 +570,34 @@ static int __devinit uvesafb_vbe_getpmi(
@@ -13870 +13614 @@
-@@ -1853,6 +1883,12 @@ static int uvesafb_remove(struct platform_device *dev)
+@@ -1853,6 +1883,12 @@ static int uvesafb_remove(struct platfor
@@ -13883,4 +13627,3 @@
-diff --git a/drivers/video/vesafb.c b/drivers/video/vesafb.c
-index e16322d157d0b9446a9e9cf6d0c2a99cc2898c7e..22564704a80ef906a26456a483e91c384715f1d4 100644
---- a/drivers/video/vesafb.c
-+++ b/drivers/video/vesafb.c
+diff -urNp linux-2.6.26.3/drivers/video/vesafb.c linux-2.6.26.3/drivers/video/vesafb.c
+--- linux-2.6.26.3/drivers/video/vesafb.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/drivers/video/vesafb.c	2008-08-09 12:03:29.000000000 -0400
@@ -13895 +13638 @@
-@@ -53,8 +54,8 @@ static int   vram_remap __initdata;		/* Set amount of memory to be used */
+@@ -53,8 +54,8 @@ static int   vram_remap __initdata;		/* 
@@ -13906 +13649 @@
-@@ -224,6 +225,7 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -224,6 +225,7 @@ static int __init vesafb_probe(struct pl
@@ -13914 +13657 @@
-@@ -266,10 +268,6 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -266,10 +268,6 @@ static int __init vesafb_probe(struct pl
@@ -13925 +13668 @@
-@@ -302,9 +300,21 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -302,9 +300,21 @@ static int __init vesafb_probe(struct pl
@@ -13949 +13692 @@
-@@ -312,9 +322,29 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -312,9 +322,29 @@ static int __init vesafb_probe(struct pl
@@ -13982 +13725 @@
-@@ -456,6 +486,11 @@ static int __init vesafb_probe(struct platform_device *dev)
+@@ -456,6 +486,11 @@ static int __init vesafb_probe(struct pl
@@ -13994,5 +13737,4 @@
-diff --git a/fs/9p/vfs_inode.c b/fs/9p/vfs_inode.c
-index c95295c65045a3540959b0ddb9c227e1366472f3..9dce08fc58495adc49563cc87630cbfc8f42aa90 100644
---- a/fs/9p/vfs_inode.c
-+++ b/fs/9p/vfs_inode.c
-@@ -1022,7 +1022,7 @@ static void *v9fs_vfs_follow_link(struct dentry *dentry, struct nameidata *nd)
+diff -urNp linux-2.6.26.3/fs/9p/vfs_inode.c linux-2.6.26.3/fs/9p/vfs_inode.c
+--- linux-2.6.26.3/fs/9p/vfs_inode.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/9p/vfs_inode.c	2008-08-09 12:03:34.000000000 -0400
+@@ -1022,7 +1022,7 @@ static void *v9fs_vfs_follow_link(struct
@@ -14007,25 +13749,4 @@
-diff --git a/fs/Kconfig b/fs/Kconfig
-index 2694648cbd1b6e7d235bc6dbb46cffa62482294d..a43757315f77551d0c8cd64737b71a9feca5b9ff 100644
---- a/fs/Kconfig
-+++ b/fs/Kconfig
-@@ -926,12 +926,12 @@ config PROC_FS
- 
- config PROC_KCORE
- 	bool "/proc/kcore support" if !ARM
--	depends on PROC_FS && MMU
-+	depends on PROC_FS && MMU && !GRKERNSEC_PROC_ADD
- 
- config PROC_VMCORE
-         bool "/proc/vmcore support (EXPERIMENTAL)"
--        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP
--	default y
-+        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP && !GRKERNSEC
-+	default n
-         help
-         Exports the dump image of crashed kernel in ELF format.
- 
-diff --git a/fs/aio.c b/fs/aio.c
-index 0fb3117ddd93d8a517720a744cd415a4b914f63c..60bb6771c2490783505ab043788efc6244fada04 100644
---- a/fs/aio.c
-+++ b/fs/aio.c
-@@ -114,7 +114,7 @@ static int aio_setup_ring(struct kioctx *ctx)
+diff -urNp linux-2.6.26.3/fs/aio.c linux-2.6.26.3/fs/aio.c
+--- linux-2.6.26.3/fs/aio.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/aio.c	2008-08-09 12:03:29.000000000 -0400
+@@ -114,7 +114,7 @@ static int aio_setup_ring(struct kioctx 
@@ -14040,4 +13761,3 @@
-diff --git a/fs/autofs4/symlink.c b/fs/autofs4/symlink.c
-index b4ea82934d2e3a7a8f2707cbac630b5627faca84..e63ef1885ef5fdcb68395d98b0c9f41e08828bf9 100644
---- a/fs/autofs4/symlink.c
-+++ b/fs/autofs4/symlink.c
+diff -urNp linux-2.6.26.3/fs/autofs4/symlink.c linux-2.6.26.3/fs/autofs4/symlink.c
+--- linux-2.6.26.3/fs/autofs4/symlink.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/autofs4/symlink.c	2008-08-09 12:03:29.000000000 -0400
@@ -14053,5 +13773,4 @@
-diff --git a/fs/befs/linuxvfs.c b/fs/befs/linuxvfs.c
-index e8717de3bab34f16f551004048fd91a4c6029cb1..c30c34828dab9fc0f5a47441dea2ca8210bdb919 100644
---- a/fs/befs/linuxvfs.c
-+++ b/fs/befs/linuxvfs.c
-@@ -489,7 +489,7 @@ static void befs_put_link(struct dentry *dentry, struct nameidata *nd, void *p)
+diff -urNp linux-2.6.26.3/fs/befs/linuxvfs.c linux-2.6.26.3/fs/befs/linuxvfs.c
+--- linux-2.6.26.3/fs/befs/linuxvfs.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/befs/linuxvfs.c	2008-08-09 12:03:29.000000000 -0400
+@@ -489,7 +489,7 @@ static void befs_put_link(struct dentry 
@@ -14066,4 +13785,3 @@
-diff --git a/fs/binfmt_aout.c b/fs/binfmt_aout.c
-index ba4cddb92f1ddf02330760e7b7614d7b261a5a64..5a14b6b2537c37f1bdcc8eebc82c95c047c4703e 100644
---- a/fs/binfmt_aout.c
-+++ b/fs/binfmt_aout.c
+diff -urNp linux-2.6.26.3/fs/binfmt_aout.c linux-2.6.26.3/fs/binfmt_aout.c
+--- linux-2.6.26.3/fs/binfmt_aout.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/binfmt_aout.c	2008-08-09 12:03:29.000000000 -0400
@@ -14078 +13796 @@
-@@ -124,18 +125,22 @@ static int aout_core_dump(long signr, struct pt_regs *regs, struct file *file, u
+@@ -124,18 +125,22 @@ static int aout_core_dump(long signr, st
@@ -14101 +13819 @@
-@@ -291,6 +296,8 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
+@@ -291,6 +296,8 @@ static int load_aout_binary(struct linux
@@ -14110 +13828 @@
-@@ -322,6 +329,28 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
+@@ -322,6 +329,28 @@ static int load_aout_binary(struct linux
@@ -14139 +13857 @@
-@@ -413,7 +442,7 @@ static int load_aout_binary(struct linux_binprm * bprm, struct pt_regs * regs)
+@@ -413,7 +442,7 @@ static int load_aout_binary(struct linux
@@ -14148,4 +13866,3 @@
-diff --git a/fs/binfmt_elf.c b/fs/binfmt_elf.c
-index d48ff5f370f4e5122c3402ed44889564366ad317..76e0ba385825f3c18c31eeffaecd339a31d6ba86 100644
---- a/fs/binfmt_elf.c
-+++ b/fs/binfmt_elf.c
+diff -urNp linux-2.6.26.3/fs/binfmt_elf.c linux-2.6.26.3/fs/binfmt_elf.c
+--- linux-2.6.26.3/fs/binfmt_elf.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/binfmt_elf.c	2008-08-09 12:03:29.000000000 -0400
@@ -14169 +13886 @@
-@@ -84,6 +90,8 @@ static struct linux_binfmt elf_format = {
+@@ -84,6 +90,8 @@ static struct linux_binfmt elf_format = 
@@ -14178 +13895 @@
-@@ -94,7 +102,7 @@ static int set_brk(unsigned long start, unsigned long end)
+@@ -94,7 +102,7 @@ static int set_brk(unsigned long start, 
@@ -14187 +13904 @@
-@@ -351,10 +359,10 @@ static unsigned long load_elf_interp(struct elfhdr *interp_elf_ex,
+@@ -351,10 +359,10 @@ static unsigned long load_elf_interp(str
@@ -14200 +13917 @@
-@@ -400,6 +408,11 @@ static unsigned long load_elf_interp(struct elfhdr *interp_elf_ex,
+@@ -400,6 +408,11 @@ static unsigned long load_elf_interp(str
@@ -14212 +13929 @@
-@@ -443,8 +456,8 @@ static unsigned long load_elf_interp(struct elfhdr *interp_elf_ex,
+@@ -443,8 +456,8 @@ static unsigned long load_elf_interp(str
@@ -14401 +14118 @@
-@@ -514,6 +698,11 @@ static unsigned long randomize_stack_top(unsigned long stack_top)
+@@ -514,6 +698,11 @@ static unsigned long randomize_stack_top
@@ -14413 +14130 @@
-@@ -532,7 +721,7 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -532,7 +721,7 @@ static int load_elf_binary(struct linux_
@@ -14422 +14139 @@
-@@ -543,11 +732,11 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -543,11 +732,11 @@ static int load_elf_binary(struct linux_
@@ -14435 +14152 @@
-@@ -715,11 +904,79 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -715,11 +904,79 @@ static int load_elf_binary(struct linux_
@@ -14516 +14233 @@
-@@ -800,6 +1057,20 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -800,6 +1057,20 @@ static int load_elf_binary(struct linux_
@@ -14537 +14254 @@
-@@ -832,9 +1103,9 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -832,9 +1103,9 @@ static int load_elf_binary(struct linux_
@@ -14550 +14267 @@
-@@ -862,6 +1133,11 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -862,6 +1133,11 @@ static int load_elf_binary(struct linux_
@@ -14562 +14279 @@
-@@ -873,9 +1149,11 @@ static int load_elf_binary(struct linux_binprm *bprm, struct pt_regs *regs)
+@@ -873,9 +1149,11 @@ static int load_elf_binary(struct linux_
@@ -14577 +14294 @@
-@@ -1118,8 +1396,10 @@ static int dump_seek(struct file *file, loff_t off)
+@@ -1118,8 +1396,10 @@ static int dump_seek(struct file *file, 
@@ -14589 +14306 @@
-@@ -1131,7 +1411,7 @@ static int dump_seek(struct file *file, loff_t off)
+@@ -1131,7 +1411,7 @@ static int dump_seek(struct file *file, 
@@ -14598 +14315 @@
-@@ -1157,7 +1437,7 @@ static unsigned long vma_dump_size(struct vm_area_struct *vma,
+@@ -1157,7 +1437,7 @@ static unsigned long vma_dump_size(struc
@@ -14607 +14324 @@
-@@ -1243,8 +1523,11 @@ static int writenote(struct memelfnote *men, struct file *file,
+@@ -1243,8 +1523,11 @@ static int writenote(struct memelfnote *
@@ -14620 +14337 @@
-@@ -1957,7 +2240,7 @@ static int elf_core_dump(long signr, struct pt_regs *regs, struct file *file, un
+@@ -1957,7 +2240,7 @@ static int elf_core_dump(long signr, str
@@ -14629 +14346 @@
-@@ -1989,7 +2272,7 @@ static int elf_core_dump(long signr, struct pt_regs *regs, struct file *file, un
+@@ -1989,7 +2272,7 @@ static int elf_core_dump(long signr, str
@@ -14638 +14355 @@
-@@ -2009,6 +2292,7 @@ static int elf_core_dump(long signr, struct pt_regs *regs, struct file *file, un
+@@ -2009,6 +2292,7 @@ static int elf_core_dump(long signr, str
@@ -14646,5 +14363,4 @@
-diff --git a/fs/binfmt_flat.c b/fs/binfmt_flat.c
-index 2cb1acda3a82f70a9f809e880d499999e39edd9d..2d7d8c87a025d445339f7b5982271f3e42ec00f4 100644
---- a/fs/binfmt_flat.c
-+++ b/fs/binfmt_flat.c
-@@ -561,7 +561,9 @@ static int load_flat_file(struct linux_binprm * bprm,
+diff -urNp linux-2.6.26.3/fs/binfmt_flat.c linux-2.6.26.3/fs/binfmt_flat.c
+--- linux-2.6.26.3/fs/binfmt_flat.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/binfmt_flat.c	2008-08-09 12:03:29.000000000 -0400
+@@ -561,7 +561,9 @@ static int load_flat_file(struct linux_b
@@ -14660 +14376 @@
-@@ -583,8 +585,10 @@ static int load_flat_file(struct linux_binprm * bprm,
+@@ -583,8 +585,10 @@ static int load_flat_file(struct linux_b
@@ -14671 +14387 @@
-@@ -657,8 +661,10 @@ static int load_flat_file(struct linux_binprm * bprm,
+@@ -657,8 +661,10 @@ static int load_flat_file(struct linux_b
@@ -14682,5 +14398,4 @@
-diff --git a/fs/binfmt_misc.c b/fs/binfmt_misc.c
-index 7191306367c5d11912ceed01c5fce4925b528eba..d03980451bb5f1d3b441dfbc267501737473e673 100644
---- a/fs/binfmt_misc.c
-+++ b/fs/binfmt_misc.c
-@@ -710,7 +710,7 @@ static int bm_fill_super(struct super_block * sb, void * data, int silent)
+diff -urNp linux-2.6.26.3/fs/binfmt_misc.c linux-2.6.26.3/fs/binfmt_misc.c
+--- linux-2.6.26.3/fs/binfmt_misc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/binfmt_misc.c	2008-08-09 12:03:29.000000000 -0400
+@@ -710,7 +710,7 @@ static int bm_fill_super(struct super_bl
@@ -14695,4 +14410,3 @@
-diff --git a/fs/buffer.c b/fs/buffer.c
-index 0f51c0f7c266ee7ebf940d94f869081a4d80b084..aac49a22522ce86b0549f48ac045bb0ef90d1199 100644
---- a/fs/buffer.c
-+++ b/fs/buffer.c
+diff -urNp linux-2.6.26.3/fs/buffer.c linux-2.6.26.3/fs/buffer.c
+--- linux-2.6.26.3/fs/buffer.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/buffer.c	2008-08-09 12:03:29.000000000 -0400
@@ -14707 +14421 @@
-@@ -2191,6 +2192,7 @@ int generic_cont_expand_simple(struct inode *inode, loff_t size)
+@@ -2191,6 +2192,7 @@ int generic_cont_expand_simple(struct in
@@ -14715,5 +14429,4 @@
-diff --git a/fs/cifs/cifs_uniupr.h b/fs/cifs/cifs_uniupr.h
-index 18a9d978e5190dfc9e3974fdf46f193d0c29d8b6..97671db849b5c4a6a3ace0f6849385e6828be85a 100644
---- a/fs/cifs/cifs_uniupr.h
-+++ b/fs/cifs/cifs_uniupr.h
-@@ -132,7 +132,7 @@ const struct UniCaseRange CifsUniUpperRange[] = {
+diff -urNp linux-2.6.26.3/fs/cifs/cifs_uniupr.h linux-2.6.26.3/fs/cifs/cifs_uniupr.h
+--- linux-2.6.26.3/fs/cifs/cifs_uniupr.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/cifs/cifs_uniupr.h	2008-08-09 12:03:29.000000000 -0400
+@@ -132,7 +132,7 @@ const struct UniCaseRange CifsUniUpperRa
@@ -14728,5 +14441,4 @@
-diff --git a/fs/cifs/link.c b/fs/cifs/link.c
-index 63f644000ce5982320cf1d5de19a88b6e0130173..69274d89ad7e39abc684a4f0856c5ce87f1fc6e1 100644
---- a/fs/cifs/link.c
-+++ b/fs/cifs/link.c
-@@ -318,7 +318,7 @@ cifs_readlink(struct dentry *direntry, char __user *pBuffer, int buflen)
+diff -urNp linux-2.6.26.3/fs/cifs/link.c linux-2.6.26.3/fs/cifs/link.c
+--- linux-2.6.26.3/fs/cifs/link.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/cifs/link.c	2008-08-09 12:03:29.000000000 -0400
+@@ -318,7 +318,7 @@ cifs_readlink(struct dentry *direntry, c
@@ -14741,4 +14453,3 @@
-diff --git a/fs/compat.c b/fs/compat.c
-index ed43e17a5dc68ad6663d28bc5abef135492c2e52..7158120b35c3760b976f94223ade1b6a4cfb415f 100644
---- a/fs/compat.c
-+++ b/fs/compat.c
+diff -urNp linux-2.6.26.3/fs/compat.c linux-2.6.26.3/fs/compat.c
+--- linux-2.6.26.3/fs/compat.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/compat.c	2008-08-09 12:03:29.000000000 -0400
@@ -14753 +14464 @@
-@@ -1294,14 +1295,12 @@ static int compat_copy_strings(int argc, compat_uptr_t __user *argv,
+@@ -1294,14 +1295,12 @@ static int compat_copy_strings(int argc,
@@ -14846,4 +14557,3 @@
-diff --git a/fs/compat_ioctl.c b/fs/compat_ioctl.c
-index 97dba0d92348d27692c4f9c10bc6e99c25333cd8..45512dc7cd27cfbcba22eb0db6772dad7397ecea 100644
---- a/fs/compat_ioctl.c
-+++ b/fs/compat_ioctl.c
+diff -urNp linux-2.6.26.3/fs/compat_ioctl.c linux-2.6.26.3/fs/compat_ioctl.c
+--- linux-2.6.26.3/fs/compat_ioctl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/compat_ioctl.c	2008-08-09 12:03:29.000000000 -0400
@@ -14869,5 +14579,4 @@
-diff --git a/fs/debugfs/inode.c b/fs/debugfs/inode.c
-index e9602d85c11d0220d5cbccf7817c25b10a6d068e..34a8acb48bd14516c7ddbf8179efeecbcd863c95 100644
---- a/fs/debugfs/inode.c
-+++ b/fs/debugfs/inode.c
-@@ -121,7 +121,7 @@ static inline int debugfs_positive(struct dentry *dentry)
+diff -urNp linux-2.6.26.3/fs/debugfs/inode.c linux-2.6.26.3/fs/debugfs/inode.c
+--- linux-2.6.26.3/fs/debugfs/inode.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/debugfs/inode.c	2008-08-09 12:03:29.000000000 -0400
+@@ -121,7 +121,7 @@ static inline int debugfs_positive(struc
@@ -14882,4 +14591,3 @@
-diff --git a/fs/exec.c b/fs/exec.c
-index fd9234379e8d2816965ff924ace687160ff0c365..450098937e4d937b2dded56374f6a6ffa0a97a07 100644
---- a/fs/exec.c
-+++ b/fs/exec.c
+diff -urNp linux-2.6.26.3/fs/exec.c linux-2.6.26.3/fs/exec.c
+--- linux-2.6.26.3/fs/exec.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/exec.c	2008-08-09 13:07:51.000000000 -0400
@@ -14912 +14620 @@
-@@ -163,18 +175,10 @@ static struct page *get_arg_page(struct linux_binprm *bprm, unsigned long pos,
+@@ -163,18 +175,10 @@ static struct page *get_arg_page(struct 
@@ -14934 +14642 @@
-@@ -247,6 +251,11 @@ static int __bprm_mm_init(struct linux_binprm *bprm)
+@@ -247,6 +251,11 @@ static int __bprm_mm_init(struct linux_b
@@ -14946 +14654 @@
-@@ -259,6 +268,11 @@ static int __bprm_mm_init(struct linux_binprm *bprm)
+@@ -259,6 +268,11 @@ static int __bprm_mm_init(struct linux_b
@@ -14958 +14666 @@
-@@ -382,7 +396,7 @@ static int count(char __user * __user * argv, int max)
+@@ -382,7 +396,7 @@ static int count(char __user * __user * 
@@ -14967 +14675 @@
-@@ -522,6 +536,10 @@ static int shift_arg_pages(struct vm_area_struct *vma, unsigned long shift)
+@@ -522,6 +536,10 @@ static int shift_arg_pages(struct vm_are
@@ -14978 +14686 @@
-@@ -610,6 +628,14 @@ int setup_arg_pages(struct linux_binprm *bprm,
+@@ -610,6 +628,14 @@ int setup_arg_pages(struct linux_binprm 
@@ -14993 +14701 @@
-@@ -623,21 +649,24 @@ int setup_arg_pages(struct linux_binprm *bprm,
+@@ -623,21 +649,24 @@ int setup_arg_pages(struct linux_binprm 
@@ -15027 +14735 @@
-@@ -649,7 +678,7 @@ int setup_arg_pages(struct linux_binprm *bprm,
+@@ -649,7 +678,7 @@ int setup_arg_pages(struct linux_binprm 
@@ -15260 +14968 @@
-@@ -1702,6 +1909,10 @@ int do_coredump(long signr, int exit_code, struct pt_regs * regs)
+@@ -1702,6 +1909,10 @@ int do_coredump(long signr, int exit_cod
@@ -15271 +14979 @@
-@@ -1722,6 +1933,8 @@ int do_coredump(long signr, int exit_code, struct pt_regs * regs)
+@@ -1722,6 +1933,8 @@ int do_coredump(long signr, int exit_cod
@@ -15280,5 +14988,4 @@
-diff --git a/fs/ext2/balloc.c b/fs/ext2/balloc.c
-index 10bb02c3f25cfcdee98897b6d7efe96e5f3ae6a1..4968eb715842564ebd4eb1bed216c6713a7f1900 100644
---- a/fs/ext2/balloc.c
-+++ b/fs/ext2/balloc.c
-@@ -1192,7 +1192,7 @@ static int ext2_has_free_blocks(struct ext2_sb_info *sbi)
+diff -urNp linux-2.6.26.3/fs/ext2/balloc.c linux-2.6.26.3/fs/ext2/balloc.c
+--- linux-2.6.26.3/fs/ext2/balloc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ext2/balloc.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1192,7 +1192,7 @@ static int ext2_has_free_blocks(struct e
@@ -15293,5 +15000,4 @@
-diff --git a/fs/ext3/balloc.c b/fs/ext3/balloc.c
-index 92fd0338a6ebe3df16739b65feec4e4ef034206f..348395ad884b4f1cd058f1726b37b89da001c21c 100644
---- a/fs/ext3/balloc.c
-+++ b/fs/ext3/balloc.c
-@@ -1421,7 +1421,7 @@ static int ext3_has_free_blocks(struct ext3_sb_info *sbi)
+diff -urNp linux-2.6.26.3/fs/ext3/balloc.c linux-2.6.26.3/fs/ext3/balloc.c
+--- linux-2.6.26.3/fs/ext3/balloc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ext3/balloc.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1421,7 +1421,7 @@ static int ext3_has_free_blocks(struct e
@@ -15306,5 +15012,4 @@
-diff --git a/fs/ext3/namei.c b/fs/ext3/namei.c
-index 0b8cf80154f1a5c912a1b2d6cae18ccebea591c1..55e72c69f0a6b54015b7b8a65bdcb39071957be6 100644
---- a/fs/ext3/namei.c
-+++ b/fs/ext3/namei.c
-@@ -1171,9 +1171,9 @@ static struct ext3_dir_entry_2 *do_split(handle_t *handle, struct inode *dir,
+diff -urNp linux-2.6.26.3/fs/ext3/namei.c linux-2.6.26.3/fs/ext3/namei.c
+--- linux-2.6.26.3/fs/ext3/namei.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ext3/namei.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1171,9 +1171,9 @@ static struct ext3_dir_entry_2 *do_split
@@ -15322,4 +15027,3 @@
-diff --git a/fs/ext3/xattr.c b/fs/ext3/xattr.c
-index 175414ac22109ef19bf0cf5841d131000cb7e6d2..8650a38efc8e3adf3d2120164df2a4a7060d8914 100644
---- a/fs/ext3/xattr.c
-+++ b/fs/ext3/xattr.c
+diff -urNp linux-2.6.26.3/fs/ext3/xattr.c linux-2.6.26.3/fs/ext3/xattr.c
+--- linux-2.6.26.3/fs/ext3/xattr.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ext3/xattr.c	2008-08-09 12:03:29.000000000 -0400
@@ -15337,5 +15041,4 @@
-diff --git a/fs/ext4/balloc.c b/fs/ext4/balloc.c
-index 9cc80b9cc8d8fa874659f7d4280d0f0e6fba5eca..256f9be3ecf5c35ca04a3faccaf288674f2eb84e 100644
---- a/fs/ext4/balloc.c
-+++ b/fs/ext4/balloc.c
-@@ -1608,7 +1608,7 @@ static int ext4_has_free_blocks(struct ext4_sb_info *sbi)
+diff -urNp linux-2.6.26.3/fs/ext4/balloc.c linux-2.6.26.3/fs/ext4/balloc.c
+--- linux-2.6.26.3/fs/ext4/balloc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ext4/balloc.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1608,7 +1608,7 @@ static int ext4_has_free_blocks(struct e
@@ -15350,5 +15053,4 @@
-diff --git a/fs/ext4/namei.c b/fs/ext4/namei.c
-index ab16beaa830d3814250146d044f8d2c4a59c7dd4..ef36c1fabe8433307dc6c250cb3f6774ff4b1308 100644
---- a/fs/ext4/namei.c
-+++ b/fs/ext4/namei.c
-@@ -1173,9 +1173,9 @@ static struct ext4_dir_entry_2 *do_split(handle_t *handle, struct inode *dir,
+diff -urNp linux-2.6.26.3/fs/ext4/namei.c linux-2.6.26.3/fs/ext4/namei.c
+--- linux-2.6.26.3/fs/ext4/namei.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ext4/namei.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1173,9 +1173,9 @@ static struct ext4_dir_entry_2 *do_split
@@ -15366,4 +15068,3 @@
-diff --git a/fs/fcntl.c b/fs/fcntl.c
-index bfd776509a7271e324c5559397542c36c4564a34..959014f2f049e3bcf966122fed29c4f6a9436424 100644
---- a/fs/fcntl.c
-+++ b/fs/fcntl.c
+diff -urNp linux-2.6.26.3/fs/fcntl.c linux-2.6.26.3/fs/fcntl.c
+--- linux-2.6.26.3/fs/fcntl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/fcntl.c	2008-08-09 12:03:29.000000000 -0400
@@ -15378 +15079 @@
-@@ -67,6 +68,7 @@ static int locate_fd(unsigned int orig_start, int cloexec)
+@@ -67,6 +68,7 @@ static int locate_fd(unsigned int orig_s
@@ -15394 +15095 @@
-@@ -133,6 +136,8 @@ asmlinkage long sys_dup2(unsigned int oldfd, unsigned int newfd)
+@@ -133,6 +136,8 @@ asmlinkage long sys_dup2(unsigned int ol
@@ -15403 +15104 @@
-@@ -452,7 +457,8 @@ static inline int sigio_perm(struct task_struct *p,
+@@ -452,7 +457,8 @@ static inline int sigio_perm(struct task
@@ -15413,5 +15114,4 @@
-diff --git a/fs/fuse/control.c b/fs/fuse/control.c
-index 4f3cab32141584264789ab3446f962d631ba04ab..80727a8f8c40321507b5d5798d97b12f8d684f55 100644
---- a/fs/fuse/control.c
-+++ b/fs/fuse/control.c
-@@ -159,7 +159,7 @@ void fuse_ctl_remove_conn(struct fuse_conn *fc)
+diff -urNp linux-2.6.26.3/fs/fuse/control.c linux-2.6.26.3/fs/fuse/control.c
+--- linux-2.6.26.3/fs/fuse/control.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/fuse/control.c	2008-08-09 12:03:29.000000000 -0400
+@@ -159,7 +159,7 @@ void fuse_ctl_remove_conn(struct fuse_co
@@ -15426,5 +15126,4 @@
-diff --git a/fs/fuse/dir.c b/fs/fuse/dir.c
-index 2060bf06b90625cf920aa08f87da07bd286a193f..d3ddaff13122b6849eb987939f341a0821065847 100644
---- a/fs/fuse/dir.c
-+++ b/fs/fuse/dir.c
-@@ -1031,7 +1031,7 @@ static char *read_link(struct dentry *dentry)
+diff -urNp linux-2.6.26.3/fs/fuse/dir.c linux-2.6.26.3/fs/fuse/dir.c
+--- linux-2.6.26.3/fs/fuse/dir.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/fuse/dir.c	2008-08-09 12:03:29.000000000 -0400
+@@ -1031,7 +1031,7 @@ static char *read_link(struct dentry *de
@@ -15439,5 +15138,4 @@
-diff --git a/fs/hfs/inode.c b/fs/hfs/inode.c
-index 97f8446c4ff415e8646a868ecce82d6ef77c20eb..71caa70f16362760a411230037ffa96f0d5fb89a 100644
---- a/fs/hfs/inode.c
-+++ b/fs/hfs/inode.c
-@@ -419,7 +419,7 @@ int hfs_write_inode(struct inode *inode, int unused)
+diff -urNp linux-2.6.26.3/fs/hfs/inode.c linux-2.6.26.3/fs/hfs/inode.c
+--- linux-2.6.26.3/fs/hfs/inode.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/hfs/inode.c	2008-08-09 12:03:29.000000000 -0400
+@@ -419,7 +419,7 @@ int hfs_write_inode(struct inode *inode,
@@ -15452 +15150 @@
-@@ -440,7 +440,7 @@ int hfs_write_inode(struct inode *inode, int unused)
+@@ -440,7 +440,7 @@ int hfs_write_inode(struct inode *inode,
@@ -15461,5 +15159,4 @@
-diff --git a/fs/hfsplus/inode.c b/fs/hfsplus/inode.c
-index 67e1c8b467c496565359331e79ca7c706166a30d..78829c94eda9a59dcabdf3b759c764c1feb18cb5 100644
---- a/fs/hfsplus/inode.c
-+++ b/fs/hfsplus/inode.c
-@@ -421,7 +421,7 @@ int hfsplus_cat_read_inode(struct inode *inode, struct hfs_find_data *fd)
+diff -urNp linux-2.6.26.3/fs/hfsplus/inode.c linux-2.6.26.3/fs/hfsplus/inode.c
+--- linux-2.6.26.3/fs/hfsplus/inode.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/hfsplus/inode.c	2008-08-09 12:03:29.000000000 -0400
+@@ -421,7 +421,7 @@ int hfsplus_cat_read_inode(struct inode 
@@ -15474 +15171 @@
-@@ -438,7 +438,7 @@ int hfsplus_cat_read_inode(struct inode *inode, struct hfs_find_data *fd)
+@@ -438,7 +438,7 @@ int hfsplus_cat_read_inode(struct inode 
@@ -15483 +15180 @@
-@@ -494,7 +494,7 @@ int hfsplus_cat_write_inode(struct inode *inode)
+@@ -494,7 +494,7 @@ int hfsplus_cat_write_inode(struct inode
@@ -15492 +15189 @@
-@@ -516,7 +516,7 @@ int hfsplus_cat_write_inode(struct inode *inode)
+@@ -516,7 +516,7 @@ int hfsplus_cat_write_inode(struct inode
@@ -15501,4 +15198,3 @@
-diff --git a/fs/jffs2/debug.h b/fs/jffs2/debug.h
-index a113ecc3bafeeb5f74172d8d5eb98e09f6eb6979..b6498fb81aec95b6ba24b7a3d0b9af80f4521abf 100644
---- a/fs/jffs2/debug.h
-+++ b/fs/jffs2/debug.h
+diff -urNp linux-2.6.26.3/fs/jffs2/debug.h linux-2.6.26.3/fs/jffs2/debug.h
+--- linux-2.6.26.3/fs/jffs2/debug.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/jffs2/debug.h	2008-08-09 12:03:29.000000000 -0400
@@ -15606,5 +15302,4 @@
-diff --git a/fs/jffs2/erase.c b/fs/jffs2/erase.c
-index dddb2a6c9e2cfc087b6becc7f88d9e85ab1d02b4..2084038cc526579e00a0e0b8bd5f2ce87ea12bf9 100644
---- a/fs/jffs2/erase.c
-+++ b/fs/jffs2/erase.c
-@@ -431,7 +431,8 @@ static void jffs2_mark_erased_block(struct jffs2_sb_info *c, struct jffs2_eraseb
+diff -urNp linux-2.6.26.3/fs/jffs2/erase.c linux-2.6.26.3/fs/jffs2/erase.c
+--- linux-2.6.26.3/fs/jffs2/erase.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/jffs2/erase.c	2008-08-09 12:03:30.000000000 -0400
+@@ -431,7 +431,8 @@ static void jffs2_mark_erased_block(stru
@@ -15620,5 +15315,4 @@
-diff --git a/fs/jffs2/summary.h b/fs/jffs2/summary.h
-index 8bf34f2fa5ce30b6f50f9d16de3ad5b9df31195e..e6c3f2ec7baba0234d7d8368ff5916c0e924d997 100644
---- a/fs/jffs2/summary.h
-+++ b/fs/jffs2/summary.h
-@@ -188,18 +188,18 @@ int jffs2_sum_scan_sumnode(struct jffs2_sb_info *c, struct jffs2_eraseblock *jeb
+diff -urNp linux-2.6.26.3/fs/jffs2/summary.h linux-2.6.26.3/fs/jffs2/summary.h
+--- linux-2.6.26.3/fs/jffs2/summary.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/jffs2/summary.h	2008-08-09 12:03:30.000000000 -0400
+@@ -188,18 +188,18 @@ int jffs2_sum_scan_sumnode(struct jffs2_
@@ -15652,5 +15346,4 @@
-diff --git a/fs/jffs2/wbuf.c b/fs/jffs2/wbuf.c
-index 0e78b00035e47a313ba43bafba87dfffbe9cf1b4..7865f7a166a38fdef397d39233b038e0da5dc933 100644
---- a/fs/jffs2/wbuf.c
-+++ b/fs/jffs2/wbuf.c
-@@ -1015,7 +1015,8 @@ static const struct jffs2_unknown_node oob_cleanmarker =
+diff -urNp linux-2.6.26.3/fs/jffs2/wbuf.c linux-2.6.26.3/fs/jffs2/wbuf.c
+--- linux-2.6.26.3/fs/jffs2/wbuf.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/jffs2/wbuf.c	2008-08-09 12:03:30.000000000 -0400
+@@ -1015,7 +1015,8 @@ static const struct jffs2_unknown_node o
@@ -15666,4 +15359,22 @@
-diff --git a/fs/namei.c b/fs/namei.c
-index 3b26a240ade94689cf4f8407dbd31d587185da9f..ec535196615c7eeb94643e93a59e8436fb901ece 100644
---- a/fs/namei.c
-+++ b/fs/namei.c
+diff -urNp linux-2.6.26.3/fs/Kconfig linux-2.6.26.3/fs/Kconfig
+--- linux-2.6.26.3/fs/Kconfig	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/Kconfig	2008-08-09 12:03:30.000000000 -0400
+@@ -926,12 +926,12 @@ config PROC_FS
+ 
+ config PROC_KCORE
+ 	bool "/proc/kcore support" if !ARM
+-	depends on PROC_FS && MMU
++	depends on PROC_FS && MMU && !GRKERNSEC_PROC_ADD
+ 
+ config PROC_VMCORE
+         bool "/proc/vmcore support (EXPERIMENTAL)"
+-        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP
+-	default y
++        depends on PROC_FS && EXPERIMENTAL && CRASH_DUMP && !GRKERNSEC
++	default n
+         help
+         Exports the dump image of crashed kernel in ELF format.
+ 
+diff -urNp linux-2.6.26.3/fs/namei.c linux-2.6.26.3/fs/namei.c
+--- linux-2.6.26.3/fs/namei.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/namei.c	2008-08-09 12:03:30.000000000 -0400
@@ -15678 +15389 @@
-@@ -673,7 +674,7 @@ static __always_inline int __do_follow_link(struct path *path, struct nameidata
+@@ -673,7 +674,7 @@ static __always_inline int __do_follow_l
@@ -15687 +15398 @@
-@@ -704,6 +705,13 @@ static inline int do_follow_link(struct path *path, struct nameidata *nd)
+@@ -704,6 +705,13 @@ static inline int do_follow_link(struct 
@@ -15720 +15431 @@
-@@ -1706,9 +1721,17 @@ static int __open_namei_create(struct nameidata *nd, struct path *path,
+@@ -1706,9 +1721,17 @@ static int __open_namei_create(struct na
@@ -15738 +15449 @@
-@@ -1789,6 +1812,17 @@ struct file *do_filp_open(int dfd, const char *pathname,
+@@ -1789,6 +1812,17 @@ struct file *do_filp_open(int dfd, const
@@ -15791 +15502 @@
-@@ -2110,9 +2165,21 @@ asmlinkage long sys_mknodat(int dfd, const char __user *filename, int mode,
+@@ -2110,9 +2165,21 @@ asmlinkage long sys_mknodat(int dfd, con
@@ -15813 +15524 @@
-@@ -2126,6 +2193,9 @@ asmlinkage long sys_mknodat(int dfd, const char __user *filename, int mode,
+@@ -2126,6 +2193,9 @@ asmlinkage long sys_mknodat(int dfd, con
@@ -15823 +15534 @@
-@@ -2184,6 +2254,11 @@ asmlinkage long sys_mkdirat(int dfd, const char __user *pathname, int mode)
+@@ -2184,6 +2254,11 @@ asmlinkage long sys_mkdirat(int dfd, con
@@ -15835 +15546 @@
-@@ -2191,6 +2266,10 @@ asmlinkage long sys_mkdirat(int dfd, const char __user *pathname, int mode)
+@@ -2191,6 +2266,10 @@ asmlinkage long sys_mkdirat(int dfd, con
@@ -15846 +15557 @@
-@@ -2273,6 +2352,8 @@ static long do_rmdir(int dfd, const char __user *pathname)
+@@ -2273,6 +2352,8 @@ static long do_rmdir(int dfd, const char
@@ -15855 +15566 @@
-@@ -2298,11 +2379,26 @@ static long do_rmdir(int dfd, const char __user *pathname)
+@@ -2298,11 +2379,26 @@ static long do_rmdir(int dfd, const char
@@ -15882 +15593 @@
-@@ -2363,6 +2459,8 @@ static long do_unlinkat(int dfd, const char __user *pathname)
+@@ -2363,6 +2459,8 @@ static long do_unlinkat(int dfd, const c
@@ -15891 +15602 @@
-@@ -2382,12 +2480,25 @@ static long do_unlinkat(int dfd, const char __user *pathname)
+@@ -2382,12 +2480,25 @@ static long do_unlinkat(int dfd, const c
@@ -15918 +15629 @@
-@@ -2469,10 +2580,18 @@ asmlinkage long sys_symlinkat(const char __user *oldname,
+@@ -2469,10 +2580,18 @@ asmlinkage long sys_symlinkat(const char
@@ -15937 +15648 @@
-@@ -2569,10 +2688,26 @@ asmlinkage long sys_linkat(int olddfd, const char __user *oldname,
+@@ -2569,10 +2688,26 @@ asmlinkage long sys_linkat(int olddfd, c
@@ -15964 +15675 @@
-@@ -2729,8 +2864,10 @@ int vfs_rename(struct inode *old_dir, struct dentry *old_dentry,
+@@ -2729,8 +2864,10 @@ int vfs_rename(struct inode *old_dir, st
@@ -15975 +15686 @@
-@@ -2800,11 +2937,21 @@ static int do_rename(int olddfd, const char *oldname,
+@@ -2800,11 +2937,21 @@ static int do_rename(int olddfd, const c
@@ -15997,4 +15708,3 @@
-diff --git a/fs/namespace.c b/fs/namespace.c
-index 4fc302c2a0e0f886e4026288bcdc50888ddf3551..fbc11a867042f407e1150ec2da3b70be583335d7 100644
---- a/fs/namespace.c
-+++ b/fs/namespace.c
+diff -urNp linux-2.6.26.3/fs/namespace.c linux-2.6.26.3/fs/namespace.c
+--- linux-2.6.26.3/fs/namespace.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/namespace.c	2008-08-09 12:03:30.000000000 -0400
@@ -16009 +15719 @@
-@@ -1085,6 +1086,8 @@ static int do_umount(struct vfsmount *mnt, int flags)
+@@ -1085,6 +1086,8 @@ static int do_umount(struct vfsmount *mn
@@ -16018 +15728 @@
-@@ -1108,6 +1111,9 @@ static int do_umount(struct vfsmount *mnt, int flags)
+@@ -1108,6 +1111,9 @@ static int do_umount(struct vfsmount *mn
@@ -16028 +15738 @@
-@@ -1940,6 +1946,11 @@ long do_mount(char *dev_name, char *dir_name, char *type_page,
+@@ -1940,6 +1946,11 @@ long do_mount(char *dev_name, char *dir_
@@ -16040 +15750 @@
-@@ -1954,6 +1965,9 @@ long do_mount(char *dev_name, char *dir_name, char *type_page,
+@@ -1954,6 +1965,9 @@ long do_mount(char *dev_name, char *dir_
@@ -16050 +15760 @@
-@@ -2072,6 +2086,9 @@ asmlinkage long sys_mount(char __user * dev_name, char __user * dir_name,
+@@ -2072,6 +2086,9 @@ asmlinkage long sys_mount(char __user * 
@@ -16060,5 +15770,4 @@
-diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.c
-index 806d17fac94427b4c9caf1529046fb317c74589c..7ec0a0b62e25b690ac039c1a57fcc96f8070d732 100644
---- a/fs/nfs/nfs4proc.c
-+++ b/fs/nfs/nfs4proc.c
-@@ -655,7 +655,7 @@ static int _nfs4_do_open_reclaim(struct nfs_open_context *ctx, struct nfs4_state
+diff -urNp linux-2.6.26.3/fs/nfs/nfs4proc.c linux-2.6.26.3/fs/nfs/nfs4proc.c
+--- linux-2.6.26.3/fs/nfs/nfs4proc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/nfs/nfs4proc.c	2008-08-09 12:03:30.000000000 -0400
+@@ -655,7 +655,7 @@ static int _nfs4_do_open_reclaim(struct 
@@ -16073 +15782 @@
-@@ -697,7 +697,7 @@ static int _nfs4_open_delegation_recall(struct nfs_open_context *ctx, struct nfs
+@@ -697,7 +697,7 @@ static int _nfs4_open_delegation_recall(
@@ -16082 +15791 @@
-@@ -990,7 +990,7 @@ static int _nfs4_open_expired(struct nfs_open_context *ctx, struct nfs4_state *s
+@@ -990,7 +990,7 @@ static int _nfs4_open_expired(struct nfs
@@ -16100 +15809 @@
-@@ -1181,7 +1181,7 @@ static int nfs4_do_setattr(struct inode *inode, struct nfs_fattr *fattr,
+@@ -1181,7 +1181,7 @@ static int nfs4_do_setattr(struct inode 
@@ -16109 +15818 @@
-@@ -1494,7 +1494,7 @@ static int _nfs4_server_capabilities(struct nfs_server *server, struct nfs_fh *f
+@@ -1494,7 +1494,7 @@ static int _nfs4_server_capabilities(str
@@ -16118 +15827 @@
-@@ -1527,7 +1527,7 @@ static int _nfs4_lookup_root(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -1527,7 +1527,7 @@ static int _nfs4_lookup_root(struct nfs_
@@ -16127 +15836 @@
-@@ -1616,7 +1616,7 @@ static int _nfs4_proc_getattr(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -1616,7 +1616,7 @@ static int _nfs4_proc_getattr(struct nfs
@@ -16136 +15845 @@
-@@ -1706,7 +1706,7 @@ static int nfs4_proc_lookupfh(struct nfs_server *server, struct nfs_fh *dirfh,
+@@ -1706,7 +1706,7 @@ static int nfs4_proc_lookupfh(struct nfs
@@ -16145 +15854 @@
-@@ -1735,7 +1735,7 @@ static int _nfs4_proc_lookup(struct inode *dir, const struct qstr *name,
+@@ -1735,7 +1735,7 @@ static int _nfs4_proc_lookup(struct inod
@@ -16154 +15863 @@
-@@ -1799,7 +1799,7 @@ static int _nfs4_proc_access(struct inode *inode, struct nfs_access_entry *entry
+@@ -1799,7 +1799,7 @@ static int _nfs4_proc_access(struct inod
@@ -16163 +15872 @@
-@@ -1854,7 +1854,7 @@ static int _nfs4_proc_readlink(struct inode *inode, struct page *page,
+@@ -1854,7 +1854,7 @@ static int _nfs4_proc_readlink(struct in
@@ -16172 +15881 @@
-@@ -1950,7 +1950,7 @@ static int _nfs4_proc_remove(struct inode *dir, struct qstr *name)
+@@ -1950,7 +1950,7 @@ static int _nfs4_proc_remove(struct inod
@@ -16181 +15890 @@
-@@ -2022,7 +2022,7 @@ static int _nfs4_proc_rename(struct inode *old_dir, struct qstr *old_name,
+@@ -2022,7 +2022,7 @@ static int _nfs4_proc_rename(struct inod
@@ -16190 +15899 @@
-@@ -2069,7 +2069,7 @@ static int _nfs4_proc_link(struct inode *inode, struct inode *dir, struct qstr *
+@@ -2069,7 +2069,7 @@ static int _nfs4_proc_link(struct inode 
@@ -16199 +15908 @@
-@@ -2126,7 +2126,7 @@ static int _nfs4_proc_symlink(struct inode *dir, struct dentry *dentry,
+@@ -2126,7 +2126,7 @@ static int _nfs4_proc_symlink(struct ino
@@ -16208 +15917 @@
-@@ -2179,7 +2179,7 @@ static int _nfs4_proc_mkdir(struct inode *dir, struct dentry *dentry,
+@@ -2179,7 +2179,7 @@ static int _nfs4_proc_mkdir(struct inode
@@ -16217 +15926 @@
-@@ -2228,7 +2228,7 @@ static int _nfs4_proc_readdir(struct dentry *dentry, struct rpc_cred *cred,
+@@ -2228,7 +2228,7 @@ static int _nfs4_proc_readdir(struct den
@@ -16226 +15935 @@
-@@ -2298,7 +2298,7 @@ static int _nfs4_proc_mknod(struct inode *dir, struct dentry *dentry,
+@@ -2298,7 +2298,7 @@ static int _nfs4_proc_mknod(struct inode
@@ -16235 +15944 @@
-@@ -2327,7 +2327,7 @@ static int _nfs4_proc_statfs(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -2327,7 +2327,7 @@ static int _nfs4_proc_statfs(struct nfs_
@@ -16244 +15953 @@
-@@ -2355,7 +2355,7 @@ static int _nfs4_do_fsinfo(struct nfs_server *server, struct nfs_fh *fhandle,
+@@ -2355,7 +2355,7 @@ static int _nfs4_do_fsinfo(struct nfs_se
@@ -16253 +15962 @@
-@@ -2398,7 +2398,7 @@ static int _nfs4_proc_pathconf(struct nfs_server *server, struct nfs_fh *fhandle
+@@ -2398,7 +2398,7 @@ static int _nfs4_proc_pathconf(struct nf
@@ -16271 +15980 @@
-@@ -2742,7 +2742,7 @@ static int __nfs4_proc_set_acl(struct inode *inode, const void *buf, size_t bufl
+@@ -2742,7 +2742,7 @@ static int __nfs4_proc_set_acl(struct in
@@ -16298 +16007 @@
-@@ -3459,7 +3459,7 @@ static int _nfs4_do_setlk(struct nfs4_state *state, int cmd, struct file_lock *f
+@@ -3459,7 +3459,7 @@ static int _nfs4_do_setlk(struct nfs4_st
@@ -16307 +16016 @@
-@@ -3477,7 +3477,7 @@ static int nfs4_lock_reclaim(struct nfs4_state *state, struct file_lock *request
+@@ -3477,7 +3477,7 @@ static int nfs4_lock_reclaim(struct nfs4
@@ -16325 +16034 @@
-@@ -3588,7 +3588,7 @@ nfs4_proc_lock(struct file *filp, int cmd, struct file_lock *request)
+@@ -3588,7 +3588,7 @@ nfs4_proc_lock(struct file *filp, int cm
@@ -16334,5 +16043,4 @@
-diff --git a/fs/nfsd/export.c b/fs/nfsd/export.c
-index 33bfcf09db46faaffa13472d1ffd351c7dad28fb..d68f2ecb70eb60f00bbbfc5574b6a5a25859e7a4 100644
---- a/fs/nfsd/export.c
-+++ b/fs/nfsd/export.c
-@@ -473,7 +473,7 @@ static int secinfo_parse(char **mesg, char *buf, struct svc_export *exp)
+diff -urNp linux-2.6.26.3/fs/nfsd/export.c linux-2.6.26.3/fs/nfsd/export.c
+--- linux-2.6.26.3/fs/nfsd/export.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/nfsd/export.c	2008-08-09 12:03:30.000000000 -0400
+@@ -473,7 +473,7 @@ static int secinfo_parse(char **mesg, ch
@@ -16347,5 +16055,4 @@
-diff --git a/fs/nls/nls_base.c b/fs/nls/nls_base.c
-index 64965e1c21c46ca2dcb9aae20611a0725e9d4f4b..2b4e67638b2982f5af206031c48f42209e21c2c4 100644
---- a/fs/nls/nls_base.c
-+++ b/fs/nls/nls_base.c
-@@ -42,7 +42,7 @@ static const struct utf8_table utf8_table[] =
+diff -urNp linux-2.6.26.3/fs/nls/nls_base.c linux-2.6.26.3/fs/nls/nls_base.c
+--- linux-2.6.26.3/fs/nls/nls_base.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/nls/nls_base.c	2008-08-09 12:03:30.000000000 -0400
+@@ -42,7 +42,7 @@ static const struct utf8_table utf8_tabl
@@ -16360,5 +16067,4 @@
-diff --git a/fs/ntfs/file.c b/fs/ntfs/file.c
-index 3c5550cd11d67b53a5d3ef6ff49dd6d4312f9d4c..451225e65c05bd8b21d5fa8b325d6d830bb68e86 100644
---- a/fs/ntfs/file.c
-+++ b/fs/ntfs/file.c
-@@ -2291,6 +2291,6 @@ const struct inode_operations ntfs_file_inode_ops = {
+diff -urNp linux-2.6.26.3/fs/ntfs/file.c linux-2.6.26.3/fs/ntfs/file.c
+--- linux-2.6.26.3/fs/ntfs/file.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ntfs/file.c	2008-08-09 12:03:30.000000000 -0400
+@@ -2291,6 +2291,6 @@ const struct inode_operations ntfs_file_
@@ -16373,4 +16079,3 @@
-diff --git a/fs/open.c b/fs/open.c
-index a99ad09c3197a1f60e4332f86520183cffa50bbd..4c2399008c266cf79a42b21524e56e1c292a3af9 100644
---- a/fs/open.c
-+++ b/fs/open.c
+diff -urNp linux-2.6.26.3/fs/open.c linux-2.6.26.3/fs/open.c
+--- linux-2.6.26.3/fs/open.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/open.c	2008-08-09 12:03:30.000000000 -0400
@@ -16385 +16090 @@
-@@ -206,6 +207,9 @@ int do_truncate(struct dentry *dentry, loff_t length, unsigned int time_attrs,
+@@ -206,6 +207,9 @@ int do_truncate(struct dentry *dentry, l
@@ -16395 +16100 @@
-@@ -478,6 +482,9 @@ asmlinkage long sys_faccessat(int dfd, const char __user *filename, int mode)
+@@ -478,6 +482,9 @@ asmlinkage long sys_faccessat(int dfd, c
@@ -16405 +16110 @@
-@@ -509,6 +516,8 @@ asmlinkage long sys_chdir(const char __user * filename)
+@@ -509,6 +516,8 @@ asmlinkage long sys_chdir(const char __u
@@ -16414 +16119 @@
-@@ -535,6 +544,13 @@ asmlinkage long sys_fchdir(unsigned int fd)
+@@ -535,6 +544,13 @@ asmlinkage long sys_fchdir(unsigned int 
@@ -16428 +16133 @@
-@@ -560,8 +576,16 @@ asmlinkage long sys_chroot(const char __user * filename)
+@@ -560,8 +576,16 @@ asmlinkage long sys_chroot(const char __
@@ -16445 +16150 @@
-@@ -592,9 +616,22 @@ asmlinkage long sys_fchmod(unsigned int fd, mode_t mode)
+@@ -592,9 +616,22 @@ asmlinkage long sys_fchmod(unsigned int 
@@ -16468 +16173 @@
-@@ -629,9 +666,21 @@ asmlinkage long sys_fchmodat(int dfd, const char __user *filename,
+@@ -629,9 +666,21 @@ asmlinkage long sys_fchmodat(int dfd, co
@@ -16490 +16195 @@
-@@ -650,7 +699,7 @@ asmlinkage long sys_chmod(const char __user *filename, mode_t mode)
+@@ -650,7 +699,7 @@ asmlinkage long sys_chmod(const char __u
@@ -16499 +16204 @@
-@@ -664,6 +713,12 @@ static int chown_common(struct dentry * dentry, uid_t user, gid_t group)
+@@ -664,6 +713,12 @@ static int chown_common(struct dentry * 
@@ -16512 +16217 @@
-@@ -694,7 +749,7 @@ asmlinkage long sys_chown(const char __user * filename, uid_t user, gid_t group)
+@@ -694,7 +749,7 @@ asmlinkage long sys_chown(const char __u
@@ -16521 +16226 @@
-@@ -719,7 +774,7 @@ asmlinkage long sys_fchownat(int dfd, const char __user *filename, uid_t user,
+@@ -719,7 +774,7 @@ asmlinkage long sys_fchownat(int dfd, co
@@ -16530 +16235 @@
-@@ -738,7 +793,7 @@ asmlinkage long sys_lchown(const char __user * filename, uid_t user, gid_t group
+@@ -738,7 +793,7 @@ asmlinkage long sys_lchown(const char __
@@ -16539 +16244 @@
-@@ -762,7 +817,7 @@ asmlinkage long sys_fchown(unsigned int fd, uid_t user, gid_t group)
+@@ -762,7 +817,7 @@ asmlinkage long sys_fchown(unsigned int 
@@ -16556,4 +16261,3 @@
-diff --git a/fs/partitions/efi.c b/fs/partitions/efi.c
-index e7b07006bc4173c5489c3bb1532f01e0473e4bf1..4210597efd47abc2eecb3a0be54689c2f24aa1a5 100644
---- a/fs/partitions/efi.c
-+++ b/fs/partitions/efi.c
+diff -urNp linux-2.6.26.3/fs/partitions/efi.c linux-2.6.26.3/fs/partitions/efi.c
+--- linux-2.6.26.3/fs/partitions/efi.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/partitions/efi.c	2008-08-09 12:03:30.000000000 -0400
@@ -16569,4 +16273,3 @@
-diff --git a/fs/pipe.c b/fs/pipe.c
-index 700f4e0d9572170a4de51527bc1698768a848afe..287e789f497ab2bd30ce04a260538de43f448e9b 100644
---- a/fs/pipe.c
-+++ b/fs/pipe.c
+diff -urNp linux-2.6.26.3/fs/pipe.c linux-2.6.26.3/fs/pipe.c
+--- linux-2.6.26.3/fs/pipe.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/pipe.c	2008-08-09 12:03:30.000000000 -0400
@@ -16582,5 +16285,4 @@
-diff --git a/fs/proc/array.c b/fs/proc/array.c
-index 797d775e0354fca502c8ab439c4e986c8e27d237..cf7da0e3290a48cd2ffb7dff2cd951a9154cb935 100644
---- a/fs/proc/array.c
-+++ b/fs/proc/array.c
-@@ -310,6 +310,21 @@ static inline void task_context_switch_counts(struct seq_file *m,
+diff -urNp linux-2.6.26.3/fs/proc/array.c linux-2.6.26.3/fs/proc/array.c
+--- linux-2.6.26.3/fs/proc/array.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/array.c	2008-08-09 12:03:30.000000000 -0400
+@@ -310,6 +310,21 @@ static inline void task_context_switch_c
@@ -16608 +16310 @@
-@@ -329,6 +344,11 @@ int proc_pid_status(struct seq_file *m, struct pid_namespace *ns,
+@@ -329,6 +344,11 @@ int proc_pid_status(struct seq_file *m, 
@@ -16620 +16322 @@
-@@ -391,6 +411,12 @@ static cputime_t task_gtime(struct task_struct *p)
+@@ -391,6 +411,12 @@ static cputime_t task_gtime(struct task_
@@ -16633 +16335 @@
-@@ -483,6 +509,19 @@ static int do_task_stat(struct seq_file *m, struct pid_namespace *ns,
+@@ -483,6 +509,19 @@ static int do_task_stat(struct seq_file 
@@ -16653 +16355 @@
-@@ -523,9 +562,15 @@ static int do_task_stat(struct seq_file *m, struct pid_namespace *ns,
+@@ -523,9 +562,15 @@ static int do_task_stat(struct seq_file 
@@ -16669 +16371 @@
-@@ -578,3 +623,10 @@ int proc_pid_statm(struct seq_file *m, struct pid_namespace *ns,
+@@ -578,3 +623,10 @@ int proc_pid_statm(struct seq_file *m, s
@@ -16680,4 +16382,3 @@
-diff --git a/fs/proc/base.c b/fs/proc/base.c
-index 3b455371e7ff50981229d98359344ef92a228d0e..a155b8740cda45535fbfda2dadcb8d88ec3d699d 100644
---- a/fs/proc/base.c
-+++ b/fs/proc/base.c
+diff -urNp linux-2.6.26.3/fs/proc/base.c linux-2.6.26.3/fs/proc/base.c
+--- linux-2.6.26.3/fs/proc/base.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/base.c	2008-08-09 12:03:30.000000000 -0400
@@ -16693 +16394 @@
-@@ -146,7 +148,7 @@ static unsigned int pid_entry_count_dirs(const struct pid_entry *entries,
+@@ -146,7 +148,7 @@ static unsigned int pid_entry_count_dirs
@@ -16702 +16403 @@
-@@ -227,6 +229,9 @@ static int check_mem_permission(struct task_struct *task)
+@@ -227,6 +229,9 @@ static int check_mem_permission(struct t
@@ -16712 +16413 @@
-@@ -305,9 +310,9 @@ static int proc_pid_auxv(struct task_struct *task, char *buffer)
+@@ -305,9 +310,9 @@ static int proc_pid_auxv(struct task_str
@@ -16724 +16425 @@
-@@ -1410,7 +1415,11 @@ static struct inode *proc_pid_make_inode(struct super_block * sb, struct task_st
+@@ -1410,7 +1415,11 @@ static struct inode *proc_pid_make_inode
@@ -16736 +16437 @@
-@@ -1426,17 +1435,45 @@ static int pid_getattr(struct vfsmount *mnt, struct dentry *dentry, struct kstat
+@@ -1426,17 +1435,45 @@ static int pid_getattr(struct vfsmount *
@@ -16783 +16484 @@
-@@ -1464,11 +1501,21 @@ static int pid_revalidate(struct dentry *dentry, struct nameidata *nd)
+@@ -1464,11 +1501,21 @@ static int pid_revalidate(struct dentry 
@@ -16805 +16506 @@
-@@ -1837,12 +1884,22 @@ static int proc_fd_permission(struct inode *inode, int mask,
+@@ -1837,12 +1884,22 @@ static int proc_fd_permission(struct ino
@@ -16830 +16531 @@
-@@ -1953,6 +2010,9 @@ static struct dentry *proc_pident_lookup(struct inode *dir,
+@@ -1953,6 +2010,9 @@ static struct dentry *proc_pident_lookup
@@ -16840 +16541 @@
-@@ -1997,6 +2057,9 @@ static int proc_pident_readdir(struct file *filp,
+@@ -1997,6 +2057,9 @@ static int proc_pident_readdir(struct fi
@@ -16850 +16551 @@
-@@ -2359,6 +2422,9 @@ static struct dentry *proc_base_lookup(struct inode *dir, struct dentry *dentry)
+@@ -2359,6 +2422,9 @@ static struct dentry *proc_base_lookup(s
@@ -16860 +16561 @@
-@@ -2471,6 +2537,9 @@ static const struct pid_entry tgid_base_stuff[] = {
+@@ -2471,6 +2537,9 @@ static const struct pid_entry tgid_base_
@@ -16870 +16571 @@
-@@ -2600,7 +2669,14 @@ static struct dentry *proc_pid_instantiate(struct inode *dir,
+@@ -2600,7 +2669,14 @@ static struct dentry *proc_pid_instantia
@@ -16885 +16586 @@
-@@ -2642,7 +2718,11 @@ struct dentry *proc_pid_lookup(struct inode *dir, struct dentry * dentry, struct
+@@ -2642,7 +2718,11 @@ struct dentry *proc_pid_lookup(struct in
@@ -16897 +16598 @@
-@@ -2707,6 +2787,9 @@ int proc_pid_readdir(struct file * filp, void * dirent, filldir_t filldir)
+@@ -2707,6 +2787,9 @@ int proc_pid_readdir(struct file * filp,
@@ -16907 +16608 @@
-@@ -2725,6 +2808,17 @@ int proc_pid_readdir(struct file * filp, void * dirent, filldir_t filldir)
+@@ -2725,6 +2808,17 @@ int proc_pid_readdir(struct file * filp,
@@ -16925,5 +16626,4 @@
-diff --git a/fs/proc/inode.c b/fs/proc/inode.c
-index b08d10017911f43927646943307e26238e4fe7dc..cf215ae7a2f9b56cfe0bde1b23a4adce56846202 100644
---- a/fs/proc/inode.c
-+++ b/fs/proc/inode.c
-@@ -403,7 +403,11 @@ struct inode *proc_get_inode(struct super_block *sb, unsigned int ino,
+diff -urNp linux-2.6.26.3/fs/proc/inode.c linux-2.6.26.3/fs/proc/inode.c
+--- linux-2.6.26.3/fs/proc/inode.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/inode.c	2008-08-09 12:03:30.000000000 -0400
+@@ -403,7 +403,11 @@ struct inode *proc_get_inode(struct supe
@@ -16941,5 +16641,4 @@
-diff --git a/fs/proc/internal.h b/fs/proc/internal.h
-index 28cbca8059057e5f1b7729b69743aea11cecc27c..161606d3d4869125c8c153de358f901837a8e618 100644
---- a/fs/proc/internal.h
-+++ b/fs/proc/internal.h
-@@ -55,6 +55,9 @@ extern int proc_pid_status(struct seq_file *m, struct pid_namespace *ns,
+diff -urNp linux-2.6.26.3/fs/proc/internal.h linux-2.6.26.3/fs/proc/internal.h
+--- linux-2.6.26.3/fs/proc/internal.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/internal.h	2008-08-09 12:03:30.000000000 -0400
+@@ -55,6 +55,9 @@ extern int proc_pid_status(struct seq_fi
@@ -16955,4 +16654,3 @@
-diff --git a/fs/proc/proc_misc.c b/fs/proc/proc_misc.c
-index 7e277f2ad466da31d9233a06f17963c718c37397..87059998af60cc615ddbaeeee41a2462b4f07ea8 100644
---- a/fs/proc/proc_misc.c
-+++ b/fs/proc/proc_misc.c
+diff -urNp linux-2.6.26.3/fs/proc/proc_misc.c linux-2.6.26.3/fs/proc/proc_misc.c
+--- linux-2.6.26.3/fs/proc/proc_misc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/proc_misc.c	2008-08-09 12:03:30.000000000 -0400
@@ -17022,5 +16720,4 @@
-diff --git a/fs/proc/proc_net.c b/fs/proc/proc_net.c
-index 83f357b30d71c583e4662784e53639b5391cf84e..0c46db3cdc9850eedb1d8aada7344307c7c2eadd 100644
---- a/fs/proc/proc_net.c
-+++ b/fs/proc/proc_net.c
-@@ -69,6 +69,14 @@ static struct net *get_proc_task_net(struct inode *dir)
+diff -urNp linux-2.6.26.3/fs/proc/proc_net.c linux-2.6.26.3/fs/proc/proc_net.c
+--- linux-2.6.26.3/fs/proc/proc_net.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/proc_net.c	2008-08-09 12:03:30.000000000 -0400
+@@ -69,6 +69,14 @@ static struct net *get_proc_task_net(str
@@ -17041,4 +16738,3 @@
-diff --git a/fs/proc/proc_sysctl.c b/fs/proc/proc_sysctl.c
-index 5acc001d49f6c72db83216173136701c2169f950..d263b9a0893da12b9ecf665de4903cc108c176bf 100644
---- a/fs/proc/proc_sysctl.c
-+++ b/fs/proc/proc_sysctl.c
+diff -urNp linux-2.6.26.3/fs/proc/proc_sysctl.c linux-2.6.26.3/fs/proc/proc_sysctl.c
+--- linux-2.6.26.3/fs/proc/proc_sysctl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/proc_sysctl.c	2008-08-09 12:03:30.000000000 -0400
@@ -17054 +16750 @@
-@@ -151,6 +153,9 @@ static struct dentry *proc_sys_lookup(struct inode *dir, struct dentry *dentry,
+@@ -151,6 +153,9 @@ static struct dentry *proc_sys_lookup(st
@@ -17064 +16760 @@
-@@ -332,6 +337,9 @@ static int proc_sys_readdir(struct file *filp, void *dirent, filldir_t filldir)
+@@ -332,6 +337,9 @@ static int proc_sys_readdir(struct file 
@@ -17105 +16801 @@
-@@ -422,6 +454,7 @@ static const struct inode_operations proc_sys_inode_operations = {
+@@ -422,6 +454,7 @@ static const struct inode_operations pro
@@ -17113,4 +16809,3 @@
-diff --git a/fs/proc/root.c b/fs/proc/root.c
-index 95117538a4f6fd3b4fdc90558127caa282d7e800..5bbdb2ec4e6522292683d4362dccfa0d1e5aca8d 100644
---- a/fs/proc/root.c
-+++ b/fs/proc/root.c
+diff -urNp linux-2.6.26.3/fs/proc/root.c linux-2.6.26.3/fs/proc/root.c
+--- linux-2.6.26.3/fs/proc/root.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/root.c	2008-08-09 12:03:30.000000000 -0400
@@ -17133,5 +16828,4 @@
-diff --git a/fs/proc/task_mmu.c b/fs/proc/task_mmu.c
-index 1eaa39a650c391279f9a9d97c6fbf15328323319..ee000da800734918baa95b172fd5ac1f3b2aff5a 100644
---- a/fs/proc/task_mmu.c
-+++ b/fs/proc/task_mmu.c
-@@ -46,15 +46,26 @@ void task_mem(struct seq_file *m, struct mm_struct *mm)
+diff -urNp linux-2.6.26.3/fs/proc/task_mmu.c linux-2.6.26.3/fs/proc/task_mmu.c
+--- linux-2.6.26.3/fs/proc/task_mmu.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/proc/task_mmu.c	2008-08-09 12:03:30.000000000 -0400
+@@ -46,15 +46,26 @@ void task_mem(struct seq_file *m, struct
@@ -17167 +16861 @@
-@@ -198,6 +209,12 @@ static int do_maps_open(struct inode *inode, struct file *file,
+@@ -198,6 +209,12 @@ static int do_maps_open(struct inode *in
@@ -17180 +16874 @@
-@@ -220,13 +237,22 @@ static int show_map(struct seq_file *m, void *v)
+@@ -220,13 +237,22 @@ static int show_map(struct seq_file *m, 
@@ -17203 +16897 @@
-@@ -240,11 +266,11 @@ static int show_map(struct seq_file *m, void *v)
+@@ -240,11 +266,11 @@ static int show_map(struct seq_file *m, 
@@ -17219 +16913 @@
-@@ -377,9 +403,16 @@ static int show_smap(struct seq_file *m, void *v)
+@@ -377,9 +403,16 @@ static int show_smap(struct seq_file *m,
@@ -17239 +16933 @@
-@@ -395,7 +428,11 @@ static int show_smap(struct seq_file *m, void *v)
+@@ -395,7 +428,11 @@ static int show_smap(struct seq_file *m,
@@ -17251 +16945 @@
-@@ -747,6 +784,11 @@ static int show_numa_map_checked(struct seq_file *m, void *v)
+@@ -747,6 +784,11 @@ static int show_numa_map_checked(struct 
@@ -17263,4 +16957,3 @@
-diff --git a/fs/readdir.c b/fs/readdir.c
-index 4e026e5407fb7516c3a52c8533f0159b6b7ecdd9..dd245680d82d2e2b333990277799741584ab1fa6 100644
---- a/fs/readdir.c
-+++ b/fs/readdir.c
+diff -urNp linux-2.6.26.3/fs/readdir.c linux-2.6.26.3/fs/readdir.c
+--- linux-2.6.26.3/fs/readdir.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/readdir.c	2008-08-09 12:03:30.000000000 -0400
@@ -17284 +16977 @@
-@@ -82,6 +85,10 @@ static int fillonedir(void * __buf, const char * name, int namlen, loff_t offset
+@@ -82,6 +85,10 @@ static int fillonedir(void * __buf, cons
@@ -17295 +16988 @@
-@@ -113,6 +120,7 @@ asmlinkage long old_readdir(unsigned int fd, struct old_linux_dirent __user * di
+@@ -113,6 +120,7 @@ asmlinkage long old_readdir(unsigned int
@@ -17311 +17004 @@
-@@ -157,6 +166,10 @@ static int filldir(void * __buf, const char * name, int namlen, loff_t offset,
+@@ -157,6 +166,10 @@ static int filldir(void * __buf, const c
@@ -17322 +17015 @@
-@@ -203,6 +216,7 @@ asmlinkage long sys_getdents(unsigned int fd, struct linux_dirent __user * diren
+@@ -203,6 +216,7 @@ asmlinkage long sys_getdents(unsigned in
@@ -17338 +17031 @@
-@@ -239,6 +254,10 @@ static int filldir64(void * __buf, const char * name, int namlen, loff_t offset,
+@@ -239,6 +254,10 @@ static int filldir64(void * __buf, const
@@ -17349 +17042 @@
-@@ -285,6 +304,7 @@ asmlinkage long sys_getdents64(unsigned int fd, struct linux_dirent64 __user * d
+@@ -285,6 +304,7 @@ asmlinkage long sys_getdents64(unsigned 
@@ -17357,5 +17050,4 @@
-diff --git a/fs/smbfs/symlink.c b/fs/smbfs/symlink.c
-index 00b2909bd469e30fc9c074029cd1d2789515f2b8..2ace3831b2b6f9d8de228b152997ebd1d70f2a2a 100644
---- a/fs/smbfs/symlink.c
-+++ b/fs/smbfs/symlink.c
-@@ -55,7 +55,7 @@ static void *smb_follow_link(struct dentry *dentry, struct nameidata *nd)
+diff -urNp linux-2.6.26.3/fs/smbfs/symlink.c linux-2.6.26.3/fs/smbfs/symlink.c
+--- linux-2.6.26.3/fs/smbfs/symlink.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/smbfs/symlink.c	2008-08-09 12:03:30.000000000 -0400
+@@ -55,7 +55,7 @@ static void *smb_follow_link(struct dent
@@ -17370,5 +17062,4 @@
-diff --git a/fs/sysfs/symlink.c b/fs/sysfs/symlink.c
-index 817f5966edcac2c2e36033902f2ac2ce0f89f626..b7e0febd65876eda5a09ee2606ff978f966a4cba 100644
---- a/fs/sysfs/symlink.c
-+++ b/fs/sysfs/symlink.c
-@@ -175,7 +175,7 @@ static void *sysfs_follow_link(struct dentry *dentry, struct nameidata *nd)
+diff -urNp linux-2.6.26.3/fs/sysfs/symlink.c linux-2.6.26.3/fs/sysfs/symlink.c
+--- linux-2.6.26.3/fs/sysfs/symlink.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/sysfs/symlink.c	2008-08-09 12:03:30.000000000 -0400
+@@ -175,7 +175,7 @@ static void *sysfs_follow_link(struct de
@@ -17383,5 +17074,4 @@
-diff --git a/fs/udf/balloc.c b/fs/udf/balloc.c
-index 1b809bd494bd098a0a7855ba10f300f66a08d46a..9ca5a3fd9363db232e1e762acf54cc8418f0705a 100644
---- a/fs/udf/balloc.c
-+++ b/fs/udf/balloc.c
-@@ -169,9 +169,7 @@ static void udf_bitmap_free_blocks(struct super_block *sb,
+diff -urNp linux-2.6.26.3/fs/udf/balloc.c linux-2.6.26.3/fs/udf/balloc.c
+--- linux-2.6.26.3/fs/udf/balloc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/udf/balloc.c	2008-08-09 12:03:30.000000000 -0400
+@@ -169,9 +169,7 @@ static void udf_bitmap_free_blocks(struc
@@ -17398 +17088 @@
-@@ -239,7 +237,7 @@ static int udf_bitmap_prealloc_blocks(struct super_block *sb,
+@@ -239,7 +237,7 @@ static int udf_bitmap_prealloc_blocks(st
@@ -17407 +17097 @@
-@@ -300,7 +298,7 @@ static int udf_bitmap_new_block(struct super_block *sb,
+@@ -300,7 +298,7 @@ static int udf_bitmap_new_block(struct s
@@ -17416 +17106 @@
-@@ -438,9 +436,7 @@ static void udf_table_free_blocks(struct super_block *sb,
+@@ -438,9 +436,7 @@ static void udf_table_free_blocks(struct
@@ -17427 +17117 @@
-@@ -671,8 +667,7 @@ static int udf_table_prealloc_blocks(struct super_block *sb,
+@@ -671,8 +667,7 @@ static int udf_table_prealloc_blocks(str
@@ -17437 +17127 @@
-@@ -750,7 +745,7 @@ static int udf_table_new_block(struct super_block *sb,
+@@ -750,7 +745,7 @@ static int udf_table_new_block(struct su
@@ -17446,5 +17136,4 @@
-diff --git a/fs/ufs/inode.c b/fs/ufs/inode.c
-index 39f8778985655b1f1a166575e013b940af7965d4..168e5518d9c6393acead57ad9762ee795d426d9b 100644
---- a/fs/ufs/inode.c
-+++ b/fs/ufs/inode.c
-@@ -56,9 +56,7 @@ static int ufs_block_to_path(struct inode *inode, sector_t i_block, sector_t off
+diff -urNp linux-2.6.26.3/fs/ufs/inode.c linux-2.6.26.3/fs/ufs/inode.c
+--- linux-2.6.26.3/fs/ufs/inode.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/ufs/inode.c	2008-08-09 12:03:30.000000000 -0400
+@@ -56,9 +56,7 @@ static int ufs_block_to_path(struct inod
@@ -17461 +17150 @@
-@@ -440,8 +438,6 @@ int ufs_getfrag_block(struct inode *inode, sector_t fragment, struct buffer_head
+@@ -440,8 +438,6 @@ int ufs_getfrag_block(struct inode *inod
@@ -17481,4 +17170,3 @@
-diff --git a/fs/utimes.c b/fs/utimes.c
-index b6b664e7145ec7e0debea47c041b7c3faa9a0aee..a61f5de24c245d3cd7cd63d65da1af52683344be 100644
---- a/fs/utimes.c
-+++ b/fs/utimes.c
+diff -urNp linux-2.6.26.3/fs/utimes.c linux-2.6.26.3/fs/utimes.c
+--- linux-2.6.26.3/fs/utimes.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/utimes.c	2008-08-09 12:03:30.000000000 -0400
@@ -17493 +17181 @@
-@@ -57,10 +58,10 @@ long do_utimes(int dfd, char __user *filename, struct timespec *times, int flags
+@@ -57,10 +58,10 @@ long do_utimes(int dfd, char __user *fil
@@ -17505 +17193 @@
-@@ -153,6 +154,12 @@ long do_utimes(int dfd, char __user *filename, struct timespec *times, int flags
+@@ -153,6 +154,12 @@ long do_utimes(int dfd, char __user *fil
@@ -17518,4 +17206,3 @@
-diff --git a/fs/xfs/linux-2.6/xfs_iops.c b/fs/xfs/linux-2.6/xfs_iops.c
-index 2bf287ef54897af2651f24b39792404270179a19..05de325f12b044789a93d9a4c89274a2319d15dc 100644
---- a/fs/xfs/linux-2.6/xfs_iops.c
-+++ b/fs/xfs/linux-2.6/xfs_iops.c
+diff -urNp linux-2.6.26.3/fs/xfs/linux-2.6/xfs_iops.c linux-2.6.26.3/fs/xfs/linux-2.6/xfs_iops.c
+--- linux-2.6.26.3/fs/xfs/linux-2.6/xfs_iops.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/xfs/linux-2.6/xfs_iops.c	2008-08-09 12:03:30.000000000 -0400
@@ -17531,4 +17218,3 @@
-diff --git a/fs/xfs/xfs_bmap.c b/fs/xfs/xfs_bmap.c
-index 53c259f5a5af5e7b85fde5f73ee678670e692ad9..b0452b34b05efa1120cfb1321f9664ea0cc46a23 100644
---- a/fs/xfs/xfs_bmap.c
-+++ b/fs/xfs/xfs_bmap.c
+diff -urNp linux-2.6.26.3/fs/xfs/xfs_bmap.c linux-2.6.26.3/fs/xfs/xfs_bmap.c
+--- linux-2.6.26.3/fs/xfs/xfs_bmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/fs/xfs/xfs_bmap.c	2008-08-09 12:03:30.000000000 -0400
@@ -17544,9 +17230,10 @@
-diff --git a/grsecurity/Kconfig b/grsecurity/Kconfig
-new file mode 100644
-index 0000000000000000000000000000000000000000..8be9ab05829f25d9a7f502149ffa344168d958f8
---- /dev/null
-+++ b/grsecurity/Kconfig
-@@ -0,0 +1,863 @@
-+#
-+# grecurity configuration
-+#
+diff -urNp linux-2.6.26.3/grsecurity/gracl_alloc.c linux-2.6.26.3/grsecurity/gracl_alloc.c
+--- linux-2.6.26.3/grsecurity/gracl_alloc.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_alloc.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,91 @@
++#include <linux/kernel.h>
++#include <linux/mm.h>
++#include <linux/slab.h>
++#include <linux/vmalloc.h>
++#include <linux/gracl.h>
++#include <linux/grsecurity.h>
@@ -17554 +17241,3 @@
-+menu "Grsecurity"
++static unsigned long alloc_stack_next = 1;
++static unsigned long alloc_stack_size = 1;
++static void **alloc_stack;
@@ -17556,12 +17245,5 @@
-+config GRKERNSEC
-+	bool "Grsecurity"
-+	select CRYPTO
-+	select CRYPTO_SHA256
-+	select SECURITY
-+	select SECURITY_CAPABILITIES
-+	help
-+	  If you say Y here, you will be able to configure many features
-+	  that will enhance the security of your system.  It is highly
-+	  recommended that you say Y here and read through the help
-+	  for each option so that you fully understand the features and
-+	  can evaluate their usefulness for your machine.
++static __inline__ int
++alloc_pop(void)
++{
++	if (alloc_stack_next == 1)
++		return 0;
@@ -17569,4 +17251 @@
-+choice
-+	prompt "Security Level"
-+	depends on GRKERNSEC
-+	default GRKERNSEC_CUSTOM
++	kfree(alloc_stack[alloc_stack_next - 2]);
@@ -17574,9 +17253 @@
-+config GRKERNSEC_LOW
-+	bool "Low"
-+	select GRKERNSEC_LINK
-+	select GRKERNSEC_FIFO
-+	select GRKERNSEC_EXECVE
-+	select GRKERNSEC_RANDNET
-+	select GRKERNSEC_DMESG
-+	select GRKERNSEC_CHROOT_CHDIR
-+	select GRKERNSEC_MODSTOP if (MODULES)
++	alloc_stack_next--;
@@ -17584,8 +17255,2 @@
-+	help
-+	  If you choose this option, several of the grsecurity options will
-+	  be enabled that will give you greater protection against a number
-+	  of attacks, while assuring that none of your software will have any
-+	  conflicts with the additional security measures.  If you run a lot
-+	  of unusual software, or you are having problems with the higher
-+	  security levels, you should say Y here.  With this option, the
-+	  following features are enabled:
++	return 1;
++}
@@ -17593,6 +17258,5 @@
-+	  - Linking restrictions
-+	  - FIFO restrictions
-+	  - Enforcing RLIMIT_NPROC on execve
-+	  - Restricted dmesg
-+	  - Enforced chdir("/") on chroot
-+	  - Runtime module disabling
++static __inline__ void
++alloc_push(void *buf)
++{
++	if (alloc_stack_next >= alloc_stack_size)
++		BUG();
@@ -17600,30 +17264 @@
-+config GRKERNSEC_MEDIUM
-+	bool "Medium"
-+	select PAX
-+	select PAX_EI_PAX
-+	select PAX_PT_PAX_FLAGS
-+	select PAX_HAVE_ACL_FLAGS
-+	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
-+	select GRKERNSEC_CHROOT_SYSCTL
-+	select GRKERNSEC_LINK
-+	select GRKERNSEC_FIFO
-+	select GRKERNSEC_EXECVE
-+	select GRKERNSEC_DMESG
-+	select GRKERNSEC_RANDNET
-+	select GRKERNSEC_FORKFAIL
-+	select GRKERNSEC_TIME
-+	select GRKERNSEC_SIGNAL
-+	select GRKERNSEC_CHROOT
-+	select GRKERNSEC_CHROOT_UNIX
-+	select GRKERNSEC_CHROOT_MOUNT
-+	select GRKERNSEC_CHROOT_PIVOT
-+	select GRKERNSEC_CHROOT_DOUBLE
-+	select GRKERNSEC_CHROOT_CHDIR
-+	select GRKERNSEC_CHROOT_MKNOD
-+	select GRKERNSEC_PROC
-+	select GRKERNSEC_PROC_USERGROUP
-+	select GRKERNSEC_MODSTOP if (MODULES)
-+	select PAX_RANDUSTACK
-+	select PAX_ASLR
-+	select PAX_RANDMMAP
-+	select PAX_REFCOUNT
++	alloc_stack[alloc_stack_next - 1] = buf;
@@ -17631,9 +17266 @@
-+	help
-+	  If you say Y here, several features in addition to those included
-+	  in the low additional security level will be enabled.  These
-+	  features provide even more security to your system, though in rare
-+	  cases they may be incompatible with very old or poorly written
-+	  software.  If you enable this option, make sure that your auth
-+	  service (identd) is running as gid 1001.  With this option, 
-+	  the following features (in addition to those provided in the 
-+	  low additional security level) will be enabled:
++	alloc_stack_next++;
@@ -17641,12 +17268,2 @@
-+	  - Failed fork logging
-+	  - Time change logging
-+	  - Signal logging
-+	  - Deny mounts in chroot
-+	  - Deny double chrooting
-+	  - Deny sysctl writes in chroot
-+	  - Deny mknod in chroot
-+	  - Deny access to abstract AF_UNIX sockets out of chroot
-+	  - Deny pivot_root in chroot
-+	  - Denied writes of /dev/kmem, /dev/mem, and /dev/port
-+	  - /proc restrictions with special GID set to 10 (usually wheel)
-+	  - Address Space Layout Randomization (ASLR)
++	return;
++}
@@ -17654,67 +17271,4 @@
-+config GRKERNSEC_HIGH
-+	bool "High"
-+	select GRKERNSEC_LINK
-+	select GRKERNSEC_FIFO
-+	select GRKERNSEC_EXECVE
-+	select GRKERNSEC_DMESG
-+	select GRKERNSEC_FORKFAIL
-+	select GRKERNSEC_TIME
-+	select GRKERNSEC_SIGNAL
-+	select GRKERNSEC_CHROOT_SHMAT
-+	select GRKERNSEC_CHROOT_UNIX
-+	select GRKERNSEC_CHROOT_MOUNT
-+	select GRKERNSEC_CHROOT_FCHDIR
-+	select GRKERNSEC_CHROOT_PIVOT
-+	select GRKERNSEC_CHROOT_DOUBLE
-+	select GRKERNSEC_CHROOT_CHDIR
-+	select GRKERNSEC_CHROOT_MKNOD
-+	select GRKERNSEC_CHROOT_CAPS
-+	select GRKERNSEC_CHROOT_SYSCTL
-+	select GRKERNSEC_CHROOT_FINDTASK
-+	select GRKERNSEC_PROC
-+	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
-+	select GRKERNSEC_HIDESYM
-+	select GRKERNSEC_BRUTE
-+	select GRKERNSEC_PROC_USERGROUP
-+	select GRKERNSEC_KMEM
-+	select GRKERNSEC_RESLOG
-+	select GRKERNSEC_RANDNET
-+	select GRKERNSEC_PROC_ADD
-+	select GRKERNSEC_CHROOT_CHMOD
-+	select GRKERNSEC_CHROOT_NICE
-+	select GRKERNSEC_AUDIT_MOUNT
-+	select GRKERNSEC_MODSTOP if (MODULES)
-+	select PAX
-+	select PAX_RANDUSTACK
-+	select PAX_ASLR
-+	select PAX_RANDMMAP
-+	select PAX_NOEXEC
-+	select PAX_MPROTECT
-+	select PAX_EI_PAX
-+	select PAX_PT_PAX_FLAGS
-+	select PAX_HAVE_ACL_FLAGS
-+	select PAX_KERNEXEC if (X86 && !EFI && !COMPAT_VDSO && !PARAVIRT && (!X86_32 || X86_WP_WORKS_OK))
-+	select PAX_MEMORY_UDEREF if (!X86_64 && !COMPAT_VDSO)
-+	select PAX_RANDKSTACK if (X86_TSC && !X86_64)
-+	select PAX_SEGMEXEC if (X86 && !X86_64)
-+	select PAX_PAGEEXEC if (!X86)
-+	select PAX_EMUPLT if (ALPHA || PARISC || PPC32 || SPARC32 || SPARC64)
-+	select PAX_DLRESOLVE if (SPARC32 || SPARC64)
-+	select PAX_SYSCALL if (PPC32)
-+	select PAX_EMUTRAMP if (PARISC)
-+	select PAX_EMUSIGRT if (PARISC)
-+	select PAX_ETEXECRELOCS if (ALPHA || IA64 || PARISC)
-+	select PAX_REFCOUNT
-+	help
-+	  If you say Y here, many of the features of grsecurity will be
-+	  enabled, which will protect you against many kinds of attacks
-+	  against your system.  The heightened security comes at a cost
-+	  of an increased chance of incompatibilities with rare software
-+	  on your machine.  Since this security level enables PaX, you should
-+	  view <http://pax.grsecurity.net> and read about the PaX
-+	  project.  While you are there, download chpax and run it on
-+	  binaries that cause problems with PaX.  Also remember that
-+	  since the /proc restrictions are enabled, you must run your
-+	  identd as gid 1001.  This security level enables the following 
-+	  features in addition to those listed in the low and medium 
-+	  security levels:
++void *
++acl_alloc(unsigned long len)
++{
++	void *ret;
@@ -17722,22 +17276,2 @@
-+	  - Additional /proc restrictions
-+	  - Chmod restrictions in chroot
-+	  - No signals, ptrace, or viewing of processes outside of chroot
-+	  - Capability restrictions in chroot
-+	  - Deny fchdir out of chroot
-+	  - Priority restrictions in chroot
-+	  - Segmentation-based implementation of PaX
-+	  - Mprotect restrictions
-+	  - Removal of addresses from /proc/<pid>/[smaps|maps|stat]
-+	  - Kernel stack randomization
-+	  - Mount/unmount/remount logging
-+	  - Kernel symbol hiding
-+	  - Prevention of memory exhaustion-based exploits
-+config GRKERNSEC_CUSTOM
-+	bool "Custom"
-+	help
-+	  If you say Y here, you will be able to configure every grsecurity
-+	  option, which allows you to enable many more features that aren't
-+	  covered in the basic security levels.  These additional features
-+	  include TPE, socket restrictions, and the sysctl system for
-+	  grsecurity.  It is advised that you read through the help for
-+	  each option to determine its usefulness in your situation.
++	if (len > PAGE_SIZE)
++		BUG();
@@ -17745 +17279 @@
-+endchoice
++	ret = kmalloc(len, GFP_KERNEL);
@@ -17747,2 +17281,2 @@
-+menu "Address Space Protection"
-+depends on GRKERNSEC
++	if (ret)
++		alloc_push(ret);
@@ -17750,19 +17284,2 @@
-+config GRKERNSEC_KMEM
-+	bool "Deny writing to /dev/kmem, /dev/mem, and /dev/port"
-+	help
-+	  If you say Y here, /dev/kmem and /dev/mem won't be allowed to
-+	  be written to via mmap or otherwise to modify the running kernel.
-+	  /dev/port will also not be allowed to be opened. If you have module
-+	  support disabled, enabling this will close up four ways that are
-+	  currently used  to insert malicious code into the running kernel.
-+	  Even with all these features enabled, we still highly recommend that
-+	  you use the RBAC system, as it is still possible for an attacker to
-+	  modify the running kernel through privileged I/O granted by ioperm/iopl.
-+	  If you are not using XFree86, you may be able to stop this additional
-+	  case by enabling the 'Disable privileged I/O' option. Though nothing
-+	  legitimately writes to /dev/kmem, XFree86 does need to write to /dev/mem,
-+	  but only to video memory, which is the only writing we allow in this
-+	  case.  If /dev/kmem or /dev/mem are mmaped without PROT_WRITE, they will
-+	  not be allowed to mprotect it with PROT_WRITE later.
-+	  It is highly recommended that you say Y here if you meet all the
-+	  conditions above.
++	return ret;
++}
@@ -17770,15 +17287,5 @@
-+config GRKERNSEC_IO
-+	bool "Disable privileged I/O"
-+	depends on X86
-+	select RTC
-+	help
-+	  If you say Y here, all ioperm and iopl calls will return an error.
-+	  Ioperm and iopl can be used to modify the running kernel.
-+	  Unfortunately, some programs need this access to operate properly,
-+	  the most notable of which are XFree86 and hwclock.  hwclock can be
-+	  remedied by having RTC support in the kernel, so CONFIG_RTC is
-+	  enabled if this option is enabled, to ensure that hwclock operates
-+	  correctly.  XFree86 still will not operate correctly with this option
-+	  enabled, so DO NOT CHOOSE Y IF YOU USE XFree86.  If you use XFree86
-+	  and you still want to protect your kernel against modification,
-+	  use the RBAC system.
++void
++acl_free_all(void)
++{
++	if (gr_acl_is_enabled() || !alloc_stack)
++		return;
@@ -17786,10 +17293 @@
-+config GRKERNSEC_PROC_MEMMAP
-+	bool "Remove addresses from /proc/<pid>/[smaps|maps|stat]"
-+	depends on PAX_NOEXEC || PAX_ASLR
-+	help
-+	  If you say Y here, the /proc/<pid>/maps and /proc/<pid>/stat files will
-+	  give no information about the addresses of its mappings if
-+	  PaX features that rely on random addresses are enabled on the task.
-+	  If you use PaX it is greatly recommended that you say Y here as it
-+	  closes up a hole that makes the full ASLR useless for suid
-+	  binaries.
++	while (alloc_pop()) ;
@@ -17797,11 +17295,6 @@
-+config GRKERNSEC_BRUTE
-+	bool "Deter exploit bruteforcing"
-+	help
-+	  If you say Y here, attempts to bruteforce exploits against forking
-+	  daemons such as apache or sshd will be deterred.  When a child of a
-+	  forking daemon is killed by PaX or crashes due to an illegal
-+	  instruction, the parent process will be delayed 30 seconds upon every
-+	  subsequent fork until the administrator is able to assess the
-+	  situation and restart the daemon.  It is recommended that you also
-+	  enable signal logging in the auditing section so that logs are
-+	  generated when a process performs an illegal instruction.
++	if (alloc_stack) {
++		if ((alloc_stack_size * sizeof (void *)) <= PAGE_SIZE)
++			kfree(alloc_stack);
++		else
++			vfree(alloc_stack);
++	}
@@ -17809,17 +17302,3 @@
-+config GRKERNSEC_MODSTOP
-+	bool "Runtime module disabling"
-+	depends on MODULES
-+	help
-+	  If you say Y here, you will be able to disable the ability to (un)load
-+	  modules at runtime.  This feature is useful if you need the ability
-+	  to load kernel modules at boot time, but do not want to allow an
-+	  attacker to load a rootkit kernel module into the system, or to remove
-+	  a loaded kernel module important to system functioning.  You should
-+	  enable the /dev/mem protection feature as well, since rootkits can be
-+	  inserted into the kernel via other methods than kernel modules.  Since
-+	  an untrusted module could still be loaded by modifying init scripts and
-+	  rebooting the system, it is also recommended that you enable the RBAC
-+	  system.  If you enable this option, a sysctl option with name
-+	  "disable_modules" will be created.  Setting this option to "1" disables
-+	  module loading.  After this option is set, no further writes to it are
-+	  allowed until the system is rebooted.
++	alloc_stack = NULL;
++	alloc_stack_size = 1;
++	alloc_stack_next = 1;
@@ -17827,15 +17306,2 @@
-+config GRKERNSEC_HIDESYM
-+	bool "Hide kernel symbols"
-+	help
-+	  If you say Y here, getting information on loaded modules, and
-+	  displaying all kernel symbols through a syscall will be restricted
-+	  to users with CAP_SYS_MODULE.  This option is only effective
-+	  provided the following conditions are met:
-+	  1) The kernel using grsecurity is not precompiled by some distribution
-+	  2) You are using the RBAC system and hiding other files such as your
-+	     kernel image and System.map
-+	  3) You have the additional /proc restrictions enabled, which removes
-+	     /proc/kcore
-+	  If the above conditions are met, this option will aid to provide a
-+	  useful protection against local and remote kernel exploitation of
-+	  overflows and arbitrary read/write vulnerabilities.
++	return;
++}
@@ -17843,3 +17309,8 @@
-+endmenu
-+menu "Role Based Access Control Options"
-+depends on GRKERNSEC
++int
++acl_alloc_stack_init(unsigned long size)
++{
++	if ((size * sizeof (void *)) <= PAGE_SIZE)
++		alloc_stack =
++		    (void **) kmalloc(size * sizeof (void *), GFP_KERNEL);
++	else
++		alloc_stack = (void **) vmalloc(size * sizeof (void *));
@@ -17847,6 +17318 @@
-+config GRKERNSEC_ACL_HIDEKERN
-+	bool "Hide kernel processes"
-+	help
-+	  If you say Y here, all kernel threads will be hidden to all
-+	  processes but those whose subject has the "view hidden processes"
-+	  flag.
++	alloc_stack_size = size;
@@ -17854,8 +17320,33 @@
-+config GRKERNSEC_ACL_MAXTRIES
-+	int "Maximum tries before password lockout"
-+	default 3
-+	help
-+	  This option enforces the maximum number of times a user can attempt
-+	  to authorize themselves with the grsecurity RBAC system before being
-+	  denied the ability to attempt authorization again for a specified time.
-+	  The lower the number, the harder it will be to brute-force a password.
++	if (!alloc_stack)
++		return 0;
++	else
++		return 1;
++}
+diff -urNp linux-2.6.26.3/grsecurity/gracl.c linux-2.6.26.3/grsecurity/gracl.c
+--- linux-2.6.26.3/grsecurity/gracl.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,3722 @@
++#include <linux/kernel.h>
++#include <linux/module.h>
++#include <linux/sched.h>
++#include <linux/mm.h>
++#include <linux/file.h>
++#include <linux/fs.h>
++#include <linux/namei.h>
++#include <linux/mount.h>
++#include <linux/tty.h>
++#include <linux/proc_fs.h>
++#include <linux/smp_lock.h>
++#include <linux/slab.h>
++#include <linux/vmalloc.h>
++#include <linux/types.h>
++#include <linux/sysctl.h>
++#include <linux/netdevice.h>
++#include <linux/ptrace.h>
++#include <linux/gracl.h>
++#include <linux/gralloc.h>
++#include <linux/grsecurity.h>
++#include <linux/grinternal.h>
++#include <linux/pid_namespace.h>
++#include <linux/fdtable.h>
++#include <linux/percpu.h>
@@ -17863,8 +17354,3 @@
-+config GRKERNSEC_ACL_TIMEOUT
-+	int "Time to wait after max password tries, in seconds"
-+	default 30
-+	help
-+	  This option specifies the time the user must wait after attempting to
-+	  authorize to the RBAC system with the maximum number of invalid
-+	  passwords.  The higher the number, the harder it will be to brute-force
-+	  a password.
++#include <asm/uaccess.h>
++#include <asm/errno.h>
++#include <asm/mman.h>
@@ -17872,3 +17358,3 @@
-+endmenu
-+menu "Filesystem Protections"
-+depends on GRKERNSEC
++static struct acl_role_db acl_role_set;
++static struct name_db name_set;
++static struct inodev_db inodev_set;
@@ -17876,19 +17362,3 @@
-+config GRKERNSEC_PROC
-+	bool "Proc restrictions"
-+	help
-+	  If you say Y here, the permissions of the /proc filesystem
-+	  will be altered to enhance system security and privacy.  You MUST
-+  	  choose either a user only restriction or a user and group restriction.
-+	  Depending upon the option you choose, you can either restrict users to
-+	  see only the processes they themselves run, or choose a group that can
-+	  view all processes and files normally restricted to root if you choose
-+	  the "restrict to user only" option.  NOTE: If you're running identd as
-+	  a non-root user, you will have to run it as the group you specify here.
-+
-+config GRKERNSEC_PROC_USER
-+	bool "Restrict /proc to user only"
-+	depends on GRKERNSEC_PROC
-+	help
-+	  If you say Y here, non-root users will only be able to view their own
-+	  processes, and restricts them from viewing network-related information,
-+	  and viewing kernel symbol and module information.
++/* for keeping track of userspace pointers used for subjects, so we
++   can share references in the kernel as well
++*/
@@ -17896,8 +17366,2 @@
-+config GRKERNSEC_PROC_USERGROUP
-+	bool "Allow special group"
-+	depends on GRKERNSEC_PROC && !GRKERNSEC_PROC_USER
-+	help
-+	  If you say Y here, you will be able to select a group that will be
-+	  able to view all processes, network-related information, and
-+	  kernel and symbol information.  This option is useful if you want
-+	  to run identd as a non-root user.
++static struct dentry *real_root;
++static struct vfsmount *real_root_mnt;
@@ -17905,4 +17369 @@
-+config GRKERNSEC_PROC_GID
-+	int "GID for special group"
-+	depends on GRKERNSEC_PROC_USERGROUP
-+	default 1001
++static struct acl_subj_map_db subj_map_set;
@@ -17910,7 +17371 @@
-+config GRKERNSEC_PROC_ADD
-+	bool "Additional restrictions"
-+	depends on GRKERNSEC_PROC_USER || GRKERNSEC_PROC_USERGROUP
-+	help
-+	  If you say Y here, additional restrictions will be placed on
-+	  /proc that keep normal users from viewing device information and 
-+	  slabinfo information that could be useful for exploits.
++static struct acl_role_label *default_role;
@@ -17918,9 +17373 @@
-+config GRKERNSEC_LINK
-+	bool "Linking restrictions"
-+	help
-+	  If you say Y here, /tmp race exploits will be prevented, since users
-+	  will no longer be able to follow symlinks owned by other users in
-+	  world-writable +t directories (i.e. /tmp), unless the owner of the
-+	  symlink is the owner of the directory. users will also not be
-+	  able to hardlink to files they do not own.  If the sysctl option is
-+	  enabled, a sysctl option with name "linking_restrictions" is created.
++static u16 acl_sp_role_value;
@@ -17928,8 +17375,3 @@
-+config GRKERNSEC_FIFO
-+	bool "FIFO restrictions"
-+	help
-+	  If you say Y here, users will not be able to write to FIFOs they don't
-+	  own in world-writable +t directories (i.e. /tmp), unless the owner of
-+	  the FIFO is the same owner of the directory it's held in.  If the sysctl
-+	  option is enabled, a sysctl option with name "fifo_restrictions" is
-+	  created.
++extern char *gr_shared_page[4];
++static DECLARE_MUTEX(gr_dev_sem);
++rwlock_t gr_inode_lock = RW_LOCK_UNLOCKED;
@@ -17937,7 +17379 @@
-+config GRKERNSEC_CHROOT
-+	bool "Chroot jail restrictions"
-+	help
-+	  If you say Y here, you will be able to choose several options that will
-+	  make breaking out of a chrooted jail much more difficult.  If you
-+	  encounter no software incompatibilities with the following options, it
-+	  is recommended that you enable each one.
++struct gr_arg *gr_usermode;
@@ -17945,7 +17381 @@
-+config GRKERNSEC_CHROOT_MOUNT
-+	bool "Deny mounts"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to
-+	  mount or remount filesystems.  If the sysctl option is enabled, a
-+	  sysctl option with name "chroot_deny_mount" is created.
++static unsigned int gr_status = GR_STATUS_INIT;
@@ -17953,9 +17383,2 @@
-+config GRKERNSEC_CHROOT_DOUBLE
-+	bool "Deny double-chroots"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to chroot
-+	  again outside the chroot.  This is a widely used method of breaking
-+	  out of a chroot jail and should not be allowed.  If the sysctl 
-+	  option is enabled, a sysctl option with name 
-+	  "chroot_deny_chroot" is created.
++extern int chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum);
++extern void gr_clear_learn_entries(void);
@@ -17963,11 +17386,4 @@
-+config GRKERNSEC_CHROOT_PIVOT
-+	bool "Deny pivot_root in chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to use
-+	  a function called pivot_root() that was introduced in Linux 2.3.41.  It
-+	  works similar to chroot in that it changes the root filesystem.  This
-+	  function could be misused in a chrooted process to attempt to break out
-+	  of the chroot, and therefore should not be allowed.  If the sysctl
-+	  option is enabled, a sysctl option with name "chroot_deny_pivot" is
-+	  created.
++#ifdef CONFIG_GRKERNSEC_RESLOG
++extern void gr_log_resource(const struct task_struct *task,
++			    const int res, const unsigned long wanted, const int gt);
++#endif
@@ -17975,11 +17391,2 @@
-+config GRKERNSEC_CHROOT_CHDIR
-+	bool "Enforce chdir(\"/\") on all chroots"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, the current working directory of all newly-chrooted
-+	  applications will be set to the the root directory of the chroot.
-+	  The man page on chroot(2) states:
-+	  Note that this call does not change  the  current  working
-+	  directory,  so  that `.' can be outside the tree rooted at
-+	  `/'.  In particular, the  super-user  can  escape  from  a
-+	  `chroot jail' by doing `mkdir foo; chroot foo; cd ..'.
++unsigned char *gr_system_salt;
++unsigned char *gr_system_sum;
@@ -17987,3 +17394,2 @@
-+	  It is recommended that you say Y here, since it's not known to break
-+	  any software.  If the sysctl option is enabled, a sysctl option with
-+	  name "chroot_enforce_chdir" is created.
++static struct sprole_pw **acl_special_roles = NULL;
++static __u16 num_sprole_pws = 0;
@@ -17991,9 +17397 @@
-+config GRKERNSEC_CHROOT_CHMOD
-+	bool "Deny (f)chmod +s"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to chmod
-+	  or fchmod files to make them have suid or sgid bits.  This protects
-+	  against another published method of breaking a chroot.  If the sysctl
-+	  option is enabled, a sysctl option with name "chroot_deny_chmod" is
-+	  created.
++static struct acl_role_label *kernel_role = NULL;
@@ -18001,8 +17399,2 @@
-+config GRKERNSEC_CHROOT_FCHDIR
-+	bool "Deny fchdir out of chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, a well-known method of breaking chroots by fchdir'ing
-+	  to a file descriptor of the chrooting process that points to a directory
-+	  outside the filesystem will be stopped.  If the sysctl option
-+	  is enabled, a sysctl option with name "chroot_deny_fchdir" is created.
++static unsigned int gr_auth_attempts = 0;
++static unsigned long gr_auth_expires = 0UL;
@@ -18010,13 +17402,4 @@
-+config GRKERNSEC_CHROOT_MKNOD
-+	bool "Deny mknod"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be allowed to
-+	  mknod.  The problem with using mknod inside a chroot is that it
-+	  would allow an attacker to create a device entry that is the same
-+	  as one on the physical root of your system, which could range from
-+	  anything from the console device to a device for your harddrive (which
-+	  they could then use to wipe the drive or steal data).  It is recommended
-+	  that you say Y here, unless you run into software incompatibilities.
-+	  If the sysctl option is enabled, a sysctl option with name
-+	  "chroot_deny_mknod" is created.
++extern struct vfsmount *sock_mnt;
++extern struct vfsmount *pipe_mnt;
++extern struct vfsmount *shm_mnt;
++static struct acl_object_label *fakefs_obj;
@@ -18024,8 +17407,4 @@
-+config GRKERNSEC_CHROOT_SHMAT
-+	bool "Deny shmat() out of chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to attach
-+	  to shared memory segments that were created outside of the chroot jail.
-+	  It is recommended that you say Y here.  If the sysctl option is enabled,
-+	  a sysctl option with name "chroot_deny_shmat" is created.
++extern int gr_init_uidset(void);
++extern void gr_free_uidset(void);
++extern void gr_remove_uid(uid_t uid);
++extern int gr_find_uid(uid_t uid);
@@ -18033,9 +17412,5 @@
-+config GRKERNSEC_CHROOT_UNIX
-+	bool "Deny access to abstract AF_UNIX sockets out of chroot"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to
-+	  connect to abstract (meaning not belonging to a filesystem) Unix
-+	  domain sockets that were bound outside of a chroot.  It is recommended
-+	  that you say Y here.  If the sysctl option is enabled, a sysctl option
-+	  with name "chroot_deny_unix" is created.
++__inline__ int
++gr_acl_is_enabled(void)
++{
++	return (gr_status & GR_READY);
++}
@@ -18043,9 +17418,14 @@
-+config GRKERNSEC_CHROOT_FINDTASK
-+	bool "Protect outside processes"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to
-+	  kill, send signals with fcntl, ptrace, capget, getpgid, getsid,
-+	  or view any process outside of the chroot.  If the sysctl
-+	  option is enabled, a sysctl option with name "chroot_findtask" is
-+	  created.
++char gr_roletype_to_char(void)
++{
++	switch (current->role->roletype &
++		(GR_ROLE_DEFAULT | GR_ROLE_USER | GR_ROLE_GROUP |
++		 GR_ROLE_SPECIAL)) {
++	case GR_ROLE_DEFAULT:
++		return 'D';
++	case GR_ROLE_USER:
++		return 'U';
++	case GR_ROLE_GROUP:
++		return 'G';
++	case GR_ROLE_SPECIAL:
++		return 'S';
++	}
@@ -18053,10 +17433,2 @@
-+config GRKERNSEC_CHROOT_NICE
-+	bool "Restrict priority changes"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, processes inside a chroot will not be able to raise
-+	  the priority of processes in the chroot, or alter the priority of
-+	  processes outside the chroot.  This provides more security than simply
-+	  removing CAP_SYS_NICE from the process' capability set.  If the
-+	  sysctl option is enabled, a sysctl option with name "chroot_restrict_nice"
-+	  is created.
++	return 'X';
++}
@@ -18064,9 +17436,10 @@
-+config GRKERNSEC_CHROOT_SYSCTL
-+	bool "Deny sysctl writes"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, an attacker in a chroot will not be able to
-+	  write to sysctl entries, either by sysctl(2) or through a /proc
-+	  interface.  It is strongly recommended that you say Y here. If the
-+	  sysctl option is enabled, a sysctl option with name
-+	  "chroot_deny_sysctl" is created.
++__inline__ int
++gr_acl_tpe_check(void)
++{
++	if (unlikely(!(gr_status & GR_READY)))
++		return 0;
++	if (current->role->roletype & GR_ROLE_TPE)
++		return 1;
++	else
++		return 0;
++}
@@ -18074,12 +17447,11 @@
-+config GRKERNSEC_CHROOT_CAPS
-+	bool "Capability restrictions"
-+	depends on GRKERNSEC_CHROOT
-+	help
-+	  If you say Y here, the capabilities on all root processes within a
-+	  chroot jail will be lowered to stop module insertion, raw i/o,
-+	  system and net admin tasks, rebooting the system, modifying immutable
-+	  files, modifying IPC owned by another, and changing the system time.
-+	  This is left an option because it can break some apps.  Disable this
-+	  if your chrooted apps are having problems performing those kinds of
-+	  tasks.  If the sysctl option is enabled, a sysctl option with
-+	  name "chroot_caps" is created.
++int
++gr_handle_rawio(const struct inode *inode)
++{
++#ifdef CONFIG_GRKERNSEC_CHROOT_CAPS
++	if (inode && S_ISBLK(inode->i_mode) &&
++	    grsec_enable_chroot_caps && proc_is_chrooted(current) &&
++	    !capable(CAP_SYS_RAWIO))
++		return 1;
++#endif
++	return 0;
++}
@@ -18087,3 +17459,9 @@
-+endmenu
-+menu "Kernel Auditing"
-+depends on GRKERNSEC
++static int
++gr_streq(const char *a, const char *b, const unsigned int lena, const unsigned int lenb)
++{
++	int i;
++	unsigned long *l1;
++	unsigned long *l2;
++	unsigned char *c1;
++	unsigned char *c2;
++	int num_longs;
@@ -18091,8 +17469,2 @@
-+config GRKERNSEC_AUDIT_GROUP
-+	bool "Single group for auditing"
-+	help
-+	  If you say Y here, the exec, chdir, (un)mount, and ipc logging features
-+	  will only operate on a group you specify.  This option is recommended
-+	  if you only want to watch certain users instead of having a large
-+	  amount of logs from the entire system.  If the sysctl option is enabled,
-+	  a sysctl option with name "audit_group" is created.
++	if (likely(lena != lenb))
++		return 0;
@@ -18100,4 +17472,2 @@
-+config GRKERNSEC_AUDIT_GID
-+	int "GID for auditing"
-+	depends on GRKERNSEC_AUDIT_GROUP
-+	default 1007
++	l1 = (unsigned long *)a;
++	l2 = (unsigned long *)b;
@@ -18105,10 +17475 @@
-+config GRKERNSEC_EXECLOG
-+	bool "Exec logging"
-+	help
-+	  If you say Y here, all execve() calls will be logged (since the
-+	  other exec*() calls are frontends to execve(), all execution
-+	  will be logged).  Useful for shell-servers that like to keep track
-+	  of their users.  If the sysctl option is enabled, a sysctl option with
-+	  name "exec_logging" is created.
-+	  WARNING: This option when enabled will produce a LOT of logs, especially
-+	  on an active system.
++	num_longs = lena / sizeof(unsigned long);
@@ -18116,8 +17477,4 @@
-+config GRKERNSEC_RESLOG
-+	bool "Resource logging"
-+	help
-+	  If you say Y here, all attempts to overstep resource limits will
-+	  be logged with the resource name, the requested size, and the current
-+	  limit.  It is highly recommended that you say Y here.  If the sysctl
-+	  option is enabled, a sysctl option with name "resource_logging" is
-+	  created.  If the RBAC system is enabled, the sysctl value is ignored.
++	for (i = num_longs; i--; l1++, l2++) {
++		if (unlikely(*l1 != *l2))
++			return 0;
++	}
@@ -18125,8 +17482,2 @@
-+config GRKERNSEC_CHROOT_EXECLOG
-+	bool "Log execs within chroot"
-+	help
-+	  If you say Y here, all executions inside a chroot jail will be logged
-+	  to syslog.  This can cause a large amount of logs if certain
-+	  applications (eg. djb's daemontools) are installed on the system, and
-+	  is therefore left as an option.  If the sysctl option is enabled, a
-+	  sysctl option with name "chroot_execlog" is created.
++	c1 = (unsigned char *) l1;
++	c2 = (unsigned char *) l2;
@@ -18134,5 +17485 @@
-+config GRKERNSEC_AUDIT_CHDIR
-+	bool "Chdir logging"
-+	help
-+	  If you say Y here, all chdir() calls will be logged.  If the sysctl
-+ 	  option is enabled, a sysctl option with name "audit_chdir" is created.
++	i = lena - (num_longs * sizeof(unsigned long));	
@@ -18140,6 +17487,4 @@
-+config GRKERNSEC_AUDIT_MOUNT
-+	bool "(Un)Mount logging"
-+	help
-+	  If you say Y here, all mounts and unmounts will be logged.  If the
-+	  sysctl option is enabled, a sysctl option with name "audit_mount" is
-+	  created.
++	for (; i--; c1++, c2++) {
++		if (unlikely(*c1 != *c2))
++			return 0;
++	}
@@ -18147,6 +17492,2 @@
-+config GRKERNSEC_AUDIT_IPC
-+	bool "IPC logging"
-+	help
-+	  If you say Y here, creation and removal of message queues, semaphores,
-+	  and shared memory will be logged.  If the sysctl option is enabled, a
-+	  sysctl option with name "audit_ipc" is created.
++	return 1;
++}
@@ -18154,8 +17495,7 @@
-+config GRKERNSEC_SIGNAL
-+	bool "Signal logging"
-+	help
-+	  If you say Y here, certain important signals will be logged, such as
-+	  SIGSEGV, which will as a result inform you of when a error in a program
-+	  occurred, which in some cases could mean a possible exploit attempt.
-+	  If the sysctl option is enabled, a sysctl option with name
-+	  "signal_logging" is created.
++static char * __our_d_path(struct dentry *dentry, struct vfsmount *vfsmnt,
++	                   struct dentry *root, struct vfsmount *rootmnt,
++			   char *buffer, int buflen)
++{
++	char * end = buffer+buflen;
++	char * retval;
++	int namelen;
@@ -18163,7 +17503,2 @@
-+config GRKERNSEC_FORKFAIL
-+	bool "Fork failure logging"
-+	help
-+	  If you say Y here, all failed fork() attempts will be logged.
-+	  This could suggest a fork bomb, or someone attempting to overstep
-+	  their process limit.  If the sysctl option is enabled, a sysctl option
-+	  with name "forkfail_logging" is created.
++	*--end = '\0';
++	buflen--;
@@ -18171,6 +17506,5 @@
-+config GRKERNSEC_TIME
-+	bool "Time change logging"
-+	help
-+	  If you say Y here, any changes of the system clock will be logged.
-+	  If the sysctl option is enabled, a sysctl option with name
-+	  "timechange_logging" is created.
++	if (buflen < 1)
++		goto Elong;
++	/* Get '/' right */
++	retval = end-1;
++	*retval = '/';
@@ -18178,10 +17512,2 @@
-+config GRKERNSEC_PROC_IPADDR
-+	bool "/proc/<pid>/ipaddr support"
-+	help
-+	  If you say Y here, a new entry will be added to each /proc/<pid>
-+	  directory that contains the IP address of the person using the task.
-+	  The IP is carried across local TCP and AF_UNIX stream sockets.
-+	  This information can be useful for IDS/IPSes to perform remote response
-+	  to a local attack.  The entry is readable by only the owner of the
-+	  process (and root if he has CAP_DAC_OVERRIDE, which can be removed via
-+	  the RBAC system), and thus does not create privacy concerns.
++	for (;;) {
++		struct dentry * parent;
@@ -18189,13 +17515,26 @@
-+config GRKERNSEC_AUDIT_TEXTREL
-+	bool 'ELF text relocations logging (READ HELP)'
-+	depends on PAX_MPROTECT
-+	help
-+	  If you say Y here, text relocations will be logged with the filename
-+	  of the offending library or binary.  The purpose of the feature is
-+	  to help Linux distribution developers get rid of libraries and
-+	  binaries that need text relocations which hinder the future progress
-+	  of PaX.  Only Linux distribution developers should say Y here, and
-+	  never on a production machine, as this option creates an information
-+	  leak that could aid an attacker in defeating the randomization of
-+	  a single memory region.  If the sysctl option is enabled, a sysctl
-+	  option with name "audit_textrel" is created.
++		if (dentry == root && vfsmnt == rootmnt)
++			break;
++		if (dentry == vfsmnt->mnt_root || IS_ROOT(dentry)) {
++			/* Global root? */
++			spin_lock(&vfsmount_lock);
++			if (vfsmnt->mnt_parent == vfsmnt) {
++				spin_unlock(&vfsmount_lock);
++				goto global_root;
++			}
++			dentry = vfsmnt->mnt_mountpoint;
++			vfsmnt = vfsmnt->mnt_parent;
++			spin_unlock(&vfsmount_lock);
++			continue;
++		}
++		parent = dentry->d_parent;
++		prefetch(parent);
++		namelen = dentry->d_name.len;
++		buflen -= namelen + 1;
++		if (buflen < 0)
++			goto Elong;
++		end -= namelen;
++		memcpy(end, dentry->d_name.name, namelen);
++		*--end = '/';
++		retval = end;
++		dentry = parent;
++	}
@@ -18203 +17542 @@
-+endmenu
++	return retval;
@@ -18205,2 +17544,11 @@
-+menu "Executable Protections"
-+depends on GRKERNSEC
++global_root:
++	namelen = dentry->d_name.len;
++	buflen -= namelen;
++	if (buflen < 0)
++		goto Elong;
++	retval -= namelen-1;	/* hit the slash */
++	memcpy(retval, dentry->d_name.name, namelen);
++	return retval;
++Elong:
++	return ERR_PTR(-ENAMETOOLONG);
++}
@@ -18208,7 +17556,5 @@
-+config GRKERNSEC_EXECVE
-+	bool "Enforce RLIMIT_NPROC on execs"
-+	help
-+	  If you say Y here, users with a resource limit on processes will
-+	  have the value checked during execve() calls.  The current system
-+	  only checks the system limit during fork() calls.  If the sysctl option
-+	  is enabled, a sysctl option with name "execve_limiting" is created.
++static char *
++gen_full_path(struct dentry *dentry, struct vfsmount *vfsmnt,
++              struct dentry *root, struct vfsmount *rootmnt, char *buf, int buflen)
++{
++	char *retval;
@@ -18216,7 +17562,5 @@
-+config GRKERNSEC_DMESG
-+	bool "Dmesg(8) restriction"
-+	help
-+	  If you say Y here, non-root users will not be able to use dmesg(8)
-+	  to view up to the last 4kb of messages in the kernel's log buffer.
-+	  If the sysctl option is enabled, a sysctl option with name "dmesg" is
-+	  created.
++	retval = __our_d_path(dentry, vfsmnt, root, rootmnt, buf, buflen);
++	if (unlikely(IS_ERR(retval)))
++		retval = strcpy(buf, "<path too long>");
++	else if (unlikely(retval[1] == '/' && retval[2] == '\0'))
++		retval[1] = '\0';
@@ -18224,8 +17568,2 @@
-+config GRKERNSEC_TPE
-+	bool "Trusted Path Execution (TPE)"
-+	help
-+	  If you say Y here, you will be able to choose a gid to add to the
-+	  supplementary groups of users you want to mark as "untrusted."
-+	  These users will not be able to execute any files that are not in
-+	  root-owned directories writable only by root.  If the sysctl option
-+	  is enabled, a sysctl option with name "tpe" is created.
++	return retval;
++}
@@ -18233,10 +17571,5 @@
-+config GRKERNSEC_TPE_ALL
-+	bool "Partially restrict non-root users"
-+	depends on GRKERNSEC_TPE
-+	help
-+	  If you say Y here, All non-root users other than the ones in the
-+	  group specified in the main TPE option will only be allowed to
-+	  execute files in directories they own that are not group or
-+	  world-writable, or in directories owned by root and writable only by
-+	  root.  If the sysctl option is enabled, a sysctl option with name
-+	  "tpe_restrict_all" is created.
++static char *
++__d_real_path(const struct dentry *dentry, const struct vfsmount *vfsmnt,
++		char *buf, int buflen)
++{
++	char *res;
@@ -18244,452 +17577,3 @@
-+config GRKERNSEC_TPE_INVERT
-+	bool "Invert GID option"
-+	depends on GRKERNSEC_TPE
-+	help
-+	  If you say Y here, the group you specify in the TPE configuration will
-+	  decide what group TPE restrictions will be *disabled* for.  This
-+	  option is useful if you want TPE restrictions to be applied to most
-+	  users on the system.
-+
-+config GRKERNSEC_TPE_GID
-+	int "GID for untrusted users"
-+	depends on GRKERNSEC_TPE && !GRKERNSEC_TPE_INVERT
-+	default 1005
-+	help
-+	  If you have selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *disabled* for.
-+	  If you have not selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *enabled* for.
-+	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
-+	  is created.
-+
-+config GRKERNSEC_TPE_GID
-+	int "GID for trusted users"
-+	depends on GRKERNSEC_TPE && GRKERNSEC_TPE_INVERT
-+	default 1005
-+	help
-+	  If you have selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *disabled* for.
-+	  If you have not selected the "Invert GID option" above, setting this
-+	  GID determines what group TPE restrictions will be *enabled* for.
-+	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
-+	  is created.
-+
-+endmenu
-+menu "Network Protections"
-+depends on GRKERNSEC
-+
-+config GRKERNSEC_RANDNET
-+	bool "Larger entropy pools"
-+	help
-+	  If you say Y here, the entropy pools used for many features of Linux
-+	  and grsecurity will be doubled in size.  Since several grsecurity
-+	  features use additional randomness, it is recommended that you say Y
-+	  here.  Saying Y here has a similar effect as modifying
-+	  /proc/sys/kernel/random/poolsize.
-+
-+config GRKERNSEC_SOCKET
-+	bool "Socket restrictions"
-+	help
-+	  If you say Y here, you will be able to choose from several options.
-+	  If you assign a GID on your system and add it to the supplementary
-+	  groups of users you want to restrict socket access to, this patch
-+	  will perform up to three things, based on the option(s) you choose.
-+
-+config GRKERNSEC_SOCKET_ALL
-+	bool "Deny any sockets to group"
-+	depends on GRKERNSEC_SOCKET
-+	help
-+	  If you say Y here, you will be able to choose a GID of whose users will
-+	  be unable to connect to other hosts from your machine or run server
-+	  applications from your machine.  If the sysctl option is enabled, a
-+	  sysctl option with name "socket_all" is created.
-+
-+config GRKERNSEC_SOCKET_ALL_GID
-+	int "GID to deny all sockets for"
-+	depends on GRKERNSEC_SOCKET_ALL
-+	default 1004
-+	help
-+	  Here you can choose the GID to disable socket access for. Remember to
-+	  add the users you want socket access disabled for to the GID
-+	  specified here.  If the sysctl option is enabled, a sysctl option
-+	  with name "socket_all_gid" is created.
-+
-+config GRKERNSEC_SOCKET_CLIENT
-+	bool "Deny client sockets to group"
-+	depends on GRKERNSEC_SOCKET
-+	help
-+	  If you say Y here, you will be able to choose a GID of whose users will
-+	  be unable to connect to other hosts from your machine, but will be
-+	  able to run servers.  If this option is enabled, all users in the group
-+	  you specify will have to use passive mode when initiating ftp transfers
-+	  from the shell on your machine.  If the sysctl option is enabled, a
-+	  sysctl option with name "socket_client" is created.
-+
-+config GRKERNSEC_SOCKET_CLIENT_GID
-+	int "GID to deny client sockets for"
-+	depends on GRKERNSEC_SOCKET_CLIENT
-+	default 1003
-+	help
-+	  Here you can choose the GID to disable client socket access for.
-+	  Remember to add the users you want client socket access disabled for to
-+	  the GID specified here.  If the sysctl option is enabled, a sysctl
-+	  option with name "socket_client_gid" is created.
-+
-+config GRKERNSEC_SOCKET_SERVER
-+	bool "Deny server sockets to group"
-+	depends on GRKERNSEC_SOCKET
-+	help
-+	  If you say Y here, you will be able to choose a GID of whose users will
-+	  be unable to run server applications from your machine.  If the sysctl
-+	  option is enabled, a sysctl option with name "socket_server" is created.
-+
-+config GRKERNSEC_SOCKET_SERVER_GID
-+	int "GID to deny server sockets for"
-+	depends on GRKERNSEC_SOCKET_SERVER
-+	default 1002
-+	help
-+	  Here you can choose the GID to disable server socket access for.
-+	  Remember to add the users you want server socket access disabled for to
-+	  the GID specified here.  If the sysctl option is enabled, a sysctl
-+	  option with name "socket_server_gid" is created.
-+
-+endmenu
-+menu "Sysctl support"
-+depends on GRKERNSEC && SYSCTL
-+
-+config GRKERNSEC_SYSCTL
-+	bool "Sysctl support"
-+	help
-+	  If you say Y here, you will be able to change the options that
-+	  grsecurity runs with at bootup, without having to recompile your
-+	  kernel.  You can echo values to files in /proc/sys/kernel/grsecurity
-+	  to enable (1) or disable (0) various features.  All the sysctl entries
-+	  are mutable until the "grsec_lock" entry is set to a non-zero value.
-+	  All features enabled in the kernel configuration are disabled at boot
-+	  if you do not say Y to the "Turn on features by default" option.
-+	  All options should be set at startup, and the grsec_lock entry should
-+	  be set to a non-zero value after all the options are set.
-+	  *THIS IS EXTREMELY IMPORTANT*
-+
-+config GRKERNSEC_SYSCTL_ON
-+	bool "Turn on features by default"
-+	depends on GRKERNSEC_SYSCTL
-+	help
-+	  If you say Y here, instead of having all features enabled in the
-+	  kernel configuration disabled at boot time, the features will be
-+	  enabled at boot time.  It is recommended you say Y here unless
-+	  there is some reason you would want all sysctl-tunable features to
-+	  be disabled by default.  As mentioned elsewhere, it is important
-+	  to enable the grsec_lock entry once you have finished modifying
-+	  the sysctl entries.
-+
-+endmenu
-+menu "Logging Options"
-+depends on GRKERNSEC
-+
-+config GRKERNSEC_FLOODTIME
-+	int "Seconds in between log messages (minimum)"
-+	default 10
-+	help
-+	  This option allows you to enforce the number of seconds between
-+	  grsecurity log messages.  The default should be suitable for most
-+	  people, however, if you choose to change it, choose a value small enough
-+	  to allow informative logs to be produced, but large enough to
-+	  prevent flooding.
-+
-+config GRKERNSEC_FLOODBURST
-+	int "Number of messages in a burst (maximum)"
-+	default 4
-+	help
-+	  This option allows you to choose the maximum number of messages allowed
-+	  within the flood time interval you chose in a separate option.  The
-+	  default should be suitable for most people, however if you find that
-+	  many of your logs are being interpreted as flooding, you may want to
-+	  raise this value.
-+
-+endmenu
-+
-+endmenu
-diff --git a/grsecurity/Makefile b/grsecurity/Makefile
-new file mode 100644
-index 0000000000000000000000000000000000000000..6769e8568c521caec84b835d9ff1a5ffddd8d1b6
---- /dev/null
-+++ b/grsecurity/Makefile
-@@ -0,0 +1,20 @@
-+# grsecurity's ACL system was originally written in 2001 by Michael Dalton
-+# during 2001-2005 it has been completely redesigned by Brad Spengler
-+# into an RBAC system
-+#
-+# All code in this directory and various hooks inserted throughout the kernel
-+# are copyright Brad Spengler, and released under the GPL v2 or higher
-+
-+obj-y = grsec_chdir.o grsec_chroot.o grsec_exec.o grsec_fifo.o grsec_fork.o \
-+	grsec_mount.o grsec_sig.o grsec_sock.o grsec_sysctl.o \
-+	grsec_time.o grsec_tpe.o grsec_ipc.o grsec_link.o grsec_textrel.o
-+
-+obj-$(CONFIG_GRKERNSEC) += grsec_init.o grsum.o gracl.o gracl_ip.o gracl_segv.o \
-+	gracl_cap.o gracl_alloc.o gracl_shm.o grsec_mem.o gracl_fs.o \
-+	gracl_learn.o grsec_log.o
-+obj-$(CONFIG_GRKERNSEC_RESLOG) += gracl_res.o
-+
-+ifndef CONFIG_GRKERNSEC
-+obj-y += grsec_disabled.o
-+endif
-+
-diff --git a/grsecurity/gracl.c b/grsecurity/gracl.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..646bf84777eaa082b5fcd460221c74f466ae6351
---- /dev/null
-+++ b/grsecurity/gracl.c
-@@ -0,0 +1,3722 @@
-+#include <linux/kernel.h>
-+#include <linux/module.h>
-+#include <linux/sched.h>
-+#include <linux/mm.h>
-+#include <linux/file.h>
-+#include <linux/fs.h>
-+#include <linux/namei.h>
-+#include <linux/mount.h>
-+#include <linux/tty.h>
-+#include <linux/proc_fs.h>
-+#include <linux/smp_lock.h>
-+#include <linux/slab.h>
-+#include <linux/vmalloc.h>
-+#include <linux/types.h>
-+#include <linux/sysctl.h>
-+#include <linux/netdevice.h>
-+#include <linux/ptrace.h>
-+#include <linux/gracl.h>
-+#include <linux/gralloc.h>
-+#include <linux/grsecurity.h>
-+#include <linux/grinternal.h>
-+#include <linux/pid_namespace.h>
-+#include <linux/fdtable.h>
-+#include <linux/percpu.h>
-+
-+#include <asm/uaccess.h>
-+#include <asm/errno.h>
-+#include <asm/mman.h>
-+
-+static struct acl_role_db acl_role_set;
-+static struct name_db name_set;
-+static struct inodev_db inodev_set;
-+
-+/* for keeping track of userspace pointers used for subjects, so we
-+   can share references in the kernel as well
-+*/
-+
-+static struct dentry *real_root;
-+static struct vfsmount *real_root_mnt;
-+
-+static struct acl_subj_map_db subj_map_set;
-+
-+static struct acl_role_label *default_role;
-+
-+static u16 acl_sp_role_value;
-+
-+extern char *gr_shared_page[4];
-+static DECLARE_MUTEX(gr_dev_sem);
-+rwlock_t gr_inode_lock = RW_LOCK_UNLOCKED;
-+
-+struct gr_arg *gr_usermode;
-+
-+static unsigned int gr_status = GR_STATUS_INIT;
-+
-+extern int chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum);
-+extern void gr_clear_learn_entries(void);
-+
-+#ifdef CONFIG_GRKERNSEC_RESLOG
-+extern void gr_log_resource(const struct task_struct *task,
-+			    const int res, const unsigned long wanted, const int gt);
-+#endif
-+
-+unsigned char *gr_system_salt;
-+unsigned char *gr_system_sum;
-+
-+static struct sprole_pw **acl_special_roles = NULL;
-+static __u16 num_sprole_pws = 0;
-+
-+static struct acl_role_label *kernel_role = NULL;
-+
-+static unsigned int gr_auth_attempts = 0;
-+static unsigned long gr_auth_expires = 0UL;
-+
-+extern struct vfsmount *sock_mnt;
-+extern struct vfsmount *pipe_mnt;
-+extern struct vfsmount *shm_mnt;
-+static struct acl_object_label *fakefs_obj;
-+
-+extern int gr_init_uidset(void);
-+extern void gr_free_uidset(void);
-+extern void gr_remove_uid(uid_t uid);
-+extern int gr_find_uid(uid_t uid);
-+
-+__inline__ int
-+gr_acl_is_enabled(void)
-+{
-+	return (gr_status & GR_READY);
-+}
-+
-+char gr_roletype_to_char(void)
-+{
-+	switch (current->role->roletype &
-+		(GR_ROLE_DEFAULT | GR_ROLE_USER | GR_ROLE_GROUP |
-+		 GR_ROLE_SPECIAL)) {
-+	case GR_ROLE_DEFAULT:
-+		return 'D';
-+	case GR_ROLE_USER:
-+		return 'U';
-+	case GR_ROLE_GROUP:
-+		return 'G';
-+	case GR_ROLE_SPECIAL:
-+		return 'S';
-+	}
-+
-+	return 'X';
-+}
-+
-+__inline__ int
-+gr_acl_tpe_check(void)
-+{
-+	if (unlikely(!(gr_status & GR_READY)))
-+		return 0;
-+	if (current->role->roletype & GR_ROLE_TPE)
-+		return 1;
-+	else
-+		return 0;
-+}
-+
-+int
-+gr_handle_rawio(const struct inode *inode)
-+{
-+#ifdef CONFIG_GRKERNSEC_CHROOT_CAPS
-+	if (inode && S_ISBLK(inode->i_mode) &&
-+	    grsec_enable_chroot_caps && proc_is_chrooted(current) &&
-+	    !capable(CAP_SYS_RAWIO))
-+		return 1;
-+#endif
-+	return 0;
-+}
-+
-+static int
-+gr_streq(const char *a, const char *b, const unsigned int lena, const unsigned int lenb)
-+{
-+	int i;
-+	unsigned long *l1;
-+	unsigned long *l2;
-+	unsigned char *c1;
-+	unsigned char *c2;
-+	int num_longs;
-+
-+	if (likely(lena != lenb))
-+		return 0;
-+
-+	l1 = (unsigned long *)a;
-+	l2 = (unsigned long *)b;
-+
-+	num_longs = lena / sizeof(unsigned long);
-+
-+	for (i = num_longs; i--; l1++, l2++) {
-+		if (unlikely(*l1 != *l2))
-+			return 0;
-+	}
-+
-+	c1 = (unsigned char *) l1;
-+	c2 = (unsigned char *) l2;
-+
-+	i = lena - (num_longs * sizeof(unsigned long));	
-+
-+	for (; i--; c1++, c2++) {
-+		if (unlikely(*c1 != *c2))
-+			return 0;
-+	}
-+
-+	return 1;
-+}
-+
-+static char * __our_d_path(struct dentry *dentry, struct vfsmount *vfsmnt,
-+	                   struct dentry *root, struct vfsmount *rootmnt,
-+			   char *buffer, int buflen)
-+{
-+	char * end = buffer+buflen;
-+	char * retval;
-+	int namelen;
-+
-+	*--end = '\0';
-+	buflen--;
-+
-+	if (buflen < 1)
-+		goto Elong;
-+	/* Get '/' right */
-+	retval = end-1;
-+	*retval = '/';
-+
-+	for (;;) {
-+		struct dentry * parent;
-+
-+		if (dentry == root && vfsmnt == rootmnt)
-+			break;
-+		if (dentry == vfsmnt->mnt_root || IS_ROOT(dentry)) {
-+			/* Global root? */
-+			spin_lock(&vfsmount_lock);
-+			if (vfsmnt->mnt_parent == vfsmnt) {
-+				spin_unlock(&vfsmount_lock);
-+				goto global_root;
-+			}
-+			dentry = vfsmnt->mnt_mountpoint;
-+			vfsmnt = vfsmnt->mnt_parent;
-+			spin_unlock(&vfsmount_lock);
-+			continue;
-+		}
-+		parent = dentry->d_parent;
-+		prefetch(parent);
-+		namelen = dentry->d_name.len;
-+		buflen -= namelen + 1;
-+		if (buflen < 0)
-+			goto Elong;
-+		end -= namelen;
-+		memcpy(end, dentry->d_name.name, namelen);
-+		*--end = '/';
-+		retval = end;
-+		dentry = parent;
-+	}
-+
-+	return retval;
-+
-+global_root:
-+	namelen = dentry->d_name.len;
-+	buflen -= namelen;
-+	if (buflen < 0)
-+		goto Elong;
-+	retval -= namelen-1;	/* hit the slash */
-+	memcpy(retval, dentry->d_name.name, namelen);
-+	return retval;
-+Elong:
-+	return ERR_PTR(-ENAMETOOLONG);
-+}
-+
-+static char *
-+gen_full_path(struct dentry *dentry, struct vfsmount *vfsmnt,
-+              struct dentry *root, struct vfsmount *rootmnt, char *buf, int buflen)
-+{
-+	char *retval;
-+
-+	retval = __our_d_path(dentry, vfsmnt, root, rootmnt, buf, buflen);
-+	if (unlikely(IS_ERR(retval)))
-+		retval = strcpy(buf, "<path too long>");
-+	else if (unlikely(retval[1] == '/' && retval[2] == '\0'))
-+		retval[1] = '\0';
-+
-+	return retval;
-+}
-+
-+static char *
-+__d_real_path(const struct dentry *dentry, const struct vfsmount *vfsmnt,
-+		char *buf, int buflen)
-+{
-+	char *res;
-+
-+	/* we can use real_root, real_root_mnt, because this is only called
-+	   by the RBAC system */
-+	res = gen_full_path((struct dentry *)dentry, (struct vfsmount *)vfsmnt, real_root, real_root_mnt, buf, buflen);
++	/* we can use real_root, real_root_mnt, because this is only called
++	   by the RBAC system */
++	res = gen_full_path((struct dentry *)dentry, (struct vfsmount *)vfsmnt, real_root, real_root_mnt, buf, buflen);
@@ -22167,6 +21051,4 @@
-diff --git a/grsecurity/gracl_alloc.c b/grsecurity/gracl_alloc.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..207dd450db814071c2e6b6b564996e9a4dc95641
---- /dev/null
-+++ b/grsecurity/gracl_alloc.c
-@@ -0,0 +1,91 @@
+diff -urNp linux-2.6.26.3/grsecurity/gracl_cap.c linux-2.6.26.3/grsecurity/gracl_cap.c
+--- linux-2.6.26.3/grsecurity/gracl_cap.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_cap.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,129 @@
@@ -22174,3 +21056,2 @@
-+#include <linux/mm.h>
-+#include <linux/slab.h>
-+#include <linux/vmalloc.h>
++#include <linux/module.h>
++#include <linux/sched.h>
@@ -22178,0 +21060 @@
++#include <linux/grinternal.h>
@@ -22180,13 +21062,36 @@
-+static unsigned long alloc_stack_next = 1;
-+static unsigned long alloc_stack_size = 1;
-+static void **alloc_stack;
-+
-+static __inline__ int
-+alloc_pop(void)
-+{
-+	if (alloc_stack_next == 1)
-+		return 0;
-+
-+	kfree(alloc_stack[alloc_stack_next - 2]);
-+
-+	alloc_stack_next--;
++static const char *captab_log[] = {
++	"CAP_CHOWN",
++	"CAP_DAC_OVERRIDE",
++	"CAP_DAC_READ_SEARCH",
++	"CAP_FOWNER",
++	"CAP_FSETID",
++	"CAP_KILL",
++	"CAP_SETGID",
++	"CAP_SETUID",
++	"CAP_SETPCAP",
++	"CAP_LINUX_IMMUTABLE",
++	"CAP_NET_BIND_SERVICE",
++	"CAP_NET_BROADCAST",
++	"CAP_NET_ADMIN",
++	"CAP_NET_RAW",
++	"CAP_IPC_LOCK",
++	"CAP_IPC_OWNER",
++	"CAP_SYS_MODULE",
++	"CAP_SYS_RAWIO",
++	"CAP_SYS_CHROOT",
++	"CAP_SYS_PTRACE",
++	"CAP_SYS_PACCT",
++	"CAP_SYS_ADMIN",
++	"CAP_SYS_BOOT",
++	"CAP_SYS_NICE",
++	"CAP_SYS_RESOURCE",
++	"CAP_SYS_TIME",
++	"CAP_SYS_TTY_CONFIG",
++	"CAP_MKNOD",
++	"CAP_LEASE",
++	"CAP_AUDIT_WRITE",
++	"CAP_AUDIT_CONTROL",
++	"CAP_SETFCAP",
++	"CAP_MAC_OVERRIDE",
++	"CAP_MAC_ADMIN"
++};
@@ -22194,2 +21099,2 @@
-+	return 1;
-+}
++EXPORT_SYMBOL(gr_task_is_capable);
++EXPORT_SYMBOL(gr_is_capable_nolog);
@@ -22197,2 +21102,2 @@
-+static __inline__ void
-+alloc_push(void *buf)
++int
++gr_task_is_capable(struct task_struct *task, const int cap)
@@ -22200,2 +21105,2 @@
-+	if (alloc_stack_next >= alloc_stack_size)
-+		BUG();
++	struct acl_subject_label *curracl;
++	kernel_cap_t cap_drop = __cap_empty_set, cap_mask = __cap_empty_set;
@@ -22203 +21108,2 @@
-+	alloc_stack[alloc_stack_next - 1] = buf;
++	if (!gr_acl_is_enabled())
++		return 1;
@@ -22205 +21111 @@
-+	alloc_stack_next++;
++	curracl = task->acl;
@@ -22207,123 +21113,2 @@
-+	return;
-+}
-+
-+void *
-+acl_alloc(unsigned long len)
-+{
-+	void *ret;
-+
-+	if (len > PAGE_SIZE)
-+		BUG();
-+
-+	ret = kmalloc(len, GFP_KERNEL);
-+
-+	if (ret)
-+		alloc_push(ret);
-+
-+	return ret;
-+}
-+
-+void
-+acl_free_all(void)
-+{
-+	if (gr_acl_is_enabled() || !alloc_stack)
-+		return;
-+
-+	while (alloc_pop()) ;
-+
-+	if (alloc_stack) {
-+		if ((alloc_stack_size * sizeof (void *)) <= PAGE_SIZE)
-+			kfree(alloc_stack);
-+		else
-+			vfree(alloc_stack);
-+	}
-+
-+	alloc_stack = NULL;
-+	alloc_stack_size = 1;
-+	alloc_stack_next = 1;
-+
-+	return;
-+}
-+
-+int
-+acl_alloc_stack_init(unsigned long size)
-+{
-+	if ((size * sizeof (void *)) <= PAGE_SIZE)
-+		alloc_stack =
-+		    (void **) kmalloc(size * sizeof (void *), GFP_KERNEL);
-+	else
-+		alloc_stack = (void **) vmalloc(size * sizeof (void *));
-+
-+	alloc_stack_size = size;
-+
-+	if (!alloc_stack)
-+		return 0;
-+	else
-+		return 1;
-+}
-diff --git a/grsecurity/gracl_cap.c b/grsecurity/gracl_cap.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..d65049ce66662774f5d72ca0c8423ecc4f6f683b
---- /dev/null
-+++ b/grsecurity/gracl_cap.c
-@@ -0,0 +1,129 @@
-+#include <linux/kernel.h>
-+#include <linux/module.h>
-+#include <linux/sched.h>
-+#include <linux/gracl.h>
-+#include <linux/grsecurity.h>
-+#include <linux/grinternal.h>
-+
-+static const char *captab_log[] = {
-+	"CAP_CHOWN",
-+	"CAP_DAC_OVERRIDE",
-+	"CAP_DAC_READ_SEARCH",
-+	"CAP_FOWNER",
-+	"CAP_FSETID",
-+	"CAP_KILL",
-+	"CAP_SETGID",
-+	"CAP_SETUID",
-+	"CAP_SETPCAP",
-+	"CAP_LINUX_IMMUTABLE",
-+	"CAP_NET_BIND_SERVICE",
-+	"CAP_NET_BROADCAST",
-+	"CAP_NET_ADMIN",
-+	"CAP_NET_RAW",
-+	"CAP_IPC_LOCK",
-+	"CAP_IPC_OWNER",
-+	"CAP_SYS_MODULE",
-+	"CAP_SYS_RAWIO",
-+	"CAP_SYS_CHROOT",
-+	"CAP_SYS_PTRACE",
-+	"CAP_SYS_PACCT",
-+	"CAP_SYS_ADMIN",
-+	"CAP_SYS_BOOT",
-+	"CAP_SYS_NICE",
-+	"CAP_SYS_RESOURCE",
-+	"CAP_SYS_TIME",
-+	"CAP_SYS_TTY_CONFIG",
-+	"CAP_MKNOD",
-+	"CAP_LEASE",
-+	"CAP_AUDIT_WRITE",
-+	"CAP_AUDIT_CONTROL",
-+	"CAP_SETFCAP",
-+	"CAP_MAC_OVERRIDE",
-+	"CAP_MAC_ADMIN"
-+};
-+
-+EXPORT_SYMBOL(gr_task_is_capable);
-+EXPORT_SYMBOL(gr_is_capable_nolog);
-+
-+int
-+gr_task_is_capable(struct task_struct *task, const int cap)
-+{
-+	struct acl_subject_label *curracl;
-+	kernel_cap_t cap_drop = __cap_empty_set, cap_mask = __cap_empty_set;
-+
-+	if (!gr_acl_is_enabled())
-+		return 1;
-+
-+	curracl = task->acl;
-+
-+	cap_drop = curracl->cap_lower;
-+	cap_mask = curracl->cap_mask;
++	cap_drop = curracl->cap_lower;
++	cap_mask = curracl->cap_mask;
@@ -22399,5 +21184,3 @@
-diff --git a/grsecurity/gracl_fs.c b/grsecurity/gracl_fs.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..67910eccd93a9a919f59d764465e8382c312f301
---- /dev/null
-+++ b/grsecurity/gracl_fs.c
+diff -urNp linux-2.6.26.3/grsecurity/gracl_fs.c linux-2.6.26.3/grsecurity/gracl_fs.c
+--- linux-2.6.26.3/grsecurity/gracl_fs.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_fs.c	2008-08-09 12:03:30.000000000 -0400
@@ -22828,5 +21611,3 @@
-diff --git a/grsecurity/gracl_ip.c b/grsecurity/gracl_ip.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..443681dace6bcdc59a3343053abb684f3b6de360
---- /dev/null
-+++ b/grsecurity/gracl_ip.c
+diff -urNp linux-2.6.26.3/grsecurity/gracl_ip.c linux-2.6.26.3/grsecurity/gracl_ip.c
+--- linux-2.6.26.3/grsecurity/gracl_ip.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_ip.c	2008-08-09 12:03:30.000000000 -0400
@@ -23147,5 +21928,3 @@
-diff --git a/grsecurity/gracl_learn.c b/grsecurity/gracl_learn.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..fc29f4201caffa07a11463865e63b41d2778e9ca
---- /dev/null
-+++ b/grsecurity/gracl_learn.c
+diff -urNp linux-2.6.26.3/grsecurity/gracl_learn.c linux-2.6.26.3/grsecurity/gracl_learn.c
+--- linux-2.6.26.3/grsecurity/gracl_learn.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_learn.c	2008-08-09 12:03:30.000000000 -0400
@@ -23364,5 +22143,3 @@
-diff --git a/grsecurity/gracl_res.c b/grsecurity/gracl_res.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..04779c92cef8ee719015aa3a4b47352d70d8b788
---- /dev/null
-+++ b/grsecurity/gracl_res.c
+diff -urNp linux-2.6.26.3/grsecurity/gracl_res.c linux-2.6.26.3/grsecurity/gracl_res.c
+--- linux-2.6.26.3/grsecurity/gracl_res.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_res.c	2008-08-09 12:03:30.000000000 -0400
@@ -23415,5 +22192,3 @@
-diff --git a/grsecurity/gracl_segv.c b/grsecurity/gracl_segv.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..f6cde6ec82a2a21c56b912083619248e7020bfa2
---- /dev/null
-+++ b/grsecurity/gracl_segv.c
+diff -urNp linux-2.6.26.3/grsecurity/gracl_segv.c linux-2.6.26.3/grsecurity/gracl_segv.c
+--- linux-2.6.26.3/grsecurity/gracl_segv.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_segv.c	2008-08-09 12:03:30.000000000 -0400
@@ -23722,5 +22497,3 @@
-diff --git a/grsecurity/gracl_shm.c b/grsecurity/gracl_shm.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..c43caefe0da5dfdd163b2f49e9d417293e08488f
---- /dev/null
-+++ b/grsecurity/gracl_shm.c
+diff -urNp linux-2.6.26.3/grsecurity/gracl_shm.c linux-2.6.26.3/grsecurity/gracl_shm.c
+--- linux-2.6.26.3/grsecurity/gracl_shm.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/gracl_shm.c	2008-08-09 12:03:30.000000000 -0400
@@ -23761,5 +22534,3 @@
-diff --git a/grsecurity/grsec_chdir.c b/grsecurity/grsec_chdir.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..bc0be01b02a0774733a0fa06313a5e81ea55c13b
---- /dev/null
-+++ b/grsecurity/grsec_chdir.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_chdir.c linux-2.6.26.3/grsecurity/grsec_chdir.c
+--- linux-2.6.26.3/grsecurity/grsec_chdir.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_chdir.c	2008-08-09 12:03:30.000000000 -0400
@@ -23786,5 +22557,3 @@
-diff --git a/grsecurity/grsec_chroot.c b/grsecurity/grsec_chroot.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3cc4a6184a9704ae1b35938603dc80dc767157a1
---- /dev/null
-+++ b/grsecurity/grsec_chroot.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_chroot.c linux-2.6.26.3/grsecurity/grsec_chroot.c
+--- linux-2.6.26.3/grsecurity/grsec_chroot.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_chroot.c	2008-08-09 12:03:30.000000000 -0400
@@ -24128,5 +22897,3 @@
-diff --git a/grsecurity/grsec_disabled.c b/grsecurity/grsec_disabled.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..adcffcecef0b97b0503eee87a004066a6b3cbfbf
---- /dev/null
-+++ b/grsecurity/grsec_disabled.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_disabled.c linux-2.6.26.3/grsecurity/grsec_disabled.c
+--- linux-2.6.26.3/grsecurity/grsec_disabled.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_disabled.c	2008-08-09 12:03:30.000000000 -0400
@@ -24552,5 +23319,3 @@
-diff --git a/grsecurity/grsec_exec.c b/grsecurity/grsec_exec.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..8e34c0b1c91a511efaec526ef781e32623c619ba
---- /dev/null
-+++ b/grsecurity/grsec_exec.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_exec.c linux-2.6.26.3/grsecurity/grsec_exec.c
+--- linux-2.6.26.3/grsecurity/grsec_exec.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_exec.c	2008-08-09 12:03:30.000000000 -0400
@@ -24646,5 +23411,3 @@
-diff --git a/grsecurity/grsec_fifo.c b/grsecurity/grsec_fifo.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..cf3169ac19c93c78cf469398010bafd3d4dd4e07
---- /dev/null
-+++ b/grsecurity/grsec_fifo.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_fifo.c linux-2.6.26.3/grsecurity/grsec_fifo.c
+--- linux-2.6.26.3/grsecurity/grsec_fifo.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_fifo.c	2008-08-09 12:03:30.000000000 -0400
@@ -24674,5 +23437,3 @@
-diff --git a/grsecurity/grsec_fork.c b/grsecurity/grsec_fork.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3d4310db2bb08d7c6c879f875bdbe892622b6081
---- /dev/null
-+++ b/grsecurity/grsec_fork.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_fork.c linux-2.6.26.3/grsecurity/grsec_fork.c
+--- linux-2.6.26.3/grsecurity/grsec_fork.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_fork.c	2008-08-09 12:03:30.000000000 -0400
@@ -24695,5 +23456,3 @@
-diff --git a/grsecurity/grsec_init.c b/grsecurity/grsec_init.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..b89ab584c58e86df80301f6aa5bfb0216e3705a2
---- /dev/null
-+++ b/grsecurity/grsec_init.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_init.c linux-2.6.26.3/grsecurity/grsec_init.c
+--- linux-2.6.26.3/grsecurity/grsec_init.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_init.c	2008-08-09 12:03:30.000000000 -0400
@@ -24931,5 +23690,3 @@
-diff --git a/grsecurity/grsec_ipc.c b/grsecurity/grsec_ipc.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..9cace6e9dea7b972c155e52ead74dc4da2c96b5d
---- /dev/null
-+++ b/grsecurity/grsec_ipc.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_ipc.c linux-2.6.26.3/grsecurity/grsec_ipc.c
+--- linux-2.6.26.3/grsecurity/grsec_ipc.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_ipc.c	2008-08-09 12:03:30.000000000 -0400
@@ -25018,5 +23775,3 @@
-diff --git a/grsecurity/grsec_link.c b/grsecurity/grsec_link.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..b8309ee50af1302d8bdad0f1b85de1c5470b1215
---- /dev/null
-+++ b/grsecurity/grsec_link.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_link.c linux-2.6.26.3/grsecurity/grsec_link.c
+--- linux-2.6.26.3/grsecurity/grsec_link.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_link.c	2008-08-09 12:03:30.000000000 -0400
@@ -25063,5 +23818,3 @@
-diff --git a/grsecurity/grsec_log.c b/grsecurity/grsec_log.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..243bc5b89d3ccd37fae3833d56753ba3185c6779
---- /dev/null
-+++ b/grsecurity/grsec_log.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_log.c linux-2.6.26.3/grsecurity/grsec_log.c
+--- linux-2.6.26.3/grsecurity/grsec_log.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_log.c	2008-08-09 12:03:30.000000000 -0400
@@ -25338,5 +24091,3 @@
-diff --git a/grsecurity/grsec_mem.c b/grsecurity/grsec_mem.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3361642bf7c1ba85444491160dc6818bc8890e9a
---- /dev/null
-+++ b/grsecurity/grsec_mem.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_mem.c linux-2.6.26.3/grsecurity/grsec_mem.c
+--- linux-2.6.26.3/grsecurity/grsec_mem.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_mem.c	2008-08-09 12:03:30.000000000 -0400
@@ -25415,5 +24166,3 @@
-diff --git a/grsecurity/grsec_mount.c b/grsecurity/grsec_mount.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..28866541d8e9093f53179a9ffbf9c3ef84b3659f
---- /dev/null
-+++ b/grsecurity/grsec_mount.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_mount.c linux-2.6.26.3/grsecurity/grsec_mount.c
+--- linux-2.6.26.3/grsecurity/grsec_mount.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_mount.c	2008-08-09 12:03:30.000000000 -0400
@@ -25455,5 +24204,3 @@
-diff --git a/grsecurity/grsec_sig.c b/grsecurity/grsec_sig.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..51ae9baa8f9a3a7fecb2690ce1565da0d632d39c
---- /dev/null
-+++ b/grsecurity/grsec_sig.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_sig.c linux-2.6.26.3/grsecurity/grsec_sig.c
+--- linux-2.6.26.3/grsecurity/grsec_sig.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_sig.c	2008-08-09 12:03:30.000000000 -0400
@@ -25519,5 +24266,3 @@
-diff --git a/grsecurity/grsec_sock.c b/grsecurity/grsec_sock.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..109a3efeb71e1fa108046c48c4ec5747f24411a0
---- /dev/null
-+++ b/grsecurity/grsec_sock.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_sock.c linux-2.6.26.3/grsecurity/grsec_sock.c
+--- linux-2.6.26.3/grsecurity/grsec_sock.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_sock.c	2008-08-09 12:03:30.000000000 -0400
@@ -25799,5 +24544,3 @@
-diff --git a/grsecurity/grsec_sysctl.c b/grsecurity/grsec_sysctl.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..79865a41d0627df565ea2defe779c2703ea8deec
---- /dev/null
-+++ b/grsecurity/grsec_sysctl.c
+diff -urNp linux-2.6.26.3/grsecurity/grsec_sysctl.c linux-2.6.26.3/grsecurity/grsec_sysctl.c
+--- linux-2.6.26.3/grsecurity/grsec_sysctl.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_sysctl.c	2008-08-09 12:03:30.000000000 -0400
@@ -26230,22 +24973,738 @@
-+int gr_check_modstop(void)
-+{
-+#ifdef CONFIG_GRKERNSEC_MODSTOP
-+	if (grsec_modstop == 1) {
-+		gr_log_noargs(GR_DONT_AUDIT, GR_STOPMOD_MSG);
-+		return 1;
-+	}
-+#endif
-+	return 0;
-+}
-diff --git a/grsecurity/grsec_textrel.c b/grsecurity/grsec_textrel.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..143ed92d5ad412940eff915c3ef6c4609d3494c1
---- /dev/null
-+++ b/grsecurity/grsec_textrel.c
-@@ -0,0 +1,16 @@
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/mm.h>
-+#include <linux/file.h>
-+#include <linux/grinternal.h>
-+#include <linux/grsecurity.h>
++int gr_check_modstop(void)
++{
++#ifdef CONFIG_GRKERNSEC_MODSTOP
++	if (grsec_modstop == 1) {
++		gr_log_noargs(GR_DONT_AUDIT, GR_STOPMOD_MSG);
++		return 1;
++	}
++#endif
++	return 0;
++}
+diff -urNp linux-2.6.26.3/grsecurity/grsec_textrel.c linux-2.6.26.3/grsecurity/grsec_textrel.c
+--- linux-2.6.26.3/grsecurity/grsec_textrel.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_textrel.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,16 @@
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/mm.h>
++#include <linux/file.h>
++#include <linux/grinternal.h>
++#include <linux/grsecurity.h>
++
++void
++gr_log_textrel(struct vm_area_struct * vma)
++{
++#ifdef CONFIG_GRKERNSEC_AUDIT_TEXTREL
++	if (grsec_enable_audit_textrel)
++		gr_log_textrel_ulong_ulong(GR_DO_AUDIT, GR_TEXTREL_AUDIT_MSG, vma->vm_file, vma->vm_start, vma->vm_pgoff);
++#endif
++	return;
++}
+diff -urNp linux-2.6.26.3/grsecurity/grsec_time.c linux-2.6.26.3/grsecurity/grsec_time.c
+--- linux-2.6.26.3/grsecurity/grsec_time.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_time.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,13 @@
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/grinternal.h>
++
++void
++gr_log_timechange(void)
++{
++#ifdef CONFIG_GRKERNSEC_TIME
++	if (grsec_enable_time)
++		gr_log_noargs(GR_DONT_AUDIT_GOOD, GR_TIME_MSG);
++#endif
++	return;
++}
+diff -urNp linux-2.6.26.3/grsecurity/grsec_tpe.c linux-2.6.26.3/grsecurity/grsec_tpe.c
+--- linux-2.6.26.3/grsecurity/grsec_tpe.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsec_tpe.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,37 @@
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/file.h>
++#include <linux/fs.h>
++#include <linux/grinternal.h>
++
++extern int gr_acl_tpe_check(void);
++
++int
++gr_tpe_allow(const struct file *file)
++{
++#ifdef CONFIG_GRKERNSEC
++	struct inode *inode = file->f_path.dentry->d_parent->d_inode;
++
++	if (current->uid && ((grsec_enable_tpe &&
++#ifdef CONFIG_GRKERNSEC_TPE_INVERT
++	    !in_group_p(grsec_tpe_gid)
++#else
++	    in_group_p(grsec_tpe_gid)
++#endif
++	    ) || gr_acl_tpe_check()) &&
++	    (inode->i_uid || (!inode->i_uid && ((inode->i_mode & S_IWGRP) ||
++						(inode->i_mode & S_IWOTH))))) {
++		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
++		return 0;
++	}
++#ifdef CONFIG_GRKERNSEC_TPE_ALL
++	if (current->uid && grsec_enable_tpe && grsec_enable_tpe_all &&
++	    ((inode->i_uid && (inode->i_uid != current->uid)) ||
++	     (inode->i_mode & S_IWGRP) || (inode->i_mode & S_IWOTH))) {
++		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
++		return 0;
++	}
++#endif
++#endif
++	return 1;
++}
+diff -urNp linux-2.6.26.3/grsecurity/grsum.c linux-2.6.26.3/grsecurity/grsum.c
+--- linux-2.6.26.3/grsecurity/grsum.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/grsum.c	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,59 @@
++#include <linux/err.h>
++#include <linux/kernel.h>
++#include <linux/sched.h>
++#include <linux/mm.h>
++#include <linux/scatterlist.h>
++#include <linux/crypto.h>
++#include <linux/gracl.h>
++
++
++#if !defined(CONFIG_CRYPTO) || defined(CONFIG_CRYPTO_MODULE) || !defined(CONFIG_CRYPTO_SHA256) || defined(CONFIG_CRYPTO_SHA256_MODULE)
++#error "crypto and sha256 must be built into the kernel"
++#endif
++
++int
++chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum)
++{
++	char *p;
++	struct crypto_hash *tfm;
++	struct hash_desc desc;
++	struct scatterlist sg;
++	unsigned char temp_sum[GR_SHA_LEN];
++	volatile int retval = 0;
++	volatile int dummy = 0;
++	unsigned int i;
++
++	tfm = crypto_alloc_hash("sha256", 0, CRYPTO_ALG_ASYNC);
++	if (IS_ERR(tfm)) {
++		/* should never happen, since sha256 should be built in */
++		return 1;
++	}
++
++	desc.tfm = tfm;
++	desc.flags = 0;
++
++	crypto_hash_init(&desc);
++
++	p = salt;
++	sg_set_buf(&sg, p, GR_SALT_LEN);
++	crypto_hash_update(&desc, &sg, sg.length);
++
++	p = entry->pw;
++	sg_set_buf(&sg, p, strlen(p));
++	
++	crypto_hash_update(&desc, &sg, sg.length);
++
++	crypto_hash_final(&desc, temp_sum);
++
++	memset(entry->pw, 0, GR_PW_LEN);
++
++	for (i = 0; i < GR_SHA_LEN; i++)
++		if (sum[i] != temp_sum[i])
++			retval = 1;
++		else
++			dummy = 1;	// waste a cycle
++
++	crypto_free_hash(tfm);
++
++	return retval;
++}
+diff -urNp linux-2.6.26.3/grsecurity/Kconfig linux-2.6.26.3/grsecurity/Kconfig
+--- linux-2.6.26.3/grsecurity/Kconfig	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/Kconfig	2008-08-09 13:02:45.000000000 -0400
+@@ -0,0 +1,863 @@
++#
++# grecurity configuration
++#
++
++menu "Grsecurity"
++
++config GRKERNSEC
++	bool "Grsecurity"
++	select CRYPTO
++	select CRYPTO_SHA256
++	select SECURITY
++	select SECURITY_CAPABILITIES
++	help
++	  If you say Y here, you will be able to configure many features
++	  that will enhance the security of your system.  It is highly
++	  recommended that you say Y here and read through the help
++	  for each option so that you fully understand the features and
++	  can evaluate their usefulness for your machine.
++
++choice
++	prompt "Security Level"
++	depends on GRKERNSEC
++	default GRKERNSEC_CUSTOM
++
++config GRKERNSEC_LOW
++	bool "Low"
++	select GRKERNSEC_LINK
++	select GRKERNSEC_FIFO
++	select GRKERNSEC_EXECVE
++	select GRKERNSEC_RANDNET
++	select GRKERNSEC_DMESG
++	select GRKERNSEC_CHROOT_CHDIR
++	select GRKERNSEC_MODSTOP if (MODULES)
++
++	help
++	  If you choose this option, several of the grsecurity options will
++	  be enabled that will give you greater protection against a number
++	  of attacks, while assuring that none of your software will have any
++	  conflicts with the additional security measures.  If you run a lot
++	  of unusual software, or you are having problems with the higher
++	  security levels, you should say Y here.  With this option, the
++	  following features are enabled:
++
++	  - Linking restrictions
++	  - FIFO restrictions
++	  - Enforcing RLIMIT_NPROC on execve
++	  - Restricted dmesg
++	  - Enforced chdir("/") on chroot
++	  - Runtime module disabling
++
++config GRKERNSEC_MEDIUM
++	bool "Medium"
++	select PAX
++	select PAX_EI_PAX
++	select PAX_PT_PAX_FLAGS
++	select PAX_HAVE_ACL_FLAGS
++	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
++	select GRKERNSEC_CHROOT_SYSCTL
++	select GRKERNSEC_LINK
++	select GRKERNSEC_FIFO
++	select GRKERNSEC_EXECVE
++	select GRKERNSEC_DMESG
++	select GRKERNSEC_RANDNET
++	select GRKERNSEC_FORKFAIL
++	select GRKERNSEC_TIME
++	select GRKERNSEC_SIGNAL
++	select GRKERNSEC_CHROOT
++	select GRKERNSEC_CHROOT_UNIX
++	select GRKERNSEC_CHROOT_MOUNT
++	select GRKERNSEC_CHROOT_PIVOT
++	select GRKERNSEC_CHROOT_DOUBLE
++	select GRKERNSEC_CHROOT_CHDIR
++	select GRKERNSEC_CHROOT_MKNOD
++	select GRKERNSEC_PROC
++	select GRKERNSEC_PROC_USERGROUP
++	select GRKERNSEC_MODSTOP if (MODULES)
++	select PAX_RANDUSTACK
++	select PAX_ASLR
++	select PAX_RANDMMAP
++	select PAX_REFCOUNT
++
++	help
++	  If you say Y here, several features in addition to those included
++	  in the low additional security level will be enabled.  These
++	  features provide even more security to your system, though in rare
++	  cases they may be incompatible with very old or poorly written
++	  software.  If you enable this option, make sure that your auth
++	  service (identd) is running as gid 1001.  With this option, 
++	  the following features (in addition to those provided in the 
++	  low additional security level) will be enabled:
++
++	  - Failed fork logging
++	  - Time change logging
++	  - Signal logging
++	  - Deny mounts in chroot
++	  - Deny double chrooting
++	  - Deny sysctl writes in chroot
++	  - Deny mknod in chroot
++	  - Deny access to abstract AF_UNIX sockets out of chroot
++	  - Deny pivot_root in chroot
++	  - Denied writes of /dev/kmem, /dev/mem, and /dev/port
++	  - /proc restrictions with special GID set to 10 (usually wheel)
++	  - Address Space Layout Randomization (ASLR)
++
++config GRKERNSEC_HIGH
++	bool "High"
++	select GRKERNSEC_LINK
++	select GRKERNSEC_FIFO
++	select GRKERNSEC_EXECVE
++	select GRKERNSEC_DMESG
++	select GRKERNSEC_FORKFAIL
++	select GRKERNSEC_TIME
++	select GRKERNSEC_SIGNAL
++	select GRKERNSEC_CHROOT_SHMAT
++	select GRKERNSEC_CHROOT_UNIX
++	select GRKERNSEC_CHROOT_MOUNT
++	select GRKERNSEC_CHROOT_FCHDIR
++	select GRKERNSEC_CHROOT_PIVOT
++	select GRKERNSEC_CHROOT_DOUBLE
++	select GRKERNSEC_CHROOT_CHDIR
++	select GRKERNSEC_CHROOT_MKNOD
++	select GRKERNSEC_CHROOT_CAPS
++	select GRKERNSEC_CHROOT_SYSCTL
++	select GRKERNSEC_CHROOT_FINDTASK
++	select GRKERNSEC_PROC
++	select GRKERNSEC_PROC_MEMMAP if (PAX_NOEXEC || PAX_ASLR)
++	select GRKERNSEC_HIDESYM
++	select GRKERNSEC_BRUTE
++	select GRKERNSEC_PROC_USERGROUP
++	select GRKERNSEC_KMEM
++	select GRKERNSEC_RESLOG
++	select GRKERNSEC_RANDNET
++	select GRKERNSEC_PROC_ADD
++	select GRKERNSEC_CHROOT_CHMOD
++	select GRKERNSEC_CHROOT_NICE
++	select GRKERNSEC_AUDIT_MOUNT
++	select GRKERNSEC_MODSTOP if (MODULES)
++	select PAX
++	select PAX_RANDUSTACK
++	select PAX_ASLR
++	select PAX_RANDMMAP
++	select PAX_NOEXEC
++	select PAX_MPROTECT
++	select PAX_EI_PAX
++	select PAX_PT_PAX_FLAGS
++	select PAX_HAVE_ACL_FLAGS
++	select PAX_KERNEXEC if (X86 && !EFI && !COMPAT_VDSO && !PARAVIRT && (!X86_32 || X86_WP_WORKS_OK))
++	select PAX_MEMORY_UDEREF if (!X86_64 && !COMPAT_VDSO)
++	select PAX_RANDKSTACK if (X86_TSC && !X86_64)
++	select PAX_SEGMEXEC if (X86 && !X86_64)
++	select PAX_PAGEEXEC if (!X86)
++	select PAX_EMUPLT if (ALPHA || PARISC || PPC32 || SPARC32 || SPARC64)
++	select PAX_DLRESOLVE if (SPARC32 || SPARC64)
++	select PAX_SYSCALL if (PPC32)
++	select PAX_EMUTRAMP if (PARISC)
++	select PAX_EMUSIGRT if (PARISC)
++	select PAX_ETEXECRELOCS if (ALPHA || IA64 || PARISC)
++	select PAX_REFCOUNT
++	help
++	  If you say Y here, many of the features of grsecurity will be
++	  enabled, which will protect you against many kinds of attacks
++	  against your system.  The heightened security comes at a cost
++	  of an increased chance of incompatibilities with rare software
++	  on your machine.  Since this security level enables PaX, you should
++	  view <http://pax.grsecurity.net> and read about the PaX
++	  project.  While you are there, download chpax and run it on
++	  binaries that cause problems with PaX.  Also remember that
++	  since the /proc restrictions are enabled, you must run your
++	  identd as gid 1001.  This security level enables the following 
++	  features in addition to those listed in the low and medium 
++	  security levels:
++
++	  - Additional /proc restrictions
++	  - Chmod restrictions in chroot
++	  - No signals, ptrace, or viewing of processes outside of chroot
++	  - Capability restrictions in chroot
++	  - Deny fchdir out of chroot
++	  - Priority restrictions in chroot
++	  - Segmentation-based implementation of PaX
++	  - Mprotect restrictions
++	  - Removal of addresses from /proc/<pid>/[smaps|maps|stat]
++	  - Kernel stack randomization
++	  - Mount/unmount/remount logging
++	  - Kernel symbol hiding
++	  - Prevention of memory exhaustion-based exploits
++config GRKERNSEC_CUSTOM
++	bool "Custom"
++	help
++	  If you say Y here, you will be able to configure every grsecurity
++	  option, which allows you to enable many more features that aren't
++	  covered in the basic security levels.  These additional features
++	  include TPE, socket restrictions, and the sysctl system for
++	  grsecurity.  It is advised that you read through the help for
++	  each option to determine its usefulness in your situation.
++
++endchoice
++
++menu "Address Space Protection"
++depends on GRKERNSEC
++
++config GRKERNSEC_KMEM
++	bool "Deny writing to /dev/kmem, /dev/mem, and /dev/port"
++	help
++	  If you say Y here, /dev/kmem and /dev/mem won't be allowed to
++	  be written to via mmap or otherwise to modify the running kernel.
++	  /dev/port will also not be allowed to be opened. If you have module
++	  support disabled, enabling this will close up four ways that are
++	  currently used  to insert malicious code into the running kernel.
++	  Even with all these features enabled, we still highly recommend that
++	  you use the RBAC system, as it is still possible for an attacker to
++	  modify the running kernel through privileged I/O granted by ioperm/iopl.
++	  If you are not using XFree86, you may be able to stop this additional
++	  case by enabling the 'Disable privileged I/O' option. Though nothing
++	  legitimately writes to /dev/kmem, XFree86 does need to write to /dev/mem,
++	  but only to video memory, which is the only writing we allow in this
++	  case.  If /dev/kmem or /dev/mem are mmaped without PROT_WRITE, they will
++	  not be allowed to mprotect it with PROT_WRITE later.
++	  It is highly recommended that you say Y here if you meet all the
++	  conditions above.
++
++config GRKERNSEC_IO
++	bool "Disable privileged I/O"
++	depends on X86
++	select RTC
++	help
++	  If you say Y here, all ioperm and iopl calls will return an error.
++	  Ioperm and iopl can be used to modify the running kernel.
++	  Unfortunately, some programs need this access to operate properly,
++	  the most notable of which are XFree86 and hwclock.  hwclock can be
++	  remedied by having RTC support in the kernel, so CONFIG_RTC is
++	  enabled if this option is enabled, to ensure that hwclock operates
++	  correctly.  XFree86 still will not operate correctly with this option
++	  enabled, so DO NOT CHOOSE Y IF YOU USE XFree86.  If you use XFree86
++	  and you still want to protect your kernel against modification,
++	  use the RBAC system.
++
++config GRKERNSEC_PROC_MEMMAP
++	bool "Remove addresses from /proc/<pid>/[smaps|maps|stat]"
++	depends on PAX_NOEXEC || PAX_ASLR
++	help
++	  If you say Y here, the /proc/<pid>/maps and /proc/<pid>/stat files will
++	  give no information about the addresses of its mappings if
++	  PaX features that rely on random addresses are enabled on the task.
++	  If you use PaX it is greatly recommended that you say Y here as it
++	  closes up a hole that makes the full ASLR useless for suid
++	  binaries.
++
++config GRKERNSEC_BRUTE
++	bool "Deter exploit bruteforcing"
++	help
++	  If you say Y here, attempts to bruteforce exploits against forking
++	  daemons such as apache or sshd will be deterred.  When a child of a
++	  forking daemon is killed by PaX or crashes due to an illegal
++	  instruction, the parent process will be delayed 30 seconds upon every
++	  subsequent fork until the administrator is able to assess the
++	  situation and restart the daemon.  It is recommended that you also
++	  enable signal logging in the auditing section so that logs are
++	  generated when a process performs an illegal instruction.
++
++config GRKERNSEC_MODSTOP
++	bool "Runtime module disabling"
++	depends on MODULES
++	help
++	  If you say Y here, you will be able to disable the ability to (un)load
++	  modules at runtime.  This feature is useful if you need the ability
++	  to load kernel modules at boot time, but do not want to allow an
++	  attacker to load a rootkit kernel module into the system, or to remove
++	  a loaded kernel module important to system functioning.  You should
++	  enable the /dev/mem protection feature as well, since rootkits can be
++	  inserted into the kernel via other methods than kernel modules.  Since
++	  an untrusted module could still be loaded by modifying init scripts and
++	  rebooting the system, it is also recommended that you enable the RBAC
++	  system.  If you enable this option, a sysctl option with name
++	  "disable_modules" will be created.  Setting this option to "1" disables
++	  module loading.  After this option is set, no further writes to it are
++	  allowed until the system is rebooted.
++
++config GRKERNSEC_HIDESYM
++	bool "Hide kernel symbols"
++	help
++	  If you say Y here, getting information on loaded modules, and
++	  displaying all kernel symbols through a syscall will be restricted
++	  to users with CAP_SYS_MODULE.  This option is only effective
++	  provided the following conditions are met:
++	  1) The kernel using grsecurity is not precompiled by some distribution
++	  2) You are using the RBAC system and hiding other files such as your
++	     kernel image and System.map
++	  3) You have the additional /proc restrictions enabled, which removes
++	     /proc/kcore
++	  If the above conditions are met, this option will aid to provide a
++	  useful protection against local and remote kernel exploitation of
++	  overflows and arbitrary read/write vulnerabilities.
++
++endmenu
++menu "Role Based Access Control Options"
++depends on GRKERNSEC
++
++config GRKERNSEC_ACL_HIDEKERN
++	bool "Hide kernel processes"
++	help
++	  If you say Y here, all kernel threads will be hidden to all
++	  processes but those whose subject has the "view hidden processes"
++	  flag.
++
++config GRKERNSEC_ACL_MAXTRIES
++	int "Maximum tries before password lockout"
++	default 3
++	help
++	  This option enforces the maximum number of times a user can attempt
++	  to authorize themselves with the grsecurity RBAC system before being
++	  denied the ability to attempt authorization again for a specified time.
++	  The lower the number, the harder it will be to brute-force a password.
++
++config GRKERNSEC_ACL_TIMEOUT
++	int "Time to wait after max password tries, in seconds"
++	default 30
++	help
++	  This option specifies the time the user must wait after attempting to
++	  authorize to the RBAC system with the maximum number of invalid
++	  passwords.  The higher the number, the harder it will be to brute-force
++	  a password.
++
++endmenu
++menu "Filesystem Protections"
++depends on GRKERNSEC
++
++config GRKERNSEC_PROC
++	bool "Proc restrictions"
++	help
++	  If you say Y here, the permissions of the /proc filesystem
++	  will be altered to enhance system security and privacy.  You MUST
++  	  choose either a user only restriction or a user and group restriction.
++	  Depending upon the option you choose, you can either restrict users to
++	  see only the processes they themselves run, or choose a group that can
++	  view all processes and files normally restricted to root if you choose
++	  the "restrict to user only" option.  NOTE: If you're running identd as
++	  a non-root user, you will have to run it as the group you specify here.
++
++config GRKERNSEC_PROC_USER
++	bool "Restrict /proc to user only"
++	depends on GRKERNSEC_PROC
++	help
++	  If you say Y here, non-root users will only be able to view their own
++	  processes, and restricts them from viewing network-related information,
++	  and viewing kernel symbol and module information.
++
++config GRKERNSEC_PROC_USERGROUP
++	bool "Allow special group"
++	depends on GRKERNSEC_PROC && !GRKERNSEC_PROC_USER
++	help
++	  If you say Y here, you will be able to select a group that will be
++	  able to view all processes, network-related information, and
++	  kernel and symbol information.  This option is useful if you want
++	  to run identd as a non-root user.
++
++config GRKERNSEC_PROC_GID
++	int "GID for special group"
++	depends on GRKERNSEC_PROC_USERGROUP
++	default 1001
++
++config GRKERNSEC_PROC_ADD
++	bool "Additional restrictions"
++	depends on GRKERNSEC_PROC_USER || GRKERNSEC_PROC_USERGROUP
++	help
++	  If you say Y here, additional restrictions will be placed on
++	  /proc that keep normal users from viewing device information and 
++	  slabinfo information that could be useful for exploits.
++
++config GRKERNSEC_LINK
++	bool "Linking restrictions"
++	help
++	  If you say Y here, /tmp race exploits will be prevented, since users
++	  will no longer be able to follow symlinks owned by other users in
++	  world-writable +t directories (i.e. /tmp), unless the owner of the
++	  symlink is the owner of the directory. users will also not be
++	  able to hardlink to files they do not own.  If the sysctl option is
++	  enabled, a sysctl option with name "linking_restrictions" is created.
++
++config GRKERNSEC_FIFO
++	bool "FIFO restrictions"
++	help
++	  If you say Y here, users will not be able to write to FIFOs they don't
++	  own in world-writable +t directories (i.e. /tmp), unless the owner of
++	  the FIFO is the same owner of the directory it's held in.  If the sysctl
++	  option is enabled, a sysctl option with name "fifo_restrictions" is
++	  created.
++
++config GRKERNSEC_CHROOT
++	bool "Chroot jail restrictions"
++	help
++	  If you say Y here, you will be able to choose several options that will
++	  make breaking out of a chrooted jail much more difficult.  If you
++	  encounter no software incompatibilities with the following options, it
++	  is recommended that you enable each one.
++
++config GRKERNSEC_CHROOT_MOUNT
++	bool "Deny mounts"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to
++	  mount or remount filesystems.  If the sysctl option is enabled, a
++	  sysctl option with name "chroot_deny_mount" is created.
++
++config GRKERNSEC_CHROOT_DOUBLE
++	bool "Deny double-chroots"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to chroot
++	  again outside the chroot.  This is a widely used method of breaking
++	  out of a chroot jail and should not be allowed.  If the sysctl 
++	  option is enabled, a sysctl option with name 
++	  "chroot_deny_chroot" is created.
++
++config GRKERNSEC_CHROOT_PIVOT
++	bool "Deny pivot_root in chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to use
++	  a function called pivot_root() that was introduced in Linux 2.3.41.  It
++	  works similar to chroot in that it changes the root filesystem.  This
++	  function could be misused in a chrooted process to attempt to break out
++	  of the chroot, and therefore should not be allowed.  If the sysctl
++	  option is enabled, a sysctl option with name "chroot_deny_pivot" is
++	  created.
++
++config GRKERNSEC_CHROOT_CHDIR
++	bool "Enforce chdir(\"/\") on all chroots"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, the current working directory of all newly-chrooted
++	  applications will be set to the the root directory of the chroot.
++	  The man page on chroot(2) states:
++	  Note that this call does not change  the  current  working
++	  directory,  so  that `.' can be outside the tree rooted at
++	  `/'.  In particular, the  super-user  can  escape  from  a
++	  `chroot jail' by doing `mkdir foo; chroot foo; cd ..'.
++
++	  It is recommended that you say Y here, since it's not known to break
++	  any software.  If the sysctl option is enabled, a sysctl option with
++	  name "chroot_enforce_chdir" is created.
++
++config GRKERNSEC_CHROOT_CHMOD
++	bool "Deny (f)chmod +s"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to chmod
++	  or fchmod files to make them have suid or sgid bits.  This protects
++	  against another published method of breaking a chroot.  If the sysctl
++	  option is enabled, a sysctl option with name "chroot_deny_chmod" is
++	  created.
++
++config GRKERNSEC_CHROOT_FCHDIR
++	bool "Deny fchdir out of chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, a well-known method of breaking chroots by fchdir'ing
++	  to a file descriptor of the chrooting process that points to a directory
++	  outside the filesystem will be stopped.  If the sysctl option
++	  is enabled, a sysctl option with name "chroot_deny_fchdir" is created.
++
++config GRKERNSEC_CHROOT_MKNOD
++	bool "Deny mknod"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be allowed to
++	  mknod.  The problem with using mknod inside a chroot is that it
++	  would allow an attacker to create a device entry that is the same
++	  as one on the physical root of your system, which could range from
++	  anything from the console device to a device for your harddrive (which
++	  they could then use to wipe the drive or steal data).  It is recommended
++	  that you say Y here, unless you run into software incompatibilities.
++	  If the sysctl option is enabled, a sysctl option with name
++	  "chroot_deny_mknod" is created.
++
++config GRKERNSEC_CHROOT_SHMAT
++	bool "Deny shmat() out of chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to attach
++	  to shared memory segments that were created outside of the chroot jail.
++	  It is recommended that you say Y here.  If the sysctl option is enabled,
++	  a sysctl option with name "chroot_deny_shmat" is created.
++
++config GRKERNSEC_CHROOT_UNIX
++	bool "Deny access to abstract AF_UNIX sockets out of chroot"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to
++	  connect to abstract (meaning not belonging to a filesystem) Unix
++	  domain sockets that were bound outside of a chroot.  It is recommended
++	  that you say Y here.  If the sysctl option is enabled, a sysctl option
++	  with name "chroot_deny_unix" is created.
++
++config GRKERNSEC_CHROOT_FINDTASK
++	bool "Protect outside processes"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to
++	  kill, send signals with fcntl, ptrace, capget, getpgid, getsid,
++	  or view any process outside of the chroot.  If the sysctl
++	  option is enabled, a sysctl option with name "chroot_findtask" is
++	  created.
++
++config GRKERNSEC_CHROOT_NICE
++	bool "Restrict priority changes"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, processes inside a chroot will not be able to raise
++	  the priority of processes in the chroot, or alter the priority of
++	  processes outside the chroot.  This provides more security than simply
++	  removing CAP_SYS_NICE from the process' capability set.  If the
++	  sysctl option is enabled, a sysctl option with name "chroot_restrict_nice"
++	  is created.
++
++config GRKERNSEC_CHROOT_SYSCTL
++	bool "Deny sysctl writes"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, an attacker in a chroot will not be able to
++	  write to sysctl entries, either by sysctl(2) or through a /proc
++	  interface.  It is strongly recommended that you say Y here. If the
++	  sysctl option is enabled, a sysctl option with name
++	  "chroot_deny_sysctl" is created.
++
++config GRKERNSEC_CHROOT_CAPS
++	bool "Capability restrictions"
++	depends on GRKERNSEC_CHROOT
++	help
++	  If you say Y here, the capabilities on all root processes within a
++	  chroot jail will be lowered to stop module insertion, raw i/o,
++	  system and net admin tasks, rebooting the system, modifying immutable
++	  files, modifying IPC owned by another, and changing the system time.
++	  This is left an option because it can break some apps.  Disable this
++	  if your chrooted apps are having problems performing those kinds of
++	  tasks.  If the sysctl option is enabled, a sysctl option with
++	  name "chroot_caps" is created.
++
++endmenu
++menu "Kernel Auditing"
++depends on GRKERNSEC
++
++config GRKERNSEC_AUDIT_GROUP
++	bool "Single group for auditing"
++	help
++	  If you say Y here, the exec, chdir, (un)mount, and ipc logging features
++	  will only operate on a group you specify.  This option is recommended
++	  if you only want to watch certain users instead of having a large
++	  amount of logs from the entire system.  If the sysctl option is enabled,
++	  a sysctl option with name "audit_group" is created.
++
++config GRKERNSEC_AUDIT_GID
++	int "GID for auditing"
++	depends on GRKERNSEC_AUDIT_GROUP
++	default 1007
++
++config GRKERNSEC_EXECLOG
++	bool "Exec logging"
++	help
++	  If you say Y here, all execve() calls will be logged (since the
++	  other exec*() calls are frontends to execve(), all execution
++	  will be logged).  Useful for shell-servers that like to keep track
++	  of their users.  If the sysctl option is enabled, a sysctl option with
++	  name "exec_logging" is created.
++	  WARNING: This option when enabled will produce a LOT of logs, especially
++	  on an active system.
++
++config GRKERNSEC_RESLOG
++	bool "Resource logging"
++	help
++	  If you say Y here, all attempts to overstep resource limits will
++	  be logged with the resource name, the requested size, and the current
++	  limit.  It is highly recommended that you say Y here.  If the sysctl
++	  option is enabled, a sysctl option with name "resource_logging" is
++	  created.  If the RBAC system is enabled, the sysctl value is ignored.
++
++config GRKERNSEC_CHROOT_EXECLOG
++	bool "Log execs within chroot"
++	help
++	  If you say Y here, all executions inside a chroot jail will be logged
++	  to syslog.  This can cause a large amount of logs if certain
++	  applications (eg. djb's daemontools) are installed on the system, and
++	  is therefore left as an option.  If the sysctl option is enabled, a
++	  sysctl option with name "chroot_execlog" is created.
@@ -26253,18 +25712,5 @@
-+void
-+gr_log_textrel(struct vm_area_struct * vma)
-+{
-+#ifdef CONFIG_GRKERNSEC_AUDIT_TEXTREL
-+	if (grsec_enable_audit_textrel)
-+		gr_log_textrel_ulong_ulong(GR_DO_AUDIT, GR_TEXTREL_AUDIT_MSG, vma->vm_file, vma->vm_start, vma->vm_pgoff);
-+#endif
-+	return;
-+}
-diff --git a/grsecurity/grsec_time.c b/grsecurity/grsec_time.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..9501ab48e537e79b8335a51c79fdca1910edc2d2
---- /dev/null
-+++ b/grsecurity/grsec_time.c
-@@ -0,0 +1,13 @@
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/grinternal.h>
++config GRKERNSEC_AUDIT_CHDIR
++	bool "Chdir logging"
++	help
++	  If you say Y here, all chdir() calls will be logged.  If the sysctl
++ 	  option is enabled, a sysctl option with name "audit_chdir" is created.
@@ -26272,20 +25718,6 @@
-+void
-+gr_log_timechange(void)
-+{
-+#ifdef CONFIG_GRKERNSEC_TIME
-+	if (grsec_enable_time)
-+		gr_log_noargs(GR_DONT_AUDIT_GOOD, GR_TIME_MSG);
-+#endif
-+	return;
-+}
-diff --git a/grsecurity/grsec_tpe.c b/grsecurity/grsec_tpe.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..10a764ef7f4521fdb86c455effc6295b99349c28
---- /dev/null
-+++ b/grsecurity/grsec_tpe.c
-@@ -0,0 +1,37 @@
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/file.h>
-+#include <linux/fs.h>
-+#include <linux/grinternal.h>
++config GRKERNSEC_AUDIT_MOUNT
++	bool "(Un)Mount logging"
++	help
++	  If you say Y here, all mounts and unmounts will be logged.  If the
++	  sysctl option is enabled, a sysctl option with name "audit_mount" is
++	  created.
@@ -26293 +25725,6 @@
-+extern int gr_acl_tpe_check(void);
++config GRKERNSEC_AUDIT_IPC
++	bool "IPC logging"
++	help
++	  If you say Y here, creation and removal of message queues, semaphores,
++	  and shared memory will be logged.  If the sysctl option is enabled, a
++	  sysctl option with name "audit_ipc" is created.
@@ -26295,5 +25732,8 @@
-+int
-+gr_tpe_allow(const struct file *file)
-+{
-+#ifdef CONFIG_GRKERNSEC
-+	struct inode *inode = file->f_path.dentry->d_parent->d_inode;
++config GRKERNSEC_SIGNAL
++	bool "Signal logging"
++	help
++	  If you say Y here, certain important signals will be logged, such as
++	  SIGSEGV, which will as a result inform you of when a error in a program
++	  occurred, which in some cases could mean a possible exploit attempt.
++	  If the sysctl option is enabled, a sysctl option with name
++	  "signal_logging" is created.
@@ -26301,36 +25741,7 @@
-+	if (current->uid && ((grsec_enable_tpe &&
-+#ifdef CONFIG_GRKERNSEC_TPE_INVERT
-+	    !in_group_p(grsec_tpe_gid)
-+#else
-+	    in_group_p(grsec_tpe_gid)
-+#endif
-+	    ) || gr_acl_tpe_check()) &&
-+	    (inode->i_uid || (!inode->i_uid && ((inode->i_mode & S_IWGRP) ||
-+						(inode->i_mode & S_IWOTH))))) {
-+		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
-+		return 0;
-+	}
-+#ifdef CONFIG_GRKERNSEC_TPE_ALL
-+	if (current->uid && grsec_enable_tpe && grsec_enable_tpe_all &&
-+	    ((inode->i_uid && (inode->i_uid != current->uid)) ||
-+	     (inode->i_mode & S_IWGRP) || (inode->i_mode & S_IWOTH))) {
-+		gr_log_fs_generic(GR_DONT_AUDIT, GR_EXEC_TPE_MSG, file->f_path.dentry, file->f_path.mnt);
-+		return 0;
-+	}
-+#endif
-+#endif
-+	return 1;
-+}
-diff --git a/grsecurity/grsum.c b/grsecurity/grsum.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..3971640ec3c77b7968a8bd596efe486c8b01b891
---- /dev/null
-+++ b/grsecurity/grsum.c
-@@ -0,0 +1,59 @@
-+#include <linux/err.h>
-+#include <linux/kernel.h>
-+#include <linux/sched.h>
-+#include <linux/mm.h>
-+#include <linux/scatterlist.h>
-+#include <linux/crypto.h>
-+#include <linux/gracl.h>
++config GRKERNSEC_FORKFAIL
++	bool "Fork failure logging"
++	help
++	  If you say Y here, all failed fork() attempts will be logged.
++	  This could suggest a fork bomb, or someone attempting to overstep
++	  their process limit.  If the sysctl option is enabled, a sysctl option
++	  with name "forkfail_logging" is created.
@@ -26337,0 +25749,6 @@
++config GRKERNSEC_TIME
++	bool "Time change logging"
++	help
++	  If you say Y here, any changes of the system clock will be logged.
++	  If the sysctl option is enabled, a sysctl option with name
++	  "timechange_logging" is created.
@@ -26339,3 +25756,10 @@
-+#if !defined(CONFIG_CRYPTO) || defined(CONFIG_CRYPTO_MODULE) || !defined(CONFIG_CRYPTO_SHA256) || defined(CONFIG_CRYPTO_SHA256_MODULE)
-+#error "crypto and sha256 must be built into the kernel"
-+#endif
++config GRKERNSEC_PROC_IPADDR
++	bool "/proc/<pid>/ipaddr support"
++	help
++	  If you say Y here, a new entry will be added to each /proc/<pid>
++	  directory that contains the IP address of the person using the task.
++	  The IP is carried across local TCP and AF_UNIX stream sockets.
++	  This information can be useful for IDS/IPSes to perform remote response
++	  to a local attack.  The entry is readable by only the owner of the
++	  process (and root if he has CAP_DAC_OVERRIDE, which can be removed via
++	  the RBAC system), and thus does not create privacy concerns.
@@ -26343,11 +25767,13 @@
-+int
-+chkpw(struct gr_arg *entry, unsigned char *salt, unsigned char *sum)
-+{
-+	char *p;
-+	struct crypto_hash *tfm;
-+	struct hash_desc desc;
-+	struct scatterlist sg;
-+	unsigned char temp_sum[GR_SHA_LEN];
-+	volatile int retval = 0;
-+	volatile int dummy = 0;
-+	unsigned int i;
++config GRKERNSEC_AUDIT_TEXTREL
++	bool 'ELF text relocations logging (READ HELP)'
++	depends on PAX_MPROTECT
++	help
++	  If you say Y here, text relocations will be logged with the filename
++	  of the offending library or binary.  The purpose of the feature is
++	  to help Linux distribution developers get rid of libraries and
++	  binaries that need text relocations which hinder the future progress
++	  of PaX.  Only Linux distribution developers should say Y here, and
++	  never on a production machine, as this option creates an information
++	  leak that could aid an attacker in defeating the randomization of
++	  a single memory region.  If the sysctl option is enabled, a sysctl
++	  option with name "audit_textrel" is created.
@@ -26355,5 +25781 @@
-+	tfm = crypto_alloc_hash("sha256", 0, CRYPTO_ALG_ASYNC);
-+	if (IS_ERR(tfm)) {
-+		/* should never happen, since sha256 should be built in */
-+		return 1;
-+	}
++endmenu
@@ -26361,2 +25783,2 @@
-+	desc.tfm = tfm;
-+	desc.flags = 0;
++menu "Executable Protections"
++depends on GRKERNSEC
@@ -26364 +25786,7 @@
-+	crypto_hash_init(&desc);
++config GRKERNSEC_EXECVE
++	bool "Enforce RLIMIT_NPROC on execs"
++	help
++	  If you say Y here, users with a resource limit on processes will
++	  have the value checked during execve() calls.  The current system
++	  only checks the system limit during fork() calls.  If the sysctl option
++	  is enabled, a sysctl option with name "execve_limiting" is created.
@@ -26366,3 +25794,7 @@
-+	p = salt;
-+	sg_set_buf(&sg, p, GR_SALT_LEN);
-+	crypto_hash_update(&desc, &sg, sg.length);
++config GRKERNSEC_DMESG
++	bool "Dmesg(8) restriction"
++	help
++	  If you say Y here, non-root users will not be able to use dmesg(8)
++	  to view up to the last 4kb of messages in the kernel's log buffer.
++	  If the sysctl option is enabled, a sysctl option with name "dmesg" is
++	  created.
@@ -26370,4 +25802,8 @@
-+	p = entry->pw;
-+	sg_set_buf(&sg, p, strlen(p));
-+	
-+	crypto_hash_update(&desc, &sg, sg.length);
++config GRKERNSEC_TPE
++	bool "Trusted Path Execution (TPE)"
++	help
++	  If you say Y here, you will be able to choose a gid to add to the
++	  supplementary groups of users you want to mark as "untrusted."
++	  These users will not be able to execute any files that are not in
++	  root-owned directories writable only by root.  If the sysctl option
++	  is enabled, a sysctl option with name "tpe" is created.
@@ -26375 +25811,10 @@
-+	crypto_hash_final(&desc, temp_sum);
++config GRKERNSEC_TPE_ALL
++	bool "Partially restrict non-root users"
++	depends on GRKERNSEC_TPE
++	help
++	  If you say Y here, All non-root users other than the ones in the
++	  group specified in the main TPE option will only be allowed to
++	  execute files in directories they own that are not group or
++	  world-writable, or in directories owned by root and writable only by
++	  root.  If the sysctl option is enabled, a sysctl option with name
++	  "tpe_restrict_all" is created.
@@ -26377 +25822,8 @@
-+	memset(entry->pw, 0, GR_PW_LEN);
++config GRKERNSEC_TPE_INVERT
++	bool "Invert GID option"
++	depends on GRKERNSEC_TPE
++	help
++	  If you say Y here, the group you specify in the TPE configuration will
++	  decide what group TPE restrictions will be *disabled* for.  This
++	  option is useful if you want TPE restrictions to be applied to most
++	  users on the system.
@@ -26379,5 +25831,11 @@
-+	for (i = 0; i < GR_SHA_LEN; i++)
-+		if (sum[i] != temp_sum[i])
-+			retval = 1;
-+		else
-+			dummy = 1;	// waste a cycle
++config GRKERNSEC_TPE_GID
++	int "GID for untrusted users"
++	depends on GRKERNSEC_TPE && !GRKERNSEC_TPE_INVERT
++	default 1005
++	help
++	  If you have selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *disabled* for.
++	  If you have not selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *enabled* for.
++	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
++	  is created.
@@ -26385 +25843,11 @@
-+	crypto_free_hash(tfm);
++config GRKERNSEC_TPE_GID
++	int "GID for trusted users"
++	depends on GRKERNSEC_TPE && GRKERNSEC_TPE_INVERT
++	default 1005
++	help
++	  If you have selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *disabled* for.
++	  If you have not selected the "Invert GID option" above, setting this
++	  GID determines what group TPE restrictions will be *enabled* for.
++	  If the sysctl option is enabled, a sysctl option with name "tpe_gid"
++	  is created.
@@ -26387,7 +25855,164 @@
-+	return retval;
-+}
-diff --git a/include/asm-alpha/elf.h b/include/asm-alpha/elf.h
-index fc1002ea1e0c766c5150e633d1a83dfa7700a17f..3aa3841844722bd35b0d77057dcb84a6ca2d0b74 100644
---- a/include/asm-alpha/elf.h
-+++ b/include/asm-alpha/elf.h
-@@ -91,6 +91,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_NFPREG];
++endmenu
++menu "Network Protections"
++depends on GRKERNSEC
++
++config GRKERNSEC_RANDNET
++	bool "Larger entropy pools"
++	help
++	  If you say Y here, the entropy pools used for many features of Linux
++	  and grsecurity will be doubled in size.  Since several grsecurity
++	  features use additional randomness, it is recommended that you say Y
++	  here.  Saying Y here has a similar effect as modifying
++	  /proc/sys/kernel/random/poolsize.
++
++config GRKERNSEC_SOCKET
++	bool "Socket restrictions"
++	help
++	  If you say Y here, you will be able to choose from several options.
++	  If you assign a GID on your system and add it to the supplementary
++	  groups of users you want to restrict socket access to, this patch
++	  will perform up to three things, based on the option(s) you choose.
++
++config GRKERNSEC_SOCKET_ALL
++	bool "Deny any sockets to group"
++	depends on GRKERNSEC_SOCKET
++	help
++	  If you say Y here, you will be able to choose a GID of whose users will
++	  be unable to connect to other hosts from your machine or run server
++	  applications from your machine.  If the sysctl option is enabled, a
++	  sysctl option with name "socket_all" is created.
++
++config GRKERNSEC_SOCKET_ALL_GID
++	int "GID to deny all sockets for"
++	depends on GRKERNSEC_SOCKET_ALL
++	default 1004
++	help
++	  Here you can choose the GID to disable socket access for. Remember to
++	  add the users you want socket access disabled for to the GID
++	  specified here.  If the sysctl option is enabled, a sysctl option
++	  with name "socket_all_gid" is created.
++
++config GRKERNSEC_SOCKET_CLIENT
++	bool "Deny client sockets to group"
++	depends on GRKERNSEC_SOCKET
++	help
++	  If you say Y here, you will be able to choose a GID of whose users will
++	  be unable to connect to other hosts from your machine, but will be
++	  able to run servers.  If this option is enabled, all users in the group
++	  you specify will have to use passive mode when initiating ftp transfers
++	  from the shell on your machine.  If the sysctl option is enabled, a
++	  sysctl option with name "socket_client" is created.
++
++config GRKERNSEC_SOCKET_CLIENT_GID
++	int "GID to deny client sockets for"
++	depends on GRKERNSEC_SOCKET_CLIENT
++	default 1003
++	help
++	  Here you can choose the GID to disable client socket access for.
++	  Remember to add the users you want client socket access disabled for to
++	  the GID specified here.  If the sysctl option is enabled, a sysctl
++	  option with name "socket_client_gid" is created.
++
++config GRKERNSEC_SOCKET_SERVER
++	bool "Deny server sockets to group"
++	depends on GRKERNSEC_SOCKET
++	help
++	  If you say Y here, you will be able to choose a GID of whose users will
++	  be unable to run server applications from your machine.  If the sysctl
++	  option is enabled, a sysctl option with name "socket_server" is created.
++
++config GRKERNSEC_SOCKET_SERVER_GID
++	int "GID to deny server sockets for"
++	depends on GRKERNSEC_SOCKET_SERVER
++	default 1002
++	help
++	  Here you can choose the GID to disable server socket access for.
++	  Remember to add the users you want server socket access disabled for to
++	  the GID specified here.  If the sysctl option is enabled, a sysctl
++	  option with name "socket_server_gid" is created.
++
++endmenu
++menu "Sysctl support"
++depends on GRKERNSEC && SYSCTL
++
++config GRKERNSEC_SYSCTL
++	bool "Sysctl support"
++	help
++	  If you say Y here, you will be able to change the options that
++	  grsecurity runs with at bootup, without having to recompile your
++	  kernel.  You can echo values to files in /proc/sys/kernel/grsecurity
++	  to enable (1) or disable (0) various features.  All the sysctl entries
++	  are mutable until the "grsec_lock" entry is set to a non-zero value.
++	  All features enabled in the kernel configuration are disabled at boot
++	  if you do not say Y to the "Turn on features by default" option.
++	  All options should be set at startup, and the grsec_lock entry should
++	  be set to a non-zero value after all the options are set.
++	  *THIS IS EXTREMELY IMPORTANT*
++
++config GRKERNSEC_SYSCTL_ON
++	bool "Turn on features by default"
++	depends on GRKERNSEC_SYSCTL
++	help
++	  If you say Y here, instead of having all features enabled in the
++	  kernel configuration disabled at boot time, the features will be
++	  enabled at boot time.  It is recommended you say Y here unless
++	  there is some reason you would want all sysctl-tunable features to
++	  be disabled by default.  As mentioned elsewhere, it is important
++	  to enable the grsec_lock entry once you have finished modifying
++	  the sysctl entries.
++
++endmenu
++menu "Logging Options"
++depends on GRKERNSEC
++
++config GRKERNSEC_FLOODTIME
++	int "Seconds in between log messages (minimum)"
++	default 10
++	help
++	  This option allows you to enforce the number of seconds between
++	  grsecurity log messages.  The default should be suitable for most
++	  people, however, if you choose to change it, choose a value small enough
++	  to allow informative logs to be produced, but large enough to
++	  prevent flooding.
++
++config GRKERNSEC_FLOODBURST
++	int "Number of messages in a burst (maximum)"
++	default 4
++	help
++	  This option allows you to choose the maximum number of messages allowed
++	  within the flood time interval you chose in a separate option.  The
++	  default should be suitable for most people, however if you find that
++	  many of your logs are being interpreted as flooding, you may want to
++	  raise this value.
++
++endmenu
++
++endmenu
+diff -urNp linux-2.6.26.3/grsecurity/Makefile linux-2.6.26.3/grsecurity/Makefile
+--- linux-2.6.26.3/grsecurity/Makefile	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/grsecurity/Makefile	2008-08-09 12:03:30.000000000 -0400
+@@ -0,0 +1,20 @@
++# grsecurity's ACL system was originally written in 2001 by Michael Dalton
++# during 2001-2005 it has been completely redesigned by Brad Spengler
++# into an RBAC system
++#
++# All code in this directory and various hooks inserted throughout the kernel
++# are copyright Brad Spengler, and released under the GPL v2 or higher
++
++obj-y = grsec_chdir.o grsec_chroot.o grsec_exec.o grsec_fifo.o grsec_fork.o \
++	grsec_mount.o grsec_sig.o grsec_sock.o grsec_sysctl.o \
++	grsec_time.o grsec_tpe.o grsec_ipc.o grsec_link.o grsec_textrel.o
++
++obj-$(CONFIG_GRKERNSEC) += grsec_init.o grsum.o gracl.o gracl_ip.o gracl_segv.o \
++	gracl_cap.o gracl_alloc.o gracl_shm.o grsec_mem.o gracl_fs.o \
++	gracl_learn.o grsec_log.o
++obj-$(CONFIG_GRKERNSEC_RESLOG) += gracl_res.o
++
++ifndef CONFIG_GRKERNSEC
++obj-y += grsec_disabled.o
++endif
++
+diff -urNp linux-2.6.26.3/include/asm-alpha/elf.h linux-2.6.26.3/include/asm-alpha/elf.h
+--- linux-2.6.26.3/include/asm-alpha/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-alpha/elf.h	2008-08-09 12:03:30.000000000 -0400
+@@ -91,6 +91,13 @@ typedef elf_fpreg_t elf_fpregset_t[ELF_N
@@ -26407,4 +26032,3 @@
-diff --git a/include/asm-alpha/kmap_types.h b/include/asm-alpha/kmap_types.h
-index 3e6735a34c571b011172cf54ee3e09db254434da..f39e3316bde9122932ed022da915d35d63d4d866 100644
---- a/include/asm-alpha/kmap_types.h
-+++ b/include/asm-alpha/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-alpha/kmap_types.h linux-2.6.26.3/include/asm-alpha/kmap_types.h
+--- linux-2.6.26.3/include/asm-alpha/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-alpha/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26421,4 +26045,3 @@
-diff --git a/include/asm-alpha/pgtable.h b/include/asm-alpha/pgtable.h
-index 3f0c59f6d8aa07dc5b68f96d1e928ac7f5b222d5..cf1e100bf6d08402668a15899f3be907687257e4 100644
---- a/include/asm-alpha/pgtable.h
-+++ b/include/asm-alpha/pgtable.h
+diff -urNp linux-2.6.26.3/include/asm-alpha/pgtable.h linux-2.6.26.3/include/asm-alpha/pgtable.h
+--- linux-2.6.26.3/include/asm-alpha/pgtable.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-alpha/pgtable.h	2008-08-09 12:03:30.000000000 -0400
@@ -26443,4 +26066,3 @@
-diff --git a/include/asm-arm/elf.h b/include/asm-arm/elf.h
-index 4ca7516274898dafae96518f76a4f6656a352264..5ba8d3798e159bba6cc9361d8ec7999d0ebc6196 100644
---- a/include/asm-arm/elf.h
-+++ b/include/asm-arm/elf.h
+diff -urNp linux-2.6.26.3/include/asm-arm/elf.h linux-2.6.26.3/include/asm-arm/elf.h
+--- linux-2.6.26.3/include/asm-arm/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-arm/elf.h	2008-08-09 12:03:30.000000000 -0400
@@ -26463,4 +26085,3 @@
-diff --git a/include/asm-arm/kmap_types.h b/include/asm-arm/kmap_types.h
-index 45def13ee17a5fc4150a92173f57f556679faee5..3d0f36f7581b3a40f26555b0861e687af99dd189 100644
---- a/include/asm-arm/kmap_types.h
-+++ b/include/asm-arm/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-arm/kmap_types.h linux-2.6.26.3/include/asm-arm/kmap_types.h
+--- linux-2.6.26.3/include/asm-arm/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-arm/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26475,5 +26096,4 @@
-diff --git a/include/asm-avr32/elf.h b/include/asm-avr32/elf.h
-index 64ce40ee1d585d052e437d4f8ada3026e200bcfb..a87cd885547864d05f07da637805ebbaf36a43ef 100644
---- a/include/asm-avr32/elf.h
-+++ b/include/asm-avr32/elf.h
-@@ -85,8 +85,14 @@ typedef struct user_fpu_struct elf_fpregset_t;
+diff -urNp linux-2.6.26.3/include/asm-avr32/elf.h linux-2.6.26.3/include/asm-avr32/elf.h
+--- linux-2.6.26.3/include/asm-avr32/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-avr32/elf.h	2008-08-09 12:03:30.000000000 -0400
+@@ -85,8 +85,14 @@ typedef struct user_fpu_struct elf_fpreg
@@ -26495,4 +26115,3 @@
-diff --git a/include/asm-avr32/kmap_types.h b/include/asm-avr32/kmap_types.h
-index b7f5c6870107544024c03383bfe6974126b46e77..556135c6edde57fd6790b3402a921e1b3e98c92e 100644
---- a/include/asm-avr32/kmap_types.h
-+++ b/include/asm-avr32/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-avr32/kmap_types.h linux-2.6.26.3/include/asm-avr32/kmap_types.h
+--- linux-2.6.26.3/include/asm-avr32/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-avr32/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26509,4 +26128,3 @@
-diff --git a/include/asm-blackfin/kmap_types.h b/include/asm-blackfin/kmap_types.h
-index e215f7104974fb76957d66695185f9e925edc519..0f30004ef284b9aa7c99baab4905794c79c257af 100644
---- a/include/asm-blackfin/kmap_types.h
-+++ b/include/asm-blackfin/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-blackfin/kmap_types.h linux-2.6.26.3/include/asm-blackfin/kmap_types.h
+--- linux-2.6.26.3/include/asm-blackfin/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-blackfin/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26521,4 +26139,3 @@
-diff --git a/include/asm-cris/kmap_types.h b/include/asm-cris/kmap_types.h
-index 492988cb9077978be3a9589173e37381aaaed87a..12b486c65088791314f6ccdf9eafa022ad79bec1 100644
---- a/include/asm-cris/kmap_types.h
-+++ b/include/asm-cris/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-cris/kmap_types.h linux-2.6.26.3/include/asm-cris/kmap_types.h
+--- linux-2.6.26.3/include/asm-cris/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-cris/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26533,4 +26150,3 @@
-diff --git a/include/asm-frv/kmap_types.h b/include/asm-frv/kmap_types.h
-index f8e16b2a58047c35877fe8d8637133af25ec8023..c73ff7949f55c24142124471b26c0bceacbec1e3 100644
---- a/include/asm-frv/kmap_types.h
-+++ b/include/asm-frv/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-frv/kmap_types.h linux-2.6.26.3/include/asm-frv/kmap_types.h
+--- linux-2.6.26.3/include/asm-frv/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-frv/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26545,4 +26161,3 @@
-diff --git a/include/asm-generic/futex.h b/include/asm-generic/futex.h
-index 3c2344f48136d98351f92b6e9d678e29c052658c..4590a7dc48d2503491969364402bfe1dae73ea93 100644
---- a/include/asm-generic/futex.h
-+++ b/include/asm-generic/futex.h
+diff -urNp linux-2.6.26.3/include/asm-generic/futex.h linux-2.6.26.3/include/asm-generic/futex.h
+--- linux-2.6.26.3/include/asm-generic/futex.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-generic/futex.h	2008-08-09 12:03:30.000000000 -0400
@@ -26558 +26173 @@
-@@ -48,7 +48,7 @@ futex_atomic_op_inuser (int encoded_op, int __user *uaddr)
+@@ -48,7 +48,7 @@ futex_atomic_op_inuser (int encoded_op, 
@@ -26567,4 +26182,3 @@
-diff --git a/include/asm-generic/vmlinux.lds.h b/include/asm-generic/vmlinux.lds.h
-index 5a544bf1edb5ff08dd8716c006415bd188c5c3b7..588cfefc43441cf65fc4f20740c4ae26136490ec 100644
---- a/include/asm-generic/vmlinux.lds.h
-+++ b/include/asm-generic/vmlinux.lds.h
+diff -urNp linux-2.6.26.3/include/asm-generic/vmlinux.lds.h linux-2.6.26.3/include/asm-generic/vmlinux.lds.h
+--- linux-2.6.26.3/include/asm-generic/vmlinux.lds.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-generic/vmlinux.lds.h	2008-08-09 12:03:30.000000000 -0400
@@ -26579,4 +26193,3 @@
-diff --git a/include/asm-h8300/kmap_types.h b/include/asm-h8300/kmap_types.h
-index 1ec8a3427120876f6ef7d998b72798a37c0cc53a..ffdcd189a2c57f6872a389b93d68c9a331fa93f7 100644
---- a/include/asm-h8300/kmap_types.h
-+++ b/include/asm-h8300/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-h8300/kmap_types.h linux-2.6.26.3/include/asm-h8300/kmap_types.h
+--- linux-2.6.26.3/include/asm-h8300/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-h8300/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26591,5 +26204,4 @@
-diff --git a/include/asm-ia64/elf.h b/include/asm-ia64/elf.h
-index 5e0c1a6bce8dea81ef7c8df40855de065a655eca..27f3dfd1438d246823852a3354cd0b9eb92e3d52 100644
---- a/include/asm-ia64/elf.h
-+++ b/include/asm-ia64/elf.h
-@@ -187,7 +187,12 @@ typedef elf_greg_t elf_gregset_t[ELF_NGREG];
+diff -urNp linux-2.6.26.3/include/asm-ia64/elf.h linux-2.6.26.3/include/asm-ia64/elf.h
+--- linux-2.6.26.3/include/asm-ia64/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-ia64/elf.h	2008-08-09 12:03:30.000000000 -0400
+@@ -187,7 +187,12 @@ typedef elf_greg_t elf_gregset_t[ELF_NGR
@@ -26608,4 +26220,3 @@
-diff --git a/include/asm-ia64/kmap_types.h b/include/asm-ia64/kmap_types.h
-index 5d1658aa2b3bf2a4770ce77c02519439a0c73857..1108681a68a80b79d595df71846e2cb75a3512d7 100644
---- a/include/asm-ia64/kmap_types.h
-+++ b/include/asm-ia64/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-ia64/kmap_types.h linux-2.6.26.3/include/asm-ia64/kmap_types.h
+--- linux-2.6.26.3/include/asm-ia64/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-ia64/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26622,4 +26233,3 @@
-diff --git a/include/asm-ia64/pgtable.h b/include/asm-ia64/pgtable.h
-index 7a9bff47564f10c3165123e378ce226e90d55f2b..80631a4752c1871eac482135066c6d55368ddfdc 100644
---- a/include/asm-ia64/pgtable.h
-+++ b/include/asm-ia64/pgtable.h
+diff -urNp linux-2.6.26.3/include/asm-ia64/pgtable.h linux-2.6.26.3/include/asm-ia64/pgtable.h
+--- linux-2.6.26.3/include/asm-ia64/pgtable.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-ia64/pgtable.h	2008-08-09 12:03:30.000000000 -0400
@@ -26644,4 +26254,3 @@
-diff --git a/include/asm-m32r/kmap_types.h b/include/asm-m32r/kmap_types.h
-index fa94dc6410ea1129083a401f01558e5028e05c23..9e51e834a3a88e7ed07309df18fb5ba09e94e847 100644
---- a/include/asm-m32r/kmap_types.h
-+++ b/include/asm-m32r/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-m32r/kmap_types.h linux-2.6.26.3/include/asm-m32r/kmap_types.h
+--- linux-2.6.26.3/include/asm-m32r/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-m32r/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26658,4 +26267,3 @@
-diff --git a/include/asm-m68k/kmap_types.h b/include/asm-m68k/kmap_types.h
-index c843c63d380161411f70e046e16c66705b9a6fac..949e1a9aef996ee72120424fed48f9868105fcf7 100644
---- a/include/asm-m68k/kmap_types.h
-+++ b/include/asm-m68k/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-m68k/kmap_types.h linux-2.6.26.3/include/asm-m68k/kmap_types.h
+--- linux-2.6.26.3/include/asm-m68k/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-m68k/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26670,4 +26278,3 @@
-diff --git a/include/asm-m68knommu/kmap_types.h b/include/asm-m68knommu/kmap_types.h
-index bfb6707575d1a878f9fbd98cf3627dcc28e18085..612b63c99b0aecee9aab7cf8b7c01536cb944fdd 100644
---- a/include/asm-m68knommu/kmap_types.h
-+++ b/include/asm-m68knommu/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-m68knommu/kmap_types.h linux-2.6.26.3/include/asm-m68knommu/kmap_types.h
+--- linux-2.6.26.3/include/asm-m68knommu/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-m68knommu/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26682,5 +26289,4 @@
-diff --git a/include/asm-mips/elf.h b/include/asm-mips/elf.h
-index f69f7acba6378542b606bed125bd409a3ec90cbf..768ad378e335d76997c44603e7a2ebebf8f8f169 100644
---- a/include/asm-mips/elf.h
-+++ b/include/asm-mips/elf.h
-@@ -368,4 +368,11 @@ extern int dump_task_fpu(struct task_struct *, elf_fpregset_t *);
+diff -urNp linux-2.6.26.3/include/asm-mips/elf.h linux-2.6.26.3/include/asm-mips/elf.h
+--- linux-2.6.26.3/include/asm-mips/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-mips/elf.h	2008-08-09 12:03:30.000000000 -0400
+@@ -368,4 +368,11 @@ extern int dump_task_fpu(struct task_str
@@ -26698,4 +26304,3 @@
-diff --git a/include/asm-mips/kmap_types.h b/include/asm-mips/kmap_types.h
-index 806aae3c533892b1e65917c4742943ff2692374b..a94b8d27713c603d4aaa1eee2bb3bcdf7e8089b7 100644
---- a/include/asm-mips/kmap_types.h
-+++ b/include/asm-mips/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-mips/kmap_types.h linux-2.6.26.3/include/asm-mips/kmap_types.h
+--- linux-2.6.26.3/include/asm-mips/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-mips/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26712,5 +26317,4 @@
-diff --git a/include/asm-mips/page.h b/include/asm-mips/page.h
-index 8735aa0b89630987f9d7341efa88e13a4bf9eb7a..b5f0dce80fff356a5ea1f5fd4fb28f421280602f 100644
---- a/include/asm-mips/page.h
-+++ b/include/asm-mips/page.h
-@@ -79,7 +79,7 @@ extern void copy_user_highpage(struct page *to, struct page *from,
+diff -urNp linux-2.6.26.3/include/asm-mips/page.h linux-2.6.26.3/include/asm-mips/page.h
+--- linux-2.6.26.3/include/asm-mips/page.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-mips/page.h	2008-08-09 12:03:30.000000000 -0400
+@@ -79,7 +79,7 @@ extern void copy_user_highpage(struct pa
@@ -26725,4 +26329,3 @@
-diff --git a/include/asm-mips/system.h b/include/asm-mips/system.h
-index a944eda4faf5ef5f1f3e6ff53932056cf4ce7e4f..9c5b6d1f7ce9ae23fb4cc9e44a2a00e1e7b7395b 100644
---- a/include/asm-mips/system.h
-+++ b/include/asm-mips/system.h
+diff -urNp linux-2.6.26.3/include/asm-mips/system.h linux-2.6.26.3/include/asm-mips/system.h
+--- linux-2.6.26.3/include/asm-mips/system.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-mips/system.h	2008-08-09 12:03:30.000000000 -0400
@@ -26737,5 +26340,4 @@
-diff --git a/include/asm-parisc/elf.h b/include/asm-parisc/elf.h
-index d0a4a82628181578a943ae082c60ae8b63959411..0fb90ecdb6e180601c582746bd7de74738a0efa6 100644
---- a/include/asm-parisc/elf.h
-+++ b/include/asm-parisc/elf.h
-@@ -333,6 +333,13 @@ struct pt_regs;	/* forward declaration... */
+diff -urNp linux-2.6.26.3/include/asm-parisc/elf.h linux-2.6.26.3/include/asm-parisc/elf.h
+--- linux-2.6.26.3/include/asm-parisc/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-parisc/elf.h	2008-08-09 12:03:30.000000000 -0400
+@@ -333,6 +333,13 @@ struct pt_regs;	/* forward declaration..
@@ -26755,4 +26357,3 @@
-diff --git a/include/asm-parisc/kmap_types.h b/include/asm-parisc/kmap_types.h
-index 806aae3c533892b1e65917c4742943ff2692374b..a94b8d27713c603d4aaa1eee2bb3bcdf7e8089b7 100644
---- a/include/asm-parisc/kmap_types.h
-+++ b/include/asm-parisc/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-parisc/kmap_types.h linux-2.6.26.3/include/asm-parisc/kmap_types.h
+--- linux-2.6.26.3/include/asm-parisc/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-parisc/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26769,4 +26370,3 @@
-diff --git a/include/asm-parisc/pgtable.h b/include/asm-parisc/pgtable.h
-index 470a4b88124da2fcfb8c9936f523abd2662079a2..e8ad38e85007387ce420a4ad11d016c2a917cefa 100644
---- a/include/asm-parisc/pgtable.h
-+++ b/include/asm-parisc/pgtable.h
+diff -urNp linux-2.6.26.3/include/asm-parisc/pgtable.h linux-2.6.26.3/include/asm-parisc/pgtable.h
+--- linux-2.6.26.3/include/asm-parisc/pgtable.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-parisc/pgtable.h	2008-08-09 12:03:30.000000000 -0400
@@ -26791,5 +26391,4 @@
-diff --git a/include/asm-powerpc/elf.h b/include/asm-powerpc/elf.h
-index 9080d85cb9d006619d0b8543f36232c41b594bf1..91eafe88c5fc5670699f89c631e8b39643cd881b 100644
---- a/include/asm-powerpc/elf.h
-+++ b/include/asm-powerpc/elf.h
-@@ -160,6 +160,18 @@ typedef elf_vrreg_t elf_vrregset_t[ELF_NVRREG];
+diff -urNp linux-2.6.26.3/include/asm-powerpc/elf.h linux-2.6.26.3/include/asm-powerpc/elf.h
+--- linux-2.6.26.3/include/asm-powerpc/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-powerpc/elf.h	2008-08-09 12:03:30.000000000 -0400
+@@ -160,6 +160,18 @@ typedef elf_vrreg_t elf_vrregset_t[ELF_N
@@ -26814,4 +26413,3 @@
-diff --git a/include/asm-powerpc/kmap_types.h b/include/asm-powerpc/kmap_types.h
-index b6bac6f61c16d60465b17da5cc77ba81e059ec5e..74d63c5429ead26adcd1c7265c27a6e8881bef1e 100644
---- a/include/asm-powerpc/kmap_types.h
-+++ b/include/asm-powerpc/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-powerpc/kmap_types.h linux-2.6.26.3/include/asm-powerpc/kmap_types.h
+--- linux-2.6.26.3/include/asm-powerpc/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-powerpc/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26826,20 +26424,3 @@
-diff --git a/include/asm-powerpc/page.h b/include/asm-powerpc/page.h
-index cffdf0eb0df68068fb0720a8ba9adff870be5fbe..5d7b2b4f76a99ed9ec6103eae53e9d6045d018c3 100644
---- a/include/asm-powerpc/page.h
-+++ b/include/asm-powerpc/page.h
-@@ -100,8 +100,9 @@ extern phys_addr_t kernstart_addr;
-  * and needs to be executable.  This means the whole heap ends
-  * up being executable.
-  */
--#define VM_DATA_DEFAULT_FLAGS32	(VM_READ | VM_WRITE | VM_EXEC | \
--				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
-+#define VM_DATA_DEFAULT_FLAGS32 \
-+	(((current->personality & READ_IMPLIES_EXEC) ? VM_EXEC : 0) | \
-+	 VM_READ | VM_WRITE | VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
- 
- #define VM_DATA_DEFAULT_FLAGS64	(VM_READ | VM_WRITE | \
- 				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
-diff --git a/include/asm-powerpc/page_64.h b/include/asm-powerpc/page_64.h
-index 25af4fc8daf40976d030c66dc553fd6c1802662e..7847f8a4ad3dd4b7a3caf2fc8f41426367406ae1 100644
---- a/include/asm-powerpc/page_64.h
-+++ b/include/asm-powerpc/page_64.h
+diff -urNp linux-2.6.26.3/include/asm-powerpc/page_64.h linux-2.6.26.3/include/asm-powerpc/page_64.h
+--- linux-2.6.26.3/include/asm-powerpc/page_64.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-powerpc/page_64.h	2008-08-09 12:03:30.000000000 -0400
@@ -26867,5 +26448,19 @@
-diff --git a/include/asm-ppc/mmu_context.h b/include/asm-ppc/mmu_context.h
-index 9f097e25b169bbba0940f4745cffdfa544ccfa98..7b9bd29d18e3bd9485c4ce9a850390c7136b35a0 100644
---- a/include/asm-ppc/mmu_context.h
-+++ b/include/asm-ppc/mmu_context.h
-@@ -141,7 +141,8 @@ static inline void get_mmu_context(struct mm_struct *mm)
+diff -urNp linux-2.6.26.3/include/asm-powerpc/page.h linux-2.6.26.3/include/asm-powerpc/page.h
+--- linux-2.6.26.3/include/asm-powerpc/page.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-powerpc/page.h	2008-08-09 12:03:30.000000000 -0400
+@@ -100,8 +100,9 @@ extern phys_addr_t kernstart_addr;
+  * and needs to be executable.  This means the whole heap ends
+  * up being executable.
+  */
+-#define VM_DATA_DEFAULT_FLAGS32	(VM_READ | VM_WRITE | VM_EXEC | \
+-				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
++#define VM_DATA_DEFAULT_FLAGS32 \
++	(((current->personality & READ_IMPLIES_EXEC) ? VM_EXEC : 0) | \
++	 VM_READ | VM_WRITE | VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
+ 
+ #define VM_DATA_DEFAULT_FLAGS64	(VM_READ | VM_WRITE | \
+ 				 VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC)
+diff -urNp linux-2.6.26.3/include/asm-ppc/mmu_context.h linux-2.6.26.3/include/asm-ppc/mmu_context.h
+--- linux-2.6.26.3/include/asm-ppc/mmu_context.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-ppc/mmu_context.h	2008-08-09 12:03:30.000000000 -0400
+@@ -141,7 +141,8 @@ static inline void get_mmu_context(struc
@@ -26881,5 +26476,4 @@
-diff --git a/include/asm-ppc/pgtable.h b/include/asm-ppc/pgtable.h
-index 55f9d38e3bf8702d302054ead258bf588edf199b..3bcd84900ec41634558a40a9b56d83c0586987d6 100644
---- a/include/asm-ppc/pgtable.h
-+++ b/include/asm-ppc/pgtable.h
-@@ -390,11 +390,21 @@ extern unsigned long ioremap_bot, ioremap_base;
+diff -urNp linux-2.6.26.3/include/asm-ppc/pgtable.h linux-2.6.26.3/include/asm-ppc/pgtable.h
+--- linux-2.6.26.3/include/asm-ppc/pgtable.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-ppc/pgtable.h	2008-08-09 12:03:30.000000000 -0400
+@@ -390,11 +390,21 @@ extern unsigned long ioremap_bot, iorema
@@ -26910 +26504 @@
-@@ -406,21 +416,21 @@ extern unsigned long ioremap_bot, ioremap_base;
+@@ -406,21 +416,21 @@ extern unsigned long ioremap_bot, iorema
@@ -26942,4 +26536,3 @@
-diff --git a/include/asm-s390/kmap_types.h b/include/asm-s390/kmap_types.h
-index fd1574648223b5aaa3a9bb60255098a64b4db919..b5fabe7c834e05fb08f97201bb42fe9dc29fbf33 100644
---- a/include/asm-s390/kmap_types.h
-+++ b/include/asm-s390/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-s390/kmap_types.h linux-2.6.26.3/include/asm-s390/kmap_types.h
+--- linux-2.6.26.3/include/asm-s390/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-s390/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26954,4 +26547,3 @@
-diff --git a/include/asm-sh/kmap_types.h b/include/asm-sh/kmap_types.h
-index 84d565c696befbaee91e7770721d1ec2a5ed6f8c..1afe64ecf096b8da52c0cb921447910397253cfd 100644
---- a/include/asm-sh/kmap_types.h
-+++ b/include/asm-sh/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-sh/kmap_types.h linux-2.6.26.3/include/asm-sh/kmap_types.h
+--- linux-2.6.26.3/include/asm-sh/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sh/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26968,4 +26560,3 @@
-diff --git a/include/asm-sparc/elf.h b/include/asm-sparc/elf.h
-index d043f80bc2fd4b858a260c91d00e1592bc780caf..1f14718f116a3a06f1a05d661b5c096ebe1507df 100644
---- a/include/asm-sparc/elf.h
-+++ b/include/asm-sparc/elf.h
+diff -urNp linux-2.6.26.3/include/asm-sparc/elf.h linux-2.6.26.3/include/asm-sparc/elf.h
+--- linux-2.6.26.3/include/asm-sparc/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sparc/elf.h	2008-08-09 12:03:30.000000000 -0400
@@ -26986,4 +26577,3 @@
-diff --git a/include/asm-sparc/kmap_types.h b/include/asm-sparc/kmap_types.h
-index e215f7104974fb76957d66695185f9e925edc519..0f30004ef284b9aa7c99baab4905794c79c257af 100644
---- a/include/asm-sparc/kmap_types.h
-+++ b/include/asm-sparc/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-sparc/kmap_types.h linux-2.6.26.3/include/asm-sparc/kmap_types.h
+--- linux-2.6.26.3/include/asm-sparc/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sparc/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -26998,4 +26588,3 @@
-diff --git a/include/asm-sparc/pgtable.h b/include/asm-sparc/pgtable.h
-index 60512296b2ca9468b04b174d61a867cf9c954680..9ecda08e235c0c42c61ab4e56b2faf554095a4ed 100644
---- a/include/asm-sparc/pgtable.h
-+++ b/include/asm-sparc/pgtable.h
+diff -urNp linux-2.6.26.3/include/asm-sparc/pgtable.h linux-2.6.26.3/include/asm-sparc/pgtable.h
+--- linux-2.6.26.3/include/asm-sparc/pgtable.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sparc/pgtable.h	2008-08-09 12:03:30.000000000 -0400
@@ -27033,4 +26622,3 @@
-diff --git a/include/asm-sparc/pgtsrmmu.h b/include/asm-sparc/pgtsrmmu.h
-index 808555fc1d58bd6257adef1876b621df9e23426d..f038dc5fd241376d1f15daf0ff0c120c10b0bff3 100644
---- a/include/asm-sparc/pgtsrmmu.h
-+++ b/include/asm-sparc/pgtsrmmu.h
+diff -urNp linux-2.6.26.3/include/asm-sparc/pgtsrmmu.h linux-2.6.26.3/include/asm-sparc/pgtsrmmu.h
+--- linux-2.6.26.3/include/asm-sparc/pgtsrmmu.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sparc/pgtsrmmu.h	2008-08-09 12:03:30.000000000 -0400
@@ -27054,4 +26642,3 @@
-diff --git a/include/asm-sparc64/elf.h b/include/asm-sparc64/elf.h
-index 0818a1308f4e7a252b213d07a0025f5e70c72dca..ab3ff260d7be9a983e39d789d48040491d19146e 100644
---- a/include/asm-sparc64/elf.h
-+++ b/include/asm-sparc64/elf.h
+diff -urNp linux-2.6.26.3/include/asm-sparc64/elf.h linux-2.6.26.3/include/asm-sparc64/elf.h
+--- linux-2.6.26.3/include/asm-sparc64/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sparc64/elf.h	2008-08-09 12:03:30.000000000 -0400
@@ -27071,4 +26658,3 @@
-diff --git a/include/asm-sparc64/kmap_types.h b/include/asm-sparc64/kmap_types.h
-index 34c1d3d9a3b0cb30ae0d19502d88a6ee82069977..6993ca7c252ce8280b855a8813442b7d5f7f323c 100644
---- a/include/asm-sparc64/kmap_types.h
-+++ b/include/asm-sparc64/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-sparc64/kmap_types.h linux-2.6.26.3/include/asm-sparc64/kmap_types.h
+--- linux-2.6.26.3/include/asm-sparc64/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-sparc64/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -27083,4 +26669,3 @@
-diff --git a/include/asm-um/kmap_types.h b/include/asm-um/kmap_types.h
-index 6c03acdb4405bf0eb1fc4a05d546cebf25aae6e7..a5e021544af6482c3ce30fd911d44dbcbcd7599b 100644
---- a/include/asm-um/kmap_types.h
-+++ b/include/asm-um/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-um/kmap_types.h linux-2.6.26.3/include/asm-um/kmap_types.h
+--- linux-2.6.26.3/include/asm-um/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-um/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -27095,4 +26680,3 @@
-diff --git a/include/asm-v850/kmap_types.h b/include/asm-v850/kmap_types.h
-index 3288976b161f52b18a278a42d2d66980d78fe875..321e0b2d5e4fa77eded63e21628d1afb77fa551e 100644
---- a/include/asm-v850/kmap_types.h
-+++ b/include/asm-v850/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-v850/kmap_types.h linux-2.6.26.3/include/asm-v850/kmap_types.h
+--- linux-2.6.26.3/include/asm-v850/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-v850/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -27107,5 +26691,4 @@
-diff --git a/include/asm-x86/alternative.h b/include/asm-x86/alternative.h
-index 1f6a9ca1012607de987efdf28d2ce19db3c423e5..c9cbedab64403ec2b9e5b4a2b8f02d780d5aaafa 100644
---- a/include/asm-x86/alternative.h
-+++ b/include/asm-x86/alternative.h
-@@ -94,7 +94,7 @@ static inline void alternatives_smp_switch(int smp) {}
+diff -urNp linux-2.6.26.3/include/asm-x86/alternative.h linux-2.6.26.3/include/asm-x86/alternative.h
+--- linux-2.6.26.3/include/asm-x86/alternative.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/alternative.h	2008-08-09 12:03:30.000000000 -0400
+@@ -94,7 +94,7 @@ static inline void alternatives_smp_swit
@@ -27120 +26703 @@
-@@ -118,7 +118,7 @@ static inline void alternatives_smp_switch(int smp) {}
+@@ -118,7 +118,7 @@ static inline void alternatives_smp_swit
@@ -27129 +26712 @@
-@@ -133,7 +133,7 @@ static inline void alternatives_smp_switch(int smp) {}
+@@ -133,7 +133,7 @@ static inline void alternatives_smp_swit
@@ -27138,4 +26721,3 @@
-diff --git a/include/asm-x86/apic.h b/include/asm-x86/apic.h
-index be9639a9a186244fef74318f901172415a7e9343..f347663e589e41c7743f626ace897ce2fdd0f37b 100644
---- a/include/asm-x86/apic.h
-+++ b/include/asm-x86/apic.h
+diff -urNp linux-2.6.26.3/include/asm-x86/apic.h linux-2.6.26.3/include/asm-x86/apic.h
+--- linux-2.6.26.3/include/asm-x86/apic.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/apic.h	2008-08-09 12:03:30.000000000 -0400
@@ -27151,4 +26733,3 @@
-diff --git a/include/asm-x86/atomic_32.h b/include/asm-x86/atomic_32.h
-index 21a4825148c09e34c70db728f68951ff32e631f8..5f8795e21a4d0a19853f31c2a3dccd67973550df 100644
---- a/include/asm-x86/atomic_32.h
-+++ b/include/asm-x86/atomic_32.h
+diff -urNp linux-2.6.26.3/include/asm-x86/atomic_32.h linux-2.6.26.3/include/asm-x86/atomic_32.h
+--- linux-2.6.26.3/include/asm-x86/atomic_32.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/atomic_32.h	2008-08-09 12:54:30.000000000 -0400
@@ -27172 +26753 @@
-@@ -61,7 +69,15 @@ static inline void atomic_add(int i, atomic_t *v)
+@@ -61,7 +69,15 @@ static inline void atomic_add(int i, ato
@@ -27189 +26770 @@
-@@ -79,7 +95,16 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -79,7 +95,16 @@ static inline int atomic_sub_and_test(in
@@ -27207 +26788 @@
-@@ -93,7 +118,18 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -93,7 +118,18 @@ static inline int atomic_sub_and_test(in
@@ -27227 +26808 @@
-@@ -105,7 +141,18 @@ static inline void atomic_inc(atomic_t *v)
+@@ -105,7 +141,18 @@ static inline void atomic_inc(atomic_t *
@@ -27247 +26828 @@
-@@ -121,7 +168,19 @@ static inline int atomic_dec_and_test(atomic_t *v)
+@@ -121,7 +168,19 @@ static inline int atomic_dec_and_test(at
@@ -27268 +26849 @@
-@@ -139,7 +198,19 @@ static inline int atomic_inc_and_test(atomic_t *v)
+@@ -139,7 +198,19 @@ static inline int atomic_inc_and_test(at
@@ -27289 +26870 @@
-@@ -158,7 +229,16 @@ static inline int atomic_add_negative(int i, atomic_t *v)
+@@ -158,7 +229,16 @@ static inline int atomic_add_negative(in
@@ -27307 +26888 @@
-@@ -181,7 +261,15 @@ static inline int atomic_add_return(int i, atomic_t *v)
+@@ -181,7 +261,15 @@ static inline int atomic_add_return(int 
@@ -27324,4 +26905,3 @@
-diff --git a/include/asm-x86/atomic_64.h b/include/asm-x86/atomic_64.h
-index 3e0cd7d3833569bab88b4e7414201aafa0d0dab2..de5b9a79929d4b8e47df2aecb973c52f391a7964 100644
---- a/include/asm-x86/atomic_64.h
-+++ b/include/asm-x86/atomic_64.h
+diff -urNp linux-2.6.26.3/include/asm-x86/atomic_64.h linux-2.6.26.3/include/asm-x86/atomic_64.h
+--- linux-2.6.26.3/include/asm-x86/atomic_64.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/atomic_64.h	2008-08-09 13:07:51.000000000 -0400
@@ -27345 +26925 @@
-@@ -68,7 +76,15 @@ static inline void atomic_add(int i, atomic_t *v)
+@@ -68,7 +76,15 @@ static inline void atomic_add(int i, ato
@@ -27362 +26942 @@
-@@ -86,7 +102,16 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -86,7 +102,16 @@ static inline int atomic_sub_and_test(in
@@ -27380 +26960 @@
-@@ -100,7 +125,19 @@ static inline int atomic_sub_and_test(int i, atomic_t *v)
+@@ -100,7 +125,19 @@ static inline int atomic_sub_and_test(in
@@ -27401 +26981 @@
-@@ -113,7 +150,19 @@ static inline void atomic_inc(atomic_t *v)
+@@ -113,7 +150,19 @@ static inline void atomic_inc(atomic_t *
@@ -27422 +27002 @@
-@@ -130,7 +179,20 @@ static inline int atomic_dec_and_test(atomic_t *v)
+@@ -130,7 +179,20 @@ static inline int atomic_dec_and_test(at
@@ -27444 +27024 @@
-@@ -148,7 +210,20 @@ static inline int atomic_inc_and_test(atomic_t *v)
+@@ -148,7 +210,20 @@ static inline int atomic_inc_and_test(at
@@ -27466 +27046 @@
-@@ -167,7 +242,16 @@ static inline int atomic_add_negative(int i, atomic_t *v)
+@@ -167,7 +242,16 @@ static inline int atomic_add_negative(in
@@ -27484 +27064 @@
-@@ -183,7 +267,15 @@ static inline int atomic_add_negative(int i, atomic_t *v)
+@@ -183,7 +267,15 @@ static inline int atomic_add_negative(in
@@ -27518 +27098 @@
-@@ -246,7 +346,15 @@ static inline void atomic64_add(long i, atomic64_t *v)
+@@ -246,7 +346,15 @@ static inline void atomic64_add(long i, 
@@ -27535 +27115 @@
-@@ -264,7 +372,16 @@ static inline int atomic64_sub_and_test(long i, atomic64_t *v)
+@@ -264,7 +372,16 @@ static inline int atomic64_sub_and_test(
@@ -27553 +27133 @@
-@@ -278,7 +395,19 @@ static inline int atomic64_sub_and_test(long i, atomic64_t *v)
+@@ -278,7 +395,19 @@ static inline int atomic64_sub_and_test(
@@ -27574 +27154 @@
-@@ -291,7 +420,19 @@ static inline void atomic64_inc(atomic64_t *v)
+@@ -291,7 +420,19 @@ static inline void atomic64_inc(atomic64
@@ -27595 +27175 @@
-@@ -308,7 +449,20 @@ static inline int atomic64_dec_and_test(atomic64_t *v)
+@@ -308,7 +449,20 @@ static inline int atomic64_dec_and_test(
@@ -27617 +27197 @@
-@@ -326,7 +480,20 @@ static inline int atomic64_inc_and_test(atomic64_t *v)
+@@ -326,7 +480,20 @@ static inline int atomic64_inc_and_test(
@@ -27639 +27219 @@
-@@ -345,7 +512,16 @@ static inline int atomic64_add_negative(long i, atomic64_t *v)
+@@ -345,7 +512,16 @@ static inline int atomic64_add_negative(
@@ -27657 +27237 @@
-@@ -361,7 +537,15 @@ static inline int atomic64_add_negative(long i, atomic64_t *v)
+@@ -361,7 +537,15 @@ static inline int atomic64_add_negative(
@@ -27674,4 +27254,3 @@
-diff --git a/include/asm-x86/boot.h b/include/asm-x86/boot.h
-index 2faed7ecb092a7893c89c573b7ac9870e060d8a7..8cf3d040702c485533e7b4df1c7d411b67969de7 100644
---- a/include/asm-x86/boot.h
-+++ b/include/asm-x86/boot.h
+diff -urNp linux-2.6.26.3/include/asm-x86/boot.h linux-2.6.26.3/include/asm-x86/boot.h
+--- linux-2.6.26.3/include/asm-x86/boot.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/boot.h	2008-08-09 12:03:30.000000000 -0400
@@ -27695,4 +27274,3 @@
-diff --git a/include/asm-x86/cache.h b/include/asm-x86/cache.h
-index 1e0bac86f38f8ee4f950380e4e1845a49fec6b30..2f84a3ad7a34624aac67306451dae7d33ae4a5ff 100644
---- a/include/asm-x86/cache.h
-+++ b/include/asm-x86/cache.h
+diff -urNp linux-2.6.26.3/include/asm-x86/cache.h linux-2.6.26.3/include/asm-x86/cache.h
+--- linux-2.6.26.3/include/asm-x86/cache.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/cache.h	2008-08-09 12:03:30.000000000 -0400
@@ -27707,5 +27285,4 @@
-diff --git a/include/asm-x86/checksum_32.h b/include/asm-x86/checksum_32.h
-index 52bbb0d8c4c15ce08c2d155fc23f031b98384547..01e55cc8aa49a33cda0d3252f00c3f8ddb725909 100644
---- a/include/asm-x86/checksum_32.h
-+++ b/include/asm-x86/checksum_32.h
-@@ -31,6 +31,14 @@ asmlinkage __wsum csum_partial_copy_generic(const void *src, void *dst,
+diff -urNp linux-2.6.26.3/include/asm-x86/checksum_32.h linux-2.6.26.3/include/asm-x86/checksum_32.h
+--- linux-2.6.26.3/include/asm-x86/checksum_32.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/checksum_32.h	2008-08-09 12:03:30.000000000 -0400
+@@ -31,6 +31,14 @@ asmlinkage __wsum csum_partial_copy_gene
@@ -27726 +27303 @@
-@@ -50,7 +58,7 @@ static inline __wsum csum_partial_copy_from_user(const void __user *src,
+@@ -50,7 +58,7 @@ static inline __wsum csum_partial_copy_f
@@ -27735 +27312 @@
-@@ -177,7 +185,7 @@ static inline __wsum csum_and_copy_to_user(const void *src,
+@@ -177,7 +185,7 @@ static inline __wsum csum_and_copy_to_us
@@ -27744,5 +27321,4 @@
-diff --git a/include/asm-x86/desc.h b/include/asm-x86/desc.h
-index 28bddbcb38be7e3d27cd73fc0a725aef68a26ad0..97b85a912bef1dd4b15cfe08067a22b1c85ad51d 100644
---- a/include/asm-x86/desc.h
-+++ b/include/asm-x86/desc.h
-@@ -16,6 +16,7 @@ static inline void fill_ldt(struct desc_struct *desc,
+diff -urNp linux-2.6.26.3/include/asm-x86/desc.h linux-2.6.26.3/include/asm-x86/desc.h
+--- linux-2.6.26.3/include/asm-x86/desc.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/desc.h	2008-08-09 12:03:30.000000000 -0400
+@@ -16,6 +16,7 @@ static inline void fill_ldt(struct desc_
@@ -27756 +27332 @@
-@@ -27,14 +28,15 @@ static inline void fill_ldt(struct desc_struct *desc,
+@@ -27,14 +28,15 @@ static inline void fill_ldt(struct desc_
@@ -27762 +27338,6 @@
-+
+ 
+-#ifdef CONFIG_X86_64
+-extern struct desc_struct cpu_gdt_table[GDT_ENTRIES];
+-extern struct desc_ptr cpu_gdt_descr[];
+-/* the cpu gdt accessor */
+-#define get_cpu_gdt_table(x) ((struct desc_struct *)cpu_gdt_descr[x].address)
@@ -27769,6 +27350 @@
- #ifdef CONFIG_X86_64
--extern struct desc_struct cpu_gdt_table[GDT_ENTRIES];
--extern struct desc_ptr cpu_gdt_descr[];
--/* the cpu gdt accessor */
--#define get_cpu_gdt_table(x) ((struct desc_struct *)cpu_gdt_descr[x].address)
--
++#ifdef CONFIG_X86_64
@@ -27778 +27354 @@
-@@ -51,16 +53,6 @@ static inline void pack_gate(gate_desc *gate, unsigned type, unsigned long func,
+@@ -51,16 +53,6 @@ static inline void pack_gate(gate_desc *
@@ -27795 +27371 @@
-@@ -69,7 +61,6 @@ static inline void pack_gate(gate_desc *gate, unsigned char type,
+@@ -69,7 +61,6 @@ static inline void pack_gate(gate_desc *
@@ -27803 +27379 @@
-@@ -106,19 +97,48 @@ static inline int desc_empty(const void *ptr)
+@@ -106,19 +97,48 @@ static inline int desc_empty(const void 
@@ -27852 +27428 @@
-@@ -130,7 +150,17 @@ static inline void native_write_gdt_entry(struct desc_struct *gdt, int entry,
+@@ -130,7 +150,17 @@ static inline void native_write_gdt_entr
@@ -27870 +27446 @@
-@@ -202,7 +232,19 @@ static inline void native_set_ldt(const void *addr, unsigned int entries)
+@@ -202,7 +232,19 @@ static inline void native_set_ldt(const 
@@ -27890 +27466 @@
-@@ -237,8 +279,19 @@ static inline void native_load_tls(struct thread_struct *t, unsigned int cpu)
+@@ -237,8 +279,19 @@ static inline void native_load_tls(struc
@@ -27910 +27486 @@
-@@ -354,6 +407,18 @@ static inline void set_system_gate_ist(int n, void *addr, unsigned ist)
+@@ -354,6 +407,18 @@ static inline void set_system_gate_ist(i
@@ -27929,4 +27505,3 @@
-diff --git a/include/asm-x86/elf.h b/include/asm-x86/elf.h
-index 8f232dc5b5fe09dc81274a5eb830ee352c052169..fef42b5122264ffaa48cfef76a9fe56e16250b26 100644
---- a/include/asm-x86/elf.h
-+++ b/include/asm-x86/elf.h
+diff -urNp linux-2.6.26.3/include/asm-x86/elf.h linux-2.6.26.3/include/asm-x86/elf.h
+--- linux-2.6.26.3/include/asm-x86/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/elf.h	2008-08-09 12:03:30.000000000 -0400
@@ -27978 +27553 @@
-@@ -329,7 +346,4 @@ extern int arch_setup_additional_pages(struct linux_binprm *bprm,
+@@ -329,7 +346,4 @@ extern int arch_setup_additional_pages(s
@@ -27986,4 +27561,3 @@
-diff --git a/include/asm-x86/futex.h b/include/asm-x86/futex.h
-index e7a76b37b333cc8b40295d7379f8cbb46b241a29..8974dbcfc9fb45503a22eebadd041a915511a756 100644
---- a/include/asm-x86/futex.h
-+++ b/include/asm-x86/futex.h
+diff -urNp linux-2.6.26.3/include/asm-x86/futex.h linux-2.6.26.3/include/asm-x86/futex.h
+--- linux-2.6.26.3/include/asm-x86/futex.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/futex.h	2008-08-09 12:03:30.000000000 -0400
@@ -28039 +27613 @@
-@@ -61,11 +96,20 @@ static inline int futex_atomic_op_inuser(int encoded_op, int __user *uaddr)
+@@ -61,11 +96,20 @@ static inline int futex_atomic_op_inuser
@@ -28060 +27634 @@
-@@ -122,14 +166,27 @@ static inline int futex_atomic_cmpxchg_inatomic(int __user *uaddr, int oldval,
+@@ -122,14 +166,27 @@ static inline int futex_atomic_cmpxchg_i
@@ -28089,5 +27663,4 @@
-diff --git a/include/asm-x86/i387.h b/include/asm-x86/i387.h
-index 4b683af883f17aaaff7531431770930d5fd13b1b..7fdc59dc8e309fa9788ec30a2ce9cc1f6de98eea 100644
---- a/include/asm-x86/i387.h
-+++ b/include/asm-x86/i387.h
-@@ -215,13 +215,8 @@ static inline void restore_fpu(struct task_struct *tsk)
+diff -urNp linux-2.6.26.3/include/asm-x86/i387.h linux-2.6.26.3/include/asm-x86/i387.h
+--- linux-2.6.26.3/include/asm-x86/i387.h	2008-08-09 13:05:26.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/i387.h	2008-08-09 13:05:38.000000000 -0400
+@@ -215,13 +215,8 @@ static inline void restore_fpu(struct ta
@@ -28109,5 +27682,4 @@
-diff --git a/include/asm-x86/io_64.h b/include/asm-x86/io_64.h
-index 0930bedf9e4d0ca4636a50d766368106ddf4d3ab..9b5712599670cf463e6be25a61b06bef4192a6e5 100644
---- a/include/asm-x86/io_64.h
-+++ b/include/asm-x86/io_64.h
-@@ -158,6 +158,17 @@ static inline void *phys_to_virt(unsigned long address)
+diff -urNp linux-2.6.26.3/include/asm-x86/io_64.h linux-2.6.26.3/include/asm-x86/io_64.h
+--- linux-2.6.26.3/include/asm-x86/io_64.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/io_64.h	2008-08-09 12:03:30.000000000 -0400
+@@ -158,6 +158,17 @@ static inline void *phys_to_virt(unsigne
@@ -28131,5 +27703,4 @@
-diff --git a/include/asm-x86/irqflags.h b/include/asm-x86/irqflags.h
-index c242527f970e8e7f8ae33e6dc080216560fbaa96..9f9015af426eef0bae74a34ee97a6ef76e278e8d 100644
---- a/include/asm-x86/irqflags.h
-+++ b/include/asm-x86/irqflags.h
-@@ -120,6 +120,8 @@ static inline unsigned long __raw_local_irq_save(void)
+diff -urNp linux-2.6.26.3/include/asm-x86/irqflags.h linux-2.6.26.3/include/asm-x86/irqflags.h
+--- linux-2.6.26.3/include/asm-x86/irqflags.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/irqflags.h	2008-08-09 12:03:30.000000000 -0400
+@@ -120,6 +120,8 @@ static inline unsigned long __raw_local_
@@ -28144,4 +27715,3 @@
-diff --git a/include/asm-x86/kmap_types.h b/include/asm-x86/kmap_types.h
-index 5f4174132a222a34d453b2fb915a0993a6e923be..727fdd7471f5a63ec1bb5dbb18880ab9705901ec 100644
---- a/include/asm-x86/kmap_types.h
-+++ b/include/asm-x86/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-x86/kmap_types.h linux-2.6.26.3/include/asm-x86/kmap_types.h
+--- linux-2.6.26.3/include/asm-x86/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -28158,4 +27728,3 @@
-diff --git a/include/asm-x86/linkage.h b/include/asm-x86/linkage.h
-index 64e444f8e85b2d9fccaf50cc78ceaa1da0654877..bf7e8a638b48d0957126cca69133af86bba64bb5 100644
---- a/include/asm-x86/linkage.h
-+++ b/include/asm-x86/linkage.h
+diff -urNp linux-2.6.26.3/include/asm-x86/linkage.h linux-2.6.26.3/include/asm-x86/linkage.h
+--- linux-2.6.26.3/include/asm-x86/linkage.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/linkage.h	2008-08-09 12:03:30.000000000 -0400
@@ -28185,4 +27754,3 @@
-diff --git a/include/asm-x86/local.h b/include/asm-x86/local.h
-index 330a72496abd94f9eb85cce30f8ae590b1b57e18..857322e13086f398877e503aea328d49b25ef62b 100644
---- a/include/asm-x86/local.h
-+++ b/include/asm-x86/local.h
+diff -urNp linux-2.6.26.3/include/asm-x86/local.h linux-2.6.26.3/include/asm-x86/local.h
+--- linux-2.6.26.3/include/asm-x86/local.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/local.h	2008-08-09 13:07:51.000000000 -0400
@@ -28284 +27852 @@
-@@ -55,7 +119,24 @@ static inline int local_sub_and_test(long i, local_t *l)
+@@ -55,7 +119,24 @@ static inline int local_sub_and_test(lon
@@ -28310 +27878 @@
-@@ -73,7 +154,24 @@ static inline int local_dec_and_test(local_t *l)
+@@ -73,7 +154,24 @@ static inline int local_dec_and_test(loc
@@ -28336 +27904 @@
-@@ -91,7 +189,24 @@ static inline int local_inc_and_test(local_t *l)
+@@ -91,7 +189,24 @@ static inline int local_inc_and_test(loc
@@ -28362 +27930 @@
-@@ -110,7 +225,24 @@ static inline int local_add_negative(long i, local_t *l)
+@@ -110,7 +225,24 @@ static inline int local_add_negative(lon
@@ -28388 +27956 @@
-@@ -133,7 +265,23 @@ static inline long local_add_return(long i, local_t *l)
+@@ -133,7 +265,23 @@ static inline long local_add_return(long
@@ -28413,5 +27981,4 @@
-diff --git a/include/asm-x86/mach-default/apm.h b/include/asm-x86/mach-default/apm.h
-index 989f34c37d321249f838efe86d4e9c2086b42233..a94d903ddc71017be4c9cfd7ba0e49145076bf4f 100644
---- a/include/asm-x86/mach-default/apm.h
-+++ b/include/asm-x86/mach-default/apm.h
-@@ -34,7 +34,7 @@ static inline void apm_bios_call_asm(u32 func, u32 ebx_in, u32 ecx_in,
+diff -urNp linux-2.6.26.3/include/asm-x86/mach-default/apm.h linux-2.6.26.3/include/asm-x86/mach-default/apm.h
+--- linux-2.6.26.3/include/asm-x86/mach-default/apm.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/mach-default/apm.h	2008-08-09 12:03:30.000000000 -0400
+@@ -34,7 +34,7 @@ static inline void apm_bios_call_asm(u32
@@ -28426 +27993 @@
-@@ -58,7 +58,7 @@ static inline u8 apm_bios_call_simple_asm(u32 func, u32 ebx_in,
+@@ -58,7 +58,7 @@ static inline u8 apm_bios_call_simple_as
@@ -28435,4 +28002,3 @@
-diff --git a/include/asm-x86/mman.h b/include/asm-x86/mman.h
-index c1682b542dafe2c02247e9d721fd69d335c874b7..1b60217bf400b415e58651d5cf94473713b6a5e5 100644
---- a/include/asm-x86/mman.h
-+++ b/include/asm-x86/mman.h
+diff -urNp linux-2.6.26.3/include/asm-x86/mman.h linux-2.6.26.3/include/asm-x86/mman.h
+--- linux-2.6.26.3/include/asm-x86/mman.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/mman.h	2008-08-09 12:03:30.000000000 -0400
@@ -28454,38 +28020,4 @@
-diff --git a/include/asm-x86/mmu.h b/include/asm-x86/mmu.h
-index 00e88679e11f780af5654ae54f2bfafc7e572369..a16a08026d34e6f217c0eadcc63c51110a27948e 100644
---- a/include/asm-x86/mmu.h
-+++ b/include/asm-x86/mmu.h
-@@ -11,13 +11,26 @@
-  * cpu_vm_mask is used to optimize ldt flushing.
-  */
- typedef struct {
--	void *ldt;
-+	struct desc_struct *ldt;
- #ifdef CONFIG_X86_64
- 	rwlock_t ldtlock;
- #endif
- 	int size;
- 	struct mutex lock;
--	void *vdso;
-+	unsigned long vdso;
-+
-+#ifdef CONFIG_X86_32
-+#if defined(CONFIG_PAX_PAGEEXEC) || defined(CONFIG_PAX_SEGMEXEC)
-+	unsigned long user_cs_base;
-+	unsigned long user_cs_limit;
-+
-+#if defined(CONFIG_PAX_PAGEEXEC) && defined(CONFIG_SMP)
-+	cpumask_t cpu_user_cs_mask;
-+#endif
-+
-+#endif
-+#endif
-+
- } mm_context_t;
- 
- #ifdef CONFIG_SMP
-diff --git a/include/asm-x86/mmu_context_32.h b/include/asm-x86/mmu_context_32.h
-index 9756ae0f1dd3acd1dca75744946afdaa824077b3..a6185077a4e73cd8a42110ee697c5af65cf4cada 100644
---- a/include/asm-x86/mmu_context_32.h
-+++ b/include/asm-x86/mmu_context_32.h
-@@ -55,6 +55,22 @@ static inline void switch_mm(struct mm_struct *prev,
+diff -urNp linux-2.6.26.3/include/asm-x86/mmu_context_32.h linux-2.6.26.3/include/asm-x86/mmu_context_32.h
+--- linux-2.6.26.3/include/asm-x86/mmu_context_32.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/mmu_context_32.h	2008-08-09 12:03:30.000000000 -0400
+@@ -55,6 +55,22 @@ static inline void switch_mm(struct mm_s
@@ -28514 +28046 @@
-@@ -67,6 +83,19 @@ static inline void switch_mm(struct mm_struct *prev,
+@@ -67,6 +83,19 @@ static inline void switch_mm(struct mm_s
@@ -28534,4 +28066,35 @@
-diff --git a/include/asm-x86/module.h b/include/asm-x86/module.h
-index bfedb247871cfbc39ecb2823f428ac62f57eb9f4..e6170a7b1084162f1c28e27170132c815fd93853 100644
---- a/include/asm-x86/module.h
-+++ b/include/asm-x86/module.h
+diff -urNp linux-2.6.26.3/include/asm-x86/mmu.h linux-2.6.26.3/include/asm-x86/mmu.h
+--- linux-2.6.26.3/include/asm-x86/mmu.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/mmu.h	2008-08-09 12:03:30.000000000 -0400
+@@ -11,13 +11,26 @@
+  * cpu_vm_mask is used to optimize ldt flushing.
+  */
+ typedef struct {
+-	void *ldt;
++	struct desc_struct *ldt;
+ #ifdef CONFIG_X86_64
+ 	rwlock_t ldtlock;
+ #endif
+ 	int size;
+ 	struct mutex lock;
+-	void *vdso;
++	unsigned long vdso;
++
++#ifdef CONFIG_X86_32
++#if defined(CONFIG_PAX_PAGEEXEC) || defined(CONFIG_PAX_SEGMEXEC)
++	unsigned long user_cs_base;
++	unsigned long user_cs_limit;
++
++#if defined(CONFIG_PAX_PAGEEXEC) && defined(CONFIG_SMP)
++	cpumask_t cpu_user_cs_mask;
++#endif
++
++#endif
++#endif
++
+ } mm_context_t;
+ 
+ #ifdef CONFIG_SMP
+diff -urNp linux-2.6.26.3/include/asm-x86/module.h linux-2.6.26.3/include/asm-x86/module.h
+--- linux-2.6.26.3/include/asm-x86/module.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/module.h	2008-08-09 12:03:30.000000000 -0400
@@ -28552,4 +28115,3 @@
-diff --git a/include/asm-x86/page_32.h b/include/asm-x86/page_32.h
-index ccf0ba3c3abac74f4329221876987df4b284ac95..b09e853b7eb584ffabd8a3d435d3981739ba9ac7 100644
---- a/include/asm-x86/page_32.h
-+++ b/include/asm-x86/page_32.h
+diff -urNp linux-2.6.26.3/include/asm-x86/page_32.h linux-2.6.26.3/include/asm-x86/page_32.h
+--- linux-2.6.26.3/include/asm-x86/page_32.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/page_32.h	2008-08-09 12:03:30.000000000 -0400
@@ -28580,4 +28142,3 @@
-diff --git a/include/asm-x86/page_64.h b/include/asm-x86/page_64.h
-index 6ea72859c491abaeec409afcdeb548e1c464192e..1af587ecc8ca9dcff00d5be7f34a5fe3a6b5a047 100644
---- a/include/asm-x86/page_64.h
-+++ b/include/asm-x86/page_64.h
+diff -urNp linux-2.6.26.3/include/asm-x86/page_64.h linux-2.6.26.3/include/asm-x86/page_64.h
+--- linux-2.6.26.3/include/asm-x86/page_64.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/page_64.h	2008-08-09 12:03:30.000000000 -0400
@@ -28594 +28155 @@
-@@ -89,5 +92,6 @@ extern unsigned long init_memory_mapping(unsigned long start,
+@@ -89,5 +92,6 @@ extern unsigned long init_memory_mapping
@@ -28601,5 +28162,4 @@
-diff --git a/include/asm-x86/paravirt.h b/include/asm-x86/paravirt.h
-index 0f13b945e2400323cb65dfd6f8a7cc5b035c3319..8c5c39fd4ed7844cff429f52e0ef18410fcc7abf 100644
---- a/include/asm-x86/paravirt.h
-+++ b/include/asm-x86/paravirt.h
-@@ -1383,24 +1383,24 @@ static inline unsigned long __raw_local_irq_save(void)
+diff -urNp linux-2.6.26.3/include/asm-x86/paravirt.h linux-2.6.26.3/include/asm-x86/paravirt.h
+--- linux-2.6.26.3/include/asm-x86/paravirt.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/paravirt.h	2008-08-09 12:03:30.000000000 -0400
+@@ -1383,24 +1383,24 @@ static inline unsigned long __raw_local_
@@ -28634,4 +28194,3 @@
-diff --git a/include/asm-x86/pda.h b/include/asm-x86/pda.h
-index 101fb9e11954e8bd45c21a4524c5c8c8f9019132..62b734986a44a03ed3958b2d272d2124bec968e7 100644
---- a/include/asm-x86/pda.h
-+++ b/include/asm-x86/pda.h
+diff -urNp linux-2.6.26.3/include/asm-x86/pda.h linux-2.6.26.3/include/asm-x86/pda.h
+--- linux-2.6.26.3/include/asm-x86/pda.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pda.h	2008-08-09 12:03:30.000000000 -0400
@@ -28650,4 +28209,3 @@
-diff --git a/include/asm-x86/percpu.h b/include/asm-x86/percpu.h
-index 736fc3bb8e1eaa1f8280ed471c70c6deffe20512..545b4d9ebefab308fc50c3dd754b06bb71b44751 100644
---- a/include/asm-x86/percpu.h
-+++ b/include/asm-x86/percpu.h
+diff -urNp linux-2.6.26.3/include/asm-x86/percpu.h linux-2.6.26.3/include/asm-x86/percpu.h
+--- linux-2.6.26.3/include/asm-x86/percpu.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/percpu.h	2008-08-09 12:03:30.000000000 -0400
@@ -28667,5 +28225,4 @@
-diff --git a/include/asm-x86/pgalloc.h b/include/asm-x86/pgalloc.h
-index 91e4641f3f319de6072c63b436c17fb252c9e5b6..bda641f3f10348ba3f6a0ce5066dab4989607b0d 100644
---- a/include/asm-x86/pgalloc.h
-+++ b/include/asm-x86/pgalloc.h
-@@ -47,7 +47,11 @@ static inline void pmd_populate_kernel(struct mm_struct *mm,
+diff -urNp linux-2.6.26.3/include/asm-x86/pgalloc.h linux-2.6.26.3/include/asm-x86/pgalloc.h
+--- linux-2.6.26.3/include/asm-x86/pgalloc.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pgalloc.h	2008-08-09 12:03:30.000000000 -0400
+@@ -47,7 +47,11 @@ static inline void pmd_populate_kernel(s
@@ -28683,5 +28240,4 @@
-diff --git a/include/asm-x86/pgtable-2level.h b/include/asm-x86/pgtable-2level.h
-index 46bc52c0eae18ce519f1fe073edbed48ab846dc8..be168d5f0c87ecaa3a570360832be98d83744b49 100644
---- a/include/asm-x86/pgtable-2level.h
-+++ b/include/asm-x86/pgtable-2level.h
-@@ -18,7 +18,19 @@ static inline void native_set_pte(pte_t *ptep , pte_t pte)
+diff -urNp linux-2.6.26.3/include/asm-x86/pgtable-2level.h linux-2.6.26.3/include/asm-x86/pgtable-2level.h
+--- linux-2.6.26.3/include/asm-x86/pgtable-2level.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pgtable-2level.h	2008-08-09 12:03:30.000000000 -0400
+@@ -18,7 +18,19 @@ static inline void native_set_pte(pte_t 
@@ -28707,5 +28263,47 @@
-diff --git a/include/asm-x86/pgtable-3level.h b/include/asm-x86/pgtable-3level.h
-index c93dbb6c26247dfa76d92b5a5dd8e73c7c41dd3c..627f141fd913f304d602e2934313016434a5b7ed 100644
---- a/include/asm-x86/pgtable-3level.h
-+++ b/include/asm-x86/pgtable-3level.h
-@@ -70,12 +70,36 @@ static inline void native_set_pte_atomic(pte_t *ptep, pte_t pte)
+diff -urNp linux-2.6.26.3/include/asm-x86/pgtable_32.h linux-2.6.26.3/include/asm-x86/pgtable_32.h
+--- linux-2.6.26.3/include/asm-x86/pgtable_32.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pgtable_32.h	2008-08-09 12:03:30.000000000 -0400
+@@ -25,8 +25,6 @@
+ struct mm_struct;
+ struct vm_area_struct;
+ 
+-extern pgd_t swapper_pg_dir[1024];
+-
+ static inline void pgtable_cache_init(void) { }
+ static inline void check_pgt_cache(void) { }
+ void paging_init(void);
+@@ -45,6 +43,11 @@ void paging_init(void);
+ # include <asm/pgtable-2level-defs.h>
+ #endif
+ 
++extern pgd_t swapper_pg_dir[PTRS_PER_PGD];
++#ifdef CONFIG_X86_PAE
++extern pmd_t swapper_pm_dir[PTRS_PER_PGD][PTRS_PER_PMD];
++#endif
++
+ #define PGDIR_SIZE	(1UL << PGDIR_SHIFT)
+ #define PGDIR_MASK	(~(PGDIR_SIZE - 1))
+ 
+@@ -81,7 +84,7 @@ void paging_init(void);
+ #undef TEST_ACCESS_OK
+ 
+ /* The boot page tables (all created as a single array) */
+-extern unsigned long pg0[];
++extern pte_t pg0[];
+ 
+ #define pte_present(x)	((x).pte_low & (_PAGE_PRESENT | _PAGE_PROTNONE))
+ 
+@@ -208,6 +211,9 @@ static inline void __init paravirt_paget
+ 
+ #endif /* !__ASSEMBLY__ */
+ 
++#define HAVE_ARCH_UNMAPPED_AREA
++#define HAVE_ARCH_UNMAPPED_AREA_TOPDOWN
++
+ /*
+  * kern_addr_valid() is (1) for FLATMEM and (0) for
+  * SPARSEMEM and DISCONTIGMEM
+diff -urNp linux-2.6.26.3/include/asm-x86/pgtable-3level.h linux-2.6.26.3/include/asm-x86/pgtable-3level.h
+--- linux-2.6.26.3/include/asm-x86/pgtable-3level.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pgtable-3level.h	2008-08-09 12:03:30.000000000 -0400
+@@ -70,12 +70,36 @@ static inline void native_set_pte_atomic
@@ -28748,4 +28346,47 @@
-diff --git a/include/asm-x86/pgtable.h b/include/asm-x86/pgtable.h
-index 97c271b2910b3266b4aaafa53385dfd8148bf374..eda8df2cea92adbb90f3fee554d9b28cd9a9861f 100644
---- a/include/asm-x86/pgtable.h
-+++ b/include/asm-x86/pgtable.h
+diff -urNp linux-2.6.26.3/include/asm-x86/pgtable_64.h linux-2.6.26.3/include/asm-x86/pgtable_64.h
+--- linux-2.6.26.3/include/asm-x86/pgtable_64.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pgtable_64.h	2008-08-09 12:03:30.000000000 -0400
+@@ -101,7 +101,19 @@ static inline pte_t native_ptep_get_and_
+ 
+ static inline void native_set_pmd(pmd_t *pmdp, pmd_t pmd)
+ {
++
++#ifdef CONFIG_PAX_KERNEXEC
++	unsigned long cr0;
++
++	pax_open_kernel(cr0);
++#endif
++
+ 	*pmdp = pmd;
++
++#ifdef CONFIG_PAX_KERNEXEC
++	pax_close_kernel(cr0);
++#endif
++
+ }
+ 
+ static inline void native_pmd_clear(pmd_t *pmd)
+@@ -153,17 +165,17 @@ static inline void native_pgd_clear(pgd_
+ 
+ static inline int pgd_bad(pgd_t pgd)
+ {
+-	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
++	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
+ }
+ 
+ static inline int pud_bad(pud_t pud)
+ {
+-	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
++	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
+ }
+ 
+ static inline int pmd_bad(pmd_t pmd)
+ {
+-	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
++	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
+ }
+ 
+ #define pte_none(x)	(!pte_val((x)))
+diff -urNp linux-2.6.26.3/include/asm-x86/pgtable.h linux-2.6.26.3/include/asm-x86/pgtable.h
+--- linux-2.6.26.3/include/asm-x86/pgtable.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/pgtable.h	2008-08-09 12:03:30.000000000 -0400
@@ -28762 +28403 @@
-@@ -104,7 +107,7 @@ extern pteval_t __PAGE_KERNEL, __PAGE_KERNEL_EXEC;
+@@ -104,7 +107,7 @@ extern pteval_t __PAGE_KERNEL, __PAGE_KE
@@ -28771 +28412 @@
-@@ -158,10 +161,17 @@ extern unsigned long empty_zero_page[PAGE_SIZE / sizeof(unsigned long)];
+@@ -158,10 +161,17 @@ extern unsigned long empty_zero_page[PAG
@@ -28789 +28430 @@
-@@ -223,9 +233,29 @@ static inline pte_t pte_wrprotect(pte_t pte)
+@@ -223,9 +233,29 @@ static inline pte_t pte_wrprotect(pte_t 
@@ -28820 +28461 @@
-@@ -268,8 +298,6 @@ static inline pte_t pte_mkspecial(pte_t pte)
+@@ -268,8 +298,6 @@ static inline pte_t pte_mkspecial(pte_t 
@@ -28829 +28470 @@
-@@ -480,7 +508,19 @@ static inline void ptep_set_wrprotect(struct mm_struct *mm,
+@@ -480,7 +508,19 @@ static inline void ptep_set_wrprotect(st
@@ -28850,93 +28491,3 @@
-diff --git a/include/asm-x86/pgtable_32.h b/include/asm-x86/pgtable_32.h
-index 32ca03109a4c5f0f6e222cea946f3141bcbca796..5d762034e4b2b3793d6209e79c4023b611fab62e 100644
---- a/include/asm-x86/pgtable_32.h
-+++ b/include/asm-x86/pgtable_32.h
-@@ -25,8 +25,6 @@
- struct mm_struct;
- struct vm_area_struct;
- 
--extern pgd_t swapper_pg_dir[1024];
--
- static inline void pgtable_cache_init(void) { }
- static inline void check_pgt_cache(void) { }
- void paging_init(void);
-@@ -45,6 +43,11 @@ void paging_init(void);
- # include <asm/pgtable-2level-defs.h>
- #endif
- 
-+extern pgd_t swapper_pg_dir[PTRS_PER_PGD];
-+#ifdef CONFIG_X86_PAE
-+extern pmd_t swapper_pm_dir[PTRS_PER_PGD][PTRS_PER_PMD];
-+#endif
-+
- #define PGDIR_SIZE	(1UL << PGDIR_SHIFT)
- #define PGDIR_MASK	(~(PGDIR_SIZE - 1))
- 
-@@ -81,7 +84,7 @@ void paging_init(void);
- #undef TEST_ACCESS_OK
- 
- /* The boot page tables (all created as a single array) */
--extern unsigned long pg0[];
-+extern pte_t pg0[];
- 
- #define pte_present(x)	((x).pte_low & (_PAGE_PRESENT | _PAGE_PROTNONE))
- 
-@@ -208,6 +211,9 @@ static inline void __init paravirt_pagetable_setup_done(pgd_t *base)
- 
- #endif /* !__ASSEMBLY__ */
- 
-+#define HAVE_ARCH_UNMAPPED_AREA
-+#define HAVE_ARCH_UNMAPPED_AREA_TOPDOWN
-+
- /*
-  * kern_addr_valid() is (1) for FLATMEM and (0) for
-  * SPARSEMEM and DISCONTIGMEM
-diff --git a/include/asm-x86/pgtable_64.h b/include/asm-x86/pgtable_64.h
-index 1cc50d22d735388f9bb74a11f0765e4d6a1d2472..63309e5f482b626b90342eafd781e90ed94ff36c 100644
---- a/include/asm-x86/pgtable_64.h
-+++ b/include/asm-x86/pgtable_64.h
-@@ -101,7 +101,19 @@ static inline pte_t native_ptep_get_and_clear(pte_t *xp)
- 
- static inline void native_set_pmd(pmd_t *pmdp, pmd_t pmd)
- {
-+
-+#ifdef CONFIG_PAX_KERNEXEC
-+	unsigned long cr0;
-+
-+	pax_open_kernel(cr0);
-+#endif
-+
- 	*pmdp = pmd;
-+
-+#ifdef CONFIG_PAX_KERNEXEC
-+	pax_close_kernel(cr0);
-+#endif
-+
- }
- 
- static inline void native_pmd_clear(pmd_t *pmd)
-@@ -153,17 +165,17 @@ static inline void native_pgd_clear(pgd_t *pgd)
- 
- static inline int pgd_bad(pgd_t pgd)
- {
--	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
-+	return (pgd_val(pgd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
- }
- 
- static inline int pud_bad(pud_t pud)
- {
--	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
-+	return (pud_val(pud) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
- }
- 
- static inline int pmd_bad(pmd_t pmd)
- {
--	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER)) != _KERNPG_TABLE;
-+	return (pmd_val(pmd) & ~(PTE_MASK | _PAGE_USER | _PAGE_NX)) != _KERNPG_TABLE;
- }
- 
- #define pte_none(x)	(!pte_val((x)))
-diff --git a/include/asm-x86/processor.h b/include/asm-x86/processor.h
-index 559105220a477e2be9cfbd87eee62d1cd68767c2..9d9250df27cabd8c3cc04fa0d71e57c8a1237f6f 100644
---- a/include/asm-x86/processor.h
-+++ b/include/asm-x86/processor.h
+diff -urNp linux-2.6.26.3/include/asm-x86/processor.h linux-2.6.26.3/include/asm-x86/processor.h
+--- linux-2.6.26.3/include/asm-x86/processor.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/processor.h	2008-08-09 12:03:30.000000000 -0400
@@ -28952 +28503 @@
-@@ -814,11 +814,20 @@ static inline void spin_lock_prefetch(const void *x)
+@@ -814,11 +814,20 @@ static inline void spin_lock_prefetch(co
@@ -28975 +28526 @@
-@@ -833,7 +842,7 @@ static inline void spin_lock_prefetch(const void *x)
+@@ -833,7 +842,7 @@ static inline void spin_lock_prefetch(co
@@ -28984 +28535 @@
-@@ -844,11 +853,7 @@ static inline void spin_lock_prefetch(const void *x)
+@@ -844,11 +853,7 @@ static inline void spin_lock_prefetch(co
@@ -28997 +28548 @@
-@@ -863,7 +868,7 @@ extern unsigned long thread_saved_pc(struct task_struct *tsk);
+@@ -863,7 +868,7 @@ extern unsigned long thread_saved_pc(str
@@ -29006 +28557 @@
-@@ -879,7 +884,7 @@ extern unsigned long thread_saved_pc(struct task_struct *tsk);
+@@ -879,7 +884,7 @@ extern unsigned long thread_saved_pc(str
@@ -29015 +28566 @@
-@@ -916,6 +921,10 @@ extern void start_thread(struct pt_regs *regs, unsigned long new_ip,
+@@ -916,6 +921,10 @@ extern void start_thread(struct pt_regs 
@@ -29026,4 +28577,3 @@
-diff --git a/include/asm-x86/ptrace.h b/include/asm-x86/ptrace.h
-index 9f922b0b95d6d3961275c9cac804acf22cbb8ef6..2bf2aa553bf46932c53ff90906cc3b271164fe6d 100644
---- a/include/asm-x86/ptrace.h
-+++ b/include/asm-x86/ptrace.h
+diff -urNp linux-2.6.26.3/include/asm-x86/ptrace.h linux-2.6.26.3/include/asm-x86/ptrace.h
+--- linux-2.6.26.3/include/asm-x86/ptrace.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/ptrace.h	2008-08-09 12:03:30.000000000 -0400
@@ -29046 +28596 @@
-@@ -152,28 +152,29 @@ static inline unsigned long regs_return_value(struct pt_regs *regs)
+@@ -152,28 +152,29 @@ static inline unsigned long regs_return_
@@ -29082,4 +28632,3 @@
-diff --git a/include/asm-x86/reboot.h b/include/asm-x86/reboot.h
-index e63741f19392e24d587b3383c18e6de2da1dab18..82d72aa7657b779adc08388d986cfffeddb9b478 100644
---- a/include/asm-x86/reboot.h
-+++ b/include/asm-x86/reboot.h
+diff -urNp linux-2.6.26.3/include/asm-x86/reboot.h linux-2.6.26.3/include/asm-x86/reboot.h
+--- linux-2.6.26.3/include/asm-x86/reboot.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/reboot.h	2008-08-09 12:03:30.000000000 -0400
@@ -29095,5 +28644,4 @@
-diff --git a/include/asm-x86/rwsem.h b/include/asm-x86/rwsem.h
-index 750f2a3542b3931044e77835dceac28457bbece8..35de738e623f195d6fe16f3e480aaa980f3bec17 100644
---- a/include/asm-x86/rwsem.h
-+++ b/include/asm-x86/rwsem.h
-@@ -106,10 +106,26 @@ static inline void __down_read(struct rw_semaphore *sem)
+diff -urNp linux-2.6.26.3/include/asm-x86/rwsem.h linux-2.6.26.3/include/asm-x86/rwsem.h
+--- linux-2.6.26.3/include/asm-x86/rwsem.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/rwsem.h	2008-08-09 13:07:51.000000000 -0400
+@@ -106,10 +106,26 @@ static inline void __down_read(struct rw
@@ -29128 +28676 @@
-@@ -127,6 +143,22 @@ static inline int __down_read_trylock(struct rw_semaphore *sem)
+@@ -127,6 +143,22 @@ static inline int __down_read_trylock(st
@@ -29151 +28699 @@
-@@ -148,6 +180,22 @@ static inline void __down_write_nested(struct rw_semaphore *sem, int subclass)
+@@ -148,6 +180,22 @@ static inline void __down_write_nested(s
@@ -29174 +28722 @@
-@@ -186,6 +234,22 @@ static inline void __up_read(struct rw_semaphore *sem)
+@@ -186,6 +234,22 @@ static inline void __up_read(struct rw_s
@@ -29197 +28745 @@
-@@ -204,6 +268,22 @@ static inline void __up_write(struct rw_semaphore *sem)
+@@ -204,6 +268,22 @@ static inline void __up_write(struct rw_
@@ -29220 +28768 @@
-@@ -222,6 +302,22 @@ static inline void __downgrade_write(struct rw_semaphore *sem)
+@@ -222,6 +302,22 @@ static inline void __downgrade_write(str
@@ -29243 +28791 @@
-@@ -237,7 +333,23 @@ static inline void __downgrade_write(struct rw_semaphore *sem)
+@@ -237,7 +333,23 @@ static inline void __downgrade_write(str
@@ -29268 +28816 @@
-@@ -249,7 +361,23 @@ static inline int rwsem_atomic_update(int delta, struct rw_semaphore *sem)
+@@ -249,7 +361,23 @@ static inline int rwsem_atomic_update(in
@@ -29293,4 +28841,3 @@
-diff --git a/include/asm-x86/segment.h b/include/asm-x86/segment.h
-index ed5131dd7d92af9980f34341aed73bbe2eaa340d..e2eb634a4116eb09b360e4d3d86c67b5528a39cc 100644
---- a/include/asm-x86/segment.h
-+++ b/include/asm-x86/segment.h
+diff -urNp linux-2.6.26.3/include/asm-x86/segment.h linux-2.6.26.3/include/asm-x86/segment.h
+--- linux-2.6.26.3/include/asm-x86/segment.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/segment.h	2008-08-09 12:03:30.000000000 -0400
@@ -29331,5 +28878,4 @@
-diff --git a/include/asm-x86/spinlock.h b/include/asm-x86/spinlock.h
-index bf2a3d2dfa62b53cb685eae44180726feb853768..4a4aad32fea90e797dba9e922c0f1028a5be2157 100644
---- a/include/asm-x86/spinlock.h
-+++ b/include/asm-x86/spinlock.h
-@@ -227,15 +227,47 @@ static inline int __raw_write_can_lock(raw_rwlock_t *lock)
+diff -urNp linux-2.6.26.3/include/asm-x86/spinlock.h linux-2.6.26.3/include/asm-x86/spinlock.h
+--- linux-2.6.26.3/include/asm-x86/spinlock.h	2008-08-09 13:05:26.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/spinlock.h	2008-08-09 13:07:51.000000000 -0400
+@@ -227,15 +227,47 @@ static inline int __raw_write_can_lock(r
@@ -29339,0 +28886 @@
+-		     "call __read_lock_failed\n\t"
@@ -29349 +28896 @@
-+		     "1:\n"
+ 		     "1:\n"
@@ -29357,2 +28904 @@
- 		     "call __read_lock_failed\n\t"
--		     "1:\n"
++		     "call __read_lock_failed\n\t"
@@ -29385 +28931 @@
-@@ -265,12 +297,45 @@ static inline int __raw_write_trylock(raw_rwlock_t *lock)
+@@ -265,12 +297,45 @@ static inline int __raw_write_trylock(ra
@@ -29433,4 +28979,3 @@
-diff --git a/include/asm-x86/system.h b/include/asm-x86/system.h
-index a2f04cd79b29617e4677a0a1a1c23f4f1d434b23..15ce7a66d66e282b39f10591a8487c364e49afb0 100644
---- a/include/asm-x86/system.h
-+++ b/include/asm-x86/system.h
+diff -urNp linux-2.6.26.3/include/asm-x86/system.h linux-2.6.26.3/include/asm-x86/system.h
+--- linux-2.6.26.3/include/asm-x86/system.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/system.h	2008-08-09 12:03:30.000000000 -0400
@@ -29457 +29002 @@
-@@ -166,7 +170,7 @@ static inline unsigned long get_limit(unsigned long segment)
+@@ -166,7 +170,7 @@ static inline unsigned long get_limit(un
@@ -29497,4 +29042,3 @@
-diff --git a/include/asm-x86/uaccess_32.h b/include/asm-x86/uaccess_32.h
-index 8e7595c1f34e69959e42eb98a33b2a64b56ba848..4af5c4f5c60632a082230257d90a747affd0f78e 100644
---- a/include/asm-x86/uaccess_32.h
-+++ b/include/asm-x86/uaccess_32.h
+diff -urNp linux-2.6.26.3/include/asm-x86/uaccess_32.h linux-2.6.26.3/include/asm-x86/uaccess_32.h
+--- linux-2.6.26.3/include/asm-x86/uaccess_32.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/uaccess_32.h	2008-08-09 12:03:30.000000000 -0400
@@ -29552 +29096 @@
-@@ -377,15 +384,19 @@ struct __large_struct { unsigned long buf[100]; };
+@@ -377,15 +384,19 @@ struct __large_struct { unsigned long bu
@@ -29596,4 +29140,3 @@
-diff --git a/include/asm-x86/uaccess_64.h b/include/asm-x86/uaccess_64.h
-index b8a2f43399032e1ce617e38a35eb28919f08a287..cf27e8629408545321a8c00c33115a56b26c0acc 100644
---- a/include/asm-x86/uaccess_64.h
-+++ b/include/asm-x86/uaccess_64.h
+diff -urNp linux-2.6.26.3/include/asm-x86/uaccess_64.h linux-2.6.26.3/include/asm-x86/uaccess_64.h
+--- linux-2.6.26.3/include/asm-x86/uaccess_64.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-x86/uaccess_64.h	2008-08-09 12:03:30.000000000 -0400
@@ -29608,4 +29151,3 @@
-diff --git a/include/asm-xtensa/kmap_types.h b/include/asm-xtensa/kmap_types.h
-index 9e822d2e3bcecf69871eb65acdf81655c02e1124..ec535f19b4ee8640d6b81f61c3e1ef6e56022c29 100644
---- a/include/asm-xtensa/kmap_types.h
-+++ b/include/asm-xtensa/kmap_types.h
+diff -urNp linux-2.6.26.3/include/asm-xtensa/kmap_types.h linux-2.6.26.3/include/asm-xtensa/kmap_types.h
+--- linux-2.6.26.3/include/asm-xtensa/kmap_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/asm-xtensa/kmap_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -29620,4 +29162,3 @@
-diff --git a/include/linux/a.out.h b/include/linux/a.out.h
-index e86dfca44589f49e083e53a3f905868ba2e89955..40cc55f81ce250ddb6da3b6446524b91eea8f72e 100644
---- a/include/linux/a.out.h
-+++ b/include/linux/a.out.h
+diff -urNp linux-2.6.26.3/include/linux/a.out.h linux-2.6.26.3/include/linux/a.out.h
+--- linux-2.6.26.3/include/linux/a.out.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/a.out.h	2008-08-09 12:03:30.000000000 -0400
@@ -29639,4 +29180,3 @@
-diff --git a/include/linux/cache.h b/include/linux/cache.h
-index 97e24881c4c6f477496130c982e1962e770df9eb..e7576b9f0ea92680498e580019e0d617800cd8e7 100644
---- a/include/linux/cache.h
-+++ b/include/linux/cache.h
+diff -urNp linux-2.6.26.3/include/linux/cache.h linux-2.6.26.3/include/linux/cache.h
+--- linux-2.6.26.3/include/linux/cache.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/cache.h	2008-08-09 12:03:30.000000000 -0400
@@ -29654,5 +29194,4 @@
-diff --git a/include/linux/capability.h b/include/linux/capability.h
-index 02673846d20539b25949c3e10356ae09e9be762b..d92662c1a19187ae50eef0abf4727e3edc73ef15 100644
---- a/include/linux/capability.h
-+++ b/include/linux/capability.h
-@@ -504,6 +504,7 @@ extern const kernel_cap_t __cap_init_eff_set;
+diff -urNp linux-2.6.26.3/include/linux/capability.h linux-2.6.26.3/include/linux/capability.h
+--- linux-2.6.26.3/include/linux/capability.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/capability.h	2008-08-09 12:03:30.000000000 -0400
+@@ -504,6 +504,7 @@ extern const kernel_cap_t __cap_init_eff
@@ -29666,4 +29205,3 @@
-diff --git a/include/linux/elf.h b/include/linux/elf.h
-index ff9fbed90123faff8fb8e3a7817a831f6bc5e276..69f07407b9dbfc8fd5d3790c3369e25e94345b69 100644
---- a/include/linux/elf.h
-+++ b/include/linux/elf.h
+diff -urNp linux-2.6.26.3/include/linux/elf.h linux-2.6.26.3/include/linux/elf.h
+--- linux-2.6.26.3/include/linux/elf.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/elf.h	2008-08-09 12:03:30.000000000 -0400
@@ -29741,5 +29279,3 @@
-diff --git a/include/linux/gracl.h b/include/linux/gracl.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..b0b09274a866614c40f3a5434333d20626b2a00f
---- /dev/null
-+++ b/include/linux/gracl.h
+diff -urNp linux-2.6.26.3/include/linux/gracl.h linux-2.6.26.3/include/linux/gracl.h
+--- linux-2.6.26.3/include/linux/gracl.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/include/linux/gracl.h	2008-08-09 12:03:30.000000000 -0400
@@ -30065,5 +29601,3 @@
-diff --git a/include/linux/gralloc.h b/include/linux/gralloc.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..35865f3ad088d10a01ef9e214ce1483152938200
---- /dev/null
-+++ b/include/linux/gralloc.h
+diff -urNp linux-2.6.26.3/include/linux/gralloc.h linux-2.6.26.3/include/linux/gralloc.h
+--- linux-2.6.26.3/include/linux/gralloc.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/include/linux/gralloc.h	2008-08-09 12:03:30.000000000 -0400
@@ -30079,5 +29613,3 @@
-diff --git a/include/linux/grdefs.h b/include/linux/grdefs.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..51e04d99d44dbad116813ef98517341f917b5254
---- /dev/null
-+++ b/include/linux/grdefs.h
+diff -urNp linux-2.6.26.3/include/linux/grdefs.h linux-2.6.26.3/include/linux/grdefs.h
+--- linux-2.6.26.3/include/linux/grdefs.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/include/linux/grdefs.h	2008-08-09 12:03:30.000000000 -0400
@@ -30216,5 +29748,3 @@
-diff --git a/include/linux/grinternal.h b/include/linux/grinternal.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..9c4a6373d220ef61d7de30aef0f371caaf38f877
---- /dev/null
-+++ b/include/linux/grinternal.h
+diff -urNp linux-2.6.26.3/include/linux/grinternal.h linux-2.6.26.3/include/linux/grinternal.h
+--- linux-2.6.26.3/include/linux/grinternal.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/include/linux/grinternal.h	2008-08-09 12:03:30.000000000 -0400
@@ -30432,5 +29962,3 @@
-diff --git a/include/linux/grmsg.h b/include/linux/grmsg.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..e230f65b535327e3912522e4d8ff9a0e7602bee4
---- /dev/null
-+++ b/include/linux/grmsg.h
+diff -urNp linux-2.6.26.3/include/linux/grmsg.h linux-2.6.26.3/include/linux/grmsg.h
+--- linux-2.6.26.3/include/linux/grmsg.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/include/linux/grmsg.h	2008-08-09 12:03:30.000000000 -0400
@@ -30546,5 +30074,3 @@
-diff --git a/include/linux/grsecurity.h b/include/linux/grsecurity.h
-new file mode 100644
-index 0000000000000000000000000000000000000000..32bd7592bf35b6ac61340e300bbf273bff3b239d
---- /dev/null
-+++ b/include/linux/grsecurity.h
+diff -urNp linux-2.6.26.3/include/linux/grsecurity.h linux-2.6.26.3/include/linux/grsecurity.h
+--- linux-2.6.26.3/include/linux/grsecurity.h	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/include/linux/grsecurity.h	2008-08-09 12:03:30.000000000 -0400
@@ -30752,5 +30278,4 @@
-diff --git a/include/linux/highmem.h b/include/linux/highmem.h
-index 7dcbc82f3b7bf4a19969d0cf19824cf373a2a91b..3a6c11ea2d9183ae5a388657b1d119ad80f9bda2 100644
---- a/include/linux/highmem.h
-+++ b/include/linux/highmem.h
-@@ -122,6 +122,13 @@ static inline void clear_highpage(struct page *page)
+diff -urNp linux-2.6.26.3/include/linux/highmem.h linux-2.6.26.3/include/linux/highmem.h
+--- linux-2.6.26.3/include/linux/highmem.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/highmem.h	2008-08-09 12:03:30.000000000 -0400
+@@ -122,6 +122,13 @@ static inline void clear_highpage(struct
@@ -30770,5 +30295,4 @@
-diff --git a/include/linux/jbd.h b/include/linux/jbd.h
-index 07a9b52a265418cb4b213ae8b1fff8e6eefbdd9d..9e861c6700870f8bc410d2d2c7a337352e2566e2 100644
---- a/include/linux/jbd.h
-+++ b/include/linux/jbd.h
-@@ -66,7 +66,7 @@ extern u8 journal_enable_debug;
+diff -urNp linux-2.6.26.3/include/linux/jbd2.h linux-2.6.26.3/include/linux/jbd2.h
+--- linux-2.6.26.3/include/linux/jbd2.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/jbd2.h	2008-08-09 12:03:30.000000000 -0400
+@@ -66,7 +66,7 @@ extern u8 jbd2_journal_enable_debug;
@@ -30782,6 +30306,5 @@
- static inline void *jbd_alloc(size_t size, gfp_t flags)
-diff --git a/include/linux/jbd2.h b/include/linux/jbd2.h
-index d147f0f903604e0a1d6ae08fefd22255be2fd3c3..bc27dd6cfee939c5536877f8de7fd734e1478487 100644
---- a/include/linux/jbd2.h
-+++ b/include/linux/jbd2.h
-@@ -66,7 +66,7 @@ extern u8 jbd2_journal_enable_debug;
+ static inline void *jbd2_alloc(size_t size, gfp_t flags)
+diff -urNp linux-2.6.26.3/include/linux/jbd.h linux-2.6.26.3/include/linux/jbd.h
+--- linux-2.6.26.3/include/linux/jbd.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/jbd.h	2008-08-09 12:03:30.000000000 -0400
+@@ -66,7 +66,7 @@ extern u8 journal_enable_debug;
@@ -30795,5 +30318,4 @@
- static inline void *jbd2_alloc(size_t size, gfp_t flags)
-diff --git a/include/linux/libata.h b/include/linux/libata.h
-index e57e5d08312d44929321204c1c0600b1068f82eb..c4d13a0a40bb1890fcc3ea65779eaf7b1b161696 100644
---- a/include/linux/libata.h
-+++ b/include/linux/libata.h
+ static inline void *jbd_alloc(size_t size, gfp_t flags)
+diff -urNp linux-2.6.26.3/include/linux/libata.h linux-2.6.26.3/include/linux/libata.h
+--- linux-2.6.26.3/include/linux/libata.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/libata.h	2008-08-09 12:03:30.000000000 -0400
@@ -30815,4 +30337,3 @@
-diff --git a/include/linux/mm.h b/include/linux/mm.h
-index 586a943cab018647da208582bc1f19e0dc485f1d..e97849674c7af48fa14e4180ce47c6ae47b5de7f 100644
---- a/include/linux/mm.h
-+++ b/include/linux/mm.h
+diff -urNp linux-2.6.26.3/include/linux/mm.h linux-2.6.26.3/include/linux/mm.h
+--- linux-2.6.26.3/include/linux/mm.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/mm.h	2008-08-09 12:03:30.000000000 -0400
@@ -30827 +30348 @@
-@@ -109,6 +110,14 @@ extern unsigned int kobjsize(const void *objp);
+@@ -109,6 +110,14 @@ extern unsigned int kobjsize(const void 
@@ -30859 +30380 @@
-@@ -1161,6 +1173,10 @@ extern struct vm_area_struct * find_vma(struct mm_struct * mm, unsigned long add
+@@ -1161,6 +1173,10 @@ extern struct vm_area_struct * find_vma(
@@ -30870 +30391 @@
-@@ -1177,7 +1193,6 @@ static inline unsigned long vma_pages(struct vm_area_struct *vma)
+@@ -1177,7 +1193,6 @@ static inline unsigned long vma_pages(st
@@ -30878 +30399 @@
-@@ -1266,5 +1281,11 @@ int vmemmap_populate_basepages(struct page *start_page,
+@@ -1266,5 +1281,11 @@ int vmemmap_populate_basepages(struct pa
@@ -30890,4 +30411,3 @@
-diff --git a/include/linux/mm_types.h b/include/linux/mm_types.h
-index 02a27ae78539cfe536106f46a8f89b50ea63985e..787434a31b02ba20ca6fc4d545fa63b9d8f5cbbe 100644
---- a/include/linux/mm_types.h
-+++ b/include/linux/mm_types.h
+diff -urNp linux-2.6.26.3/include/linux/mm_types.h linux-2.6.26.3/include/linux/mm_types.h
+--- linux-2.6.26.3/include/linux/mm_types.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/mm_types.h	2008-08-09 12:03:30.000000000 -0400
@@ -30928,4 +30448,3 @@
-diff --git a/include/linux/module.h b/include/linux/module.h
-index 3e03b1acbc94a8ba7fbbd28e394f442c4710f2f9..b23e97c3896a5bf1117b8fae2ff3fa5e0a7732d8 100644
---- a/include/linux/module.h
-+++ b/include/linux/module.h
+diff -urNp linux-2.6.26.3/include/linux/module.h linux-2.6.26.3/include/linux/module.h
+--- linux-2.6.26.3/include/linux/module.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/module.h	2008-08-09 12:03:30.000000000 -0400
@@ -30953,5 +30472,4 @@
-diff --git a/include/linux/moduleloader.h b/include/linux/moduleloader.h
-index eb1033957486670348f892b4d93117958af76c0a..06529f3addd580e3986a05007ecfee4644ce883c 100644
---- a/include/linux/moduleloader.h
-+++ b/include/linux/moduleloader.h
-@@ -17,9 +17,21 @@ int module_frob_arch_sections(Elf_Ehdr *hdr,
+diff -urNp linux-2.6.26.3/include/linux/moduleloader.h linux-2.6.26.3/include/linux/moduleloader.h
+--- linux-2.6.26.3/include/linux/moduleloader.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/moduleloader.h	2008-08-09 12:03:30.000000000 -0400
+@@ -17,9 +17,21 @@ int module_frob_arch_sections(Elf_Ehdr *
@@ -30979,4 +30497,3 @@
-diff --git a/include/linux/namei.h b/include/linux/namei.h
-index 24d88e98a62648180a553fdfb457837bcbcb5c00..4a1e2c9d23212d90c27015904cfdb8e129286b94 100644
---- a/include/linux/namei.h
-+++ b/include/linux/namei.h
+diff -urNp linux-2.6.26.3/include/linux/namei.h linux-2.6.26.3/include/linux/namei.h
+--- linux-2.6.26.3/include/linux/namei.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/namei.h	2008-08-09 12:03:30.000000000 -0400
@@ -30992 +30509 @@
-@@ -83,12 +83,12 @@ extern int follow_up(struct vfsmount **, struct dentry **);
+@@ -83,12 +83,12 @@ extern int follow_up(struct vfsmount **,
@@ -31007,4 +30524,3 @@
-diff --git a/include/linux/percpu.h b/include/linux/percpu.h
-index 4cdd393e71e1bb70ee0286c16f2aeb08d1458d98..e12c358bc759a0a2f48d49b56a50e5e5288406a2 100644
---- a/include/linux/percpu.h
-+++ b/include/linux/percpu.h
+diff -urNp linux-2.6.26.3/include/linux/percpu.h linux-2.6.26.3/include/linux/percpu.h
+--- linux-2.6.26.3/include/linux/percpu.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/percpu.h	2008-08-09 12:03:30.000000000 -0400
@@ -31020,4 +30536,3 @@
-diff --git a/include/linux/poison.h b/include/linux/poison.h
-index 9f31683728fd7e2c59f738ae35ab6835066270c1..f28e10432d9b22914a3ca94a24c05b122064c94c 100644
---- a/include/linux/poison.h
-+++ b/include/linux/poison.h
+diff -urNp linux-2.6.26.3/include/linux/poison.h linux-2.6.26.3/include/linux/poison.h
+--- linux-2.6.26.3/include/linux/poison.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/poison.h	2008-08-09 12:03:30.000000000 -0400
@@ -31035,5 +30550,4 @@
-diff --git a/include/linux/random.h b/include/linux/random.h
-index 36f125c0c6037f0270941e96e63790151a66fe34..1250dc939625c3577d8d3775edd8b3d677e37d8e 100644
---- a/include/linux/random.h
-+++ b/include/linux/random.h
-@@ -72,6 +72,11 @@ unsigned long randomize_range(unsigned long start, unsigned long end, unsigned l
+diff -urNp linux-2.6.26.3/include/linux/random.h linux-2.6.26.3/include/linux/random.h
+--- linux-2.6.26.3/include/linux/random.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/random.h	2008-08-09 12:03:30.000000000 -0400
+@@ -72,6 +72,11 @@ unsigned long randomize_range(unsigned l
@@ -31051,4 +30565,3 @@
-diff --git a/include/linux/sched.h b/include/linux/sched.h
-index c5d3f847ca8d05bd52ca575608c2d428a23d1b28..5c9b075373dd17513997e11129cd6832321d0b54 100644
---- a/include/linux/sched.h
-+++ b/include/linux/sched.h
+diff -urNp linux-2.6.26.3/include/linux/sched.h linux-2.6.26.3/include/linux/sched.h
+--- linux-2.6.26.3/include/linux/sched.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/sched.h	2008-08-09 13:07:51.000000000 -0400
@@ -31176 +30689 @@
-@@ -1851,7 +1916,7 @@ extern void __cleanup_sighand(struct sighand_struct *);
+@@ -1851,7 +1916,7 @@ extern void __cleanup_sighand(struct sig
@@ -31185 +30698 @@
-@@ -1953,8 +2018,8 @@ static inline void unlock_task_sighand(struct task_struct *tsk,
+@@ -1953,8 +2018,8 @@ static inline void unlock_task_sighand(s
@@ -31196 +30709 @@
-@@ -2126,6 +2191,12 @@ extern void arch_pick_mmap_layout(struct mm_struct *mm);
+@@ -2126,6 +2191,12 @@ extern void arch_pick_mmap_layout(struct
@@ -31209,4 +30722,3 @@
-diff --git a/include/linux/screen_info.h b/include/linux/screen_info.h
-index 1ee2c05142f627ba68cfcf17205a1ae3e38b8893..81b7ec456f2c9b0753516c2dae01f92dc1ceb22f 100644
---- a/include/linux/screen_info.h
-+++ b/include/linux/screen_info.h
+diff -urNp linux-2.6.26.3/include/linux/screen_info.h linux-2.6.26.3/include/linux/screen_info.h
+--- linux-2.6.26.3/include/linux/screen_info.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/screen_info.h	2008-08-09 12:03:30.000000000 -0400
@@ -31223,5 +30735,4 @@
-diff --git a/include/linux/shm.h b/include/linux/shm.h
-index eca6235a46c0b1b89d951a90216b132c6a21cfb7..c7417edfe6ef06ec8681b7b6dbe265f13cbef2cd 100644
---- a/include/linux/shm.h
-+++ b/include/linux/shm.h
-@@ -95,6 +95,10 @@ struct shmid_kernel /* private to the kernel */
+diff -urNp linux-2.6.26.3/include/linux/shm.h linux-2.6.26.3/include/linux/shm.h
+--- linux-2.6.26.3/include/linux/shm.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/shm.h	2008-08-09 12:03:30.000000000 -0400
+@@ -95,6 +95,10 @@ struct shmid_kernel /* private to the ke
@@ -31238,4 +30749,3 @@
-diff --git a/include/linux/slab.h b/include/linux/slab.h
-index 9aa90a6f20e02e920e883f17e7393aa0e0046400..a39b24c03bc647b9cf7cba514a3d927f04fee865 100644
---- a/include/linux/slab.h
-+++ b/include/linux/slab.h
+diff -urNp linux-2.6.26.3/include/linux/slab.h linux-2.6.26.3/include/linux/slab.h
+--- linux-2.6.26.3/include/linux/slab.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/slab.h	2008-08-09 12:03:30.000000000 -0400
@@ -31255,4 +30765,3 @@
-diff --git a/include/linux/sysctl.h b/include/linux/sysctl.h
-index 24141b4d1a116a4523ab9085e8f830cdd26cb471..fa061750e9f1cfe02f8ed0a19892a1e552739bde 100644
---- a/include/linux/sysctl.h
-+++ b/include/linux/sysctl.h
+diff -urNp linux-2.6.26.3/include/linux/sysctl.h linux-2.6.26.3/include/linux/sysctl.h
+--- linux-2.6.26.3/include/linux/sysctl.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/sysctl.h	2008-08-09 12:03:30.000000000 -0400
@@ -31282,5 +30791,4 @@
-diff --git a/include/linux/uaccess.h b/include/linux/uaccess.h
-index fec6decfb983503ec8ae24bafa793f09b5f902b2..da099cef4319498579a80aad2d1d1857d79a7820 100644
---- a/include/linux/uaccess.h
-+++ b/include/linux/uaccess.h
-@@ -76,11 +76,11 @@ static inline unsigned long __copy_from_user_nocache(void *to,
+diff -urNp linux-2.6.26.3/include/linux/uaccess.h linux-2.6.26.3/include/linux/uaccess.h
+--- linux-2.6.26.3/include/linux/uaccess.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/linux/uaccess.h	2008-08-09 12:03:30.000000000 -0400
+@@ -76,11 +76,11 @@ static inline unsigned long __copy_from_
@@ -31300,4 +30808,3 @@
-diff --git a/include/net/sctp/sctp.h b/include/net/sctp/sctp.h
-index 90b1e8d23b1638e59d45e9623d5a2f6ff81c8356..57cb4e7e9881cb654fdf195d84182ea225142e1c 100644
---- a/include/net/sctp/sctp.h
-+++ b/include/net/sctp/sctp.h
+diff -urNp linux-2.6.26.3/include/net/sctp/sctp.h linux-2.6.26.3/include/net/sctp/sctp.h
+--- linux-2.6.26.3/include/net/sctp/sctp.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/net/sctp/sctp.h	2008-08-09 12:03:30.000000000 -0400
@@ -31315,5 +30822,4 @@
-diff --git a/include/sound/core.h b/include/sound/core.h
-index 695ee53488a382ab85d90f1deb5e3b83a5fe82e6..c374e80428e282caaf659da68594d79f6623c97e 100644
---- a/include/sound/core.h
-+++ b/include/sound/core.h
-@@ -406,9 +406,9 @@ void snd_verbose_printd(const char *file, int line, const char *format, ...)
+diff -urNp linux-2.6.26.3/include/sound/core.h linux-2.6.26.3/include/sound/core.h
+--- linux-2.6.26.3/include/sound/core.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/sound/core.h	2008-08-09 12:03:30.000000000 -0400
+@@ -406,9 +406,9 @@ void snd_verbose_printd(const char *file
@@ -31331 +30837 @@
-@@ -422,7 +422,7 @@ void snd_verbose_printd(const char *file, int line, const char *format, ...)
+@@ -422,7 +422,7 @@ void snd_verbose_printd(const char *file
@@ -31340,4 +30846,3 @@
-diff --git a/include/video/uvesafb.h b/include/video/uvesafb.h
-index 95bcef19395482b089e3ea421ddb24395c394dfb..d73a2f1c0f2426a52390800e4b7aa1dfd3a35b67 100644
---- a/include/video/uvesafb.h
-+++ b/include/video/uvesafb.h
+diff -urNp linux-2.6.26.3/include/video/uvesafb.h linux-2.6.26.3/include/video/uvesafb.h
+--- linux-2.6.26.3/include/video/uvesafb.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/include/video/uvesafb.h	2008-08-09 12:03:30.000000000 -0400
@@ -31352,40 +30857,4 @@
-diff --git a/init/Kconfig b/init/Kconfig
-index 6199d1120900841ca57367cc33a01f36eff72d12..bec72028139c2e66e28a204ee9215da2b444a827 100644
---- a/init/Kconfig
-+++ b/init/Kconfig
-@@ -572,6 +572,7 @@ config SYSCTL_SYSCALL_CHECK
- config KALLSYMS
- 	 bool "Load all symbols for debugging/ksymoops" if EMBEDDED
- 	 default y
-+	 depends on !GRKERNSEC_HIDESYM
- 	 help
- 	   Say Y here to let the kernel print out symbolic crash information and
- 	   symbolic stack backtraces. This increases the size of the kernel
-@@ -791,8 +792,8 @@ config MARKERS
- source "arch/Kconfig"
- 
- config PROC_PAGE_MONITOR
-- 	default y
--	depends on PROC_FS && MMU
-+ 	default n
-+	depends on PROC_FS && MMU && !GRKERNSEC
- 	bool "Enable /proc page monitoring" if EMBEDDED
-  	help
- 	  Various /proc files exist to monitor process memory utilization:
-@@ -804,9 +805,9 @@ endmenu		# General setup
- 
- config SLABINFO
- 	bool
--	depends on PROC_FS
-+	depends on PROC_FS && !GRKERNSEC_PROC_ADD
- 	depends on SLAB || SLUB_DEBUG
--	default y
-+	default n
- 
- config RT_MUTEXES
- 	boolean
-diff --git a/init/do_mounts.c b/init/do_mounts.c
-index 660c1e50c91b7a622b2e65bf1095cd4e982b58af..d9a836ecacef831335d8de5fa63240771d9709d0 100644
---- a/init/do_mounts.c
-+++ b/init/do_mounts.c
-@@ -213,11 +213,11 @@ static void __init get_fs_names(char *page)
+diff -urNp linux-2.6.26.3/init/do_mounts.c linux-2.6.26.3/init/do_mounts.c
+--- linux-2.6.26.3/init/do_mounts.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/do_mounts.c	2008-08-09 12:03:30.000000000 -0400
+@@ -213,11 +213,11 @@ static void __init get_fs_names(char *pa
@@ -31405 +30874 @@
-@@ -303,18 +303,18 @@ void __init change_floppy(char *fmt, ...)
+@@ -303,18 +303,18 @@ void __init change_floppy(char *fmt, ...
@@ -31437,4 +30906,3 @@
-diff --git a/init/do_mounts.h b/init/do_mounts.h
-index 735705d137ff9beaf0f7866e7c804d7080183780..5146aa61420d9dc5d72d9d7d7ede91c74889e3aa 100644
---- a/init/do_mounts.h
-+++ b/init/do_mounts.h
+diff -urNp linux-2.6.26.3/init/do_mounts.h linux-2.6.26.3/init/do_mounts.h
+--- linux-2.6.26.3/init/do_mounts.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/do_mounts.h	2008-08-09 12:03:30.000000000 -0400
@@ -31460,4 +30928,3 @@
-diff --git a/init/do_mounts_md.c b/init/do_mounts_md.c
-index 693d24694a6c9f1839a4f7f2f7828f4671d16459..034b44a7ad5d96f74aba70149b54cb59523b210b 100644
---- a/init/do_mounts_md.c
-+++ b/init/do_mounts_md.c
+diff -urNp linux-2.6.26.3/init/do_mounts_md.c linux-2.6.26.3/init/do_mounts_md.c
+--- linux-2.6.26.3/init/do_mounts_md.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/do_mounts_md.c	2008-08-09 12:03:30.000000000 -0400
@@ -31491,4 +30958,3 @@
-diff --git a/init/initramfs.c b/init/initramfs.c
-index 8eeeccb328c9f984812941592258ebd72e5d96e6..b905f50abd01f04ab8bedd6fcf9b1905c4002442 100644
---- a/init/initramfs.c
-+++ b/init/initramfs.c
+diff -urNp linux-2.6.26.3/init/initramfs.c linux-2.6.26.3/init/initramfs.c
+--- linux-2.6.26.3/init/initramfs.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/initramfs.c	2008-08-09 12:03:30.000000000 -0400
@@ -31504 +30970 @@
-@@ -249,11 +249,11 @@ static void __init clean_path(char *path, mode_t mode)
+@@ -249,11 +249,11 @@ static void __init clean_path(char *path
@@ -31577,5 +31043,38 @@
-diff --git a/init/main.c b/init/main.c
-index f7fb20021d48d5a4a175cc79d84f6b3cfb9eab53..34068b6f94e22198059719a4f0b3ff20e32187fe 100644
---- a/init/main.c
-+++ b/init/main.c
-@@ -103,6 +103,7 @@ static inline void mark_rodata_ro(void) { }
+diff -urNp linux-2.6.26.3/init/Kconfig linux-2.6.26.3/init/Kconfig
+--- linux-2.6.26.3/init/Kconfig	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/Kconfig	2008-08-09 12:03:30.000000000 -0400
+@@ -572,6 +572,7 @@ config SYSCTL_SYSCALL_CHECK
+ config KALLSYMS
+ 	 bool "Load all symbols for debugging/ksymoops" if EMBEDDED
+ 	 default y
++	 depends on !GRKERNSEC_HIDESYM
+ 	 help
+ 	   Say Y here to let the kernel print out symbolic crash information and
+ 	   symbolic stack backtraces. This increases the size of the kernel
+@@ -791,8 +792,8 @@ config MARKERS
+ source "arch/Kconfig"
+ 
+ config PROC_PAGE_MONITOR
+- 	default y
+-	depends on PROC_FS && MMU
++ 	default n
++	depends on PROC_FS && MMU && !GRKERNSEC
+ 	bool "Enable /proc page monitoring" if EMBEDDED
+  	help
+ 	  Various /proc files exist to monitor process memory utilization:
+@@ -804,9 +805,9 @@ endmenu		# General setup
+ 
+ config SLABINFO
+ 	bool
+-	depends on PROC_FS
++	depends on PROC_FS && !GRKERNSEC_PROC_ADD
+ 	depends on SLAB || SLUB_DEBUG
+-	default y
++	default n
+ 
+ config RT_MUTEXES
+ 	boolean
+diff -urNp linux-2.6.26.3/init/main.c linux-2.6.26.3/init/main.c
+--- linux-2.6.26.3/init/main.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/main.c	2008-08-09 12:03:30.000000000 -0400
+@@ -103,6 +103,7 @@ static inline void mark_rodata_ro(void) 
@@ -31589 +31088 @@
-@@ -189,6 +190,40 @@ static int __init set_reset_devices(char *str)
+@@ -189,6 +190,40 @@ static int __init set_reset_devices(char
@@ -31630 +31129 @@
-@@ -387,7 +422,7 @@ static void __init setup_nr_cpu_ids(void)
+@@ -387,7 +422,7 @@ static void __init setup_nr_cpu_ids(void
@@ -31639 +31138 @@
-@@ -697,6 +732,7 @@ static void __init do_one_initcall(initcall_t fn)
+@@ -697,6 +732,7 @@ static void __init do_one_initcall(initc
@@ -31647 +31146 @@
-@@ -722,16 +758,16 @@ static void __init do_one_initcall(initcall_t fn)
+@@ -722,16 +758,16 @@ static void __init do_one_initcall(initc
@@ -31668 +31167 @@
-@@ -878,6 +914,8 @@ static int __init kernel_init(void * unused)
+@@ -878,6 +914,8 @@ static int __init kernel_init(void * unu
@@ -31677,4 +31176,3 @@
-diff --git a/init/noinitramfs.c b/init/noinitramfs.c
-index f4c1a3a1b8c52bd06dbdcadf6833b5328693b0e3..96c19bdb5fda2b6160523a2bbf7210921d421a50 100644
---- a/init/noinitramfs.c
-+++ b/init/noinitramfs.c
+diff -urNp linux-2.6.26.3/init/noinitramfs.c linux-2.6.26.3/init/noinitramfs.c
+--- linux-2.6.26.3/init/noinitramfs.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/init/noinitramfs.c	2008-08-09 12:03:30.000000000 -0400
@@ -31699,5 +31197,4 @@
-diff --git a/ipc/ipc_sysctl.c b/ipc/ipc_sysctl.c
-index d3497465cc0a5aa461dabce18b0f7af4dc537cea..1378a3965810b6ddb348a96e7a105fa48c942483 100644
---- a/ipc/ipc_sysctl.c
-+++ b/ipc/ipc_sysctl.c
-@@ -222,7 +222,7 @@ static struct ctl_table ipc_kern_table[] = {
+diff -urNp linux-2.6.26.3/ipc/ipc_sysctl.c linux-2.6.26.3/ipc/ipc_sysctl.c
+--- linux-2.6.26.3/ipc/ipc_sysctl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/ipc/ipc_sysctl.c	2008-08-09 12:03:30.000000000 -0400
+@@ -222,7 +222,7 @@ static struct ctl_table ipc_kern_table[]
@@ -31712 +31209 @@
-@@ -232,7 +232,7 @@ static struct ctl_table ipc_root_table[] = {
+@@ -232,7 +232,7 @@ static struct ctl_table ipc_root_table[]
@@ -31721,4 +31218,3 @@
-diff --git a/ipc/msg.c b/ipc/msg.c
-index b4eee1c6101d6fda19583015a8f4881bc74f8f4b..dfe1e735bab7f88501c93b9cc922c8d31f72d55a 100644
---- a/ipc/msg.c
-+++ b/ipc/msg.c
+diff -urNp linux-2.6.26.3/ipc/msg.c linux-2.6.26.3/ipc/msg.c
+--- linux-2.6.26.3/ipc/msg.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/ipc/msg.c	2008-08-09 12:03:30.000000000 -0400
@@ -31733 +31229 @@
-@@ -314,6 +315,7 @@ asmlinkage long sys_msgget(key_t key, int msgflg)
+@@ -314,6 +315,7 @@ asmlinkage long sys_msgget(key_t key, in
@@ -31741 +31237 @@
-@@ -324,7 +326,11 @@ asmlinkage long sys_msgget(key_t key, int msgflg)
+@@ -324,7 +326,11 @@ asmlinkage long sys_msgget(key_t key, in
@@ -31754 +31250 @@
-@@ -434,6 +440,7 @@ static int msgctl_down(struct ipc_namespace *ns, int msqid, int cmd,
+@@ -434,6 +440,7 @@ static int msgctl_down(struct ipc_namesp
@@ -31762,4 +31258,3 @@
-diff --git a/ipc/sem.c b/ipc/sem.c
-index e9418df5ff3ecf0c3cb3bb6e6fbac9de5fcac828..90d8a99be5dc69ac27913728c79ba1ed494d21bb 100644
---- a/ipc/sem.c
-+++ b/ipc/sem.c
+diff -urNp linux-2.6.26.3/ipc/sem.c linux-2.6.26.3/ipc/sem.c
+--- linux-2.6.26.3/ipc/sem.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/ipc/sem.c	2008-08-09 12:03:30.000000000 -0400
@@ -31774 +31269 @@
-@@ -314,6 +315,7 @@ asmlinkage long sys_semget(key_t key, int nsems, int semflg)
+@@ -314,6 +315,7 @@ asmlinkage long sys_semget(key_t key, in
@@ -31782 +31277 @@
-@@ -328,7 +330,11 @@ asmlinkage long sys_semget(key_t key, int nsems, int semflg)
+@@ -328,7 +330,11 @@ asmlinkage long sys_semget(key_t key, in
@@ -31795 +31290 @@
-@@ -876,6 +882,7 @@ static int semctl_down(struct ipc_namespace *ns, int semid,
+@@ -876,6 +882,7 @@ static int semctl_down(struct ipc_namesp
@@ -31803,4 +31298,3 @@
-diff --git a/ipc/shm.c b/ipc/shm.c
-index 790240cd067f60860957951db601dfb2fc81e373..255b5fad038b1e9b3734dd99c2cc9668c476b87b 100644
---- a/ipc/shm.c
-+++ b/ipc/shm.c
+diff -urNp linux-2.6.26.3/ipc/shm.c linux-2.6.26.3/ipc/shm.c
+--- linux-2.6.26.3/ipc/shm.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/ipc/shm.c	2008-08-09 12:03:30.000000000 -0400
@@ -31815 +31309 @@
-@@ -69,6 +70,14 @@ static void shm_destroy (struct ipc_namespace *ns, struct shmid_kernel *shp);
+@@ -69,6 +70,14 @@ static void shm_destroy (struct ipc_name
@@ -31830 +31324 @@
-@@ -87,6 +96,8 @@ static void do_shm_rmid(struct ipc_namespace *ns, struct kern_ipc_perm *ipcp)
+@@ -87,6 +96,8 @@ static void do_shm_rmid(struct ipc_names
@@ -31839 +31333 @@
-@@ -407,6 +418,14 @@ static int newseg(struct ipc_namespace *ns, struct ipc_params *params)
+@@ -407,6 +418,14 @@ static int newseg(struct ipc_namespace *
@@ -31854 +31348 @@
-@@ -460,6 +479,7 @@ asmlinkage long sys_shmget (key_t key, size_t size, int shmflg)
+@@ -460,6 +479,7 @@ asmlinkage long sys_shmget (key_t key, s
@@ -31862 +31356 @@
-@@ -471,7 +491,11 @@ asmlinkage long sys_shmget (key_t key, size_t size, int shmflg)
+@@ -471,7 +491,11 @@ asmlinkage long sys_shmget (key_t key, s
@@ -31875 +31369 @@
-@@ -883,9 +907,21 @@ long do_shmat(int shmid, char __user *shmaddr, int shmflg, ulong *raddr)
+@@ -883,9 +907,21 @@ long do_shmat(int shmid, char __user *sh
@@ -31897,5 +31391,4 @@
-diff --git a/kernel/acct.c b/kernel/acct.c
-index 91e1cfd734d286f922597108e54065ef691d31b2..2b8098ef362006cc69b9f6320bfc3356f878d6b0 100644
---- a/kernel/acct.c
-+++ b/kernel/acct.c
-@@ -519,7 +519,7 @@ static void do_acct_process(struct pid_namespace *ns, struct file *file)
+diff -urNp linux-2.6.26.3/kernel/acct.c linux-2.6.26.3/kernel/acct.c
+--- linux-2.6.26.3/kernel/acct.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/acct.c	2008-08-09 12:03:30.000000000 -0400
+@@ -519,7 +519,7 @@ static void do_acct_process(struct pid_n
@@ -31910,4 +31403,3 @@
-diff --git a/kernel/capability.c b/kernel/capability.c
-index 901e0fdc3fffa3b32fca26e0aa4e1985b244bd10..002127f85026d1cfcb6e763a14e418fcb259670d 100644
---- a/kernel/capability.c
-+++ b/kernel/capability.c
+diff -urNp linux-2.6.26.3/kernel/capability.c linux-2.6.26.3/kernel/capability.c
+--- linux-2.6.26.3/kernel/capability.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/capability.c	2008-08-09 12:03:30.000000000 -0400
@@ -31949,4 +31441,3 @@
-diff --git a/kernel/configs.c b/kernel/configs.c
-index 4c345210ed8cca3ffb1c64a9e4aef92cf97eedf8..45030e00a4870a1b95bb30f87e6876aadda442ad 100644
---- a/kernel/configs.c
-+++ b/kernel/configs.c
+diff -urNp linux-2.6.26.3/kernel/configs.c linux-2.6.26.3/kernel/configs.c
+--- linux-2.6.26.3/kernel/configs.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/configs.c	2008-08-09 12:03:30.000000000 -0400
@@ -31973,4 +31464,3 @@
-diff --git a/kernel/cpu.c b/kernel/cpu.c
-index c77bc3a1c7226b504be0a50f05136662dd464a73..9c7ec93738c054a72e564b0fc812d93557da3948 100644
---- a/kernel/cpu.c
-+++ b/kernel/cpu.c
+diff -urNp linux-2.6.26.3/kernel/cpu.c linux-2.6.26.3/kernel/cpu.c
+--- linux-2.6.26.3/kernel/cpu.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/cpu.c	2008-08-09 12:03:30.000000000 -0400
@@ -31986,4 +31476,3 @@
-diff --git a/kernel/exit.c b/kernel/exit.c
-index 8f6185e69b691265746f81a1ca4ce9de9fd8a640..2b2c06ef0bd7502a6bb177d35fe3fca6bcf528a5 100644
---- a/kernel/exit.c
-+++ b/kernel/exit.c
+diff -urNp linux-2.6.26.3/kernel/exit.c linux-2.6.26.3/kernel/exit.c
+--- linux-2.6.26.3/kernel/exit.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/exit.c	2008-08-09 12:03:30.000000000 -0400
@@ -32002 +31491 @@
-@@ -132,6 +137,7 @@ static void __exit_signal(struct task_struct *tsk)
+@@ -132,6 +137,7 @@ static void __exit_signal(struct task_st
@@ -32062 +31551 @@
-@@ -1248,7 +1279,7 @@ static int wait_task_zombie(struct task_struct *p, int noreap,
+@@ -1248,7 +1279,7 @@ static int wait_task_zombie(struct task_
@@ -32071,4 +31560,3 @@
-diff --git a/kernel/fork.c b/kernel/fork.c
-index 19908b26cf80494a0db8f3410384521081293a32..d3807ad53ea28270f40d9c33a93f8befab074eff 100644
---- a/kernel/fork.c
-+++ b/kernel/fork.c
+diff -urNp linux-2.6.26.3/kernel/fork.c linux-2.6.26.3/kernel/fork.c
+--- linux-2.6.26.3/kernel/fork.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/fork.c	2008-08-09 12:03:30.000000000 -0400
@@ -32083 +31571 @@
-@@ -213,7 +214,7 @@ static struct task_struct *dup_task_struct(struct task_struct *orig)
+@@ -213,7 +214,7 @@ static struct task_struct *dup_task_stru
@@ -32092 +31580 @@
-@@ -250,8 +251,8 @@ static int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
+@@ -250,8 +251,8 @@ static int dup_mmap(struct mm_struct *mm
@@ -32103 +31591 @@
-@@ -288,6 +289,7 @@ static int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
+@@ -288,6 +289,7 @@ static int dup_mmap(struct mm_struct *mm
@@ -32111 +31599 @@
-@@ -324,6 +326,31 @@ static int dup_mmap(struct mm_struct *mm, struct mm_struct *oldmm)
+@@ -324,6 +326,31 @@ static int dup_mmap(struct mm_struct *mm
@@ -32143 +31631 @@
-@@ -505,7 +532,7 @@ void mm_release(struct task_struct *tsk, struct mm_struct *mm)
+@@ -505,7 +532,7 @@ void mm_release(struct task_struct *tsk,
@@ -32152 +31640 @@
-@@ -513,7 +540,7 @@ void mm_release(struct task_struct *tsk, struct mm_struct *mm)
+@@ -513,7 +540,7 @@ void mm_release(struct task_struct *tsk,
@@ -32161 +31649 @@
-@@ -914,6 +941,9 @@ static struct task_struct *copy_process(unsigned long clone_flags,
+@@ -914,6 +941,9 @@ static struct task_struct *copy_process(
@@ -32171 +31659 @@
-@@ -1080,6 +1110,8 @@ static struct task_struct *copy_process(unsigned long clone_flags,
+@@ -1080,6 +1110,8 @@ static struct task_struct *copy_process(
@@ -32198,5 +31686,4 @@
-diff --git a/kernel/futex.c b/kernel/futex.c
-index 7d1136e97c142d198b897dab1846acd99f1f655f..c1da98995e81b9148ed35ec497a6609fbd0d845b 100644
---- a/kernel/futex.c
-+++ b/kernel/futex.c
-@@ -188,6 +188,11 @@ static int get_futex_key(u32 __user *uaddr, struct rw_semaphore *fshared,
+diff -urNp linux-2.6.26.3/kernel/futex.c linux-2.6.26.3/kernel/futex.c
+--- linux-2.6.26.3/kernel/futex.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/futex.c	2008-08-09 12:03:30.000000000 -0400
+@@ -188,6 +188,11 @@ static int get_futex_key(u32 __user *uad
@@ -32214 +31701 @@
-@@ -214,8 +219,8 @@ static int get_futex_key(u32 __user *uaddr, struct rw_semaphore *fshared,
+@@ -214,8 +219,8 @@ static int get_futex_key(u32 __user *uad
@@ -32234,5 +31721,4 @@
-diff --git a/kernel/irq/handle.c b/kernel/irq/handle.c
-index 5fa6198e91394a935bcb8f51d70cdef9222c261f..410bf604aa88da9e7ce390aa4b690628b12312a8 100644
---- a/kernel/irq/handle.c
-+++ b/kernel/irq/handle.c
-@@ -55,7 +55,8 @@ struct irq_desc irq_desc[NR_IRQS] __cacheline_aligned_in_smp = {
+diff -urNp linux-2.6.26.3/kernel/irq/handle.c linux-2.6.26.3/kernel/irq/handle.c
+--- linux-2.6.26.3/kernel/irq/handle.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/irq/handle.c	2008-08-09 12:03:30.000000000 -0400
+@@ -55,7 +55,8 @@ struct irq_desc irq_desc[NR_IRQS] __cach
@@ -32248,5 +31734,4 @@
-diff --git a/kernel/kallsyms.c b/kernel/kallsyms.c
-index 6fc0040f3e3abacade62c7d63f74d240974d80fe..f73033979fada98646f2e47d2f9e1a18fdfc1151 100644
---- a/kernel/kallsyms.c
-+++ b/kernel/kallsyms.c
-@@ -62,6 +62,19 @@ static inline int is_kernel_text(unsigned long addr)
+diff -urNp linux-2.6.26.3/kernel/kallsyms.c linux-2.6.26.3/kernel/kallsyms.c
+--- linux-2.6.26.3/kernel/kallsyms.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/kallsyms.c	2008-08-09 12:03:30.000000000 -0400
+@@ -62,6 +62,19 @@ static inline int is_kernel_text(unsigne
@@ -32272 +31757 @@
-@@ -366,7 +379,6 @@ static unsigned long get_ksymbol_core(struct kallsym_iter *iter)
+@@ -366,7 +379,6 @@ static unsigned long get_ksymbol_core(st
@@ -32280 +31765 @@
-@@ -450,7 +462,7 @@ static int kallsyms_open(struct inode *inode, struct file *file)
+@@ -450,7 +462,7 @@ static int kallsyms_open(struct inode *i
@@ -32289 +31774 @@
-@@ -472,7 +484,15 @@ static const struct file_operations kallsyms_operations = {
+@@ -472,7 +484,15 @@ static const struct file_operations kall
@@ -32305,4 +31790,3 @@
-diff --git a/kernel/kmod.c b/kernel/kmod.c
-index 8df97d3dfda8611423d7cac323cb9ef5dce5170c..b563303948d6f69c46071ec0a40bf0b2358acd8f 100644
---- a/kernel/kmod.c
-+++ b/kernel/kmod.c
+diff -urNp linux-2.6.26.3/kernel/kmod.c linux-2.6.26.3/kernel/kmod.c
+--- linux-2.6.26.3/kernel/kmod.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/kmod.c	2008-08-09 12:03:30.000000000 -0400
@@ -32318,5 +31802,4 @@
-diff --git a/kernel/kprobes.c b/kernel/kprobes.c
-index 1485ca8d0e00503104e81248a7c5e30b58edfb79..2fbe127e384774f11e8c5773a3d3976aadcb1ee9 100644
---- a/kernel/kprobes.c
-+++ b/kernel/kprobes.c
-@@ -174,7 +174,7 @@ kprobe_opcode_t __kprobes *get_insn_slot(void)
+diff -urNp linux-2.6.26.3/kernel/kprobes.c linux-2.6.26.3/kernel/kprobes.c
+--- linux-2.6.26.3/kernel/kprobes.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/kprobes.c	2008-08-09 12:03:30.000000000 -0400
+@@ -174,7 +174,7 @@ kprobe_opcode_t __kprobes *get_insn_slot
@@ -32331 +31814 @@
-@@ -206,7 +206,7 @@ static int __kprobes collect_one_slot(struct kprobe_insn_page *kip, int idx)
+@@ -206,7 +206,7 @@ static int __kprobes collect_one_slot(st
@@ -32340,4 +31823,3 @@
-diff --git a/kernel/lockdep.c b/kernel/lockdep.c
-index 81a4e4a3f087adfc650eb6baf2c05147f209e062..8349c34593a06759977c43a8fe33d978d52a27d6 100644
---- a/kernel/lockdep.c
-+++ b/kernel/lockdep.c
+diff -urNp linux-2.6.26.3/kernel/lockdep.c linux-2.6.26.3/kernel/lockdep.c
+--- linux-2.6.26.3/kernel/lockdep.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/lockdep.c	2008-08-09 12:03:30.000000000 -0400
@@ -32370,4 +31852,3 @@
-diff --git a/kernel/module.c b/kernel/module.c
-index 5f80478b746d4eeb1a1dc92040c1e8eacd31bc34..b015e9784b5685c37788ed7d849b8876014090d3 100644
---- a/kernel/module.c
-+++ b/kernel/module.c
+diff -urNp linux-2.6.26.3/kernel/module.c linux-2.6.26.3/kernel/module.c
+--- linux-2.6.26.3/kernel/module.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/module.c	2008-08-09 12:03:30.000000000 -0400
@@ -32386 +31867 @@
-@@ -70,6 +75,8 @@ static DECLARE_WAIT_QUEUE_HEAD(module_wq);
+@@ -70,6 +75,8 @@ static DECLARE_WAIT_QUEUE_HEAD(module_wq
@@ -32395 +31876 @@
-@@ -352,6 +359,8 @@ static inline unsigned int block_size(int val)
+@@ -352,6 +359,8 @@ static inline unsigned int block_size(in
@@ -32404 +31885 @@
-@@ -359,7 +368,7 @@ static void *percpu_modalloc(unsigned long size, unsigned long align,
+@@ -359,7 +368,7 @@ static void *percpu_modalloc(unsigned lo
@@ -32413 +31894 @@
-@@ -441,7 +450,11 @@ static void percpu_modcopy(void *pcpudest, const void *from, unsigned long size)
+@@ -441,7 +450,11 @@ static void percpu_modcopy(void *pcpudes
@@ -32425 +31906 @@
-@@ -692,6 +705,9 @@ sys_delete_module(const char __user *name_user, unsigned int flags)
+@@ -692,6 +705,9 @@ sys_delete_module(const char __user *nam
@@ -32435 +31916 @@
-@@ -1400,16 +1416,19 @@ static void free_module(struct module *mod)
+@@ -1400,16 +1416,19 @@ static void free_module(struct module *m
@@ -32458 +31939 @@
-@@ -1473,10 +1492,14 @@ static int simplify_symbols(Elf_Shdr *sechdrs,
+@@ -1473,10 +1492,14 @@ static int simplify_symbols(Elf_Shdr *se
@@ -32474 +31955 @@
-@@ -1495,10 +1518,19 @@ static int simplify_symbols(Elf_Shdr *sechdrs,
+@@ -1495,10 +1518,19 @@ static int simplify_symbols(Elf_Shdr *se
@@ -32496 +31977 @@
-@@ -1513,11 +1545,27 @@ static int simplify_symbols(Elf_Shdr *sechdrs,
+@@ -1513,11 +1545,27 @@ static int simplify_symbols(Elf_Shdr *se
@@ -32526 +32007 @@
-@@ -1569,11 +1617,14 @@ static void layout_sections(struct module *mod,
+@@ -1569,11 +1617,14 @@ static void layout_sections(struct modul
@@ -32543 +32024 @@
-@@ -1587,12 +1638,15 @@ static void layout_sections(struct module *mod,
+@@ -1587,12 +1638,15 @@ static void layout_sections(struct modul
@@ -32562 +32043 @@
-@@ -1719,14 +1773,31 @@ static void add_kallsyms(struct module *mod,
+@@ -1719,14 +1773,31 @@ static void add_kallsyms(struct module *
@@ -32597 +32078 @@
-@@ -1776,6 +1847,10 @@ static struct module *load_module(void __user *umod,
+@@ -1776,6 +1847,10 @@ static struct module *load_module(void _
@@ -32608 +32089 @@
-@@ -1935,21 +2010,57 @@ static struct module *load_module(void __user *umod,
+@@ -1935,21 +2010,57 @@ static struct module *load_module(void _
@@ -32622,3 +32103 @@
- 
--	ptr = module_alloc(mod->init_size);
--	if (!ptr && mod->init_size) {
++
@@ -32627,2 +32106 @@
- 		err = -ENOMEM;
--		goto free_core;
++		err = -ENOMEM;
@@ -32630,3 +32108 @@
- 	}
--	memset(ptr, 0, mod->init_size);
--	mod->module_init = ptr;
++	}
@@ -32641 +32117,3 @@
-+
+ 
+-	ptr = module_alloc(mod->init_size);
+-	if (!ptr && mod->init_size) {
@@ -32656 +32134,2 @@
-+		err = -ENOMEM;
+ 		err = -ENOMEM;
+-		goto free_core;
@@ -32658 +32137,3 @@
-+	}
+ 	}
+-	memset(ptr, 0, mod->init_size);
+-	mod->module_init = ptr;
@@ -32674 +32155 @@
-@@ -1959,17 +2070,41 @@ static struct module *load_module(void __user *umod,
+@@ -1959,17 +2070,41 @@ static struct module *load_module(void _
@@ -32695,0 +32177,2 @@
++
++		if (sechdrs[i].sh_type != SHT_NOBITS) {
@@ -32700,2 +32182,0 @@
-+		if (sechdrs[i].sh_type != SHT_NOBITS) {
-+
@@ -32725 +32206 @@
-@@ -2112,12 +2247,12 @@ static struct module *load_module(void __user *umod,
+@@ -2112,12 +2247,12 @@ static struct module *load_module(void _
@@ -32744 +32225 @@
-@@ -2170,9 +2305,13 @@ static struct module *load_module(void __user *umod,
+@@ -2170,9 +2305,13 @@ static struct module *load_module(void _
@@ -32802 +32283 @@
-@@ -2286,10 +2437,14 @@ static const char *get_ksymbol(struct module *mod,
+@@ -2286,10 +2437,14 @@ static const char *get_ksymbol(struct mo
@@ -32820 +32301 @@
-@@ -2334,8 +2489,10 @@ const char *module_address_lookup(unsigned long addr,
+@@ -2334,8 +2489,10 @@ const char *module_address_lookup(unsign
@@ -32833 +32314 @@
-@@ -2357,8 +2514,10 @@ int lookup_module_symbol_name(unsigned long addr, char *symname)
+@@ -2357,8 +2514,10 @@ int lookup_module_symbol_name(unsigned l
@@ -32846 +32327 @@
-@@ -2381,8 +2540,10 @@ int lookup_module_symbol_attrs(unsigned long addr, unsigned long *size,
+@@ -2381,8 +2540,10 @@ int lookup_module_symbol_attrs(unsigned 
@@ -32859 +32340 @@
-@@ -2513,7 +2674,7 @@ static int m_show(struct seq_file *m, void *p)
+@@ -2513,7 +2674,7 @@ static int m_show(struct seq_file *m, vo
@@ -32868 +32349 @@
-@@ -2522,7 +2683,7 @@ static int m_show(struct seq_file *m, void *p)
+@@ -2522,7 +2683,7 @@ static int m_show(struct seq_file *m, vo
@@ -32877 +32358 @@
-@@ -2578,7 +2739,8 @@ int is_module_address(unsigned long addr)
+@@ -2578,7 +2739,8 @@ int is_module_address(unsigned long addr
@@ -32887 +32368 @@
-@@ -2596,8 +2758,8 @@ struct module *__module_text_address(unsigned long addr)
+@@ -2596,8 +2758,8 @@ struct module *__module_text_address(uns
@@ -32898,5 +32379,4 @@
-diff --git a/kernel/mutex.c b/kernel/mutex.c
-index d046a345d365793e84076e2517ec02cdd11bc40d..4c5d625d52d5c212f22c2f67942c8907fa30598f 100644
---- a/kernel/mutex.c
-+++ b/kernel/mutex.c
-@@ -82,7 +82,7 @@ __mutex_lock_slowpath(atomic_t *lock_count);
+diff -urNp linux-2.6.26.3/kernel/mutex.c linux-2.6.26.3/kernel/mutex.c
+--- linux-2.6.26.3/kernel/mutex.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/mutex.c	2008-08-09 12:03:30.000000000 -0400
+@@ -82,7 +82,7 @@ __mutex_lock_slowpath(atomic_t *lock_cou
@@ -32911,4 +32391,3 @@
-diff --git a/kernel/panic.c b/kernel/panic.c
-index 425567f45b9f776148f1767b2f4af2d357a0c2fd..2bb7637790f2e7f65c61602c4f6c91948957cf06 100644
---- a/kernel/panic.c
-+++ b/kernel/panic.c
+diff -urNp linux-2.6.26.3/kernel/panic.c linux-2.6.26.3/kernel/panic.c
+--- linux-2.6.26.3/kernel/panic.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/panic.c	2008-08-09 12:03:30.000000000 -0400
@@ -32924,4 +32403,3 @@
-diff --git a/kernel/pid.c b/kernel/pid.c
-index 20d59fa2d493c7a20b83ff151745e38a847e0366..52e46f3e5cbca5dec3e48d7303ab3a29d4348ce4 100644
---- a/kernel/pid.c
-+++ b/kernel/pid.c
+diff -urNp linux-2.6.26.3/kernel/pid.c linux-2.6.26.3/kernel/pid.c
+--- linux-2.6.26.3/kernel/pid.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/pid.c	2008-08-09 12:03:30.000000000 -0400
@@ -32936 +32414 @@
-@@ -44,7 +45,7 @@ struct pid init_struct_pid = INIT_STRUCT_PID;
+@@ -44,7 +45,7 @@ struct pid init_struct_pid = INIT_STRUCT
@@ -32961,4 +32439,3 @@
-diff --git a/kernel/posix-cpu-timers.c b/kernel/posix-cpu-timers.c
-index f1525ad06cb3ebbb83680b2bc0176854002217ca..2c4ee6752d72e992611c377a5dedde5d816a1b10 100644
---- a/kernel/posix-cpu-timers.c
-+++ b/kernel/posix-cpu-timers.c
+diff -urNp linux-2.6.26.3/kernel/posix-cpu-timers.c linux-2.6.26.3/kernel/posix-cpu-timers.c
+--- linux-2.6.26.3/kernel/posix-cpu-timers.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/posix-cpu-timers.c	2008-08-09 12:03:30.000000000 -0400
@@ -32973 +32450 @@
-@@ -1173,6 +1174,7 @@ static void check_process_timers(struct task_struct *tsk,
+@@ -1173,6 +1174,7 @@ static void check_process_timers(struct 
@@ -32981,5 +32458,4 @@
-diff --git a/kernel/power/poweroff.c b/kernel/power/poweroff.c
-index 678ec736076b1395b4a16949cb5f595b72bdd616..52e2ef1eaa526a41abf68e667e104b510568998c 100644
---- a/kernel/power/poweroff.c
-+++ b/kernel/power/poweroff.c
-@@ -35,7 +35,7 @@ static struct sysrq_key_op	sysrq_poweroff_op = {
+diff -urNp linux-2.6.26.3/kernel/power/poweroff.c linux-2.6.26.3/kernel/power/poweroff.c
+--- linux-2.6.26.3/kernel/power/poweroff.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/power/poweroff.c	2008-08-09 12:03:30.000000000 -0400
+@@ -35,7 +35,7 @@ static struct sysrq_key_op	sysrq_powerof
@@ -32994,4 +32470,3 @@
-diff --git a/kernel/printk.c b/kernel/printk.c
-index e2129e83fd75b8d0c708a7c410005015e0cba564..c8c086337c258329bd9a08801d7781081ab9ab61 100644
---- a/kernel/printk.c
-+++ b/kernel/printk.c
+diff -urNp linux-2.6.26.3/kernel/printk.c linux-2.6.26.3/kernel/printk.c
+--- linux-2.6.26.3/kernel/printk.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/printk.c	2008-08-09 12:03:30.000000000 -0400
@@ -33006 +32481 @@
-@@ -302,6 +303,11 @@ int do_syslog(int type, char __user *buf, int len)
+@@ -302,6 +303,11 @@ int do_syslog(int type, char __user *buf
@@ -33018,4 +32493,3 @@
-diff --git a/kernel/ptrace.c b/kernel/ptrace.c
-index 6c19e94fd0a5482786e432599a0fb4840a5c66cb..8a46e4595b8ad26b6dcaf3776e73bab69cbdf258 100644
---- a/kernel/ptrace.c
-+++ b/kernel/ptrace.c
+diff -urNp linux-2.6.26.3/kernel/ptrace.c linux-2.6.26.3/kernel/ptrace.c
+--- linux-2.6.26.3/kernel/ptrace.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/ptrace.c	2008-08-09 12:03:30.000000000 -0400
@@ -33030 +32504 @@
-@@ -140,12 +141,12 @@ int __ptrace_may_attach(struct task_struct *task)
+@@ -140,12 +141,12 @@ int __ptrace_may_attach(struct task_stru
@@ -33054 +32528 @@
-@@ -571,6 +572,11 @@ asmlinkage long sys_ptrace(long request, long pid, long addr, long data)
+@@ -571,6 +572,11 @@ asmlinkage long sys_ptrace(long request,
@@ -33066,5 +32540,4 @@
-diff --git a/kernel/relay.c b/kernel/relay.c
-index f5a5a960e95d624d03f819c611abd13b45fc269c..b2f5195ca525879c3382b9d3245c0cd6e96b2440 100644
---- a/kernel/relay.c
-+++ b/kernel/relay.c
-@@ -1179,7 +1179,7 @@ static int subbuf_splice_actor(struct file *in,
+diff -urNp linux-2.6.26.3/kernel/relay.c linux-2.6.26.3/kernel/relay.c
+--- linux-2.6.26.3/kernel/relay.c	2008-08-09 13:05:27.000000000 -0400
++++ linux-2.6.26.3/kernel/relay.c	2008-08-09 13:05:38.000000000 -0400
+@@ -1179,7 +1179,7 @@ static int subbuf_splice_actor(struct fi
@@ -33079,5 +32552,4 @@
-diff --git a/kernel/resource.c b/kernel/resource.c
-index 74af2d7cb5a135ffa1da4c52ce9af026c527044d..a05e30a0d2a6ce9517768409bdbde49b4cc67bc9 100644
---- a/kernel/resource.c
-+++ b/kernel/resource.c
-@@ -131,8 +131,18 @@ static const struct file_operations proc_iomem_operations = {
+diff -urNp linux-2.6.26.3/kernel/resource.c linux-2.6.26.3/kernel/resource.c
+--- linux-2.6.26.3/kernel/resource.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/resource.c	2008-08-09 12:03:30.000000000 -0400
+@@ -131,8 +131,18 @@ static const struct file_operations proc
@@ -33102,4 +32574,3 @@
-diff --git a/kernel/sched.c b/kernel/sched.c
-index 4e2f6033565687f648cbd27e8976ea6c647217fa..3b22328661bcc2e90461313011b559f569db569e 100644
---- a/kernel/sched.c
-+++ b/kernel/sched.c
+diff -urNp linux-2.6.26.3/kernel/sched.c linux-2.6.26.3/kernel/sched.c
+--- linux-2.6.26.3/kernel/sched.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/sched.c	2008-08-09 12:03:30.000000000 -0400
@@ -33133 +32604 @@
-@@ -5912,7 +5914,7 @@ static struct ctl_table sd_ctl_root[] = {
+@@ -5912,7 +5914,7 @@ static struct ctl_table sd_ctl_root[] = 
@@ -33142,4 +32613,3 @@
-diff --git a/kernel/signal.c b/kernel/signal.c
-index c5bf0c0df658b69c493ab7de922832e89cc991fa..3db92fac9d4a2e6b1887872c4daac7ef4869d7c3 100644
---- a/kernel/signal.c
-+++ b/kernel/signal.c
+diff -urNp linux-2.6.26.3/kernel/signal.c linux-2.6.26.3/kernel/signal.c
+--- linux-2.6.26.3/kernel/signal.c	2008-08-09 13:05:27.000000000 -0400
++++ linux-2.6.26.3/kernel/signal.c	2008-08-09 13:05:39.000000000 -0400
@@ -33154 +32624 @@
-@@ -597,6 +598,9 @@ static int check_kill_permission(int sig, struct siginfo *info,
+@@ -597,6 +598,9 @@ static int check_kill_permission(int sig
@@ -33164 +32634 @@
-@@ -912,7 +916,7 @@ __group_send_sig_info(int sig, struct siginfo *info, struct task_struct *p)
+@@ -912,7 +916,7 @@ __group_send_sig_info(int sig, struct si
@@ -33173 +32643 @@
-@@ -950,8 +954,12 @@ force_sig_info(int sig, struct siginfo *info, struct task_struct *t)
+@@ -950,8 +954,12 @@ force_sig_info(int sig, struct siginfo *
@@ -33186 +32656 @@
-@@ -1022,6 +1030,8 @@ int group_send_sig_info(int sig, struct siginfo *info, struct task_struct *p)
+@@ -1022,6 +1030,8 @@ int group_send_sig_info(int sig, struct 
@@ -33195,5 +32665,4 @@
-diff --git a/kernel/softirq.c b/kernel/softirq.c
-index 36e0617400470f398700376c7fa3359d768e7e58..51f2587b79c3d8ff1f593f7a7e274a6bf67ecd32 100644
---- a/kernel/softirq.c
-+++ b/kernel/softirq.c
-@@ -482,9 +482,9 @@ void tasklet_kill(struct tasklet_struct *t)
+diff -urNp linux-2.6.26.3/kernel/softirq.c linux-2.6.26.3/kernel/softirq.c
+--- linux-2.6.26.3/kernel/softirq.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/softirq.c	2008-08-09 12:03:30.000000000 -0400
+@@ -482,9 +482,9 @@ void tasklet_kill(struct tasklet_struct 
@@ -33211,4 +32680,3 @@
-diff --git a/kernel/sys.c b/kernel/sys.c
-index 14e97282eb6c941605913dc68c2d4e2778cbe3b6..d9ca3ba0bed52735bda954010706b3a0d1caf0a4 100644
---- a/kernel/sys.c
-+++ b/kernel/sys.c
+diff -urNp linux-2.6.26.3/kernel/sys.c linux-2.6.26.3/kernel/sys.c
+--- linux-2.6.26.3/kernel/sys.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/sys.c	2008-08-09 12:03:30.000000000 -0400
@@ -33223 +32691 @@
-@@ -125,6 +126,12 @@ static int set_one_prio(struct task_struct *p, int niceval, int error)
+@@ -125,6 +126,12 @@ static int set_one_prio(struct task_stru
@@ -33236 +32704 @@
-@@ -181,10 +188,10 @@ asmlinkage long sys_setpriority(int which, int who, int niceval)
+@@ -181,10 +188,10 @@ asmlinkage long sys_setpriority(int whic
@@ -33249 +32717 @@
-@@ -243,13 +250,13 @@ asmlinkage long sys_getpriority(int which, int who)
+@@ -243,13 +250,13 @@ asmlinkage long sys_getpriority(int whic
@@ -33265 +32733 @@
-@@ -514,6 +521,10 @@ asmlinkage long sys_setregid(gid_t rgid, gid_t egid)
+@@ -514,6 +521,10 @@ asmlinkage long sys_setregid(gid_t rgid,
@@ -33276 +32744 @@
-@@ -521,6 +532,9 @@ asmlinkage long sys_setregid(gid_t rgid, gid_t egid)
+@@ -521,6 +532,9 @@ asmlinkage long sys_setregid(gid_t rgid,
@@ -33304 +32772 @@
-@@ -585,6 +605,9 @@ static int set_user(uid_t new_ruid, int dumpclear)
+@@ -585,6 +605,9 @@ static int set_user(uid_t new_ruid, int 
@@ -33314 +32782 @@
-@@ -634,6 +657,9 @@ asmlinkage long sys_setreuid(uid_t ruid, uid_t euid)
+@@ -634,6 +657,9 @@ asmlinkage long sys_setreuid(uid_t ruid,
@@ -33337 +32805 @@
-@@ -727,6 +759,10 @@ asmlinkage long sys_setresuid(uid_t ruid, uid_t euid, uid_t suid)
+@@ -727,6 +759,10 @@ asmlinkage long sys_setresuid(uid_t ruid
@@ -33348 +32816 @@
-@@ -781,6 +817,10 @@ asmlinkage long sys_setresgid(gid_t rgid, gid_t egid, gid_t sgid)
+@@ -781,6 +817,10 @@ asmlinkage long sys_setresgid(gid_t rgid
@@ -33359 +32827 @@
-@@ -789,8 +829,10 @@ asmlinkage long sys_setresgid(gid_t rgid, gid_t egid, gid_t sgid)
+@@ -789,8 +829,10 @@ asmlinkage long sys_setresgid(gid_t rgid
@@ -33391 +32859 @@
-@@ -938,7 +986,10 @@ asmlinkage long sys_setpgid(pid_t pid, pid_t pgid)
+@@ -938,7 +986,10 @@ asmlinkage long sys_setpgid(pid_t pid, p
@@ -33403 +32871 @@
-@@ -1672,7 +1723,7 @@ asmlinkage long sys_prctl(int option, unsigned long arg2, unsigned long arg3,
+@@ -1672,7 +1723,7 @@ asmlinkage long sys_prctl(int option, un
@@ -33412,4 +32880,3 @@
-diff --git a/kernel/sysctl.c b/kernel/sysctl.c
-index 29116652dca825943ed7cb8e70350108542ce641..07c04cde7b9e49c6bf353bd42d6b4144ed11c2fb 100644
---- a/kernel/sysctl.c
-+++ b/kernel/sysctl.c
+diff -urNp linux-2.6.26.3/kernel/sysctl.c linux-2.6.26.3/kernel/sysctl.c
+--- linux-2.6.26.3/kernel/sysctl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/sysctl.c	2008-08-09 12:03:30.000000000 -0400
@@ -33430 +32897 @@
-@@ -152,6 +159,7 @@ static int proc_do_cad_pid(struct ctl_table *table, int write, struct file *filp
+@@ -152,6 +159,7 @@ static int proc_do_cad_pid(struct ctl_ta
@@ -33502 +32969 @@
-@@ -1472,6 +1516,8 @@ static int do_sysctl_strategy(struct ctl_table_root *root,
+@@ -1472,6 +1516,8 @@ static int do_sysctl_strategy(struct ctl
@@ -33520 +32987 @@
-@@ -1575,6 +1621,33 @@ int sysctl_perm(struct ctl_table_root *root, struct ctl_table *table, int op)
+@@ -1575,6 +1621,33 @@ int sysctl_perm(struct ctl_table_root *r
@@ -33554,4 +33021,3 @@
-diff --git a/kernel/time.c b/kernel/time.c
-index 6a08660b4fac30f97ea573b9cd017941401046ff..7af6230537db257b00563af769764deb430f3ea8 100644
---- a/kernel/time.c
-+++ b/kernel/time.c
+diff -urNp linux-2.6.26.3/kernel/time.c linux-2.6.26.3/kernel/time.c
+--- linux-2.6.26.3/kernel/time.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/time.c	2008-08-09 12:03:30.000000000 -0400
@@ -33566 +33032 @@
-@@ -92,6 +93,9 @@ asmlinkage long sys_stime(time_t __user *tptr)
+@@ -92,6 +93,9 @@ asmlinkage long sys_stime(time_t __user 
@@ -33576 +33042 @@
-@@ -200,6 +204,8 @@ asmlinkage long sys_settimeofday(struct timeval __user *tv,
+@@ -200,6 +204,8 @@ asmlinkage long sys_settimeofday(struct 
@@ -33594 +33060 @@
-@@ -254,7 +260,7 @@ unsigned int inline jiffies_to_msecs(const unsigned long j)
+@@ -254,7 +260,7 @@ unsigned int inline jiffies_to_msecs(con
@@ -33603,5 +33069,4 @@
-diff --git a/kernel/utsname_sysctl.c b/kernel/utsname_sysctl.c
-index fe3a56c2256d7ee44e46813aeee597559ba29131..e4b72c2aff4e9d93e7f88ce3c47e50e0bba21b45 100644
---- a/kernel/utsname_sysctl.c
-+++ b/kernel/utsname_sysctl.c
-@@ -125,7 +125,7 @@ static struct ctl_table uts_kern_table[] = {
+diff -urNp linux-2.6.26.3/kernel/utsname_sysctl.c linux-2.6.26.3/kernel/utsname_sysctl.c
+--- linux-2.6.26.3/kernel/utsname_sysctl.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/kernel/utsname_sysctl.c	2008-08-09 12:03:30.000000000 -0400
+@@ -125,7 +125,7 @@ static struct ctl_table uts_kern_table[]
@@ -33616 +33081 @@
-@@ -135,7 +135,7 @@ static struct ctl_table uts_root_table[] = {
+@@ -135,7 +135,7 @@ static struct ctl_table uts_root_table[]
@@ -33625,4 +33090,3 @@
-diff --git a/lib/radix-tree.c b/lib/radix-tree.c
-index 56ec21a7f73dc09fb64dc395ee4297b04907d649..a73af59afa38e4a3a54dea82c104d543d8dc222f 100644
---- a/lib/radix-tree.c
-+++ b/lib/radix-tree.c
+diff -urNp linux-2.6.26.3/lib/radix-tree.c linux-2.6.26.3/lib/radix-tree.c
+--- linux-2.6.26.3/lib/radix-tree.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/lib/radix-tree.c	2008-08-09 12:03:30.000000000 -0400
@@ -33638,5 +33102,3 @@
-diff --git a/localversion-grsec b/localversion-grsec
-new file mode 100644
-index 0000000000000000000000000000000000000000..7cd6065beb8d6e5457afdf0c5f79c1ca740fcb7e
---- /dev/null
-+++ b/localversion-grsec
+diff -urNp linux-2.6.26.3/localversion-grsec linux-2.6.26.3/localversion-grsec
+--- linux-2.6.26.3/localversion-grsec	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/localversion-grsec	2008-08-09 12:03:30.000000000 -0400
@@ -33645,4 +33107,24 @@
-diff --git a/mm/filemap.c b/mm/filemap.c
-index afb991a79fc79f94703abc5f46257c235c97a330..3ceb9f36e5182abad4141cf1eeed2d032d588dcc 100644
---- a/mm/filemap.c
-+++ b/mm/filemap.c
+diff -urNp linux-2.6.26.3/Makefile linux-2.6.26.3/Makefile
+--- linux-2.6.26.3/Makefile	2008-08-09 13:05:25.000000000 -0400
++++ linux-2.6.26.3/Makefile	2008-08-09 13:05:37.000000000 -0400
+@@ -214,7 +214,7 @@ CONFIG_SHELL := $(shell if [ -x "$$BASH"
+ 
+ HOSTCC       = gcc
+ HOSTCXX      = g++
+-HOSTCFLAGS   = -Wall -Wstrict-prototypes -O2 -fomit-frame-pointer
++HOSTCFLAGS   = -Wall -W -Wno-unused -Wno-sign-compare -Wstrict-prototypes -O2 -fomit-frame-pointer
+ HOSTCXXFLAGS = -O2
+ 
+ # Decide whether to build built-in, modular, or both.
+@@ -607,7 +607,7 @@ export mod_strip_cmd
+ 
+ 
+ ifeq ($(KBUILD_EXTMOD),)
+-core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
++core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ grsecurity/
+ 
+ vmlinux-dirs	:= $(patsubst %/,%,$(filter %/, $(init-y) $(init-m) \
+ 		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \
+diff -urNp linux-2.6.26.3/mm/filemap.c linux-2.6.26.3/mm/filemap.c
+--- linux-2.6.26.3/mm/filemap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/filemap.c	2008-08-09 12:03:30.000000000 -0400
@@ -33657 +33139 @@
-@@ -1488,7 +1489,7 @@ int generic_file_mmap(struct file * file, struct vm_area_struct * vma)
+@@ -1488,7 +1489,7 @@ int generic_file_mmap(struct file * file
@@ -33666 +33148 @@
-@@ -1848,6 +1849,7 @@ inline int generic_write_checks(struct file *file, loff_t *pos, size_t *count, i
+@@ -1848,6 +1849,7 @@ inline int generic_write_checks(struct f
@@ -33674,5 +33156,4 @@
-diff --git a/mm/fremap.c b/mm/fremap.c
-index 07a9c82ce1a3fa0e24da2f2da23e9416e3f1819c..63257e7c09a89b8baa8f9b69ff714f3e35ac6f61 100644
---- a/mm/fremap.c
-+++ b/mm/fremap.c
-@@ -150,6 +150,13 @@ asmlinkage long sys_remap_file_pages(unsigned long start, unsigned long size,
+diff -urNp linux-2.6.26.3/mm/fremap.c linux-2.6.26.3/mm/fremap.c
+--- linux-2.6.26.3/mm/fremap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/fremap.c	2008-08-09 12:03:30.000000000 -0400
+@@ -150,6 +150,13 @@ asmlinkage long sys_remap_file_pages(uns
@@ -33692,5 +33173,4 @@
-diff --git a/mm/hugetlb.c b/mm/hugetlb.c
-index ab171274ef217817291667bee226b45bebe259e3..aae54eba7806c97dab5b3ca123bb77723b28cd02 100644
---- a/mm/hugetlb.c
-+++ b/mm/hugetlb.c
-@@ -867,6 +867,26 @@ void unmap_hugepage_range(struct vm_area_struct *vma, unsigned long start,
+diff -urNp linux-2.6.26.3/mm/hugetlb.c linux-2.6.26.3/mm/hugetlb.c
+--- linux-2.6.26.3/mm/hugetlb.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/hugetlb.c	2008-08-09 12:03:30.000000000 -0400
+@@ -867,6 +867,26 @@ void unmap_hugepage_range(struct vm_area
@@ -33723 +33203 @@
-@@ -902,6 +922,11 @@ static int hugetlb_cow(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -902,6 +922,11 @@ static int hugetlb_cow(struct mm_struct 
@@ -33746 +33226 @@
-@@ -999,6 +1028,27 @@ int hugetlb_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -999,6 +1028,27 @@ int hugetlb_fault(struct mm_struct *mm, 
@@ -33774,5 +33254,4 @@
-diff --git a/mm/madvise.c b/mm/madvise.c
-index 23a0ec3e0ea07bb0f37a001bc1f7e5a683172c22..cca62b473be6f5674b2167866cc46fb152eb4a12 100644
---- a/mm/madvise.c
-+++ b/mm/madvise.c
-@@ -43,6 +43,10 @@ static long madvise_behavior(struct vm_area_struct * vma,
+diff -urNp linux-2.6.26.3/mm/madvise.c linux-2.6.26.3/mm/madvise.c
+--- linux-2.6.26.3/mm/madvise.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/madvise.c	2008-08-09 12:03:30.000000000 -0400
+@@ -43,6 +43,10 @@ static long madvise_behavior(struct vm_a
@@ -33803 +33282 @@
-@@ -236,6 +247,17 @@ madvise_vma(struct vm_area_struct *vma, struct vm_area_struct **prev,
+@@ -236,6 +247,17 @@ madvise_vma(struct vm_area_struct *vma, 
@@ -33821 +33300 @@
-@@ -308,6 +330,16 @@ asmlinkage long sys_madvise(unsigned long start, size_t len_in, int behavior)
+@@ -308,6 +330,16 @@ asmlinkage long sys_madvise(unsigned lon
@@ -33838,4 +33317,3 @@
-diff --git a/mm/memory.c b/mm/memory.c
-index 0755c52a817725f675c453ac507c260b1b35288f..65d15eb4be4cac7f4bf26fbde41b0a15a83e6763 100644
---- a/mm/memory.c
-+++ b/mm/memory.c
+diff -urNp linux-2.6.26.3/mm/memory.c linux-2.6.26.3/mm/memory.c
+--- linux-2.6.26.3/mm/memory.c	2008-08-09 13:05:27.000000000 -0400
++++ linux-2.6.26.3/mm/memory.c	2008-08-09 13:05:39.000000000 -0400
@@ -33850 +33328 @@
-@@ -1082,11 +1083,11 @@ int get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
+@@ -1082,11 +1083,11 @@ int get_user_pages(struct task_struct *t
@@ -33864 +33342 @@
-@@ -1126,7 +1127,7 @@ int get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
+@@ -1126,7 +1127,7 @@ int get_user_pages(struct task_struct *t
@@ -33873 +33351 @@
-@@ -1199,7 +1200,7 @@ int get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
+@@ -1199,7 +1200,7 @@ int get_user_pages(struct task_struct *t
@@ -33882 +33360 @@
-@@ -1668,6 +1669,186 @@ static inline void cow_user_page(struct page *dst, struct page *src, unsigned lo
+@@ -1668,6 +1669,186 @@ static inline void cow_user_page(struct 
@@ -34093 +33571 @@
-@@ -2103,6 +2294,7 @@ int vmtruncate(struct inode * inode, loff_t offset)
+@@ -2103,6 +2294,7 @@ int vmtruncate(struct inode * inode, lof
@@ -34101 +33579 @@
-@@ -2253,6 +2445,11 @@ static int do_swap_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2253,6 +2445,11 @@ static int do_swap_page(struct mm_struct
@@ -34113 +33591 @@
-@@ -2264,6 +2461,11 @@ static int do_swap_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2264,6 +2461,11 @@ static int do_swap_page(struct mm_struct
@@ -34125 +33603 @@
-@@ -2308,6 +2510,12 @@ static int do_anonymous_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2308,6 +2510,12 @@ static int do_anonymous_page(struct mm_s
@@ -34138 +33616 @@
-@@ -2315,6 +2523,11 @@ static int do_anonymous_page(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2315,6 +2523,11 @@ static int do_anonymous_page(struct mm_s
@@ -34150 +33628 @@
-@@ -2443,6 +2656,12 @@ static int __do_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2443,6 +2656,12 @@ static int __do_fault(struct mm_struct *
@@ -34163 +33641 @@
-@@ -2463,6 +2682,14 @@ static int __do_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2463,6 +2682,14 @@ static int __do_fault(struct mm_struct *
@@ -34178 +33656 @@
-@@ -2549,6 +2776,11 @@ static noinline int do_no_pfn(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2549,6 +2776,11 @@ static noinline int do_no_pfn(struct mm_
@@ -34190 +33668 @@
-@@ -2651,6 +2883,12 @@ static inline int handle_pte_fault(struct mm_struct *mm,
+@@ -2651,6 +2883,12 @@ static inline int handle_pte_fault(struc
@@ -34203 +33681 @@
-@@ -2667,6 +2905,10 @@ int handle_mm_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2667,6 +2905,10 @@ int handle_mm_fault(struct mm_struct *mm
@@ -34214 +33692 @@
-@@ -2674,6 +2916,34 @@ int handle_mm_fault(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -2674,6 +2916,34 @@ int handle_mm_fault(struct mm_struct *mm
@@ -34258,5 +33736,4 @@
-diff --git a/mm/mempolicy.c b/mm/mempolicy.c
-index c94e58b192c3c9913f4f4ab57860b6ac9469f839..905e3dbbc4f9384b75d6b78a48c2de44abedc4b1 100644
---- a/mm/mempolicy.c
-+++ b/mm/mempolicy.c
-@@ -555,6 +555,10 @@ static int mbind_range(struct vm_area_struct *vma, unsigned long start,
+diff -urNp linux-2.6.26.3/mm/mempolicy.c linux-2.6.26.3/mm/mempolicy.c
+--- linux-2.6.26.3/mm/mempolicy.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/mempolicy.c	2008-08-09 12:03:30.000000000 -0400
+@@ -555,6 +555,10 @@ static int mbind_range(struct vm_area_st
@@ -34273 +33750 @@
-@@ -566,6 +570,16 @@ static int mbind_range(struct vm_area_struct *vma, unsigned long start,
+@@ -566,6 +570,16 @@ static int mbind_range(struct vm_area_st
@@ -34290 +33767 @@
-@@ -952,6 +966,17 @@ static long do_mbind(unsigned long start, unsigned long len,
+@@ -952,6 +966,17 @@ static long do_mbind(unsigned long start
@@ -34308,4 +33785,3 @@
-diff --git a/mm/mlock.c b/mm/mlock.c
-index 01fbe93eff5ca25f1143b1295da6ce7115e00bde..16068cbba3a5b79bf8c5d0c42a0b414a33606a5c 100644
---- a/mm/mlock.c
-+++ b/mm/mlock.c
+diff -urNp linux-2.6.26.3/mm/mlock.c linux-2.6.26.3/mm/mlock.c
+--- linux-2.6.26.3/mm/mlock.c	2008-08-09 13:05:27.000000000 -0400
++++ linux-2.6.26.3/mm/mlock.c	2008-08-09 13:05:39.000000000 -0400
@@ -34320 +33796 @@
-@@ -93,6 +94,17 @@ static int do_mlock(unsigned long start, size_t len, int on)
+@@ -93,6 +94,17 @@ static int do_mlock(unsigned long start,
@@ -34338 +33814 @@
-@@ -150,6 +162,7 @@ asmlinkage long sys_mlock(unsigned long start, size_t len)
+@@ -150,6 +162,7 @@ asmlinkage long sys_mlock(unsigned long 
@@ -34346 +33822 @@
-@@ -171,10 +184,10 @@ asmlinkage long sys_munlock(unsigned long start, size_t len)
+@@ -171,10 +184,10 @@ asmlinkage long sys_munlock(unsigned lon
@@ -34380,4 +33856,3 @@
-diff --git a/mm/mmap.c b/mm/mmap.c
-index 3354fdd83d4bde726d7bb2d2a0951debd4cbc51b..77787dc644f4f5608f2f69c239cf1261cb5008cb 100644
---- a/mm/mmap.c
-+++ b/mm/mmap.c
+diff -urNp linux-2.6.26.3/mm/mmap.c linux-2.6.26.3/mm/mmap.c
+--- linux-2.6.26.3/mm/mmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/mmap.c	2008-08-09 12:03:30.000000000 -0400
@@ -34409 +33884 @@
-@@ -65,15 +76,23 @@ static void unmap_region(struct mm_struct *mm,
+@@ -65,15 +76,23 @@ static void unmap_region(struct mm_struc
@@ -34436 +33911 @@
-@@ -228,6 +247,7 @@ static struct vm_area_struct *remove_vma(struct vm_area_struct *vma)
+@@ -228,6 +247,7 @@ static struct vm_area_struct *remove_vma
@@ -34444 +33919 @@
-@@ -264,6 +284,7 @@ asmlinkage unsigned long sys_brk(unsigned long brk)
+@@ -264,6 +284,7 @@ asmlinkage unsigned long sys_brk(unsigne
@@ -34452 +33927 @@
-@@ -365,8 +386,12 @@ find_vma_prepare(struct mm_struct *mm, unsigned long addr,
+@@ -365,8 +386,12 @@ find_vma_prepare(struct mm_struct *mm, u
@@ -34493 +33968 @@
-@@ -754,12 +791,19 @@ can_vma_merge_after(struct vm_area_struct *vma, unsigned long vm_flags,
+@@ -754,12 +791,19 @@ can_vma_merge_after(struct vm_area_struc
@@ -34514 +33989 @@
-@@ -775,6 +819,15 @@ struct vm_area_struct *vma_merge(struct mm_struct *mm,
+@@ -775,6 +819,15 @@ struct vm_area_struct *vma_merge(struct 
@@ -34530 +34005 @@
-@@ -794,9 +847,24 @@ struct vm_area_struct *vma_merge(struct mm_struct *mm,
+@@ -794,9 +847,24 @@ struct vm_area_struct *vma_merge(struct 
@@ -34556 +34031 @@
-@@ -807,12 +875,27 @@ struct vm_area_struct *vma_merge(struct mm_struct *mm,
+@@ -807,12 +875,27 @@ struct vm_area_struct *vma_merge(struct 
@@ -34602 +34077 @@
-@@ -922,7 +1002,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -922,7 +1002,7 @@ unsigned long do_mmap_pgoff(struct file 
@@ -34611 +34086 @@
-@@ -932,15 +1012,15 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -932,15 +1012,15 @@ unsigned long do_mmap_pgoff(struct file 
@@ -34631 +34106 @@
-@@ -952,7 +1032,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -952,7 +1032,7 @@ unsigned long do_mmap_pgoff(struct file 
@@ -34640 +34115 @@
-@@ -963,6 +1043,26 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -963,6 +1043,26 @@ unsigned long do_mmap_pgoff(struct file 
@@ -34667 +34142 @@
-@@ -975,6 +1075,7 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -975,6 +1075,7 @@ unsigned long do_mmap_pgoff(struct file 
@@ -34675 +34150 @@
-@@ -1043,6 +1144,9 @@ unsigned long do_mmap_pgoff(struct file * file, unsigned long addr,
+@@ -1043,6 +1144,9 @@ unsigned long do_mmap_pgoff(struct file 
@@ -34698 +34173 @@
-@@ -1093,14 +1197,24 @@ unsigned long mmap_region(struct file *file, unsigned long addr,
+@@ -1093,14 +1197,24 @@ unsigned long mmap_region(struct file *f
@@ -34813 +34288 @@
-@@ -1263,6 +1424,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -1263,6 +1424,10 @@ arch_get_unmapped_area(struct file *filp
@@ -34824 +34299 @@
-@@ -1271,10 +1436,10 @@ arch_get_unmapped_area(struct file *filp, unsigned long addr,
+@@ -1271,10 +1436,10 @@ arch_get_unmapped_area(struct file *filp
@@ -34868 +34343 @@
-@@ -1330,7 +1500,7 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -1330,7 +1500,7 @@ arch_get_unmapped_area_topdown(struct fi
@@ -34877 +34352 @@
-@@ -1339,6 +1509,10 @@ arch_get_unmapped_area_topdown(struct file *filp, const unsigned long addr0,
+@@ -1339,6 +1509,10 @@ arch_get_unmapped_area_topdown(struct fi
@@ -34925 +34400 @@
-@@ -1418,8 +1606,10 @@ void arch_unmap_area_topdown(struct mm_struct *mm, unsigned long addr)
+@@ -1418,8 +1606,10 @@ void arch_unmap_area_topdown(struct mm_s
@@ -34971 +34446 @@
-@@ -1535,6 +1752,7 @@ static int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, un
+@@ -1535,6 +1752,7 @@ static int acct_stack_growth(struct vm_a
@@ -34979 +34454 @@
-@@ -1544,6 +1762,7 @@ static int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, un
+@@ -1544,6 +1762,7 @@ static int acct_stack_growth(struct vm_a
@@ -34987 +34462 @@
-@@ -1558,7 +1777,7 @@ static int acct_stack_growth(struct vm_area_struct * vma, unsigned long size, un
+@@ -1558,7 +1777,7 @@ static int acct_stack_growth(struct vm_a
@@ -35047 +34522 @@
-@@ -1617,6 +1841,8 @@ int expand_upwards(struct vm_area_struct *vma, unsigned long address)
+@@ -1617,6 +1841,8 @@ int expand_upwards(struct vm_area_struct
@@ -35056 +34531 @@
-@@ -1628,7 +1854,8 @@ int expand_upwards(struct vm_area_struct *vma, unsigned long address)
+@@ -1628,7 +1854,8 @@ int expand_upwards(struct vm_area_struct
@@ -35066 +34541 @@
-@@ -1642,6 +1869,15 @@ static inline int expand_downwards(struct vm_area_struct *vma,
+@@ -1642,6 +1869,15 @@ static inline int expand_downwards(struc
@@ -35082 +34557 @@
-@@ -1651,9 +1887,15 @@ static inline int expand_downwards(struct vm_area_struct *vma,
+@@ -1651,9 +1887,15 @@ static inline int expand_downwards(struc
@@ -35099 +34574 @@
-@@ -1661,9 +1903,20 @@ static inline int expand_downwards(struct vm_area_struct *vma,
+@@ -1661,9 +1903,20 @@ static inline int expand_downwards(struc
@@ -35120 +34595 @@
-@@ -1735,6 +1988,13 @@ static void remove_vma_list(struct mm_struct *mm, struct vm_area_struct *vma)
+@@ -1735,6 +1988,13 @@ static void remove_vma_list(struct mm_st
@@ -35134 +34609 @@
-@@ -1781,6 +2041,16 @@ detach_vmas_to_be_unmapped(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -1781,6 +2041,16 @@ detach_vmas_to_be_unmapped(struct mm_str
@@ -35151 +34626 @@
-@@ -1800,6 +2070,108 @@ detach_vmas_to_be_unmapped(struct mm_struct *mm, struct vm_area_struct *vma,
+@@ -1800,6 +2070,108 @@ detach_vmas_to_be_unmapped(struct mm_str
@@ -35260 +34735 @@
-@@ -1850,17 +2222,37 @@ int split_vma(struct mm_struct * mm, struct vm_area_struct * vma,
+@@ -1850,17 +2222,37 @@ int split_vma(struct mm_struct * mm, str
@@ -35272,2 +34747,2 @@
- int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
- {
++int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
++{
@@ -35283 +34758 @@
-+int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
+ int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
@@ -35285 +34760 @@
-+{
+ {
@@ -35298 +34773 @@
-@@ -1910,6 +2302,8 @@ int do_munmap(struct mm_struct *mm, unsigned long start, size_t len)
+@@ -1910,6 +2302,8 @@ int do_munmap(struct mm_struct *mm, unsi
@@ -35307 +34782 @@
-@@ -1922,22 +2316,18 @@ asmlinkage long sys_munmap(unsigned long addr, size_t len)
+@@ -1922,22 +2316,18 @@ asmlinkage long sys_munmap(unsigned long
@@ -35336 +34811 @@
-@@ -1951,6 +2341,11 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -1951,6 +2341,11 @@ unsigned long do_brk(unsigned long addr,
@@ -35348 +34823 @@
-@@ -1968,19 +2363,34 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -1968,19 +2363,34 @@ unsigned long do_brk(unsigned long addr,
@@ -35384 +34859 @@
-@@ -1994,22 +2404,22 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -1994,22 +2404,22 @@ unsigned long do_brk(unsigned long addr,
@@ -35411 +34886 @@
-@@ -2022,10 +2432,21 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -2022,10 +2432,21 @@ unsigned long do_brk(unsigned long addr,
@@ -35434 +34909 @@
-@@ -2033,12 +2454,19 @@ unsigned long do_brk(unsigned long addr, unsigned long len)
+@@ -2033,12 +2454,19 @@ unsigned long do_brk(unsigned long addr,
@@ -35468 +34943 @@
-@@ -2084,6 +2514,10 @@ int insert_vm_struct(struct mm_struct * mm, struct vm_area_struct * vma)
+@@ -2084,6 +2514,10 @@ int insert_vm_struct(struct mm_struct * 
@@ -35479 +34954 @@
-@@ -2106,7 +2540,22 @@ int insert_vm_struct(struct mm_struct * mm, struct vm_area_struct * vma)
+@@ -2106,7 +2540,22 @@ int insert_vm_struct(struct mm_struct * 
@@ -35502 +34977 @@
-@@ -2124,6 +2573,8 @@ struct vm_area_struct *copy_vma(struct vm_area_struct **vmap,
+@@ -2124,6 +2573,8 @@ struct vm_area_struct *copy_vma(struct v
@@ -35511 +34986 @@
-@@ -2167,6 +2618,35 @@ struct vm_area_struct *copy_vma(struct vm_area_struct **vmap,
+@@ -2167,6 +2618,35 @@ struct vm_area_struct *copy_vma(struct v
@@ -35547 +35022 @@
-@@ -2177,7 +2657,7 @@ int may_expand_vm(struct mm_struct *mm, unsigned long npages)
+@@ -2177,7 +2657,7 @@ int may_expand_vm(struct mm_struct *mm, 
@@ -35556 +35031 @@
-@@ -2246,6 +2726,15 @@ int install_special_mapping(struct mm_struct *mm,
+@@ -2246,6 +2726,15 @@ int install_special_mapping(struct mm_st
@@ -35572,4 +35047,3 @@
-diff --git a/mm/mprotect.c b/mm/mprotect.c
-index a5bf31c273757848ae7614bd9fc3c8595c493705..7a57defa62d0468481a332e56bce0c74645ac794 100644
---- a/mm/mprotect.c
-+++ b/mm/mprotect.c
+diff -urNp linux-2.6.26.3/mm/mprotect.c linux-2.6.26.3/mm/mprotect.c
+--- linux-2.6.26.3/mm/mprotect.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/mprotect.c	2008-08-09 12:03:30.000000000 -0400
@@ -35594 +35068 @@
-@@ -134,6 +141,48 @@ static void change_protection(struct vm_area_struct *vma,
+@@ -134,6 +141,48 @@ static void change_protection(struct vm_
@@ -35643 +35117 @@
-@@ -146,6 +195,14 @@ mprotect_fixup(struct vm_area_struct *vma, struct vm_area_struct **pprev,
+@@ -146,6 +195,14 @@ mprotect_fixup(struct vm_area_struct *vm
@@ -35658 +35132 @@
-@@ -168,6 +225,38 @@ mprotect_fixup(struct vm_area_struct *vma, struct vm_area_struct **pprev,
+@@ -168,6 +225,38 @@ mprotect_fixup(struct vm_area_struct *vm
@@ -35768 +35242 @@
-@@ -239,6 +392,17 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -239,6 +392,17 @@ sys_mprotect(unsigned long start, size_t
@@ -35786 +35260 @@
-@@ -246,7 +410,7 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -246,7 +410,7 @@ sys_mprotect(unsigned long start, size_t
@@ -35795 +35269 @@
-@@ -278,6 +442,16 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -278,6 +442,16 @@ sys_mprotect(unsigned long start, size_t
@@ -35812 +35286 @@
-@@ -291,6 +465,12 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -291,6 +465,12 @@ sys_mprotect(unsigned long start, size_t
@@ -35825 +35299 @@
-@@ -301,6 +481,9 @@ sys_mprotect(unsigned long start, size_t len, unsigned long prot)
+@@ -301,6 +481,9 @@ sys_mprotect(unsigned long start, size_t
@@ -35835,5 +35309,4 @@
-diff --git a/mm/mremap.c b/mm/mremap.c
-index 08e3c7f2bd15a1b2e502aeb3e9f509148cb5dfa8..e75d87beae910d94591018b3f813e817399344e9 100644
---- a/mm/mremap.c
-+++ b/mm/mremap.c
-@@ -106,6 +106,12 @@ static void move_ptes(struct vm_area_struct *vma, pmd_t *old_pmd,
+diff -urNp linux-2.6.26.3/mm/mremap.c linux-2.6.26.3/mm/mremap.c
+--- linux-2.6.26.3/mm/mremap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/mremap.c	2008-08-09 12:03:30.000000000 -0400
+@@ -106,6 +106,12 @@ static void move_ptes(struct vm_area_str
@@ -35852 +35325 @@
-@@ -254,6 +260,7 @@ unsigned long do_mremap(unsigned long addr,
+@@ -254,6 +260,7 @@ unsigned long do_mremap(unsigned long ad
@@ -35860 +35333 @@
-@@ -272,6 +279,15 @@ unsigned long do_mremap(unsigned long addr,
+@@ -272,6 +279,15 @@ unsigned long do_mremap(unsigned long ad
@@ -35876 +35349 @@
-@@ -279,16 +295,13 @@ unsigned long do_mremap(unsigned long addr,
+@@ -279,16 +295,13 @@ unsigned long do_mremap(unsigned long ad
@@ -35895 +35368 @@
-@@ -326,6 +339,14 @@ unsigned long do_mremap(unsigned long addr,
+@@ -326,6 +339,14 @@ unsigned long do_mremap(unsigned long ad
@@ -35910 +35383 @@
-@@ -359,7 +380,7 @@ unsigned long do_mremap(unsigned long addr,
+@@ -359,7 +380,7 @@ unsigned long do_mremap(unsigned long ad
@@ -35919 +35392 @@
-@@ -377,6 +398,7 @@ unsigned long do_mremap(unsigned long addr,
+@@ -377,6 +398,7 @@ unsigned long do_mremap(unsigned long ad
@@ -35927 +35400 @@
-@@ -387,8 +409,8 @@ unsigned long do_mremap(unsigned long addr,
+@@ -387,8 +409,8 @@ unsigned long do_mremap(unsigned long ad
@@ -35937 +35410 @@
-@@ -403,7 +425,12 @@ unsigned long do_mremap(unsigned long addr,
+@@ -403,7 +425,12 @@ unsigned long do_mremap(unsigned long ad
@@ -35950,5 +35423,4 @@
-diff --git a/mm/nommu.c b/mm/nommu.c
-index 4462b6a3fcb984e9bd37a69ef7d377f0b5dd2367..41420f71efb7f994f7698dab51402d9c1f4d4afb 100644
---- a/mm/nommu.c
-+++ b/mm/nommu.c
-@@ -416,15 +416,6 @@ struct vm_area_struct *find_vma(struct mm_struct *mm, unsigned long addr)
+diff -urNp linux-2.6.26.3/mm/nommu.c linux-2.6.26.3/mm/nommu.c
+--- linux-2.6.26.3/mm/nommu.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/nommu.c	2008-08-09 12:03:30.000000000 -0400
+@@ -416,15 +416,6 @@ struct vm_area_struct *find_vma(struct m
@@ -35970,5 +35442,4 @@
-diff --git a/mm/page_alloc.c b/mm/page_alloc.c
-index f32fae3121f07461f846911ee6963ce679828780..a7edd88350d1b79e7fadb310f4c92b1ff93fd8dd 100644
---- a/mm/page_alloc.c
-+++ b/mm/page_alloc.c
-@@ -497,9 +497,20 @@ static void free_pages_bulk(struct zone *zone, int count,
+diff -urNp linux-2.6.26.3/mm/page_alloc.c linux-2.6.26.3/mm/page_alloc.c
+--- linux-2.6.26.3/mm/page_alloc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/page_alloc.c	2008-08-09 12:03:30.000000000 -0400
+@@ -497,9 +497,20 @@ static void free_pages_bulk(struct zone 
@@ -35995 +35466 @@
-@@ -617,8 +628,10 @@ static int prep_new_page(struct page *page, int order, gfp_t gfp_flags)
+@@ -617,8 +628,10 @@ static int prep_new_page(struct page *pa
@@ -36006 +35477 @@
-@@ -987,6 +1000,11 @@ static void free_hot_cold_page(struct page *page, int cold)
+@@ -987,6 +1000,11 @@ static void free_hot_cold_page(struct pa
@@ -36018,5 +35489,4 @@
-diff --git a/mm/rmap.c b/mm/rmap.c
-index bf0a5b7cfb8e7a97369271ed235a714bd11dfd12..4f2bf9f339bc838ab68997738c783d5c66c5c06b 100644
---- a/mm/rmap.c
-+++ b/mm/rmap.c
-@@ -64,6 +64,10 @@ int anon_vma_prepare(struct vm_area_struct *vma)
+diff -urNp linux-2.6.26.3/mm/rmap.c linux-2.6.26.3/mm/rmap.c
+--- linux-2.6.26.3/mm/rmap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/rmap.c	2008-08-09 12:03:30.000000000 -0400
+@@ -64,6 +64,10 @@ int anon_vma_prepare(struct vm_area_stru
@@ -36033 +35503 @@
-@@ -80,6 +84,15 @@ int anon_vma_prepare(struct vm_area_struct *vma)
+@@ -80,6 +84,15 @@ int anon_vma_prepare(struct vm_area_stru
@@ -36049,5 +35519,4 @@
-diff --git a/mm/shmem.c b/mm/shmem.c
-index 8f8412bab0fb9161451170152e4da333f104d359..7df67d52db8e3901dea92a8ea69ef2bf26ff89b8 100644
---- a/mm/shmem.c
-+++ b/mm/shmem.c
-@@ -2460,7 +2460,7 @@ static struct file_system_type tmpfs_fs_type = {
+diff -urNp linux-2.6.26.3/mm/shmem.c linux-2.6.26.3/mm/shmem.c
+--- linux-2.6.26.3/mm/shmem.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/shmem.c	2008-08-09 12:03:30.000000000 -0400
+@@ -2460,7 +2460,7 @@ static struct file_system_type tmpfs_fs_
@@ -36062,4 +35531,3 @@
-diff --git a/mm/slab.c b/mm/slab.c
-index 046607f05f3eb16414538201836c6e605135b0e8..ee492acfb15a9c64cf3eb1e2b68cdeacffdfaecd 100644
---- a/mm/slab.c
-+++ b/mm/slab.c
+diff -urNp linux-2.6.26.3/mm/slab.c linux-2.6.26.3/mm/slab.c
+--- linux-2.6.26.3/mm/slab.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/slab.c	2008-08-09 12:03:30.000000000 -0400
@@ -36102,4 +35570,3 @@
-diff --git a/mm/swap.c b/mm/swap.c
-index 45c9f25a8a3be7e2dccc6a6f807e0eaeade1e697..28ab96b88be9d93c294a2916aa225be2f567a65b 100644
---- a/mm/swap.c
-+++ b/mm/swap.c
+diff -urNp linux-2.6.26.3/mm/swap.c linux-2.6.26.3/mm/swap.c
+--- linux-2.6.26.3/mm/swap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/swap.c	2008-08-09 12:03:30.000000000 -0400
@@ -36119,5 +35586,4 @@
-diff --git a/mm/tiny-shmem.c b/mm/tiny-shmem.c
-index ae532f50194319ce83b813a88b6a25aa5a4e85e5..d0eb17eabd97029f54a55c479ed282e2aee61396 100644
---- a/mm/tiny-shmem.c
-+++ b/mm/tiny-shmem.c
-@@ -26,7 +26,7 @@ static struct file_system_type tmpfs_fs_type = {
+diff -urNp linux-2.6.26.3/mm/tiny-shmem.c linux-2.6.26.3/mm/tiny-shmem.c
+--- linux-2.6.26.3/mm/tiny-shmem.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/tiny-shmem.c	2008-08-09 12:03:30.000000000 -0400
+@@ -26,7 +26,7 @@ static struct file_system_type tmpfs_fs_
@@ -36132,5 +35598,4 @@
-diff --git a/mm/vmalloc.c b/mm/vmalloc.c
-index 6e45b0f3d1256e0bdc3a3caffa74597cf96a5138..151102568276a4ebab4f8b0c3f5f62489e6b3e85 100644
---- a/mm/vmalloc.c
-+++ b/mm/vmalloc.c
-@@ -248,20 +248,15 @@ __get_vm_area_node(unsigned long size, unsigned long flags, unsigned long start,
+diff -urNp linux-2.6.26.3/mm/vmalloc.c linux-2.6.26.3/mm/vmalloc.c
+--- linux-2.6.26.3/mm/vmalloc.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/mm/vmalloc.c	2008-08-09 12:54:30.000000000 -0400
+@@ -248,20 +248,15 @@ __get_vm_area_node(unsigned long size, u
@@ -36167,5 +35632,4 @@
-diff --git a/net/bridge/br_stp_if.c b/net/bridge/br_stp_if.c
-index 1a430eccec9b8a25aef64971e812f4ec3483b242..55089bec07cf2575da5f5234cd9138e6275d75c1 100644
---- a/net/bridge/br_stp_if.c
-+++ b/net/bridge/br_stp_if.c
-@@ -148,7 +148,7 @@ static void br_stp_stop(struct net_bridge *br)
+diff -urNp linux-2.6.26.3/net/bridge/br_stp_if.c linux-2.6.26.3/net/bridge/br_stp_if.c
+--- linux-2.6.26.3/net/bridge/br_stp_if.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/bridge/br_stp_if.c	2008-08-09 12:03:30.000000000 -0400
+@@ -148,7 +148,7 @@ static void br_stp_stop(struct net_bridg
@@ -36180,5 +35644,4 @@
-diff --git a/net/core/flow.c b/net/core/flow.c
-index 19991175fdeb4bca0f2e357ae7dfa5545dc72371..9375bb93958d4a1d568df4abd99afe68be7db897 100644
---- a/net/core/flow.c
-+++ b/net/core/flow.c
-@@ -39,7 +39,7 @@ atomic_t flow_cache_genid = ATOMIC_INIT(0);
+diff -urNp linux-2.6.26.3/net/core/flow.c linux-2.6.26.3/net/core/flow.c
+--- linux-2.6.26.3/net/core/flow.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/core/flow.c	2008-08-09 12:03:30.000000000 -0400
+@@ -39,7 +39,7 @@ atomic_t flow_cache_genid = ATOMIC_INIT(
@@ -36211,4 +35674,3 @@
-diff --git a/net/dccp/ccids/ccid3.c b/net/dccp/ccids/ccid3.c
-index a1929f33d7030a2ac91fe51c99b16a104070eeb7..db5fcf003e2cd23f4c381c19c16caad56dfbc6a3 100644
---- a/net/dccp/ccids/ccid3.c
-+++ b/net/dccp/ccids/ccid3.c
+diff -urNp linux-2.6.26.3/net/dccp/ccids/ccid3.c linux-2.6.26.3/net/dccp/ccids/ccid3.c
+--- linux-2.6.26.3/net/dccp/ccids/ccid3.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/dccp/ccids/ccid3.c	2008-08-09 12:03:30.000000000 -0400
@@ -36224,4 +35686,3 @@
-diff --git a/net/dccp/dccp.h b/net/dccp/dccp.h
-index f44d492d3b7491d5dbce8dec8cd6a49749bb068d..540e2ac446a1820a085dea13055ec2f198b1598b 100644
---- a/net/dccp/dccp.h
-+++ b/net/dccp/dccp.h
+diff -urNp linux-2.6.26.3/net/dccp/dccp.h linux-2.6.26.3/net/dccp/dccp.h
+--- linux-2.6.26.3/net/dccp/dccp.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/dccp/dccp.h	2008-08-09 12:03:30.000000000 -0400
@@ -36239,4 +35700,3 @@
-diff --git a/net/ipv4/inet_connection_sock.c b/net/ipv4/inet_connection_sock.c
-index ec834480abe727c3cfee6100824cf87a2f7284fa..6485ebb0dd832059a3ff8f8ccd862ed59a3a4a15 100644
---- a/net/ipv4/inet_connection_sock.c
-+++ b/net/ipv4/inet_connection_sock.c
+diff -urNp linux-2.6.26.3/net/ipv4/inet_connection_sock.c linux-2.6.26.3/net/ipv4/inet_connection_sock.c
+--- linux-2.6.26.3/net/ipv4/inet_connection_sock.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv4/inet_connection_sock.c	2008-08-09 12:03:30.000000000 -0400
@@ -36251,4 +35711,3 @@
-diff --git a/net/ipv4/inet_hashtables.c b/net/ipv4/inet_hashtables.c
-index 2023d37b2708ea12ea5e5a4cb6ae010697b8d386..de33fa69553ec9a9f77d1f0e8461259d0b008206 100644
---- a/net/ipv4/inet_hashtables.c
-+++ b/net/ipv4/inet_hashtables.c
+diff -urNp linux-2.6.26.3/net/ipv4/inet_hashtables.c linux-2.6.26.3/net/ipv4/inet_hashtables.c
+--- linux-2.6.26.3/net/ipv4/inet_hashtables.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv4/inet_hashtables.c	2008-08-09 12:03:30.000000000 -0400
@@ -36279,48 +35738,3 @@
-diff --git a/net/ipv4/netfilter/Kconfig b/net/ipv4/netfilter/Kconfig
-index 2767841a8cefc19377a96506e2f2c4e1c2db7586..65971f1ba58104e7ef320e714d6ef5691bd891e7 100644
---- a/net/ipv4/netfilter/Kconfig
-+++ b/net/ipv4/netfilter/Kconfig
-@@ -111,6 +111,21 @@ config IP_NF_MATCH_ADDRTYPE
- 	  If you want to compile it as a module, say M here and read
- 	  <file:Documentation/kbuild/modules.txt>.  If unsure, say `N'.
- 
-+config IP_NF_MATCH_STEALTH
-+	tristate "stealth match support"
-+	depends on IP_NF_IPTABLES
-+	help
-+	  Enabling this option will drop all syn packets coming to unserved tcp
-+	  ports as well as all packets coming to unserved udp ports.  If you
-+	  are using your system to route any type of packets (ie. via NAT)
-+	  you should put this module at the end of your ruleset, since it will
-+	  drop packets that aren't going to ports that are listening on your
-+	  machine itself, it doesn't take into account that the packet might be
-+	  destined for someone on your internal network if you're using NAT for
-+	  instance.
-+
-+	  To compile it as a module, choose M here.  If unsure, say N.
-+
- # `filter', generic and specific targets
- config IP_NF_FILTER
- 	tristate "Packet filtering"
-@@ -396,4 +411,3 @@ config IP_NF_ARP_MANGLE
- 	  hardware and network addresses.
- 
- endmenu
--
-diff --git a/net/ipv4/netfilter/Makefile b/net/ipv4/netfilter/Makefile
-index d9b92fbf5579583918a7d5f01a1ea3ce0184b60a..f5c827ab65659578ab29e94391e5f81201b7600b 100644
---- a/net/ipv4/netfilter/Makefile
-+++ b/net/ipv4/netfilter/Makefile
-@@ -58,6 +58,7 @@ obj-$(CONFIG_IP_NF_TARGET_MASQUERADE) += ipt_MASQUERADE.o
- obj-$(CONFIG_IP_NF_TARGET_NETMAP) += ipt_NETMAP.o
- obj-$(CONFIG_IP_NF_TARGET_REDIRECT) += ipt_REDIRECT.o
- obj-$(CONFIG_IP_NF_TARGET_REJECT) += ipt_REJECT.o
-+obj-$(CONFIG_IP_NF_MATCH_STEALTH) += ipt_stealth.o
- obj-$(CONFIG_IP_NF_TARGET_TTL) += ipt_TTL.o
- obj-$(CONFIG_IP_NF_TARGET_ULOG) += ipt_ULOG.o
- 
-diff --git a/net/ipv4/netfilter/ipt_stealth.c b/net/ipv4/netfilter/ipt_stealth.c
-new file mode 100644
-index 0000000000000000000000000000000000000000..6141a8207c2ac0cc1d009a54eec35b944d57e48f
---- /dev/null
-+++ b/net/ipv4/netfilter/ipt_stealth.c
+diff -urNp linux-2.6.26.3/net/ipv4/netfilter/ipt_stealth.c linux-2.6.26.3/net/ipv4/netfilter/ipt_stealth.c
+--- linux-2.6.26.3/net/ipv4/netfilter/ipt_stealth.c	1969-12-31 19:00:00.000000000 -0500
++++ linux-2.6.26.3/net/ipv4/netfilter/ipt_stealth.c	2008-08-09 12:03:30.000000000 -0400
@@ -36442,4 +35856,44 @@
-diff --git a/net/ipv4/tcp_ipv4.c b/net/ipv4/tcp_ipv4.c
-index ffe869ac1bcf15b51abd801b3b3b4533da0b530e..cd188dce4e890c30dec2b82ddf45e88b628311ae 100644
---- a/net/ipv4/tcp_ipv4.c
-+++ b/net/ipv4/tcp_ipv4.c
+diff -urNp linux-2.6.26.3/net/ipv4/netfilter/Kconfig linux-2.6.26.3/net/ipv4/netfilter/Kconfig
+--- linux-2.6.26.3/net/ipv4/netfilter/Kconfig	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv4/netfilter/Kconfig	2008-08-09 12:03:30.000000000 -0400
+@@ -111,6 +111,21 @@ config IP_NF_MATCH_ADDRTYPE
+ 	  If you want to compile it as a module, say M here and read
+ 	  <file:Documentation/kbuild/modules.txt>.  If unsure, say `N'.
+ 
++config IP_NF_MATCH_STEALTH
++	tristate "stealth match support"
++	depends on IP_NF_IPTABLES
++	help
++	  Enabling this option will drop all syn packets coming to unserved tcp
++	  ports as well as all packets coming to unserved udp ports.  If you
++	  are using your system to route any type of packets (ie. via NAT)
++	  you should put this module at the end of your ruleset, since it will
++	  drop packets that aren't going to ports that are listening on your
++	  machine itself, it doesn't take into account that the packet might be
++	  destined for someone on your internal network if you're using NAT for
++	  instance.
++
++	  To compile it as a module, choose M here.  If unsure, say N.
++
+ # `filter', generic and specific targets
+ config IP_NF_FILTER
+ 	tristate "Packet filtering"
+@@ -396,4 +411,3 @@ config IP_NF_ARP_MANGLE
+ 	  hardware and network addresses.
+ 
+ endmenu
+-
+diff -urNp linux-2.6.26.3/net/ipv4/netfilter/Makefile linux-2.6.26.3/net/ipv4/netfilter/Makefile
+--- linux-2.6.26.3/net/ipv4/netfilter/Makefile	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv4/netfilter/Makefile	2008-08-09 12:03:30.000000000 -0400
+@@ -58,6 +58,7 @@ obj-$(CONFIG_IP_NF_TARGET_MASQUERADE) +=
+ obj-$(CONFIG_IP_NF_TARGET_NETMAP) += ipt_NETMAP.o
+ obj-$(CONFIG_IP_NF_TARGET_REDIRECT) += ipt_REDIRECT.o
+ obj-$(CONFIG_IP_NF_TARGET_REJECT) += ipt_REJECT.o
++obj-$(CONFIG_IP_NF_MATCH_STEALTH) += ipt_stealth.o
+ obj-$(CONFIG_IP_NF_TARGET_TTL) += ipt_TTL.o
+ obj-$(CONFIG_IP_NF_TARGET_ULOG) += ipt_ULOG.o
+ 
+diff -urNp linux-2.6.26.3/net/ipv4/tcp_ipv4.c linux-2.6.26.3/net/ipv4/tcp_ipv4.c
+--- linux-2.6.26.3/net/ipv4/tcp_ipv4.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv4/tcp_ipv4.c	2008-08-09 12:03:30.000000000 -0400
@@ -36454,4 +35908,3 @@
-diff --git a/net/ipv4/udp.c b/net/ipv4/udp.c
-index 9f3f7bade279a5081813ca39358c5f306195f2ee..ea18a468718ea282dfa66d9decd98d0ac7f81c4f 100644
---- a/net/ipv4/udp.c
-+++ b/net/ipv4/udp.c
+diff -urNp linux-2.6.26.3/net/ipv4/udp.c linux-2.6.26.3/net/ipv4/udp.c
+--- linux-2.6.26.3/net/ipv4/udp.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv4/udp.c	2008-08-09 12:03:30.000000000 -0400
@@ -36478 +35931 @@
-@@ -307,6 +313,13 @@ static struct sock *__udp4_lib_lookup(struct net *net, __be32 saddr,
+@@ -307,6 +313,13 @@ static struct sock *__udp4_lib_lookup(st
@@ -36492 +35945 @@
-@@ -594,9 +607,16 @@ int udp_sendmsg(struct kiocb *iocb, struct sock *sk, struct msghdr *msg,
+@@ -594,9 +607,16 @@ int udp_sendmsg(struct kiocb *iocb, stru
@@ -36521,5 +35974,4 @@
-diff --git a/net/ipv6/exthdrs.c b/net/ipv6/exthdrs.c
-index dcf94fdfb863889bf1a9729010f4ffa3a6c3696a..cecfd27a47270f2a13c60a7e4432070277490112 100644
---- a/net/ipv6/exthdrs.c
-+++ b/net/ipv6/exthdrs.c
-@@ -626,7 +626,7 @@ static struct tlvtype_proc tlvprochopopt_lst[] = {
+diff -urNp linux-2.6.26.3/net/ipv6/exthdrs.c linux-2.6.26.3/net/ipv6/exthdrs.c
+--- linux-2.6.26.3/net/ipv6/exthdrs.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv6/exthdrs.c	2008-08-09 12:03:30.000000000 -0400
+@@ -626,7 +626,7 @@ static struct tlvtype_proc tlvprochopopt
@@ -36534,4 +35986,3 @@
-diff --git a/net/ipv6/raw.c b/net/ipv6/raw.c
-index 3aee12310d946e8bb882b929c89c991791ff1d85..06d503235c0df22104e5c51768d3f8634388b981 100644
---- a/net/ipv6/raw.c
-+++ b/net/ipv6/raw.c
+diff -urNp linux-2.6.26.3/net/ipv6/raw.c linux-2.6.26.3/net/ipv6/raw.c
+--- linux-2.6.26.3/net/ipv6/raw.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/ipv6/raw.c	2008-08-09 12:03:30.000000000 -0400
@@ -36547,5 +35998,4 @@
-diff --git a/net/irda/ircomm/ircomm_tty.c b/net/irda/ircomm/ircomm_tty.c
-index 76c3057d01790c23ae1e1055e6927cf6c2d2a6a0..0b92324ed1c0d3d62ed5d155231ebefa69a075fc 100644
---- a/net/irda/ircomm/ircomm_tty.c
-+++ b/net/irda/ircomm/ircomm_tty.c
-@@ -371,7 +371,7 @@ static int ircomm_tty_open(struct tty_struct *tty, struct file *filp)
+diff -urNp linux-2.6.26.3/net/irda/ircomm/ircomm_tty.c linux-2.6.26.3/net/irda/ircomm/ircomm_tty.c
+--- linux-2.6.26.3/net/irda/ircomm/ircomm_tty.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/irda/ircomm/ircomm_tty.c	2008-08-09 12:03:30.000000000 -0400
+@@ -371,7 +371,7 @@ static int ircomm_tty_open(struct tty_st
@@ -36560,5 +36010,4 @@
-diff --git a/net/sctp/socket.c b/net/sctp/socket.c
-index 0dbcde6758ea3158216e37af50df35ea56c37135..eeb0a6546a566f5b2857e48f31842dba48cf4993 100644
---- a/net/sctp/socket.c
-+++ b/net/sctp/socket.c
-@@ -1386,7 +1386,7 @@ SCTP_STATIC int sctp_sendmsg(struct kiocb *iocb, struct sock *sk,
+diff -urNp linux-2.6.26.3/net/sctp/socket.c linux-2.6.26.3/net/sctp/socket.c
+--- linux-2.6.26.3/net/sctp/socket.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/sctp/socket.c	2008-08-09 12:03:30.000000000 -0400
+@@ -1386,7 +1386,7 @@ SCTP_STATIC int sctp_sendmsg(struct kioc
@@ -36573,4 +36022,3 @@
-diff --git a/net/socket.c b/net/socket.c
-index 66c4a8cf6db9d2d2886e013cf3904d5527c7438d..3ffbf1b32026f897845bb139769a2b8dc2c305be 100644
---- a/net/socket.c
-+++ b/net/socket.c
+diff -urNp linux-2.6.26.3/net/socket.c linux-2.6.26.3/net/socket.c
+--- linux-2.6.26.3/net/socket.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/socket.c	2008-08-09 12:03:30.000000000 -0400
@@ -36607 +36055 @@
-@@ -297,7 +313,7 @@ static int sockfs_get_sb(struct file_system_type *fs_type,
+@@ -297,7 +313,7 @@ static int sockfs_get_sb(struct file_sys
@@ -36616 +36064 @@
-@@ -1218,6 +1234,16 @@ asmlinkage long sys_socket(int family, int type, int protocol)
+@@ -1218,6 +1234,16 @@ asmlinkage long sys_socket(int family, i
@@ -36633 +36081 @@
-@@ -1348,6 +1374,12 @@ asmlinkage long sys_bind(int fd, struct sockaddr __user *umyaddr, int addrlen)
+@@ -1348,6 +1374,12 @@ asmlinkage long sys_bind(int fd, struct 
@@ -36646 +36094 @@
-@@ -1356,6 +1388,7 @@ asmlinkage long sys_bind(int fd, struct sockaddr __user *umyaddr, int addrlen)
+@@ -1356,6 +1388,7 @@ asmlinkage long sys_bind(int fd, struct 
@@ -36654 +36102 @@
-@@ -1379,10 +1412,17 @@ asmlinkage long sys_listen(int fd, int backlog)
+@@ -1379,10 +1412,17 @@ asmlinkage long sys_listen(int fd, int b
@@ -36672 +36120 @@
-@@ -1419,6 +1459,13 @@ asmlinkage long sys_accept(int fd, struct sockaddr __user *upeer_sockaddr,
+@@ -1419,6 +1459,13 @@ asmlinkage long sys_accept(int fd, struc
@@ -36686 +36134 @@
-@@ -1462,6 +1509,7 @@ asmlinkage long sys_accept(int fd, struct sockaddr __user *upeer_sockaddr,
+@@ -1462,6 +1509,7 @@ asmlinkage long sys_accept(int fd, struc
@@ -36694 +36142 @@
-@@ -1495,6 +1543,7 @@ asmlinkage long sys_connect(int fd, struct sockaddr __user *uservaddr,
+@@ -1495,6 +1543,7 @@ asmlinkage long sys_connect(int fd, stru
@@ -36702 +36150 @@
-@@ -1504,6 +1553,13 @@ asmlinkage long sys_connect(int fd, struct sockaddr __user *uservaddr,
+@@ -1504,6 +1553,13 @@ asmlinkage long sys_connect(int fd, stru
@@ -36716 +36164 @@
-@@ -1770,6 +1826,7 @@ asmlinkage long sys_shutdown(int fd, int how)
+@@ -1770,6 +1826,7 @@ asmlinkage long sys_shutdown(int fd, int
@@ -36724,4 +36172,3 @@
-diff --git a/net/unix/af_unix.c b/net/unix/af_unix.c
-index 783317dacd3090f7d602b3c56e82859f3cc22a46..783d94dac0eb2054cc19c81813b67cd56248e3fa 100644
---- a/net/unix/af_unix.c
-+++ b/net/unix/af_unix.c
+diff -urNp linux-2.6.26.3/net/unix/af_unix.c linux-2.6.26.3/net/unix/af_unix.c
+--- linux-2.6.26.3/net/unix/af_unix.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/net/unix/af_unix.c	2008-08-09 12:03:30.000000000 -0400
@@ -36736 +36183 @@
-@@ -727,6 +728,12 @@ static struct sock *unix_find_other(struct net *net,
+@@ -727,6 +728,12 @@ static struct sock *unix_find_other(stru
@@ -36749 +36196 @@
-@@ -747,6 +754,13 @@ static struct sock *unix_find_other(struct net *net,
+@@ -747,6 +754,13 @@ static struct sock *unix_find_other(stru
@@ -36763 +36210 @@
-@@ -829,10 +843,20 @@ static int unix_bind(struct socket *sock, struct sockaddr *uaddr, int addr_len)
+@@ -829,10 +843,20 @@ static int unix_bind(struct socket *sock
@@ -36784 +36231 @@
-@@ -850,6 +874,10 @@ static int unix_bind(struct socket *sock, struct sockaddr *uaddr, int addr_len)
+@@ -850,6 +874,10 @@ static int unix_bind(struct socket *sock
@@ -36795,4 +36242,3 @@
-diff --git a/scripts/pnmtologo.c b/scripts/pnmtologo.c
-index 6aa2a2483f8df04abe75421f28d8deca7cff42c3..c45c7ba03dd534ae91234a2c03be4c5d028eb843 100644
---- a/scripts/pnmtologo.c
-+++ b/scripts/pnmtologo.c
+diff -urNp linux-2.6.26.3/scripts/pnmtologo.c linux-2.6.26.3/scripts/pnmtologo.c
+--- linux-2.6.26.3/scripts/pnmtologo.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/scripts/pnmtologo.c	2008-08-09 12:03:30.000000000 -0400
@@ -36825,4 +36271,95 @@
-diff --git a/security/Kconfig b/security/Kconfig
-index 49b51f964897dcb7133be9b58f1b936462bb6309..a698a7603932b22b249d2a1a6024ce8b1a64fe55 100644
---- a/security/Kconfig
-+++ b/security/Kconfig
+diff -urNp linux-2.6.26.3/security/commoncap.c linux-2.6.26.3/security/commoncap.c
+--- linux-2.6.26.3/security/commoncap.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/security/commoncap.c	2008-08-09 12:03:30.000000000 -0400
+@@ -26,10 +26,13 @@
+ #include <linux/sched.h>
+ #include <linux/prctl.h>
+ #include <linux/securebits.h>
++#include <linux/grsecurity.h>
++
++extern kernel_cap_t gr_cap_rtnetlink(struct sock *sk);
+ 
+ int cap_netlink_send(struct sock *sk, struct sk_buff *skb)
+ {
+-	NETLINK_CB(skb).eff_cap = current->cap_effective;
++	NETLINK_CB(skb).eff_cap = gr_cap_rtnetlink(sk);
+ 	return 0;
+ }
+ 
+@@ -51,7 +54,15 @@ EXPORT_SYMBOL(cap_netlink_recv);
+ int cap_capable (struct task_struct *tsk, int cap)
+ {
+ 	/* Derived from include/linux/sched.h:capable. */
+-	if (cap_raised(tsk->cap_effective, cap))
++	if (cap_raised (tsk->cap_effective, cap))
++		return 0;
++	return -EPERM;
++}
++
++int cap_capable_nolog (struct task_struct *tsk, int cap)
++{
++	/* tsk = current for all callers */
++	if (cap_raised(tsk->cap_effective, cap) && gr_is_capable_nolog(cap))
+ 		return 0;
+ 	return -EPERM;
+ }
+@@ -356,8 +367,11 @@ void cap_bprm_apply_creds (struct linux_
+ 		}
+ 	}
+ 
+-	current->suid = current->euid = current->fsuid = bprm->e_uid;
+-	current->sgid = current->egid = current->fsgid = bprm->e_gid;
++	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
++		current->suid = current->euid = current->fsuid = bprm->e_uid;
++
++	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
++		current->sgid = current->egid = current->fsgid = bprm->e_gid;
+ 
+ 	/* For init, we want to retain the capabilities set
+ 	 * in the init_task struct. Thus we skip the usual
+@@ -370,6 +384,8 @@ void cap_bprm_apply_creds (struct linux_
+ 			cap_clear(current->cap_effective);
+ 	}
+ 
++	gr_handle_chroot_caps(current);
++
+ 	/* AUD: Audit candidate if current->cap_effective is set */
+ 
+ 	current->securebits &= ~issecure_mask(SECURE_KEEP_CAPS);
+@@ -684,7 +700,7 @@ int cap_vm_enough_memory(struct mm_struc
+ {
+ 	int cap_sys_admin = 0;
+ 
+-	if (cap_capable(current, CAP_SYS_ADMIN) == 0)
++	if (cap_capable_nolog(current, CAP_SYS_ADMIN) == 0)
+ 		cap_sys_admin = 1;
+ 	return __vm_enough_memory(mm, pages, cap_sys_admin);
+ }
+diff -urNp linux-2.6.26.3/security/dummy.c linux-2.6.26.3/security/dummy.c
+--- linux-2.6.26.3/security/dummy.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/security/dummy.c	2008-08-09 12:03:30.000000000 -0400
+@@ -29,6 +29,7 @@
+ #include <linux/file.h>
+ #include <linux/prctl.h>
+ #include <linux/securebits.h>
++#include <linux/grsecurity.h>
+ 
+ static int dummy_ptrace (struct task_struct *parent, struct task_struct *child)
+ {
+@@ -142,8 +143,11 @@ static void dummy_bprm_apply_creds (stru
+ 		}
+ 	}
+ 
+-	current->suid = current->euid = current->fsuid = bprm->e_uid;
+-	current->sgid = current->egid = current->fsgid = bprm->e_gid;
++	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
++		current->suid = current->euid = current->fsuid = bprm->e_uid;
++
++	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
++		current->sgid = current->egid = current->fsgid = bprm->e_gid;
+ 
+ 	dummy_capget(current, &current->cap_effective, &current->cap_inheritable, &current->cap_permitted);
+ }
+diff -urNp linux-2.6.26.3/security/Kconfig linux-2.6.26.3/security/Kconfig
+--- linux-2.6.26.3/security/Kconfig	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/security/Kconfig	2008-08-09 12:54:30.000000000 -0400
@@ -37277,99 +36814,4 @@
-diff --git a/security/commoncap.c b/security/commoncap.c
-index 33d34330841344f7329e1b1f313cc531c65aa7a9..5f4f145aaf1a93903749117dd076d44412ec65ca 100644
---- a/security/commoncap.c
-+++ b/security/commoncap.c
-@@ -26,10 +26,13 @@
- #include <linux/sched.h>
- #include <linux/prctl.h>
- #include <linux/securebits.h>
-+#include <linux/grsecurity.h>
-+
-+extern kernel_cap_t gr_cap_rtnetlink(struct sock *sk);
- 
- int cap_netlink_send(struct sock *sk, struct sk_buff *skb)
- {
--	NETLINK_CB(skb).eff_cap = current->cap_effective;
-+	NETLINK_CB(skb).eff_cap = gr_cap_rtnetlink(sk);
- 	return 0;
- }
- 
-@@ -51,7 +54,15 @@ EXPORT_SYMBOL(cap_netlink_recv);
- int cap_capable (struct task_struct *tsk, int cap)
- {
- 	/* Derived from include/linux/sched.h:capable. */
--	if (cap_raised(tsk->cap_effective, cap))
-+	if (cap_raised (tsk->cap_effective, cap))
-+		return 0;
-+	return -EPERM;
-+}
-+
-+int cap_capable_nolog (struct task_struct *tsk, int cap)
-+{
-+	/* tsk = current for all callers */
-+	if (cap_raised(tsk->cap_effective, cap) && gr_is_capable_nolog(cap))
- 		return 0;
- 	return -EPERM;
- }
-@@ -356,8 +367,11 @@ void cap_bprm_apply_creds (struct linux_binprm *bprm, int unsafe)
- 		}
- 	}
- 
--	current->suid = current->euid = current->fsuid = bprm->e_uid;
--	current->sgid = current->egid = current->fsgid = bprm->e_gid;
-+	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
-+		current->suid = current->euid = current->fsuid = bprm->e_uid;
-+
-+	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
-+		current->sgid = current->egid = current->fsgid = bprm->e_gid;
- 
- 	/* For init, we want to retain the capabilities set
- 	 * in the init_task struct. Thus we skip the usual
-@@ -370,6 +384,8 @@ void cap_bprm_apply_creds (struct linux_binprm *bprm, int unsafe)
- 			cap_clear(current->cap_effective);
- 	}
- 
-+	gr_handle_chroot_caps(current);
-+
- 	/* AUD: Audit candidate if current->cap_effective is set */
- 
- 	current->securebits &= ~issecure_mask(SECURE_KEEP_CAPS);
-@@ -684,7 +700,7 @@ int cap_vm_enough_memory(struct mm_struct *mm, long pages)
- {
- 	int cap_sys_admin = 0;
- 
--	if (cap_capable(current, CAP_SYS_ADMIN) == 0)
-+	if (cap_capable_nolog(current, CAP_SYS_ADMIN) == 0)
- 		cap_sys_admin = 1;
- 	return __vm_enough_memory(mm, pages, cap_sys_admin);
- }
-diff --git a/security/dummy.c b/security/dummy.c
-index b8916883b77f0c0cdc495e979edcf5775818272d..84342a8ff79e303e398e15f7c4ec9138e0d9915c 100644
---- a/security/dummy.c
-+++ b/security/dummy.c
-@@ -29,6 +29,7 @@
- #include <linux/file.h>
- #include <linux/prctl.h>
- #include <linux/securebits.h>
-+#include <linux/grsecurity.h>
- 
- static int dummy_ptrace (struct task_struct *parent, struct task_struct *child)
- {
-@@ -142,8 +143,11 @@ static void dummy_bprm_apply_creds (struct linux_binprm *bprm, int unsafe)
- 		}
- 	}
- 
--	current->suid = current->euid = current->fsuid = bprm->e_uid;
--	current->sgid = current->egid = current->fsgid = bprm->e_gid;
-+	if (!gr_check_user_change(-1, bprm->e_uid, bprm->e_uid))
-+		current->suid = current->euid = current->fsuid = bprm->e_uid;
-+
-+	if (!gr_check_group_change(-1, bprm->e_gid, bprm->e_gid))
-+		current->sgid = current->egid = current->fsgid = bprm->e_gid;
- 
- 	dummy_capget(current, &current->cap_effective, &current->cap_inheritable, &current->cap_permitted);
- }
-diff --git a/sound/core/oss/pcm_oss.c b/sound/core/oss/pcm_oss.c
-index 4c601b192ddf3feb4117186d230a73f4538f1723..f5975895e162a85e9cd65c29109dae3cf3c7b6a0 100644
---- a/sound/core/oss/pcm_oss.c
-+++ b/sound/core/oss/pcm_oss.c
-@@ -2911,8 +2911,8 @@ static void snd_pcm_oss_proc_done(struct snd_pcm *pcm)
+diff -urNp linux-2.6.26.3/sound/core/oss/pcm_oss.c linux-2.6.26.3/sound/core/oss/pcm_oss.c
+--- linux-2.6.26.3/sound/core/oss/pcm_oss.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/sound/core/oss/pcm_oss.c	2008-08-09 12:03:30.000000000 -0400
+@@ -2911,8 +2911,8 @@ static void snd_pcm_oss_proc_done(struct
@@ -37386,5 +36828,4 @@
-diff --git a/sound/core/seq/seq_lock.h b/sound/core/seq/seq_lock.h
-index 54044bc2c9ef24892a7e6747dcd67e92fb01b0f1..75df3ef63512290c8cd8028c6b0d9b6117e0e97b 100644
---- a/sound/core/seq/seq_lock.h
-+++ b/sound/core/seq/seq_lock.h
-@@ -23,10 +23,10 @@ void snd_use_lock_sync_helper(snd_use_lock_t *lock, const char *file, int line);
+diff -urNp linux-2.6.26.3/sound/core/seq/seq_lock.h linux-2.6.26.3/sound/core/seq/seq_lock.h
+--- linux-2.6.26.3/sound/core/seq/seq_lock.h	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/sound/core/seq/seq_lock.h	2008-08-09 12:03:30.000000000 -0400
+@@ -23,10 +23,10 @@ void snd_use_lock_sync_helper(snd_use_lo
@@ -37405,5 +36846,4 @@
-diff --git a/sound/pci/ac97/ac97_patch.c b/sound/pci/ac97/ac97_patch.c
-index 1292dcee072df21b34aa39daecaee841a429dfe0..4997be3c55d52354481e4f48579b04d8c0aa617a 100644
---- a/sound/pci/ac97/ac97_patch.c
-+++ b/sound/pci/ac97/ac97_patch.c
-@@ -1497,7 +1497,7 @@ static const struct snd_ac97_res_table ad1819_restbl[] = {
+diff -urNp linux-2.6.26.3/sound/pci/ac97/ac97_patch.c linux-2.6.26.3/sound/pci/ac97/ac97_patch.c
+--- linux-2.6.26.3/sound/pci/ac97/ac97_patch.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/sound/pci/ac97/ac97_patch.c	2008-08-09 12:03:30.000000000 -0400
+@@ -1497,7 +1497,7 @@ static const struct snd_ac97_res_table a
@@ -37418 +36858 @@
-@@ -3591,7 +3591,7 @@ static struct snd_ac97_res_table lm4550_restbl[] = {
+@@ -3591,7 +3591,7 @@ static struct snd_ac97_res_table lm4550_
@@ -37427,5 +36867,4 @@
-diff --git a/sound/pci/ens1370.c b/sound/pci/ens1370.c
-index fbf1124f7c79d1609f594fdb786e0ec0e0b676ac..35335238a3b12a8e25bf269dac78d3345adc270b 100644
---- a/sound/pci/ens1370.c
-+++ b/sound/pci/ens1370.c
-@@ -452,7 +452,7 @@ static struct pci_device_id snd_audiopci_ids[] = {
+diff -urNp linux-2.6.26.3/sound/pci/ens1370.c linux-2.6.26.3/sound/pci/ens1370.c
+--- linux-2.6.26.3/sound/pci/ens1370.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/sound/pci/ens1370.c	2008-08-09 12:03:30.000000000 -0400
+@@ -452,7 +452,7 @@ static struct pci_device_id snd_audiopci
@@ -37440,5 +36879,4 @@
-diff --git a/sound/pci/intel8x0.c b/sound/pci/intel8x0.c
-index 048d99e25ab0f0010ea1f4c7a7a06b553e1449d6..0b42d0f08d7b71d7b95973d45396b2e1e48d7cec 100644
---- a/sound/pci/intel8x0.c
-+++ b/sound/pci/intel8x0.c
-@@ -437,7 +437,7 @@ static struct pci_device_id snd_intel8x0_ids[] = {
+diff -urNp linux-2.6.26.3/sound/pci/intel8x0.c linux-2.6.26.3/sound/pci/intel8x0.c
+--- linux-2.6.26.3/sound/pci/intel8x0.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/sound/pci/intel8x0.c	2008-08-09 12:03:30.000000000 -0400
+@@ -437,7 +437,7 @@ static struct pci_device_id snd_intel8x0
@@ -37453 +36891 @@
-@@ -2076,7 +2076,7 @@ static struct ac97_quirk ac97_quirks[] __devinitdata = {
+@@ -2076,7 +2076,7 @@ static struct ac97_quirk ac97_quirks[] _
@@ -37462,5 +36900,4 @@
-diff --git a/sound/pci/intel8x0m.c b/sound/pci/intel8x0m.c
-index faf674e671aca3c1432cf4d04860bb69f210d5df..e84fd5d8a27f11d0417873f4c22e6bf6c831be8a 100644
---- a/sound/pci/intel8x0m.c
-+++ b/sound/pci/intel8x0m.c
-@@ -239,7 +239,7 @@ static struct pci_device_id snd_intel8x0m_ids[] = {
+diff -urNp linux-2.6.26.3/sound/pci/intel8x0m.c linux-2.6.26.3/sound/pci/intel8x0m.c
+--- linux-2.6.26.3/sound/pci/intel8x0m.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/sound/pci/intel8x0m.c	2008-08-09 12:03:30.000000000 -0400
+@@ -239,7 +239,7 @@ static struct pci_device_id snd_intel8x0
@@ -37484,4 +36921,3 @@
-diff --git a/virt/kvm/kvm_main.c b/virt/kvm/kvm_main.c
-index 02628471365b95645fc8ae9cb656b3d99f8c1648..0aebe5db7a47707db5021c7ebd88abc340410313 100644
---- a/virt/kvm/kvm_main.c
-+++ b/virt/kvm/kvm_main.c
+diff -urNp linux-2.6.26.3/virt/kvm/kvm_main.c linux-2.6.26.3/virt/kvm/kvm_main.c
+--- linux-2.6.26.3/virt/kvm/kvm_main.c	2008-08-06 12:19:01.000000000 -0400
++++ linux-2.6.26.3/virt/kvm/kvm_main.c	2008-08-09 12:03:31.000000000 -0400
